THREE={},THREE.Math={clamp:function(E,n,t){return E>t?t:E<n?n:E}};
THREE.Vector3=function(t,i,s){this.x=t||0,this.y=i||0,this.z=s||0},THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(t,i,s){return this.x=t,this.y=i,this.z=s,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+t)}},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,i){return void 0!==i?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,i)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this},addScaledVector:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this},sub:function(t,i){return void 0!==i?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,i)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this},multiply:function(t,i){return void 0!==i?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,i)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return isFinite(t)?(this.x*=t,this.y*=t,this.z*=t):(this.x=0,this.y=0,this.z=0),this},multiplyVectors:function(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this},applyEuler:function(){var t;return function(i){return i instanceof THREE.Euler==!1&&console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),void 0===t&&(t=new THREE.Quaternion),this.applyQuaternion(t.setFromEuler(i))}}(),applyAxisAngle:function(){var t;return function(i,s){return void 0===t&&(t=new THREE.Quaternion),this.applyQuaternion(t.setFromAxisAngle(i,s))}}(),applyMatrix3:function(t){var i=this.x,s=this.y,n=this.z,r=t.elements;return this.x=r[0]*i+r[3]*s+r[6]*n,this.y=r[1]*i+r[4]*s+r[7]*n,this.z=r[2]*i+r[5]*s+r[8]*n,this},applyMatrix4:function(t){var i=this.x,s=this.y,n=this.z,r=t.elements;return this.x=r[0]*i+r[4]*s+r[8]*n+r[12],this.y=r[1]*i+r[5]*s+r[9]*n+r[13],this.z=r[2]*i+r[6]*s+r[10]*n+r[14],this},applyProjection:function(t){var i=this.x,s=this.y,n=this.z,r=t.elements,h=1/(r[3]*i+r[7]*s+r[11]*n+r[15]);return this.x=(r[0]*i+r[4]*s+r[8]*n+r[12])*h,this.y=(r[1]*i+r[5]*s+r[9]*n+r[13])*h,this.z=(r[2]*i+r[6]*s+r[10]*n+r[14])*h,this},applyQuaternion:function(t){var i=this.x,s=this.y,n=this.z,r=t.x,h=t.y,e=t.z,o=t.w,a=o*i+h*n-e*s,u=o*s+e*i-r*n,c=o*n+r*s-h*i,y=-r*i-h*s-e*n;return this.x=a*o+y*-r+u*-e-c*-h,this.y=u*o+y*-h+c*-r-a*-e,this.z=c*o+y*-e+a*-h-u*-r,this},project:function(){var t;return function(i){return void 0===t&&(t=new THREE.Matrix4),t.multiplyMatrices(i.projectionMatrix,t.getInverse(i.matrixWorld)),this.applyProjection(t)}}(),unproject:function(){var t;return function(i){return void 0===t&&(t=new THREE.Matrix4),t.multiplyMatrices(i.matrixWorld,t.getInverse(i.projectionMatrix)),this.applyProjection(t)}}(),transformDirection:function(t){var i=this.x,s=this.y,n=this.z,r=t.elements;return this.x=r[0]*i+r[4]*s+r[8]*n,this.y=r[1]*i+r[5]*s+r[9]*n,this.z=r[2]*i+r[6]*s+r[10]*n,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this},clampScalar:function(){var t,i;return function(s,n){return void 0===t&&(t=new THREE.Vector3,i=new THREE.Vector3),t.set(s,s,s),i.set(n,n,n),this.clamp(t,i)}}(),clampLength:function(t,i){var s=this.length();return this.multiplyScalar(Math.max(t,Math.min(i,s))/s)},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){return this.multiplyScalar(t/this.length())},lerp:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this},lerpVectors:function(t,i,s){return this.subVectors(i,t).multiplyScalar(s).add(t)},cross:function(t,i){if(void 0!==i)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,i);var s=this.x,n=this.y,r=this.z;return this.x=n*t.z-r*t.y,this.y=r*t.x-s*t.z,this.z=s*t.y-n*t.x,this},crossVectors:function(t,i){var s=t.x,n=t.y,r=t.z,h=i.x,e=i.y,o=i.z;return this.x=n*o-r*e,this.y=r*h-s*o,this.z=s*e-n*h,this},projectOnVector:function(t){var i=t.dot(this)/t.lengthSq();return this.copy(t).multiplyScalar(i)},projectOnPlane:function(){var t;return function(i){return void 0===t&&(t=new THREE.Vector3),t.copy(this).projectOnVector(i),this.sub(t)}}(),reflect:function(){var t;return function(i){return void 0===t&&(t=new THREE.Vector3),this.sub(t.copy(i).multiplyScalar(2*this.dot(i)))}}(),angleTo:function(t){var i=this.dot(t)/Math.sqrt(this.lengthSq()*t.lengthSq());return Math.acos(THREE.Math.clamp(i,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var i=this.x-t.x,s=this.y-t.y,n=this.z-t.z;return i*i+s*s+n*n},distanceToManhattan:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){var i=Math.sin(t.phi)*t.radius;return this.x=i*Math.sin(t.theta),this.y=Math.cos(t.phi)*t.radius,this.z=i*Math.cos(t.theta),this},setFromMatrixPosition:function(t){return this.setFromMatrixColumn(t,3)},setFromMatrixScale:function(t){var i=this.setFromMatrixColumn(t,0).length(),s=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=i,this.y=s,this.z=n,this},setFromMatrixColumn:function(t,i){if("number"==typeof t){console.warn("THREE.Vector3: setFromMatrixColumn now expects ( matrix, index ).");var s=t;t=i,i=s}return this.fromArray(t.elements,4*i)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,i){return void 0===i&&(i=0),this.x=t[i],this.y=t[i+1],this.z=t[i+2],this},toArray:function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t},fromAttribute:function(t,i,s){return void 0===s&&(s=0),i=i*t.itemSize+s,this.x=t.array[i],this.y=t.array[i+1],this.z=t.array[i+2],this}};
THREE.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")},THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(t,e,r,n,i,s,o,a,u,l,h,c,m,f,v,y){var E=this.elements;return E[0]=t,E[4]=e,E[8]=r,E[12]=n,E[1]=i,E[5]=s,E[9]=o,E[13]=a,E[2]=u,E[6]=l,E[10]=h,E[14]=c,E[3]=m,E[7]=f,E[11]=v,E[15]=y,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new THREE.Matrix4).fromArray(this.elements)},copy:function(t){return this.elements.set(t.elements),this},copyPosition:function(t){var e=this.elements,r=t.elements;return e[12]=r[12],e[13]=r[13],e[14]=r[14],this},extractBasis:function(t,e,r){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,r){return this.set(t.x,e.x,r.x,0,t.y,e.y,r.y,0,t.z,e.z,r.z,0,0,0,0,1),this},extractRotation:function(){var t;return function(e){void 0===t&&(t=new THREE.Vector3);var r=this.elements,n=e.elements,i=1/t.setFromMatrixColumn(e,0).length(),s=1/t.setFromMatrixColumn(e,1).length(),o=1/t.setFromMatrixColumn(e,2).length();return r[0]=n[0]*i,r[1]=n[1]*i,r[2]=n[2]*i,r[4]=n[4]*s,r[5]=n[5]*s,r[6]=n[6]*s,r[8]=n[8]*o,r[9]=n[9]*o,r[10]=n[10]*o,this}}(),makeRotationFromEuler:function(t){t instanceof THREE.Euler==!1&&console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=this.elements,r=t.x,n=t.y,i=t.z,s=Math.cos(r),o=Math.sin(r),a=Math.cos(n),u=Math.sin(n),l=Math.cos(i),h=Math.sin(i);if("XYZ"===t.order){var c=s*l,m=s*h,f=o*l,v=o*h;e[0]=a*l,e[4]=-a*h,e[8]=u,e[1]=m+f*u,e[5]=c-v*u,e[9]=-o*a,e[2]=v-c*u,e[6]=f+m*u,e[10]=s*a}else if("YXZ"===t.order){var y=a*l,E=a*h,M=u*l,x=u*h;e[0]=y+x*o,e[4]=M*o-E,e[8]=s*u,e[1]=s*h,e[5]=s*l,e[9]=-o,e[2]=E*o-M,e[6]=x+y*o,e[10]=s*a}else if("ZXY"===t.order){var y=a*l,E=a*h,M=u*l,x=u*h;e[0]=y-x*o,e[4]=-s*h,e[8]=M+E*o,e[1]=E+M*o,e[5]=s*l,e[9]=x-y*o,e[2]=-s*u,e[6]=o,e[10]=s*a}else if("ZYX"===t.order){var c=s*l,m=s*h,f=o*l,v=o*h;e[0]=a*l,e[4]=f*u-m,e[8]=c*u+v,e[1]=a*h,e[5]=v*u+c,e[9]=m*u-f,e[2]=-u,e[6]=o*a,e[10]=s*a}else if("YZX"===t.order){var d=s*a,p=s*u,R=o*a,T=o*u;e[0]=a*l,e[4]=T-d*h,e[8]=R*h+p,e[1]=h,e[5]=s*l,e[9]=-o*l,e[2]=-u*l,e[6]=p*h+R,e[10]=d-T*h}else if("XZY"===t.order){var d=s*a,p=s*u,R=o*a,T=o*u;e[0]=a*l,e[4]=-h,e[8]=u*l,e[1]=d*h+T,e[5]=s*l,e[9]=p*h-R,e[2]=R*h-p,e[6]=o*l,e[10]=T*h+d}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:function(t){var e=this.elements,r=t.x,n=t.y,i=t.z,s=t.w,o=r+r,a=n+n,u=i+i,l=r*o,h=r*a,c=r*u,m=n*a,f=n*u,v=i*u,y=s*o,E=s*a,M=s*u;return e[0]=1-(m+v),e[4]=h-M,e[8]=c+E,e[1]=h+M,e[5]=1-(l+v),e[9]=f-y,e[2]=c-E,e[6]=f+y,e[10]=1-(l+m),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},lookAt:function(){var t,e,r;return function(n,i,s){void 0===t&&(t=new THREE.Vector3,e=new THREE.Vector3,r=new THREE.Vector3);var o=this.elements;return r.subVectors(n,i).normalize(),0===r.lengthSq()&&(r.z=1),t.crossVectors(s,r).normalize(),0===t.lengthSq()&&(r.z+=1e-4,t.crossVectors(s,r).normalize()),e.crossVectors(r,t),o[0]=t.x,o[4]=e.x,o[8]=r.x,o[1]=t.y,o[5]=e.y,o[9]=r.y,o[2]=t.z,o[6]=e.z,o[10]=r.z,this}}(),multiply:function(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var r=t.elements,n=e.elements,i=this.elements,s=r[0],o=r[4],a=r[8],u=r[12],l=r[1],h=r[5],c=r[9],m=r[13],f=r[2],v=r[6],y=r[10],E=r[14],M=r[3],x=r[7],d=r[11],p=r[15],R=n[0],T=n[4],g=n[8],z=n[12],H=n[1],w=n[5],k=n[9],A=n[13],F=n[2],V=n[6],X=n[10],Y=n[14],Z=n[3],C=n[7],P=n[11],S=n[15];return i[0]=s*R+o*H+a*F+u*Z,i[4]=s*T+o*w+a*V+u*C,i[8]=s*g+o*k+a*X+u*P,i[12]=s*z+o*A+a*Y+u*S,i[1]=l*R+h*H+c*F+m*Z,i[5]=l*T+h*w+c*V+m*C,i[9]=l*g+h*k+c*X+m*P,i[13]=l*z+h*A+c*Y+m*S,i[2]=f*R+v*H+y*F+E*Z,i[6]=f*T+v*w+y*V+E*C,i[10]=f*g+v*k+y*X+E*P,i[14]=f*z+v*A+y*Y+E*S,i[3]=M*R+x*H+d*F+p*Z,i[7]=M*T+x*w+d*V+p*C,i[11]=M*g+x*k+d*X+p*P,i[15]=M*z+x*A+d*Y+p*S,this},multiplyToArray:function(t,e,r){var n=this.elements;return this.multiplyMatrices(t,e),r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[8]=n[8],r[9]=n[9],r[10]=n[10],r[11]=n[11],r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15],this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},applyToVector3Array:function(){var t;return function(e,r,n){void 0===t&&(t=new THREE.Vector3),void 0===r&&(r=0),void 0===n&&(n=e.length);for(var i=0,s=r;i<n;i+=3,s+=3)t.fromArray(e,s),t.applyMatrix4(this),t.toArray(e,s);return e}}(),applyToBuffer:function(){var t;return function(e,r,n){void 0===t&&(t=new THREE.Vector3),void 0===r&&(r=0),void 0===n&&(n=e.length/e.itemSize);for(var i=0,s=r;i<n;i++,s++)t.x=e.getX(s),t.y=e.getY(s),t.z=e.getZ(s),t.applyMatrix4(this),e.setXYZ(t.x,t.y,t.z);return e}}(),determinant:function(){var t=this.elements,e=t[0],r=t[4],n=t[8],i=t[12],s=t[1],o=t[5],a=t[9],u=t[13],l=t[2],h=t[6],c=t[10],m=t[14],f=t[3],v=t[7],y=t[11],E=t[15];return f*(+i*a*h-n*u*h-i*o*c+r*u*c+n*o*m-r*a*m)+v*(+e*a*m-e*u*c+i*s*c-n*s*m+n*u*l-i*a*l)+y*(+e*u*h-e*o*m-i*s*h+r*s*m+i*o*l-r*u*l)+E*(-n*o*l-e*a*h+e*o*c+n*s*h-r*s*c+r*a*l)},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset is deprecated - just use .toArray instead."),this.toArray(t,e)},getPosition:function(){var t;return function(){return void 0===t&&(t=new THREE.Vector3),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),t.setFromMatrixColumn(this,3)}}(),setPosition:function(t){var e=this.elements;return e[12]=t.x,e[13]=t.y,e[14]=t.z,this},getInverse:function(t,e){var r=this.elements,n=t.elements,i=n[0],s=n[1],o=n[2],a=n[3],u=n[4],l=n[5],h=n[6],c=n[7],m=n[8],f=n[9],v=n[10],y=n[11],E=n[12],M=n[13],x=n[14],d=n[15],p=f*x*c-M*v*c+M*h*y-l*x*y-f*h*d+l*v*d,R=E*v*c-m*x*c-E*h*y+u*x*y+m*h*d-u*v*d,T=m*M*c-E*f*c+E*l*y-u*M*y-m*l*d+u*f*d,g=E*f*h-m*M*h-E*l*v+u*M*v+m*l*x-u*f*x,z=i*p+s*R+o*T+a*g;if(0===z){var H="THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0";if(e)throw new Error(H);return console.warn(H),this.identity()}var w=1/z;return r[0]=p*w,r[1]=(M*v*a-f*x*a-M*o*y+s*x*y+f*o*d-s*v*d)*w,r[2]=(l*x*a-M*h*a+M*o*c-s*x*c-l*o*d+s*h*d)*w,r[3]=(f*h*a-l*v*a-f*o*c+s*v*c+l*o*y-s*h*y)*w,r[4]=R*w,r[5]=(m*x*a-E*v*a+E*o*y-i*x*y-m*o*d+i*v*d)*w,r[6]=(E*h*a-u*x*a-E*o*c+i*x*c+u*o*d-i*h*d)*w,r[7]=(u*v*a-m*h*a+m*o*c-i*v*c-u*o*y+i*h*y)*w,r[8]=T*w,r[9]=(E*f*a-m*M*a-E*s*y+i*M*y+m*s*d-i*f*d)*w,r[10]=(u*M*a-E*l*a+E*s*c-i*M*c-u*s*d+i*l*d)*w,r[11]=(m*l*a-u*f*a-m*s*c+i*f*c+u*s*y-i*l*y)*w,r[12]=g*w,r[13]=(m*M*o-E*f*o+E*s*v-i*M*v-m*s*x+i*f*x)*w,r[14]=(E*l*o-u*M*o-E*s*h+i*M*h+u*s*x-i*l*x)*w,r[15]=(u*f*o-m*l*o+m*s*h-i*f*h-u*s*v+i*l*v)*w,this},scale:function(t){var e=this.elements,r=t.x,n=t.y,i=t.z;return e[0]*=r,e[4]*=n,e[8]*=i,e[1]*=r,e[5]*=n,e[9]*=i,e[2]*=r,e[6]*=n,e[10]*=i,e[3]*=r,e[7]*=n,e[11]*=i,this},getMaxScaleOnAxis:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,r,n))},makeTranslation:function(t,e,r){return this.set(1,0,0,t,0,1,0,e,0,0,1,r,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(1,0,0,0,0,e,-r,0,0,r,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(e,0,r,0,0,1,0,0,-r,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(e,-r,0,0,r,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var r=Math.cos(e),n=Math.sin(e),i=1-r,s=t.x,o=t.y,a=t.z,u=i*s,l=i*o;return this.set(u*s+r,u*o-n*a,u*a+n*o,0,u*o+n*a,l*o+r,l*a-n*s,0,u*a-n*o,l*a+n*s,i*a*a+r,0,0,0,0,1),this},makeScale:function(t,e,r){return this.set(t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1),this},compose:function(t,e,r){return this.makeRotationFromQuaternion(e),this.scale(r),this.setPosition(t),this},decompose:function(){var t,e;return function(r,n,i){void 0===t&&(t=new THREE.Vector3,e=new THREE.Matrix4);var s=this.elements,o=t.set(s[0],s[1],s[2]).length(),a=t.set(s[4],s[5],s[6]).length(),u=t.set(s[8],s[9],s[10]).length(),l=this.determinant();l<0&&(o=-o),r.x=s[12],r.y=s[13],r.z=s[14],e.elements.set(this.elements);var h=1/o,c=1/a,m=1/u;return e.elements[0]*=h,e.elements[1]*=h,e.elements[2]*=h,e.elements[4]*=c,e.elements[5]*=c,e.elements[6]*=c,e.elements[8]*=m,e.elements[9]*=m,e.elements[10]*=m,n.setFromRotationMatrix(e),i.x=o,i.y=a,i.z=u,this}}(),makeFrustum:function(t,e,r,n,i,s){var o=this.elements,a=2*i/(e-t),u=2*i/(n-r),l=(e+t)/(e-t),h=(n+r)/(n-r),c=-(s+i)/(s-i),m=-2*s*i/(s-i);return o[0]=a,o[4]=0,o[8]=l,o[12]=0,o[1]=0,o[5]=u,o[9]=h,o[13]=0,o[2]=0,o[6]=0,o[10]=c,o[14]=m,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makePerspective:function(t,e,r,n){var i=r*Math.tan(THREE.Math.DEG2RAD*t*.5),s=-i,o=s*e,a=i*e;return this.makeFrustum(o,a,s,i,r,n)},makeOrthographic:function(t,e,r,n,i,s){var o=this.elements,a=1/(e-t),u=1/(r-n),l=1/(s-i),h=(e+t)*a,c=(r+n)*u,m=(s+i)*l;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-h,o[1]=0,o[5]=2*u,o[9]=0,o[13]=-c,o[2]=0,o[6]=0,o[10]=-2*l,o[14]=-m,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},equals:function(t){for(var e=this.elements,r=t.elements,n=0;n<16;n++)if(e[n]!==r[n])return!1;return!0},fromArray:function(t){return this.elements.set(t),this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t[e+9]=r[9],t[e+10]=r[10],t[e+11]=r[11],t[e+12]=r[12],t[e+13]=r[13],t[e+14]=r[14],t[e+15]=r[15],t}};
THREE.Quaternion=function(t,i,s,h){this._x=t||0,this._y=i||0,this._z=s||0,this._w=void 0!==h?h:1},THREE.Quaternion.prototype={constructor:THREE.Quaternion,get x(){return this._x},set x(t){this._x=t,this.onChangeCallback()},get y(){return this._y},set y(t){this._y=t,this.onChangeCallback()},get z(){return this._z},set z(t){this._z=t,this.onChangeCallback()},get w(){return this._w},set w(t){this._w=t,this.onChangeCallback()},set:function(t,i,s,h){return this._x=t,this._y=i,this._z=s,this._w=h,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this.onChangeCallback(),this},setFromEuler:function(t,i){if(t instanceof THREE.Euler==!1)throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var s=Math.cos(t._x/2),h=Math.cos(t._y/2),n=Math.cos(t._z/2),_=Math.sin(t._x/2),r=Math.sin(t._y/2),e=Math.sin(t._z/2),a=t.order;return"XYZ"===a?(this._x=_*h*n+s*r*e,this._y=s*r*n-_*h*e,this._z=s*h*e+_*r*n,this._w=s*h*n-_*r*e):"YXZ"===a?(this._x=_*h*n+s*r*e,this._y=s*r*n-_*h*e,this._z=s*h*e-_*r*n,this._w=s*h*n+_*r*e):"ZXY"===a?(this._x=_*h*n-s*r*e,this._y=s*r*n+_*h*e,this._z=s*h*e+_*r*n,this._w=s*h*n-_*r*e):"ZYX"===a?(this._x=_*h*n-s*r*e,this._y=s*r*n+_*h*e,this._z=s*h*e-_*r*n,this._w=s*h*n+_*r*e):"YZX"===a?(this._x=_*h*n+s*r*e,this._y=s*r*n+_*h*e,this._z=s*h*e-_*r*n,this._w=s*h*n-_*r*e):"XZY"===a&&(this._x=_*h*n-s*r*e,this._y=s*r*n-_*h*e,this._z=s*h*e+_*r*n,this._w=s*h*n+_*r*e),i!==!1&&this.onChangeCallback(),this},setFromAxisAngle:function(t,i){var s=i/2,h=Math.sin(s);return this._x=t.x*h,this._y=t.y*h,this._z=t.z*h,this._w=Math.cos(s),this.onChangeCallback(),this},setFromRotationMatrix:function(t){var i,s=t.elements,h=s[0],n=s[4],_=s[8],r=s[1],e=s[5],a=s[9],o=s[2],u=s[6],c=s[10],l=h+e+c;return l>0?(i=.5/Math.sqrt(l+1),this._w=.25/i,this._x=(u-a)*i,this._y=(_-o)*i,this._z=(r-n)*i):h>e&&h>c?(i=2*Math.sqrt(1+h-e-c),this._w=(u-a)/i,this._x=.25*i,this._y=(n+r)/i,this._z=(_+o)/i):e>c?(i=2*Math.sqrt(1+e-h-c),this._w=(_-o)/i,this._x=(n+r)/i,this._y=.25*i,this._z=(a+u)/i):(i=2*Math.sqrt(1+c-h-e),this._w=(r-n)/i,this._x=(_+o)/i,this._y=(a+u)/i,this._z=.25*i),this.onChangeCallback(),this},setFromUnitVectors:function(){var t,i,s=1e-6;return function(h,n){return void 0===t&&(t=new THREE.Vector3),i=h.dot(n)+1,i<s?(i=0,Math.abs(h.x)>Math.abs(h.z)?t.set(-h.y,h.x,0):t.set(0,-h.z,h.y)):t.crossVectors(h,n),this._x=t.x,this._y=t.y,this._z=t.z,this._w=i,this.normalize()}}(),inverse:function(){return this.conjugate().normalize()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this.onChangeCallback(),this},multiply:function(t,i){return void 0!==i?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,i)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,i){var s=t._x,h=t._y,n=t._z,_=t._w,r=i._x,e=i._y,a=i._z,o=i._w;return this._x=s*o+_*r+h*a-n*e,this._y=h*o+_*e+n*r-s*a,this._z=n*o+_*a+s*e-h*r,this._w=_*o-s*r-h*e-n*a,this.onChangeCallback(),this},slerp:function(t,i){if(0===i)return this;if(1===i)return this.copy(t);var s=this._x,h=this._y,n=this._z,_=this._w,r=_*t._w+s*t._x+h*t._y+n*t._z;if(r<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,r=-r):this.copy(t),r>=1)return this._w=_,this._x=s,this._y=h,this._z=n,this;var e=Math.sqrt(1-r*r);if(Math.abs(e)<.001)return this._w=.5*(_+this._w),this._x=.5*(s+this._x),this._y=.5*(h+this._y),this._z=.5*(n+this._z),this;var a=Math.atan2(e,r),o=Math.sin((1-i)*a)/e,u=Math.sin(i*a)/e;return this._w=_*o+this._w*u,this._x=s*o+this._x*u,this._y=h*o+this._y*u,this._z=n*o+this._z*u,this.onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,i){return void 0===i&&(i=0),this._x=t[i],this._y=t[i+1],this._z=t[i+2],this._w=t[i+3],this.onChangeCallback(),this},toArray:function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._w,t},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}},Object.assign(THREE.Quaternion,{slerp:function(t,i,s,h){return s.copy(t).slerp(i,h)},slerpFlat:function(t,i,s,h,n,_,r){var e=s[h+0],a=s[h+1],o=s[h+2],u=s[h+3],c=n[_+0],l=n[_+1],y=n[_+2],x=n[_+3];if(u!==x||e!==c||a!==l||o!==y){var z=1-r,w=e*c+a*l+o*y+u*x,f=w>=0?1:-1,b=1-w*w;if(b>Number.EPSILON){var C=Math.sqrt(b),g=Math.atan2(C,w*f);z=Math.sin(z*g)/C,r=Math.sin(r*g)/C}var M=r*f;if(e=e*z+c*M,a=a*z+l*M,o=o*z+y*M,u=u*z+x*M,z===1-r){var E=1/Math.sqrt(e*e+a*a+o*o+u*u);e*=E,a*=E,o*=E,u*=E}}t[i]=e,t[i+1]=a,t[i+2]=o,t[i+3]=u}});
THREE.Euler=function(t,i,h,n){this._x=t||0,this._y=i||0,this._z=h||0,this._order=n||THREE.Euler.DefaultOrder},THREE.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],THREE.Euler.DefaultOrder="XYZ",THREE.Euler.prototype={constructor:THREE.Euler,get x(){return this._x},set x(t){this._x=t,this.onChangeCallback()},get y(){return this._y},set y(t){this._y=t,this.onChangeCallback()},get z(){return this._z},set z(t){this._z=t,this.onChangeCallback()},get order(){return this._order},set order(t){this._order=t,this.onChangeCallback()},set:function(t,i,h,n){return this._x=t,this._y=i,this._z=h,this._order=n||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this.onChangeCallback(),this},setFromRotationMatrix:function(t,i,h){var n=THREE.Math.clamp,a=t.elements,s=a[0],r=a[4],e=a[8],o=a[1],_=a[5],c=a[9],u=a[2],l=a[6],M=a[10];return i=i||this._order,"XYZ"===i?(this._y=Math.asin(n(e,-1,1)),Math.abs(e)<.99999?(this._x=Math.atan2(-c,M),this._z=Math.atan2(-r,s)):(this._x=Math.atan2(l,_),this._z=0)):"YXZ"===i?(this._x=Math.asin(-n(c,-1,1)),Math.abs(c)<.99999?(this._y=Math.atan2(e,M),this._z=Math.atan2(o,_)):(this._y=Math.atan2(-u,s),this._z=0)):"ZXY"===i?(this._x=Math.asin(n(l,-1,1)),Math.abs(l)<.99999?(this._y=Math.atan2(-u,M),this._z=Math.atan2(-r,_)):(this._y=0,this._z=Math.atan2(o,s))):"ZYX"===i?(this._y=Math.asin(-n(u,-1,1)),Math.abs(u)<.99999?(this._x=Math.atan2(l,M),this._z=Math.atan2(o,s)):(this._x=0,this._z=Math.atan2(-r,_))):"YZX"===i?(this._z=Math.asin(n(o,-1,1)),Math.abs(o)<.99999?(this._x=Math.atan2(-c,_),this._y=Math.atan2(-u,s)):(this._x=0,this._y=Math.atan2(e,M))):"XZY"===i?(this._z=Math.asin(-n(r,-1,1)),Math.abs(r)<.99999?(this._x=Math.atan2(l,_),this._y=Math.atan2(e,s)):(this._x=Math.atan2(-c,M),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+i),this._order=i,h!==!1&&this.onChangeCallback(),this},setFromQuaternion:function(){var t;return function(i,h,n){return void 0===t&&(t=new THREE.Matrix4),t.makeRotationFromQuaternion(i),this.setFromRotationMatrix(t,h,n)}}(),setFromVector3:function(t,i){return this.set(t.x,t.y,t.z,i||this._order)},reorder:function(){var t=new THREE.Quaternion;return function(i){return t.setFromEuler(this),this.setFromQuaternion(t,i)}}(),equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this.onChangeCallback(),this},toArray:function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new THREE.Vector3(this._x,this._y,this._z)},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}};


/*!art-template - Template Engine | http://aui.github.com/artTemplate/*/
!function(){function a(a){return a.replace(t,"").replace(u,",").replace(v,"").replace(w,"").replace(x,"").split(y)}function b(a){return"'"+a.replace(/('|\\)/g,"\\$1").replace(/\r/g,"\\r").replace(/\n/g,"\\n")+"'"}function c(c,d){function e(a){return m+=a.split(/\n/).length-1,k&&(a=a.replace(/\s+/g," ").replace(/<!--[\w\W]*?-->/g,"")),a&&(a=s[1]+b(a)+s[2]+"\n"),a}function f(b){var c=m;if(j?b=j(b,d):g&&(b=b.replace(/\n/g,function(){return m++,"$line="+m+";"})),0===b.indexOf("=")){var e=l&&!/^=[=#]/.test(b);if(b=b.replace(/^=[=#]?|[\s;]*$/g,""),e){var f=b.replace(/\s*\([^\)]+\)/,"");n[f]||/^(include|print)$/.test(f)||(b="$escape("+b+")")}else b="$string("+b+")";b=s[1]+b+s[2]}return g&&(b="$line="+c+";"+b),r(a(b),function(a){if(a&&!p[a]){var b;b="print"===a?u:"include"===a?v:n[a]?"$utils."+a:o[a]?"$helpers."+a:"$data."+a,w+=a+"="+b+",",p[a]=!0}}),b+"\n"}var g=d.debug,h=d.openTag,i=d.closeTag,j=d.parser,k=d.compress,l=d.escape,m=1,p={$data:1,$filename:1,$utils:1,$helpers:1,$out:1,$line:1},q="".trim,s=q?["$out='';","$out+=",";","$out"]:["$out=[];","$out.push(",");","$out.join('')"],t=q?"$out+=text;return $out;":"$out.push(text);",u="function(){var text=''.concat.apply('',arguments);"+t+"}",v="function(filename,data){data=data||$data;var text=$utils.$include(filename,data,$filename);"+t+"}",w="'use strict';var $utils=this,$helpers=$utils.$helpers,"+(g?"$line=0,":""),x=s[0],y="return new String("+s[3]+");";r(c.split(h),function(a){a=a.split(i);var b=a[0],c=a[1];1===a.length?x+=e(b):(x+=f(b),c&&(x+=e(c)))});var z=w+x+y;g&&(z="try{"+z+"}catch(e){throw {filename:$filename,name:'Render Error',message:e.message,line:$line,source:"+b(c)+".split(/\\n/)[$line-1].replace(/^\\s+/,'')};}");try{var A=new Function("$data","$filename",z);return A.prototype=n,A}catch(B){throw B.temp="function anonymous($data,$filename) {"+z+"}",B}}var d=function(a,b){return"string"==typeof b?q(b,{filename:a}):g(a,b)};d.version="3.0.0",d.config=function(a,b){e[a]=b};var e=d.defaults={openTag:"<%",closeTag:"%>",escape:!0,cache:!0,compress:!1,parser:null},f=d.cache={};d.render=function(a,b){return q(a,b)};var g=d.renderFile=function(a,b){var c=d.get(a)||p({filename:a,name:"Render Error",message:"Template not found"});return b?c(b):c};d.get=function(a){var b;if(f[a])b=f[a];else if("object"==typeof document){var c=document.getElementById(a);if(c){var d=(c.value||c.innerHTML).replace(/^\s*|\s*$/g,"");b=q(d,{filename:a})}}return b};var h=function(a,b){return"string"!=typeof a&&(b=typeof a,"number"===b?a+="":a="function"===b?h(a.call(a)):""),a},i={"<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","&":"&#38;"},j=function(a){return i[a]},k=function(a){return h(a).replace(/&(?![\w#]+;)|[<>"']/g,j)},l=Array.isArray||function(a){return"[object Array]"==={}.toString.call(a)},m=function(a,b){var c,d;if(l(a))for(c=0,d=a.length;d>c;c++)b.call(a,a[c],c,a);else for(c in a)b.call(a,a[c],c)},n=d.utils={$helpers:{},$include:g,$string:h,$escape:k,$each:m};d.helper=function(a,b){o[a]=b};var o=d.helpers=n.$helpers;d.onerror=function(a){var b="Template Error\n\n";for(var c in a)b+="<"+c+">\n"+a[c]+"\n\n";"object"==typeof console&&console.error(b)};var p=function(a){return d.onerror(a),function(){return"{Template Error}"}},q=d.compile=function(a,b){function d(c){try{return new i(c,h)+""}catch(d){return b.debug?p(d)():(b.debug=!0,q(a,b)(c))}}b=b||{};for(var g in e)void 0===b[g]&&(b[g]=e[g]);var h=b.filename;try{var i=c(a,b)}catch(j){return j.filename=h||"anonymous",j.name="Syntax Error",p(j)}return d.prototype=i.prototype,d.toString=function(){return i.toString()},h&&b.cache&&(f[h]=d),d},r=n.$each,s="break,case,catch,continue,debugger,default,delete,do,else,false,finally,for,function,if,in,instanceof,new,null,return,switch,this,throw,true,try,typeof,var,void,while,with,abstract,boolean,byte,char,class,const,double,enum,export,extends,final,float,goto,implements,import,int,interface,long,native,package,private,protected,public,short,static,super,synchronized,throws,transient,volatile,arguments,let,yield,undefined",t=/\/\*[\w\W]*?\*\/|\/\/[^\n]*\n|\/\/[^\n]*$|"(?:[^"\\]|\\[\w\W])*"|'(?:[^'\\]|\\[\w\W])*'|\s*\.\s*[$\w\.]+/g,u=/[^\w$]+/g,v=new RegExp(["\\b"+s.replace(/,/g,"\\b|\\b")+"\\b"].join("|"),"g"),w=/^\d[^,]*|,\d[^,]*/g,x=/^,+|,+$/g,y=/^$|,+/;"function"==typeof define?define(function(){return d}):"undefined"!=typeof exports?module.exports=d:this.template=d}();
!function(global) {

  if (global.template) {
    global.template.config('openTag','<#');
    global.template.config('closeTag','#>');
  }

  global.snot = {};

  global.snot.util = {
    left_pos: left_pos,
    top_pos: top_pos,
    standardlization: standardlization,
    is_mobile: is_mobile,
    is_wechat_login: is_wechat_login,
    get_window_width: get_window_width,
    get_window_height: get_window_height,
    position_to_rotation: position_to_rotation,
    distance2D: distance2D,
    distance3D: distance3D,
    epsilon: epsilon,
    css_text_to_matrix: css_text_to_matrix,
    matrix_to_css_text: matrix_to_css_text,
    webgl_detect: webgl_detect,
    webgl_enabled: webgl_detect(),
    load_js: load_js,
    rotation_to_position: rotation_to_position,

    v_set_from_matrix_position: v_set_from_matrix_position,
    m_make_rotation_axis: m_make_rotation_axis,
    m_multiply: m_multiply,
    m_set_position: m_set_position,
    m_make_rotation_from_quaternion: m_make_rotation_from_quaternion,

    merge_json: merge_json,
    octree_collision: octree_collision,

  };

  function top_pos(elem) {
    var curtop = 0;
    if (elem.offsetParent) {
      do { 
          curtop += elem.offsetTop; 
      } while (elem = elem.offsetParent);
    }
    return curtop;
  };

  function left_pos(elem) {
    var curleft = 0;
    if (elem.offsetParent) {
        do { 
            curleft += elem.offsetLeft; 
        } while (elem = elem.offsetParent);
    }
    return curleft;
  };
  
  function is_mobile() {
    return get_window_width() < 500;
  }
  
  function is_wechat_login() {
    return window.navigator.userAgent.indexOf('MicroMessenger') >= 0 ? true : false;
  }
  
  function get_window_width() {
    return document.documentElement.clientWidth;
  }
  
  function get_window_height() {
    return document.documentElement.clientHeight;
  }
  
  function position_to_rotation(x, y, z) {
    var r = distance3D(x, y, z, 0, 0, 0);
    var rx = Math.asin(z / r);
    var ry = Math.asin(y / r / Math.cos(rx));
    if (x < 0) {
        ry = ry > 0 ? Math.PI - ry : - Math.PI - ry;
    }
  
    return {
      rx: - rx * 180 / Math.PI,
      ry: (ry < 0 ? ry + Math.PI * 2 : ry) * 180 / Math.PI
    };
  }
  
  function distance2D(a, b, c, d) {
    return Math.pow((a - c) * (a - c) + (b - d) * (b - d), 0.5);
  }
  
  function distance3D(a, b, c, d, e, f) {
    return Math.pow((a - d) * (a - d) + (b - e) * (b - e) + (c - f) * (c - f), 0.5);
  }
  
  function epsilon(value) {
    return Math.abs(value) < 0.000001 ? 0 : value.toFixed(5);
  };
  
  function css_text_to_matrix(t) {
    var m = new WebKitCSSMatrix(t);
    return [
      epsilon(m.m11), epsilon(m.m12), epsilon(m.m13), epsilon(m.m14),
      epsilon(m.m21), epsilon(m.m22), epsilon(m.m23), epsilon(m.m24),
      epsilon(m.m31), epsilon(m.m32), epsilon(m.m33), epsilon(m.m34),
      epsilon(m.m41), epsilon(m.m42), epsilon(m.m43), epsilon(m.m44)
    ];
  }
  
  function matrix_to_css_text(a, b, c, d,
                              e, f, g, h,
                              i, j, k, l,
                              m, n, o, p) {
      if (typeof(a) == 'object') {
          return 'matrix3d(' + (a.join(',')) + ')';
      }
      return 'matrix3d(' + a + ',' + b + ',' + c + ',' + d+',' + e + ',' + f + ',' + g + ',' + h + ',' + i + ',' + j + ',' + k + ',' + l + ',' + m + ',' + n + ',' + o+ ',' + p + ')';
  }
  
  window.requestAnimationFrame= (function () { 
    return window.requestAnimationFrame || 
    window.webkitRequestAnimationFrame || 
    window.mozRequestAnimationFrame || 
    window.oRequestAnimationFrame || 
    // if all else fails, use setTimeout 
    function (callback) { 
      return window.setTimeout(callback, 1000 / 60); // shoot for 60 fps 
    }; 
  })(); 
  
  function webgl_detect(return_context) {
    if (!!window.WebGLRenderingContext) {
      var canvas = document.createElement("canvas");
      var names = ['webgl', 'experimental-webgl', 'moz-webgl', 'webkit-3d'];
      var context = false;
  
      for (var i = 0;i < 4; i++) {
        try {
          context = canvas.getContext(names[i]);
          if (context && typeof context.getParameter == 'function') {
            // WebGL is enabled
            if (return_context) {
              // return WebGL object if the function's argument is present
              return {
                name: names[i],
                gl: context
              };
            }
            // else, return just true
            return true;
          }
        } catch(e) {}
      }
  
      // WebGL is supported, but disabled
      return false;
    }
  
    // WebGL not supported
    return false;
  }
  
  function load_js(file, callback) {
    var _doc = document.getElementsByTagName('head')[0];
    var js = document.createElement('script');
    js.setAttribute('type', 'text/javascript');
    js.setAttribute('src', file);
    _doc.appendChild(js);
    if (!/*@cc_on!@*/0) { //if not ie
      //firefox2、firefox3、safari3.1+、opera9.6+ support js.onload
      js.onload = function () {
        callback();
      }
    } else {
      //ie6、ie7 support js.onreadystatechange
      js.onReadyStateChange = function () {
        if (js.readyState == 'loaded' || js.readyState == 'complete') {
          callback();
        }
      }
    }
  }
  
  function rotation_to_position(z, rx, ry, rz) {
    z = - z;
    rx = - rx;
  
    var x = snot.bg_size / 2;
    var y = snot.bg_size / 2;
  
    var transform = css_text_to_matrix('translate3d(' + x + 'px,' + y + 'px,0) rotateY(' + (0) + 'deg) rotateX(' + (0) + 'deg) rotateY(' + (ry ? - ry : 0) + 'deg) rotateX(' + (rx ? - rx : 0) + 'deg) rotateZ(' + (rz ? rz : 0) +'deg) translateZ(' + z + 'px)' );
    return [ - transform[12] + snot.bg_size / 2, transform[13] - snot.bg_size / 2, - transform[14]];
  }

  function m_make_rotation_axis(point, rotation) {
    return new THREE.Matrix4().makeRotationAxis(point, rotation);
  }

  function m_multiply() {
    var mats = arguments;

    var l = mats.length;
    while (l > 1) {
      var last2 = mats[l - 2];
      var last1 = mats[l - 1];
      mats[l - 2] = new THREE.Matrix4().multiplyMatrices(
        last2,
        last1
      );
      l--;
    }
    return mats[0];
  }

  function v_set_from_matrix_position(mat4) {
    return new THREE.Vector3().setFromMatrixPosition(mat4);
  }

  function m_set_position(p) {
    return new THREE.Matrix4().setPosition(p);
  }

  function m_make_rotation_from_quaternion(q) {
    return new THREE.Matrix4().makeRotationFromQuaternion(q);
  }

  function merge_json(obj, json) {
    for (var i in json) {
      if (obj[i] == undefined) {
        obj[i] = json[i];
      }
    }
  }

  function standardlization(point, r) {
    r = r || 1;
    var distance_to_origin = distance3D(0, 0, 0, point.x, point.y, point.z);
    point.x *= r / distance_to_origin;
    point.y *= r / distance_to_origin;
    point.z *= r / distance_to_origin;
  }

  function is_point_inside(point, a, b) {
    if (point.x >= b.x && point.y >= b.y && point.z >= b.z &&
        point.x < a.x && point.y < a.y && point.z < a.z) {
      return true;
    }
    return false;
  }
  function get_inside_points(points, a, b) {
    let candidates = [];
    for (let i in points) {
      if (is_point_inside(points[i], a, b)) {
        candidates.push(points[i]);
      }
    }
    return candidates;
  }
  /*
   * see ../images/octree.png
   *
   * a.x > b.x
   * a.y > b.y
   * a.z > b.z
   */
  function octree_collision(a, b, points_a, points_b, res, depth = 1) {
    if (!points_a.length || !points_b.length) {
      return false;
    }
    if (depth > 7) {
      res.push({
        points_a: points_a,
        points_b: points_b,
      });
      return true;
    }

    // random split
    let half = {
      x: (a.x - b.x) / (Math.random() * 0.2 - 0.1 + 2),
      y: (a.y - b.y) / (Math.random() * 0.2 - 0.1 + 2),
      z: (a.z - b.z) / (Math.random() * 0.2 - 0.1 + 2),
    };
    let b_xyz = {
      x: b.x + half.x,
      y: b.y + half.y,
      z: b.z + half.z,
    };
    let b_x = {
      x: b_xyz.x,
      y: b.y,
      z: b.z,
    };
    let b_y = {
      x: b.x,
      y: b_xyz.y,
      z: b.z,
    };
    let b_z = {
      x: b.x,
      y: b.y,
      z: b_xyz.z,
    };
    let b_xz = {
      x: b_xyz.x,
      y: b.y,
      z: b_xyz.z,
    };
    let b_xy = {
      x: b_xyz.x,
      y: b_xyz.y,
      z: b.z,
    };
    let b_yz = {
      x: b.x,
      y: b_xyz.y,
      z: b_xyz.z,
    };

    let a_z = {
      x: a.x,
      y: a.y,
      z: a.z - half.z,
    };
    let a_x = {
      x: a.x - half.x,
      y: a.y,
      z: a.z,
    };
    let a_y = {
      x: a.x,
      y: a.y - half.y,
      z: a.z,
    };
    let a_xy = {
      x: a_x.x,
      y: a_y.y,
      z: a.z,
    };
    let a_yz = {
      x: a.x,
      y: a_y.y,
      z: a_z.z,
    };
    let a_xz = {
      x: a_x.x,
      y: a.y,
      z: a_z.z,
    };

    function sub_collision(a, b) {
      let candidates_a = get_inside_points(points_a, a, b);
      let candidates_b = get_inside_points(points_b, a, b);
      return octree_collision(a, b, candidates_a, candidates_b, res, depth + 1);
    }

    let pairs = [
      [a_x, b_yz],
      [a, b_xyz],
      [a_xy, b_z],
      [a_y, b_xz],

      [a_xz, b_y],
      [a_z, b_xy],
      [b_xyz, b],
      [a_yz, b_x],
    ];

    let found = false;
    for (let i in pairs) {
      if (sub_collision(pairs[i][0], pairs[i][1])) {
        found = true;
      }
    }

    return found;
  }

}(window);

!function(global) {

  var PI = Math.PI;
  var sin = Math.sin;
  var cos = Math.cos;
  var tan = Math.tan;
  var acos = Math.acos;
  var atan = Math.atan;
  var pow = Math.pow;
  var floor = Math.floor;
  var sqrt = Math.sqrt;

  var snot = {
    debug: false,
    container: document.getElementById('snot-container'),
    dom: document.getElementById('snot-wrap'),

    camera_look_at: {
      x: 0,
      y: 0,
      z: 1,
    },
    controls: {
      screen_orientation: 0,
      gyro_data: {
        alpha: 0,
        beta: 90 * PI / 180,
        gamma: 0
      },
    },
    mouse_sensitivity: 0.3,
    auto_rotation: 0,
    frames: 0,
    bg_rotation: [0, 0, 0, 0, 0, 0],

    pause_animation: false,


    bg_size: 1024,

    generator: {},
    gyro: false,
    ry: 0,        // Rotate * degree around y axis
    rx: 0,        // Rotate * degree around x axis
    dest_rx: 0,
    dest_ry: 0,
    dest_rz: 0,

    max_fov: 120, // Max field of view (degree)
    min_fov: 60,   // Min field of view (degree)
    fov: 90,      // Default field of view
    smooth: 0.17,
    min_detect_distance: 20,
    on_click: function() {},
    on_sprite_click: function() {},
  };
  var camera_dom = document.getElementById('snot-camera');
  var prev_gyro;

  var camera_base_transform;
  var previous_quat = new THREE.Quaternion();

  function _pointStandardlization(x, y, z) {
    var ratio = 200 / distance3D(x, y, z, 0, 0, 0);
    return [x * ratio, y * ratio, z * ratio];
  }

  if (global.snot) {
    for (var i in snot) {
      global.snot[i] = snot[i];
    }
    snot = global.snot;
  } else {
    console.error('snot-utils.js is missing');
    return;
  }
  var m_make_rotation_axis = snot.util.m_make_rotation_axis;
  var m_multiply = snot.util.m_multiply;
  var m_set_position = snot.util.m_set_position;
  var m_make_rotation_from_quaternion = snot.util.m_make_rotation_from_quaternion;
  var v_set_from_matrix_position = snot.util.v_set_from_matrix_position;

  var util = global.snot.util;
  var epsilon = util.epsilon;
  var distance3D = util.distance3D;
  var distance2D = util.distance2D;

  var set_fov = function (degree) {
    if (degree < snot.min_fov || degree > snot.max_fov) {
      return;
    }
    snot.fov = degree;
    snot.container.style['-webkit-transform'] = 'scale(' + tan(snot.max_fov / 2 * PI / 180) / tan(snot.fov / 2 * PI / 180) + ')';
  }

  function reset() {
    var sprites = document.getElementsByClassName('sprite');
    for (var i = 0; i < sprites.length; ++ i) {
      sprites[i].remove();
    }
  }

  var init = function(config) {
    reset();

    cancelAnimationFrame(snot._animateId);

    for (var i in config) {
      if (i == 'generator') {
        util.merge_json(snot.generator, config.generator);
      }
      snot[i] = config[i];
    }
    prev_gyro = snot.gyro;

    snot.dest_rx = snot.rx;
    snot.dest_ry = snot.ry;

    snot.width = snot.dom.offsetWidth;
    snot.height = snot.dom.offsetHeight;

    //compute the max Horizontal Field of view
    //perspective= projectiveScreenWidth/2
    //           = width/2/tan(max_fov/2)
    snot.perspective = snot.width / 2 / tan(snot.max_fov / 2 * PI / 180);

    snot.container.style['-webkit-perspective'] = snot.perspective + 'px';

    //camera offset
    // Z is depth(front) Y is height X is right
    //
    // translateZ setFOV
    // rotateX rotate around X axis
    // rotateY rotate around Y axis
    // translateX translate the Camera to center
    // translateY
    camera_base_transform = 'translateX(' + epsilon(- (snot.bg_size - snot.width) / 2) + 'px) translateY(' + epsilon(- (snot.bg_size - snot.height) / 2) + 'px)';
    camera_dom.style['-webkit-transform'] = 'translateZ(-' + snot.perspective + 'px) rotateY(' + epsilon(snot.rx) + 'deg) rotateX(' + epsilon(snot.ry) + 'deg)' + camera_base_transform;

    set_fov(snot.fov);

    if (config.bg_imgs) {
      load_bg_imgs(config.bg_imgs, config.bg_rotation || snot.bg_rotation);
    }

    if (config) {
      load_sprites(config.sprites);
    }

    if (util.is_mobile()) {
    }

    if (config.callback) {
      config.callback();
    }
    snot.init_controls();
    update();
  }

  function load_bg_imgs(bg_imgs, bg_rotation) {
    var bg_config = {
      front : 'rotateY(90deg)' + '                rotateZ(' + bg_rotation[0] + 'deg)  translateZ(-' + (snot.bg_size / 2) + 'px)',
      bottom: 'rotateY(90deg)' + 'rotateX(90deg)  rotateZ(' + bg_rotation[1] + 'deg)  translateZ(-' + (snot.bg_size / 2) + 'px) rotateZ(90deg)',
      left  : 'rotateY(90deg)' + 'rotateY(90deg)  rotateZ(' + bg_rotation[2] + 'deg)  translateZ(-' + (snot.bg_size / 2) + 'px)',
      back  : 'rotateY(90deg)' + 'rotateY(180deg) rotateZ(' + bg_rotation[3] + 'deg)  translateZ(-' + (snot.bg_size / 2) + 'px)',
      top   : 'rotateY(90deg)' + 'rotateX(-90deg) rotateZ(' + bg_rotation[4] + 'deg)  translateZ(-' + (snot.bg_size / 2) + 'px) rotateZ(-90deg)',
      right : 'rotateY(90deg)' + 'rotateY(-90deg) rotateZ(' + bg_rotation[5] + 'deg)  translateZ(-' + (snot.bg_size / 2) + 'px)'
    };

    var bg_dom;
    var count = 0;
    for (var i in bg_config) {
      bg_dom = document.getElementsByClassName('snot-bg ' + i)[0];
      bg_dom.style['-webkit-transform'] = bg_config[i];
      bg_dom.style['width'] = snot.bg_size + 2 + 'px';        // 2 more pixels for overlapping gaps ( chrome's bug )
      bg_dom.style['height'] = snot.bg_size + 2 + 'px';       // 2 more pixels for overlapping gaps ( chrome's bug )

      bg_dom.setAttribute('src', bg_imgs[count]);
      bg_dom.setAttribute('data-index', count);
      ++count;
    }
  }

  var load_sprites = function(sprites) {
    for (var i in sprites) {
      var t = sprites[i];
      if (t.standardlization) {
        var standard = _pointStandardlization(t.x,t.y,t.z);
        t.x=standard[0];
        t.y=standard[1];
        t.z=standard[2];
      }

      var temp_wrapper = document.createElement('div');
      temp_wrapper.innerHTML = template(snot.generator[t.generator], t);
      var element = temp_wrapper.firstChild;
      element.data = sprites[i];
      add_sprite_by_position(element, t);
    }
  }

  function add_sprite_by_position(element, p) {

    var x = - p.x;
    var z = - p.z;
    var y = - p.y;

    var spriteContainer = document.createElement('div');
    spriteContainer.style.display = 'inline-block';
    spriteContainer.style.position = 'absolute';
    spriteContainer.className = 'sprite-container';
    spriteContainer.id = element.data.id;

    spriteContainer.style['-webkit-transform-origin-x'] = '0';
    spriteContainer.style['-webkit-transform-origin-y'] = '0';

    var arc = x == 0 && z == 0 ? 0 : acos( z / pow(x * x + z * z, 0.5));

    arc = x < 0 ? 2 * PI - arc : arc;
    arc = arc * 180 / PI;

    var r = distance3D(x, y, z, 0, 0, 0);
    x += snot.bg_size / 2;
    y += snot.bg_size / 2;

    spriteContainer.style['-webkit-transform'] = 'translate3d(' + epsilon(x) + 'px,' + epsilon(y) + 'px,' + epsilon(z) + 'px) rotateY(' + epsilon(arc) + 'deg) rotateX(' + epsilon(- (y - snot.bg_size / 2) / r * 90)+'deg) rotateY(180deg)';

    var spriteWrap = document.createElement('div');
    spriteWrap.className='sprite-wrap';
    spriteWrap.appendChild(element);
    spriteWrap.setAttribute('data-visible', element.data.visible == false ? false : true);

    spriteContainer.appendChild(spriteWrap);
    camera_dom.appendChild(spriteContainer);
  }

  var update_sprite_visibility = function(id) {
    var visible = snot.sprites[id].visible;
    var spriteContainer = document.getElementById(id);
    spriteContainer.firstChild.setAttribute('data-visible', visible ? true : false);
  }

  var update_sprite_position = function(id) {
    var x = snot.sprites[id].x;
    var y = snot.sprites[id].y;
    var z = snot.sprites[id].z;
    z=-z;
    y=-y;
    var arc = x == 0 && z == 0 ? 0 : acos( z / pow(x * x + z * z, 0.5));

    arc = x < 0 ? 2 * PI - arc : arc;
    arc = arc * 180/ PI;

    var r = distance3D(x, y, z, 0, 0, 0);
    x += snot.bg_size / 2;
    y += snot.bg_size / 2;

    var spriteContainer = document.getElementById(id);

    spriteContainer.style['-webkit-transform'] = 'translate3d(' + epsilon(x) + 'px,' + epsilon(y) + 'px,' + epsilon(z) + 'px) rotateY(' + epsilon(arc) + 'deg) rotateX(' + epsilon(- (y - snot.bg_size / 2) / r * 90) + 'deg) rotateY(180deg)';
  }

  function run() {
    snot._animateId = requestAnimationFrame(run);
    if (!snot.pause_animation) {
      update();
    }
  }

  var camera_euler = new THREE.Euler();
  var target_quat = new THREE.Quaternion();
  var rotate_90_quat = new THREE.Quaternion(- sqrt( 0.5 ), 0, 0, sqrt( 0.5 ))
  var adjust_screen_quats = {
    0: new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0, 0, 1), 0),
    90: new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0, 0, 1), - 90),
    180: new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0, 0, 1), - 180),
    '-90': new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0, 0, 1), 90),
  };
  var look_at_euler = new THREE.Euler();

  function update_camera(x, y, z) {

    camera_euler.set(y, x, z, 'YXZ'); // 'ZXY' for the device, but 'YXZ' for us

    target_quat.setFromEuler(camera_euler); // orient the device

    target_quat.multiply(rotate_90_quat); // camera looks out the back of the device, not the top
                                          // - PI/2 around the x-axis
    target_quat.multiply(adjust_screen_quats[snot.controls.screen_orientation]); // adjust for screen orientation

    var slerp_quat = new THREE.Quaternion();
    THREE.Quaternion.slerp(target_quat, previous_quat, slerp_quat, 1 - snot.smooth);
    previous_quat = slerp_quat;
    var look_at_quat = slerp_quat.clone();
    look_at_quat.x *= -1;
    look_at_quat.z *= -1;
    var look_at_mat = m_make_rotation_from_quaternion(look_at_quat.normalize()).transpose();
    for (var i = 0; i < look_at_mat.elements.length; ++i) {
      look_at_mat.elements[i] = epsilon(look_at_mat.elements[i]);
    }
    var look_at_rot = look_at_euler.setFromRotationMatrix(look_at_mat, 'XZY');

    snot.rx = look_at_rot._x * 180 / PI;
    snot.ry = - look_at_rot._y * 180 / PI;
    snot.rz = look_at_rot._z * 180 / PI;

    snot.camera_look_at = v_set_from_matrix_position(m_multiply(
      m_make_rotation_axis({x: 0, y: 1, z: 0}, look_at_rot._y),
      m_make_rotation_axis({x: 0, y: 0, z: 1}, look_at_rot._z),
      m_make_rotation_axis({x: 1, y: 0, z: 0}, - look_at_rot._x),
      m_set_position({x: 0, y: 0, z: 1})
    )); // bad performance here

    camera_dom.style.transform = 'translateZ(' + epsilon(snot.perspective) + 'px)' + " matrix3d(" + look_at_mat.elements + ")"+ camera_base_transform;
  }

  function update() {
    snot.frames++;

    if (snot.gyro) {
      if (snot.controls.gyro_data.alpha === -1 && snot.controls.gyro_data.beta === -1 && snot.controls.gyro_data.gamma === - 1) {
        return;
      }

      update_camera(snot.controls.gyro_data.alpha, snot.controls.gyro_data.beta, - snot.controls.gyro_data.gamma);
    } else {
      if (prev_gyro) {
        snot.dest_rx = 0;
        snot.dest_ry = 0;
      }
      snot.dest_ry -= snot.auto_rotation;
      update_camera(- snot.dest_ry * PI / 180, snot.dest_rx * PI / 180 + PI/2, 0);
    }
    prev_gyro = snot.gyro;

    for (var i in snot.sprites) {
      var sprite = snot.sprites[i];
      if (sprite.need_update_position) {
        sprite.need_update_position = false;
        update_sprite_position(sprite.id);
      }
      if (sprite.need_update_visibility) {
        sprite.need_update_visibility = false;
        update_sprite_visibility(sprite.id);
      }
    }
    if (snot.debug) {
      document.getElementById('logger').innerHTML = 'rx:' + parseInt(snot.rx) + ' ' +
                        'ry:' + parseInt(snot.ry) + ' ' +
                        'rz:' + parseInt(snot.rz);
    }
  }


  var set_rx = function(rx, smooth) {
    //TODO
  }

  var set_ry=function(ry,smooth){
    //TODO
  }

  snot.controls.mouse_click = function(x, y) {
    var R = 100;
    var fov = snot.fov;
    var bg_size = snot.bg_size;
    var arcFactor = Math.PI / 180;
    var rz = snot.rz * arcFactor;
    var width = snot.width;
    var height = snot.height;

    var ry = (x / width - 0.5) * fov;
    var rx = (y / height-0.5) * fov * height / width;
    var r = cos(fov / 2 * arcFactor) * bg_size;
    var ratiox = (x - width / 2) / width * 2;
    var ratioy = (y - height / 2) / width * 2;
    var P = sin(fov / 2 * arcFactor) * bg_size;

    ry = atan(ratiox * P / r);
    rx = atan(ratioy * P / r);

    ry *= 180 / PI;
    rx *= 180 / PI;

    var xyz2 = util.rotation_to_position(R, rx, 0);

    var rr = distance3D(- tan(ry * arcFactor) * xyz2[2], - xyz2[1], xyz2[2], 0, 0, 0);
    var ratio = R / rr;

    var new_x = - tan(ry * PI / 180) * xyz2[2] * ratio;
    var new_y = - xyz2[1] * ratio;
    var new_z = xyz2[2] * ratio;

    var pos = v_set_from_matrix_position(m_multiply(
      m_make_rotation_axis({x: 0, y: 1, z: 0}, snot.ry * PI / 180),
      m_make_rotation_axis({x: 0, y: 0, z: 1}, - snot.rz * PI / 180),
      m_make_rotation_axis({x: 1, y: 0, z: 0}, - snot.rx * PI / 180),
      m_set_position({x: new_x, y: new_y, z: new_z})
    ));

    ax = pos.x;
    ay = pos.y;
    az = pos.z;

    var min_offset = 0.4;
    var min_distance = snot.min_detect_distance;
    var nearest;

    var spriteContainers = document.getElementsByClassName('sprite-container');
    for (var i = 0 ;i < spriteContainers.length; ++i) {
      var self = spriteContainers[i];
      var matrix = util.css_text_to_matrix(self.style.webkitTransform);
      var rate_ = 100 / distance3D(0, 0, 0, snot.bg_size / 2 - matrix[12], matrix[13] - snot.bg_size / 2, - matrix[14]);

      var distance = distance3D(ax, - ay, az, (snot.bg_size / 2 - matrix[12]) * rate_, rate_ * (matrix[13] - snot.bg_size / 2), rate_ * ( - matrix[14]));
      if (distance < min_distance) {
        min_distance = distance;
        nearest = self.children[0];
      }
    }

    var rotation = util.position_to_rotation(ax, az, ay);
    if (nearest) {
      snot.on_sprite_click(snot.sprites[nearest.parentElement.id], nearest);
    } else {
      snot.on_click({
        x: ax,
        y: ay,
        z: az,
      }, {
        rx: rotation[0],
        ry: rotation[1]
      });
    }
  }

  util.merge_json(snot, {
    set_fov: set_fov,
    set_rx: set_rx,
    set_ry: set_ry,
    init: init,
    run: run,
    update: update,
    load_sprites: load_sprites,
  });
}(window);

!function(global) {

  var dom_offset_top;
  var dom_offset_left;
  snot.init_controls = function() {

    dom_offset_left = util.left_pos(snot.dom);
    dom_offset_top = util.top_pos(snot.dom);
    snot.container.addEventListener('touchstart', mouse_down, false);
    snot.container.addEventListener('touchmove' , mouse_move, false);
    snot.container.addEventListener('touchend'  , mouse_up  , false);

    snot.container.addEventListener('mousedown' , mouse_down , false);
    snot.container.addEventListener('mousemove' , mouse_move , false);
    snot.container.addEventListener('mouseup'   , mouse_up   , false);
    snot.container.addEventListener('mousewheel', mouse_wheel, false);

    window.addEventListener('orientationchange', function(ev) {
      snot.controls.screen_orientation = window.orientation || 0;
    }, false);

    window.addEventListener('deviceorientation', function(ev) {
      if (ev.alpha !== null) {
        snot.controls.gyro_data.beta = ev.beta  * Math.PI / 180 ;
        snot.controls.gyro_data.gamma = ev.gamma  * Math.PI / 180;
        snot.controls.gyro_data.alpha = ev.alpha  * Math.PI / 180;
      } else {
        snot.controls.gyro_data.beta = snot.controls.gyro_data.gamma = snot.controls.gyro_data.alpha = -1;
      }
    }, true);
  }

  var util = snot.util;
  var distance3D = util.distance3D;
  var distance2D = util.distance2D;
  var floor = Math.floor;
  var cos = Math.cos;
  var sin = Math.sin;
  var atan = Math.atan;
  var tan = Math.tan;
  var PI = Math.PI;

  var m_make_rotation_axis = snot.util.m_make_rotation_axis;
  var m_multiply = snot.util.m_multiply;
  var m_set_position = snot.util.m_set_position;
  var m_make_rotation_from_quaternion = snot.util.m_make_rotation_from_quaternion;
  var v_set_from_matrix_position = snot.util.v_set_from_matrix_position;

  var touches = {
    fx: 0,   // First  finger x
    fy: 0,   // First  finger y
    sx: 0,   // Second finger x
    sy: 0    // Second finger y
  };

  var mouse_move = function(event) {

    event.preventDefault();
    event.stopPropagation();

    var x = Math.floor(event.clientX >= 0 ? event.clientX : event.touches[0].pageX);
    var y = Math.floor(event.clientY >= 0 ? event.clientY : event.touches[0].pageY);
    x -= dom_offset_left;
    y -= dom_offset_top;

    touches.click = false;

    if (!touches.is_touching) {
      return false;
    }

    if (event.touches && event.touches.length > 1) {

      var cfx = x;                          // Current frist  finger x
      var cfy = y;                          // Current first  finger y
      var csx = event.touches[1].pageX;     // Current second finger x
      var csy = event.touches[1].pageY;     // Current second finger y

      var dis = distance2D(touches.fx, touches.fy, touches.sx, touches.sy) - distance2D(cfx, cfy, csx, csy);

      var ratio = 0.12;
      snot.set_fov(snot.fov + dis * ratio);

      touches.fx = cfx;
      touches.fy = cfy;
      touches.sx = csx;
      touches.sy = csy;

      return false;
    }

    var ratio = snot.mouse_sensitivity;

    snot.dest_ry = snot.dest_ry + (touches.fx - x) * ratio;
    snot.dest_rx = snot.dest_rx - (touches.fy - y) * ratio;

    touches.fx = x;
    touches.fy = y;

    snot.dest_rx = snot.dest_rx > 90 ? 90 : snot.dest_rx;
    snot.dest_rx = snot.dest_rx < -90 ? -90 : snot.dest_rx;

  };

  var mouse_down = function (event) {

    event.preventDefault();
    event.stopPropagation();

    var x = floor(event.clientX >= 0 ? event.clientX : event.touches[0].clientX);
    var y = floor(event.clientY >= 0 ? event.clientY : event.touches[0].clientY);
    x -= dom_offset_left;
    y -= dom_offset_top;

    touches.mouse_down_x = x;
    touches.mouse_down_y = y;
    touches.fx = x;
    touches.fy = y;
    touches.click = true;

    if (event.touches && event.touches.length > 1) {

      touches.sx = event.touches[1].pageX;
      touches.sy = event.touches[1].pageY;

    }

    touches.is_touching = true;
  }

  var mouse_wheel = function (event) {

    event.preventDefault();
    event.stopPropagation();

    var offset = event.deltaY;
    snot.set_fov(snot.fov + offset * 0.06);

  }

  var mouse_up = function(event) {
    event.preventDefault();
    event.stopPropagation();

    var x = floor(event.clientX >= 0 ? event.clientX : event.changedTouches[0].pageX);
    var y = floor(event.clientY >= 0 ? event.clientY : event.changedTouches[0].pageY);
    x -= dom_offset_left;
    y -= dom_offset_top;

    //Screen coordinate to Sphere 3d coordinate
    if (distance2D(touches.mouse_down_x, touches.mouse_down_y, x, y) < 5) {
      snot.controls.mouse_click(x, y);
    }
    touches.is_touching = false;
  }

}(window);

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRocmVlX21hdGguanMiLCJWZWN0b3IzLmpzIiwiTWF0cml4NC5qcyIsIlF1YXRlcm5pb24uanMiLCJFdWxlci5qcyIsInRlbXBsYXRlLW5hdGl2ZS5qcyIsInNub3RfdXRpbHMuanMiLCJzbm90X2Nzc19yZW5kZXJlci5qcyIsInNub3RfY29udHJvbHMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQ0FBO0FDQUE7QUNBQTs7O0FDQUE7QUFDQTtBQ0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN1hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzliQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6InNub3RfY3NzX3JlbmRlcmVyLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIlRIUkVFPXt9LFRIUkVFLk1hdGg9e2NsYW1wOmZ1bmN0aW9uKEUsbix0KXtyZXR1cm4gRT50P3Q6RTxuP246RX19OyIsIlRIUkVFLlZlY3RvcjM9ZnVuY3Rpb24odCxpLHMpe3RoaXMueD10fHwwLHRoaXMueT1pfHwwLHRoaXMuej1zfHwwfSxUSFJFRS5WZWN0b3IzLnByb3RvdHlwZT17Y29uc3RydWN0b3I6VEhSRUUuVmVjdG9yMyxzZXQ6ZnVuY3Rpb24odCxpLHMpe3JldHVybiB0aGlzLng9dCx0aGlzLnk9aSx0aGlzLno9cyx0aGlzfSxzZXRTY2FsYXI6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMueD10LHRoaXMueT10LHRoaXMuej10LHRoaXN9LHNldFg6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMueD10LHRoaXN9LHNldFk6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMueT10LHRoaXN9LHNldFo6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuej10LHRoaXN9LHNldENvbXBvbmVudDpmdW5jdGlvbih0LGkpe3N3aXRjaCh0KXtjYXNlIDA6dGhpcy54PWk7YnJlYWs7Y2FzZSAxOnRoaXMueT1pO2JyZWFrO2Nhc2UgMjp0aGlzLno9aTticmVhaztkZWZhdWx0OnRocm93IG5ldyBFcnJvcihcImluZGV4IGlzIG91dCBvZiByYW5nZTogXCIrdCl9fSxnZXRDb21wb25lbnQ6ZnVuY3Rpb24odCl7c3dpdGNoKHQpe2Nhc2UgMDpyZXR1cm4gdGhpcy54O2Nhc2UgMTpyZXR1cm4gdGhpcy55O2Nhc2UgMjpyZXR1cm4gdGhpcy56O2RlZmF1bHQ6dGhyb3cgbmV3IEVycm9yKFwiaW5kZXggaXMgb3V0IG9mIHJhbmdlOiBcIit0KX19LGNsb25lOmZ1bmN0aW9uKCl7cmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKHRoaXMueCx0aGlzLnksdGhpcy56KX0sY29weTpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy54PXQueCx0aGlzLnk9dC55LHRoaXMuej10LnosdGhpc30sYWRkOmZ1bmN0aW9uKHQsaSl7cmV0dXJuIHZvaWQgMCE9PWk/KGNvbnNvbGUud2FybihcIlRIUkVFLlZlY3RvcjM6IC5hZGQoKSBub3cgb25seSBhY2NlcHRzIG9uZSBhcmd1bWVudC4gVXNlIC5hZGRWZWN0b3JzKCBhLCBiICkgaW5zdGVhZC5cIiksdGhpcy5hZGRWZWN0b3JzKHQsaSkpOih0aGlzLngrPXQueCx0aGlzLnkrPXQueSx0aGlzLnorPXQueix0aGlzKX0sYWRkU2NhbGFyOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLngrPXQsdGhpcy55Kz10LHRoaXMueis9dCx0aGlzfSxhZGRWZWN0b3JzOmZ1bmN0aW9uKHQsaSl7cmV0dXJuIHRoaXMueD10LngraS54LHRoaXMueT10LnkraS55LHRoaXMuej10LnoraS56LHRoaXN9LGFkZFNjYWxlZFZlY3RvcjpmdW5jdGlvbih0LGkpe3JldHVybiB0aGlzLngrPXQueCppLHRoaXMueSs9dC55KmksdGhpcy56Kz10LnoqaSx0aGlzfSxzdWI6ZnVuY3Rpb24odCxpKXtyZXR1cm4gdm9pZCAwIT09aT8oY29uc29sZS53YXJuKFwiVEhSRUUuVmVjdG9yMzogLnN1YigpIG5vdyBvbmx5IGFjY2VwdHMgb25lIGFyZ3VtZW50LiBVc2UgLnN1YlZlY3RvcnMoIGEsIGIgKSBpbnN0ZWFkLlwiKSx0aGlzLnN1YlZlY3RvcnModCxpKSk6KHRoaXMueC09dC54LHRoaXMueS09dC55LHRoaXMuei09dC56LHRoaXMpfSxzdWJTY2FsYXI6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMueC09dCx0aGlzLnktPXQsdGhpcy56LT10LHRoaXN9LHN1YlZlY3RvcnM6ZnVuY3Rpb24odCxpKXtyZXR1cm4gdGhpcy54PXQueC1pLngsdGhpcy55PXQueS1pLnksdGhpcy56PXQuei1pLnosdGhpc30sbXVsdGlwbHk6ZnVuY3Rpb24odCxpKXtyZXR1cm4gdm9pZCAwIT09aT8oY29uc29sZS53YXJuKFwiVEhSRUUuVmVjdG9yMzogLm11bHRpcGx5KCkgbm93IG9ubHkgYWNjZXB0cyBvbmUgYXJndW1lbnQuIFVzZSAubXVsdGlwbHlWZWN0b3JzKCBhLCBiICkgaW5zdGVhZC5cIiksdGhpcy5tdWx0aXBseVZlY3RvcnModCxpKSk6KHRoaXMueCo9dC54LHRoaXMueSo9dC55LHRoaXMueio9dC56LHRoaXMpfSxtdWx0aXBseVNjYWxhcjpmdW5jdGlvbih0KXtyZXR1cm4gaXNGaW5pdGUodCk/KHRoaXMueCo9dCx0aGlzLnkqPXQsdGhpcy56Kj10KToodGhpcy54PTAsdGhpcy55PTAsdGhpcy56PTApLHRoaXN9LG11bHRpcGx5VmVjdG9yczpmdW5jdGlvbih0LGkpe3JldHVybiB0aGlzLng9dC54KmkueCx0aGlzLnk9dC55KmkueSx0aGlzLno9dC56Kmkueix0aGlzfSxhcHBseUV1bGVyOmZ1bmN0aW9uKCl7dmFyIHQ7cmV0dXJuIGZ1bmN0aW9uKGkpe3JldHVybiBpIGluc3RhbmNlb2YgVEhSRUUuRXVsZXI9PSExJiZjb25zb2xlLmVycm9yKFwiVEhSRUUuVmVjdG9yMzogLmFwcGx5RXVsZXIoKSBub3cgZXhwZWN0cyBhbiBFdWxlciByb3RhdGlvbiByYXRoZXIgdGhhbiBhIFZlY3RvcjMgYW5kIG9yZGVyLlwiKSx2b2lkIDA9PT10JiYodD1uZXcgVEhSRUUuUXVhdGVybmlvbiksdGhpcy5hcHBseVF1YXRlcm5pb24odC5zZXRGcm9tRXVsZXIoaSkpfX0oKSxhcHBseUF4aXNBbmdsZTpmdW5jdGlvbigpe3ZhciB0O3JldHVybiBmdW5jdGlvbihpLHMpe3JldHVybiB2b2lkIDA9PT10JiYodD1uZXcgVEhSRUUuUXVhdGVybmlvbiksdGhpcy5hcHBseVF1YXRlcm5pb24odC5zZXRGcm9tQXhpc0FuZ2xlKGkscykpfX0oKSxhcHBseU1hdHJpeDM6ZnVuY3Rpb24odCl7dmFyIGk9dGhpcy54LHM9dGhpcy55LG49dGhpcy56LHI9dC5lbGVtZW50cztyZXR1cm4gdGhpcy54PXJbMF0qaStyWzNdKnMrcls2XSpuLHRoaXMueT1yWzFdKmkrcls0XSpzK3JbN10qbix0aGlzLno9clsyXSppK3JbNV0qcytyWzhdKm4sdGhpc30sYXBwbHlNYXRyaXg0OmZ1bmN0aW9uKHQpe3ZhciBpPXRoaXMueCxzPXRoaXMueSxuPXRoaXMueixyPXQuZWxlbWVudHM7cmV0dXJuIHRoaXMueD1yWzBdKmkrcls0XSpzK3JbOF0qbityWzEyXSx0aGlzLnk9clsxXSppK3JbNV0qcytyWzldKm4rclsxM10sdGhpcy56PXJbMl0qaStyWzZdKnMrclsxMF0qbityWzE0XSx0aGlzfSxhcHBseVByb2plY3Rpb246ZnVuY3Rpb24odCl7dmFyIGk9dGhpcy54LHM9dGhpcy55LG49dGhpcy56LHI9dC5lbGVtZW50cyxoPTEvKHJbM10qaStyWzddKnMrclsxMV0qbityWzE1XSk7cmV0dXJuIHRoaXMueD0oclswXSppK3JbNF0qcytyWzhdKm4rclsxMl0pKmgsdGhpcy55PShyWzFdKmkrcls1XSpzK3JbOV0qbityWzEzXSkqaCx0aGlzLno9KHJbMl0qaStyWzZdKnMrclsxMF0qbityWzE0XSkqaCx0aGlzfSxhcHBseVF1YXRlcm5pb246ZnVuY3Rpb24odCl7dmFyIGk9dGhpcy54LHM9dGhpcy55LG49dGhpcy56LHI9dC54LGg9dC55LGU9dC56LG89dC53LGE9byppK2gqbi1lKnMsdT1vKnMrZSppLXIqbixjPW8qbityKnMtaCppLHk9LXIqaS1oKnMtZSpuO3JldHVybiB0aGlzLng9YSpvK3kqLXIrdSotZS1jKi1oLHRoaXMueT11Km8reSotaCtjKi1yLWEqLWUsdGhpcy56PWMqbyt5Ki1lK2EqLWgtdSotcix0aGlzfSxwcm9qZWN0OmZ1bmN0aW9uKCl7dmFyIHQ7cmV0dXJuIGZ1bmN0aW9uKGkpe3JldHVybiB2b2lkIDA9PT10JiYodD1uZXcgVEhSRUUuTWF0cml4NCksdC5tdWx0aXBseU1hdHJpY2VzKGkucHJvamVjdGlvbk1hdHJpeCx0LmdldEludmVyc2UoaS5tYXRyaXhXb3JsZCkpLHRoaXMuYXBwbHlQcm9qZWN0aW9uKHQpfX0oKSx1bnByb2plY3Q6ZnVuY3Rpb24oKXt2YXIgdDtyZXR1cm4gZnVuY3Rpb24oaSl7cmV0dXJuIHZvaWQgMD09PXQmJih0PW5ldyBUSFJFRS5NYXRyaXg0KSx0Lm11bHRpcGx5TWF0cmljZXMoaS5tYXRyaXhXb3JsZCx0LmdldEludmVyc2UoaS5wcm9qZWN0aW9uTWF0cml4KSksdGhpcy5hcHBseVByb2plY3Rpb24odCl9fSgpLHRyYW5zZm9ybURpcmVjdGlvbjpmdW5jdGlvbih0KXt2YXIgaT10aGlzLngscz10aGlzLnksbj10aGlzLnoscj10LmVsZW1lbnRzO3JldHVybiB0aGlzLng9clswXSppK3JbNF0qcytyWzhdKm4sdGhpcy55PXJbMV0qaStyWzVdKnMrcls5XSpuLHRoaXMuej1yWzJdKmkrcls2XSpzK3JbMTBdKm4sdGhpcy5ub3JtYWxpemUoKX0sZGl2aWRlOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLngvPXQueCx0aGlzLnkvPXQueSx0aGlzLnovPXQueix0aGlzfSxkaXZpZGVTY2FsYXI6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMubXVsdGlwbHlTY2FsYXIoMS90KX0sbWluOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLng9TWF0aC5taW4odGhpcy54LHQueCksdGhpcy55PU1hdGgubWluKHRoaXMueSx0LnkpLHRoaXMuej1NYXRoLm1pbih0aGlzLnosdC56KSx0aGlzfSxtYXg6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMueD1NYXRoLm1heCh0aGlzLngsdC54KSx0aGlzLnk9TWF0aC5tYXgodGhpcy55LHQueSksdGhpcy56PU1hdGgubWF4KHRoaXMueix0LnopLHRoaXN9LGNsYW1wOmZ1bmN0aW9uKHQsaSl7cmV0dXJuIHRoaXMueD1NYXRoLm1heCh0LngsTWF0aC5taW4oaS54LHRoaXMueCkpLHRoaXMueT1NYXRoLm1heCh0LnksTWF0aC5taW4oaS55LHRoaXMueSkpLHRoaXMuej1NYXRoLm1heCh0LnosTWF0aC5taW4oaS56LHRoaXMueikpLHRoaXN9LGNsYW1wU2NhbGFyOmZ1bmN0aW9uKCl7dmFyIHQsaTtyZXR1cm4gZnVuY3Rpb24ocyxuKXtyZXR1cm4gdm9pZCAwPT09dCYmKHQ9bmV3IFRIUkVFLlZlY3RvcjMsaT1uZXcgVEhSRUUuVmVjdG9yMyksdC5zZXQocyxzLHMpLGkuc2V0KG4sbixuKSx0aGlzLmNsYW1wKHQsaSl9fSgpLGNsYW1wTGVuZ3RoOmZ1bmN0aW9uKHQsaSl7dmFyIHM9dGhpcy5sZW5ndGgoKTtyZXR1cm4gdGhpcy5tdWx0aXBseVNjYWxhcihNYXRoLm1heCh0LE1hdGgubWluKGkscykpL3MpfSxmbG9vcjpmdW5jdGlvbigpe3JldHVybiB0aGlzLng9TWF0aC5mbG9vcih0aGlzLngpLHRoaXMueT1NYXRoLmZsb29yKHRoaXMueSksdGhpcy56PU1hdGguZmxvb3IodGhpcy56KSx0aGlzfSxjZWlsOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMueD1NYXRoLmNlaWwodGhpcy54KSx0aGlzLnk9TWF0aC5jZWlsKHRoaXMueSksdGhpcy56PU1hdGguY2VpbCh0aGlzLnopLHRoaXN9LHJvdW5kOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMueD1NYXRoLnJvdW5kKHRoaXMueCksdGhpcy55PU1hdGgucm91bmQodGhpcy55KSx0aGlzLno9TWF0aC5yb3VuZCh0aGlzLnopLHRoaXN9LHJvdW5kVG9aZXJvOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMueD10aGlzLng8MD9NYXRoLmNlaWwodGhpcy54KTpNYXRoLmZsb29yKHRoaXMueCksdGhpcy55PXRoaXMueTwwP01hdGguY2VpbCh0aGlzLnkpOk1hdGguZmxvb3IodGhpcy55KSx0aGlzLno9dGhpcy56PDA/TWF0aC5jZWlsKHRoaXMueik6TWF0aC5mbG9vcih0aGlzLnopLHRoaXN9LG5lZ2F0ZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLng9LXRoaXMueCx0aGlzLnk9LXRoaXMueSx0aGlzLno9LXRoaXMueix0aGlzfSxkb3Q6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMueCp0LngrdGhpcy55KnQueSt0aGlzLnoqdC56fSxsZW5ndGhTcTpmdW5jdGlvbigpe3JldHVybiB0aGlzLngqdGhpcy54K3RoaXMueSp0aGlzLnkrdGhpcy56KnRoaXMuen0sbGVuZ3RoOmZ1bmN0aW9uKCl7cmV0dXJuIE1hdGguc3FydCh0aGlzLngqdGhpcy54K3RoaXMueSp0aGlzLnkrdGhpcy56KnRoaXMueil9LGxlbmd0aE1hbmhhdHRhbjpmdW5jdGlvbigpe3JldHVybiBNYXRoLmFicyh0aGlzLngpK01hdGguYWJzKHRoaXMueSkrTWF0aC5hYnModGhpcy56KX0sbm9ybWFsaXplOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZGl2aWRlU2NhbGFyKHRoaXMubGVuZ3RoKCkpfSxzZXRMZW5ndGg6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMubXVsdGlwbHlTY2FsYXIodC90aGlzLmxlbmd0aCgpKX0sbGVycDpmdW5jdGlvbih0LGkpe3JldHVybiB0aGlzLngrPSh0LngtdGhpcy54KSppLHRoaXMueSs9KHQueS10aGlzLnkpKmksdGhpcy56Kz0odC56LXRoaXMueikqaSx0aGlzfSxsZXJwVmVjdG9yczpmdW5jdGlvbih0LGkscyl7cmV0dXJuIHRoaXMuc3ViVmVjdG9ycyhpLHQpLm11bHRpcGx5U2NhbGFyKHMpLmFkZCh0KX0sY3Jvc3M6ZnVuY3Rpb24odCxpKXtpZih2b2lkIDAhPT1pKXJldHVybiBjb25zb2xlLndhcm4oXCJUSFJFRS5WZWN0b3IzOiAuY3Jvc3MoKSBub3cgb25seSBhY2NlcHRzIG9uZSBhcmd1bWVudC4gVXNlIC5jcm9zc1ZlY3RvcnMoIGEsIGIgKSBpbnN0ZWFkLlwiKSx0aGlzLmNyb3NzVmVjdG9ycyh0LGkpO3ZhciBzPXRoaXMueCxuPXRoaXMueSxyPXRoaXMuejtyZXR1cm4gdGhpcy54PW4qdC56LXIqdC55LHRoaXMueT1yKnQueC1zKnQueix0aGlzLno9cyp0Lnktbip0LngsdGhpc30sY3Jvc3NWZWN0b3JzOmZ1bmN0aW9uKHQsaSl7dmFyIHM9dC54LG49dC55LHI9dC56LGg9aS54LGU9aS55LG89aS56O3JldHVybiB0aGlzLng9bipvLXIqZSx0aGlzLnk9cipoLXMqbyx0aGlzLno9cyplLW4qaCx0aGlzfSxwcm9qZWN0T25WZWN0b3I6ZnVuY3Rpb24odCl7dmFyIGk9dC5kb3QodGhpcykvdC5sZW5ndGhTcSgpO3JldHVybiB0aGlzLmNvcHkodCkubXVsdGlwbHlTY2FsYXIoaSl9LHByb2plY3RPblBsYW5lOmZ1bmN0aW9uKCl7dmFyIHQ7cmV0dXJuIGZ1bmN0aW9uKGkpe3JldHVybiB2b2lkIDA9PT10JiYodD1uZXcgVEhSRUUuVmVjdG9yMyksdC5jb3B5KHRoaXMpLnByb2plY3RPblZlY3RvcihpKSx0aGlzLnN1Yih0KX19KCkscmVmbGVjdDpmdW5jdGlvbigpe3ZhciB0O3JldHVybiBmdW5jdGlvbihpKXtyZXR1cm4gdm9pZCAwPT09dCYmKHQ9bmV3IFRIUkVFLlZlY3RvcjMpLHRoaXMuc3ViKHQuY29weShpKS5tdWx0aXBseVNjYWxhcigyKnRoaXMuZG90KGkpKSl9fSgpLGFuZ2xlVG86ZnVuY3Rpb24odCl7dmFyIGk9dGhpcy5kb3QodCkvTWF0aC5zcXJ0KHRoaXMubGVuZ3RoU3EoKSp0Lmxlbmd0aFNxKCkpO3JldHVybiBNYXRoLmFjb3MoVEhSRUUuTWF0aC5jbGFtcChpLC0xLDEpKX0sZGlzdGFuY2VUbzpmdW5jdGlvbih0KXtyZXR1cm4gTWF0aC5zcXJ0KHRoaXMuZGlzdGFuY2VUb1NxdWFyZWQodCkpfSxkaXN0YW5jZVRvU3F1YXJlZDpmdW5jdGlvbih0KXt2YXIgaT10aGlzLngtdC54LHM9dGhpcy55LXQueSxuPXRoaXMuei10Lno7cmV0dXJuIGkqaStzKnMrbipufSxkaXN0YW5jZVRvTWFuaGF0dGFuOmZ1bmN0aW9uKHQpe3JldHVybiBNYXRoLmFicyh0aGlzLngtdC54KStNYXRoLmFicyh0aGlzLnktdC55KStNYXRoLmFicyh0aGlzLnotdC56KX0sc2V0RnJvbVNwaGVyaWNhbDpmdW5jdGlvbih0KXt2YXIgaT1NYXRoLnNpbih0LnBoaSkqdC5yYWRpdXM7cmV0dXJuIHRoaXMueD1pKk1hdGguc2luKHQudGhldGEpLHRoaXMueT1NYXRoLmNvcyh0LnBoaSkqdC5yYWRpdXMsdGhpcy56PWkqTWF0aC5jb3ModC50aGV0YSksdGhpc30sc2V0RnJvbU1hdHJpeFBvc2l0aW9uOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLnNldEZyb21NYXRyaXhDb2x1bW4odCwzKX0sc2V0RnJvbU1hdHJpeFNjYWxlOmZ1bmN0aW9uKHQpe3ZhciBpPXRoaXMuc2V0RnJvbU1hdHJpeENvbHVtbih0LDApLmxlbmd0aCgpLHM9dGhpcy5zZXRGcm9tTWF0cml4Q29sdW1uKHQsMSkubGVuZ3RoKCksbj10aGlzLnNldEZyb21NYXRyaXhDb2x1bW4odCwyKS5sZW5ndGgoKTtyZXR1cm4gdGhpcy54PWksdGhpcy55PXMsdGhpcy56PW4sdGhpc30sc2V0RnJvbU1hdHJpeENvbHVtbjpmdW5jdGlvbih0LGkpe2lmKFwibnVtYmVyXCI9PXR5cGVvZiB0KXtjb25zb2xlLndhcm4oXCJUSFJFRS5WZWN0b3IzOiBzZXRGcm9tTWF0cml4Q29sdW1uIG5vdyBleHBlY3RzICggbWF0cml4LCBpbmRleCApLlwiKTt2YXIgcz10O3Q9aSxpPXN9cmV0dXJuIHRoaXMuZnJvbUFycmF5KHQuZWxlbWVudHMsNCppKX0sZXF1YWxzOmZ1bmN0aW9uKHQpe3JldHVybiB0Lng9PT10aGlzLngmJnQueT09PXRoaXMueSYmdC56PT09dGhpcy56fSxmcm9tQXJyYXk6ZnVuY3Rpb24odCxpKXtyZXR1cm4gdm9pZCAwPT09aSYmKGk9MCksdGhpcy54PXRbaV0sdGhpcy55PXRbaSsxXSx0aGlzLno9dFtpKzJdLHRoaXN9LHRvQXJyYXk6ZnVuY3Rpb24odCxpKXtyZXR1cm4gdm9pZCAwPT09dCYmKHQ9W10pLHZvaWQgMD09PWkmJihpPTApLHRbaV09dGhpcy54LHRbaSsxXT10aGlzLnksdFtpKzJdPXRoaXMueix0fSxmcm9tQXR0cmlidXRlOmZ1bmN0aW9uKHQsaSxzKXtyZXR1cm4gdm9pZCAwPT09cyYmKHM9MCksaT1pKnQuaXRlbVNpemUrcyx0aGlzLng9dC5hcnJheVtpXSx0aGlzLnk9dC5hcnJheVtpKzFdLHRoaXMuej10LmFycmF5W2krMl0sdGhpc319OyIsIlRIUkVFLk1hdHJpeDQ9ZnVuY3Rpb24oKXt0aGlzLmVsZW1lbnRzPW5ldyBGbG9hdDMyQXJyYXkoWzEsMCwwLDAsMCwxLDAsMCwwLDAsMSwwLDAsMCwwLDFdKSxhcmd1bWVudHMubGVuZ3RoPjAmJmNvbnNvbGUuZXJyb3IoXCJUSFJFRS5NYXRyaXg0OiB0aGUgY29uc3RydWN0b3Igbm8gbG9uZ2VyIHJlYWRzIGFyZ3VtZW50cy4gdXNlIC5zZXQoKSBpbnN0ZWFkLlwiKX0sVEhSRUUuTWF0cml4NC5wcm90b3R5cGU9e2NvbnN0cnVjdG9yOlRIUkVFLk1hdHJpeDQsc2V0OmZ1bmN0aW9uKHQsZSxyLG4saSxzLG8sYSx1LGwsaCxjLG0sZix2LHkpe3ZhciBFPXRoaXMuZWxlbWVudHM7cmV0dXJuIEVbMF09dCxFWzRdPWUsRVs4XT1yLEVbMTJdPW4sRVsxXT1pLEVbNV09cyxFWzldPW8sRVsxM109YSxFWzJdPXUsRVs2XT1sLEVbMTBdPWgsRVsxNF09YyxFWzNdPW0sRVs3XT1mLEVbMTFdPXYsRVsxNV09eSx0aGlzfSxpZGVudGl0eTpmdW5jdGlvbigpe3JldHVybiB0aGlzLnNldCgxLDAsMCwwLDAsMSwwLDAsMCwwLDEsMCwwLDAsMCwxKSx0aGlzfSxjbG9uZTpmdW5jdGlvbigpe3JldHVybihuZXcgVEhSRUUuTWF0cml4NCkuZnJvbUFycmF5KHRoaXMuZWxlbWVudHMpfSxjb3B5OmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLmVsZW1lbnRzLnNldCh0LmVsZW1lbnRzKSx0aGlzfSxjb3B5UG9zaXRpb246ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy5lbGVtZW50cyxyPXQuZWxlbWVudHM7cmV0dXJuIGVbMTJdPXJbMTJdLGVbMTNdPXJbMTNdLGVbMTRdPXJbMTRdLHRoaXN9LGV4dHJhY3RCYXNpczpmdW5jdGlvbih0LGUscil7cmV0dXJuIHQuc2V0RnJvbU1hdHJpeENvbHVtbih0aGlzLDApLGUuc2V0RnJvbU1hdHJpeENvbHVtbih0aGlzLDEpLHIuc2V0RnJvbU1hdHJpeENvbHVtbih0aGlzLDIpLHRoaXN9LG1ha2VCYXNpczpmdW5jdGlvbih0LGUscil7cmV0dXJuIHRoaXMuc2V0KHQueCxlLngsci54LDAsdC55LGUueSxyLnksMCx0LnosZS56LHIueiwwLDAsMCwwLDEpLHRoaXN9LGV4dHJhY3RSb3RhdGlvbjpmdW5jdGlvbigpe3ZhciB0O3JldHVybiBmdW5jdGlvbihlKXt2b2lkIDA9PT10JiYodD1uZXcgVEhSRUUuVmVjdG9yMyk7dmFyIHI9dGhpcy5lbGVtZW50cyxuPWUuZWxlbWVudHMsaT0xL3Quc2V0RnJvbU1hdHJpeENvbHVtbihlLDApLmxlbmd0aCgpLHM9MS90LnNldEZyb21NYXRyaXhDb2x1bW4oZSwxKS5sZW5ndGgoKSxvPTEvdC5zZXRGcm9tTWF0cml4Q29sdW1uKGUsMikubGVuZ3RoKCk7cmV0dXJuIHJbMF09blswXSppLHJbMV09blsxXSppLHJbMl09blsyXSppLHJbNF09bls0XSpzLHJbNV09bls1XSpzLHJbNl09bls2XSpzLHJbOF09bls4XSpvLHJbOV09bls5XSpvLHJbMTBdPW5bMTBdKm8sdGhpc319KCksbWFrZVJvdGF0aW9uRnJvbUV1bGVyOmZ1bmN0aW9uKHQpe3QgaW5zdGFuY2VvZiBUSFJFRS5FdWxlcj09ITEmJmNvbnNvbGUuZXJyb3IoXCJUSFJFRS5NYXRyaXg6IC5tYWtlUm90YXRpb25Gcm9tRXVsZXIoKSBub3cgZXhwZWN0cyBhIEV1bGVyIHJvdGF0aW9uIHJhdGhlciB0aGFuIGEgVmVjdG9yMyBhbmQgb3JkZXIuXCIpO3ZhciBlPXRoaXMuZWxlbWVudHMscj10Lngsbj10LnksaT10Lnoscz1NYXRoLmNvcyhyKSxvPU1hdGguc2luKHIpLGE9TWF0aC5jb3MobiksdT1NYXRoLnNpbihuKSxsPU1hdGguY29zKGkpLGg9TWF0aC5zaW4oaSk7aWYoXCJYWVpcIj09PXQub3JkZXIpe3ZhciBjPXMqbCxtPXMqaCxmPW8qbCx2PW8qaDtlWzBdPWEqbCxlWzRdPS1hKmgsZVs4XT11LGVbMV09bStmKnUsZVs1XT1jLXYqdSxlWzldPS1vKmEsZVsyXT12LWMqdSxlWzZdPWYrbSp1LGVbMTBdPXMqYX1lbHNlIGlmKFwiWVhaXCI9PT10Lm9yZGVyKXt2YXIgeT1hKmwsRT1hKmgsTT11KmwseD11Kmg7ZVswXT15K3gqbyxlWzRdPU0qby1FLGVbOF09cyp1LGVbMV09cypoLGVbNV09cypsLGVbOV09LW8sZVsyXT1FKm8tTSxlWzZdPXgreSpvLGVbMTBdPXMqYX1lbHNlIGlmKFwiWlhZXCI9PT10Lm9yZGVyKXt2YXIgeT1hKmwsRT1hKmgsTT11KmwseD11Kmg7ZVswXT15LXgqbyxlWzRdPS1zKmgsZVs4XT1NK0UqbyxlWzFdPUUrTSpvLGVbNV09cypsLGVbOV09eC15Km8sZVsyXT0tcyp1LGVbNl09byxlWzEwXT1zKmF9ZWxzZSBpZihcIlpZWFwiPT09dC5vcmRlcil7dmFyIGM9cypsLG09cypoLGY9bypsLHY9bypoO2VbMF09YSpsLGVbNF09Zip1LW0sZVs4XT1jKnUrdixlWzFdPWEqaCxlWzVdPXYqdStjLGVbOV09bSp1LWYsZVsyXT0tdSxlWzZdPW8qYSxlWzEwXT1zKmF9ZWxzZSBpZihcIllaWFwiPT09dC5vcmRlcil7dmFyIGQ9cyphLHA9cyp1LFI9byphLFQ9byp1O2VbMF09YSpsLGVbNF09VC1kKmgsZVs4XT1SKmgrcCxlWzFdPWgsZVs1XT1zKmwsZVs5XT0tbypsLGVbMl09LXUqbCxlWzZdPXAqaCtSLGVbMTBdPWQtVCpofWVsc2UgaWYoXCJYWllcIj09PXQub3JkZXIpe3ZhciBkPXMqYSxwPXMqdSxSPW8qYSxUPW8qdTtlWzBdPWEqbCxlWzRdPS1oLGVbOF09dSpsLGVbMV09ZCpoK1QsZVs1XT1zKmwsZVs5XT1wKmgtUixlWzJdPVIqaC1wLGVbNl09bypsLGVbMTBdPVQqaCtkfXJldHVybiBlWzNdPTAsZVs3XT0wLGVbMTFdPTAsZVsxMl09MCxlWzEzXT0wLGVbMTRdPTAsZVsxNV09MSx0aGlzfSxtYWtlUm90YXRpb25Gcm9tUXVhdGVybmlvbjpmdW5jdGlvbih0KXt2YXIgZT10aGlzLmVsZW1lbnRzLHI9dC54LG49dC55LGk9dC56LHM9dC53LG89cityLGE9bituLHU9aStpLGw9cipvLGg9ciphLGM9cip1LG09biphLGY9bip1LHY9aSp1LHk9cypvLEU9cyphLE09cyp1O3JldHVybiBlWzBdPTEtKG0rdiksZVs0XT1oLU0sZVs4XT1jK0UsZVsxXT1oK00sZVs1XT0xLShsK3YpLGVbOV09Zi15LGVbMl09Yy1FLGVbNl09Zit5LGVbMTBdPTEtKGwrbSksZVszXT0wLGVbN109MCxlWzExXT0wLGVbMTJdPTAsZVsxM109MCxlWzE0XT0wLGVbMTVdPTEsdGhpc30sbG9va0F0OmZ1bmN0aW9uKCl7dmFyIHQsZSxyO3JldHVybiBmdW5jdGlvbihuLGkscyl7dm9pZCAwPT09dCYmKHQ9bmV3IFRIUkVFLlZlY3RvcjMsZT1uZXcgVEhSRUUuVmVjdG9yMyxyPW5ldyBUSFJFRS5WZWN0b3IzKTt2YXIgbz10aGlzLmVsZW1lbnRzO3JldHVybiByLnN1YlZlY3RvcnMobixpKS5ub3JtYWxpemUoKSwwPT09ci5sZW5ndGhTcSgpJiYoci56PTEpLHQuY3Jvc3NWZWN0b3JzKHMscikubm9ybWFsaXplKCksMD09PXQubGVuZ3RoU3EoKSYmKHIueis9MWUtNCx0LmNyb3NzVmVjdG9ycyhzLHIpLm5vcm1hbGl6ZSgpKSxlLmNyb3NzVmVjdG9ycyhyLHQpLG9bMF09dC54LG9bNF09ZS54LG9bOF09ci54LG9bMV09dC55LG9bNV09ZS55LG9bOV09ci55LG9bMl09dC56LG9bNl09ZS56LG9bMTBdPXIueix0aGlzfX0oKSxtdWx0aXBseTpmdW5jdGlvbih0LGUpe3JldHVybiB2b2lkIDAhPT1lPyhjb25zb2xlLndhcm4oXCJUSFJFRS5NYXRyaXg0OiAubXVsdGlwbHkoKSBub3cgb25seSBhY2NlcHRzIG9uZSBhcmd1bWVudC4gVXNlIC5tdWx0aXBseU1hdHJpY2VzKCBhLCBiICkgaW5zdGVhZC5cIiksdGhpcy5tdWx0aXBseU1hdHJpY2VzKHQsZSkpOnRoaXMubXVsdGlwbHlNYXRyaWNlcyh0aGlzLHQpfSxwcmVtdWx0aXBseTpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5tdWx0aXBseU1hdHJpY2VzKHQsdGhpcyl9LG11bHRpcGx5TWF0cmljZXM6ZnVuY3Rpb24odCxlKXt2YXIgcj10LmVsZW1lbnRzLG49ZS5lbGVtZW50cyxpPXRoaXMuZWxlbWVudHMscz1yWzBdLG89cls0XSxhPXJbOF0sdT1yWzEyXSxsPXJbMV0saD1yWzVdLGM9cls5XSxtPXJbMTNdLGY9clsyXSx2PXJbNl0seT1yWzEwXSxFPXJbMTRdLE09clszXSx4PXJbN10sZD1yWzExXSxwPXJbMTVdLFI9blswXSxUPW5bNF0sZz1uWzhdLHo9blsxMl0sSD1uWzFdLHc9bls1XSxrPW5bOV0sQT1uWzEzXSxGPW5bMl0sVj1uWzZdLFg9blsxMF0sWT1uWzE0XSxaPW5bM10sQz1uWzddLFA9blsxMV0sUz1uWzE1XTtyZXR1cm4gaVswXT1zKlIrbypIK2EqRit1KlosaVs0XT1zKlQrbyp3K2EqVit1KkMsaVs4XT1zKmcrbyprK2EqWCt1KlAsaVsxMl09cyp6K28qQSthKlkrdSpTLGlbMV09bCpSK2gqSCtjKkYrbSpaLGlbNV09bCpUK2gqdytjKlYrbSpDLGlbOV09bCpnK2gqaytjKlgrbSpQLGlbMTNdPWwqeitoKkErYypZK20qUyxpWzJdPWYqUit2KkgreSpGK0UqWixpWzZdPWYqVCt2KncreSpWK0UqQyxpWzEwXT1mKmcrdiprK3kqWCtFKlAsaVsxNF09Zip6K3YqQSt5KlkrRSpTLGlbM109TSpSK3gqSCtkKkYrcCpaLGlbN109TSpUK3gqdytkKlYrcCpDLGlbMTFdPU0qZyt4KmsrZCpYK3AqUCxpWzE1XT1NKnoreCpBK2QqWStwKlMsdGhpc30sbXVsdGlwbHlUb0FycmF5OmZ1bmN0aW9uKHQsZSxyKXt2YXIgbj10aGlzLmVsZW1lbnRzO3JldHVybiB0aGlzLm11bHRpcGx5TWF0cmljZXModCxlKSxyWzBdPW5bMF0sclsxXT1uWzFdLHJbMl09blsyXSxyWzNdPW5bM10scls0XT1uWzRdLHJbNV09bls1XSxyWzZdPW5bNl0scls3XT1uWzddLHJbOF09bls4XSxyWzldPW5bOV0sclsxMF09blsxMF0sclsxMV09blsxMV0sclsxMl09blsxMl0sclsxM109blsxM10sclsxNF09blsxNF0sclsxNV09blsxNV0sdGhpc30sbXVsdGlwbHlTY2FsYXI6ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy5lbGVtZW50cztyZXR1cm4gZVswXSo9dCxlWzRdKj10LGVbOF0qPXQsZVsxMl0qPXQsZVsxXSo9dCxlWzVdKj10LGVbOV0qPXQsZVsxM10qPXQsZVsyXSo9dCxlWzZdKj10LGVbMTBdKj10LGVbMTRdKj10LGVbM10qPXQsZVs3XSo9dCxlWzExXSo9dCxlWzE1XSo9dCx0aGlzfSxhcHBseVRvVmVjdG9yM0FycmF5OmZ1bmN0aW9uKCl7dmFyIHQ7cmV0dXJuIGZ1bmN0aW9uKGUscixuKXt2b2lkIDA9PT10JiYodD1uZXcgVEhSRUUuVmVjdG9yMyksdm9pZCAwPT09ciYmKHI9MCksdm9pZCAwPT09biYmKG49ZS5sZW5ndGgpO2Zvcih2YXIgaT0wLHM9cjtpPG47aSs9MyxzKz0zKXQuZnJvbUFycmF5KGUscyksdC5hcHBseU1hdHJpeDQodGhpcyksdC50b0FycmF5KGUscyk7cmV0dXJuIGV9fSgpLGFwcGx5VG9CdWZmZXI6ZnVuY3Rpb24oKXt2YXIgdDtyZXR1cm4gZnVuY3Rpb24oZSxyLG4pe3ZvaWQgMD09PXQmJih0PW5ldyBUSFJFRS5WZWN0b3IzKSx2b2lkIDA9PT1yJiYocj0wKSx2b2lkIDA9PT1uJiYobj1lLmxlbmd0aC9lLml0ZW1TaXplKTtmb3IodmFyIGk9MCxzPXI7aTxuO2krKyxzKyspdC54PWUuZ2V0WChzKSx0Lnk9ZS5nZXRZKHMpLHQuej1lLmdldFoocyksdC5hcHBseU1hdHJpeDQodGhpcyksZS5zZXRYWVoodC54LHQueSx0LnopO3JldHVybiBlfX0oKSxkZXRlcm1pbmFudDpmdW5jdGlvbigpe3ZhciB0PXRoaXMuZWxlbWVudHMsZT10WzBdLHI9dFs0XSxuPXRbOF0saT10WzEyXSxzPXRbMV0sbz10WzVdLGE9dFs5XSx1PXRbMTNdLGw9dFsyXSxoPXRbNl0sYz10WzEwXSxtPXRbMTRdLGY9dFszXSx2PXRbN10seT10WzExXSxFPXRbMTVdO3JldHVybiBmKigraSphKmgtbip1KmgtaSpvKmMrcip1KmMrbipvKm0tciphKm0pK3YqKCtlKmEqbS1lKnUqYytpKnMqYy1uKnMqbStuKnUqbC1pKmEqbCkreSooK2UqdSpoLWUqbyptLWkqcypoK3IqcyptK2kqbypsLXIqdSpsKStFKigtbipvKmwtZSphKmgrZSpvKmMrbipzKmgtcipzKmMrciphKmwpfSx0cmFuc3Bvc2U6ZnVuY3Rpb24oKXt2YXIgdCxlPXRoaXMuZWxlbWVudHM7cmV0dXJuIHQ9ZVsxXSxlWzFdPWVbNF0sZVs0XT10LHQ9ZVsyXSxlWzJdPWVbOF0sZVs4XT10LHQ9ZVs2XSxlWzZdPWVbOV0sZVs5XT10LHQ9ZVszXSxlWzNdPWVbMTJdLGVbMTJdPXQsdD1lWzddLGVbN109ZVsxM10sZVsxM109dCx0PWVbMTFdLGVbMTFdPWVbMTRdLGVbMTRdPXQsdGhpc30sZmxhdHRlblRvQXJyYXlPZmZzZXQ6ZnVuY3Rpb24odCxlKXtyZXR1cm4gY29uc29sZS53YXJuKFwiVEhSRUUuTWF0cml4MzogLmZsYXR0ZW5Ub0FycmF5T2Zmc2V0IGlzIGRlcHJlY2F0ZWQgLSBqdXN0IHVzZSAudG9BcnJheSBpbnN0ZWFkLlwiKSx0aGlzLnRvQXJyYXkodCxlKX0sZ2V0UG9zaXRpb246ZnVuY3Rpb24oKXt2YXIgdDtyZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gdm9pZCAwPT09dCYmKHQ9bmV3IFRIUkVFLlZlY3RvcjMpLGNvbnNvbGUud2FybihcIlRIUkVFLk1hdHJpeDQ6IC5nZXRQb3NpdGlvbigpIGhhcyBiZWVuIHJlbW92ZWQuIFVzZSBWZWN0b3IzLnNldEZyb21NYXRyaXhQb3NpdGlvbiggbWF0cml4ICkgaW5zdGVhZC5cIiksdC5zZXRGcm9tTWF0cml4Q29sdW1uKHRoaXMsMyl9fSgpLHNldFBvc2l0aW9uOmZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMuZWxlbWVudHM7cmV0dXJuIGVbMTJdPXQueCxlWzEzXT10LnksZVsxNF09dC56LHRoaXN9LGdldEludmVyc2U6ZnVuY3Rpb24odCxlKXt2YXIgcj10aGlzLmVsZW1lbnRzLG49dC5lbGVtZW50cyxpPW5bMF0scz1uWzFdLG89blsyXSxhPW5bM10sdT1uWzRdLGw9bls1XSxoPW5bNl0sYz1uWzddLG09bls4XSxmPW5bOV0sdj1uWzEwXSx5PW5bMTFdLEU9blsxMl0sTT1uWzEzXSx4PW5bMTRdLGQ9blsxNV0scD1mKngqYy1NKnYqYytNKmgqeS1sKngqeS1mKmgqZCtsKnYqZCxSPUUqdipjLW0qeCpjLUUqaCp5K3UqeCp5K20qaCpkLXUqdipkLFQ9bSpNKmMtRSpmKmMrRSpsKnktdSpNKnktbSpsKmQrdSpmKmQsZz1FKmYqaC1tKk0qaC1FKmwqdit1Kk0qdittKmwqeC11KmYqeCx6PWkqcCtzKlIrbypUK2EqZztpZigwPT09eil7dmFyIEg9XCJUSFJFRS5NYXRyaXg0LmdldEludmVyc2UoKTogY2FuJ3QgaW52ZXJ0IG1hdHJpeCwgZGV0ZXJtaW5hbnQgaXMgMFwiO2lmKGUpdGhyb3cgbmV3IEVycm9yKEgpO3JldHVybiBjb25zb2xlLndhcm4oSCksdGhpcy5pZGVudGl0eSgpfXZhciB3PTEvejtyZXR1cm4gclswXT1wKncsclsxXT0oTSp2KmEtZip4KmEtTSpvKnkrcyp4KnkrZipvKmQtcyp2KmQpKncsclsyXT0obCp4KmEtTSpoKmErTSpvKmMtcyp4KmMtbCpvKmQrcypoKmQpKncsclszXT0oZipoKmEtbCp2KmEtZipvKmMrcyp2KmMrbCpvKnktcypoKnkpKncscls0XT1SKncscls1XT0obSp4KmEtRSp2KmErRSpvKnktaSp4KnktbSpvKmQraSp2KmQpKncscls2XT0oRSpoKmEtdSp4KmEtRSpvKmMraSp4KmMrdSpvKmQtaSpoKmQpKncscls3XT0odSp2KmEtbSpoKmErbSpvKmMtaSp2KmMtdSpvKnkraSpoKnkpKncscls4XT1UKncscls5XT0oRSpmKmEtbSpNKmEtRSpzKnkraSpNKnkrbSpzKmQtaSpmKmQpKncsclsxMF09KHUqTSphLUUqbCphK0UqcypjLWkqTSpjLXUqcypkK2kqbCpkKSp3LHJbMTFdPShtKmwqYS11KmYqYS1tKnMqYytpKmYqYyt1KnMqeS1pKmwqeSkqdyxyWzEyXT1nKncsclsxM109KG0qTSpvLUUqZipvK0Uqcyp2LWkqTSp2LW0qcyp4K2kqZip4KSp3LHJbMTRdPShFKmwqby11Kk0qby1FKnMqaCtpKk0qaCt1KnMqeC1pKmwqeCkqdyxyWzE1XT0odSpmKm8tbSpsKm8rbSpzKmgtaSpmKmgtdSpzKnYraSpsKnYpKncsdGhpc30sc2NhbGU6ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy5lbGVtZW50cyxyPXQueCxuPXQueSxpPXQuejtyZXR1cm4gZVswXSo9cixlWzRdKj1uLGVbOF0qPWksZVsxXSo9cixlWzVdKj1uLGVbOV0qPWksZVsyXSo9cixlWzZdKj1uLGVbMTBdKj1pLGVbM10qPXIsZVs3XSo9bixlWzExXSo9aSx0aGlzfSxnZXRNYXhTY2FsZU9uQXhpczpmdW5jdGlvbigpe3ZhciB0PXRoaXMuZWxlbWVudHMsZT10WzBdKnRbMF0rdFsxXSp0WzFdK3RbMl0qdFsyXSxyPXRbNF0qdFs0XSt0WzVdKnRbNV0rdFs2XSp0WzZdLG49dFs4XSp0WzhdK3RbOV0qdFs5XSt0WzEwXSp0WzEwXTtyZXR1cm4gTWF0aC5zcXJ0KE1hdGgubWF4KGUscixuKSl9LG1ha2VUcmFuc2xhdGlvbjpmdW5jdGlvbih0LGUscil7cmV0dXJuIHRoaXMuc2V0KDEsMCwwLHQsMCwxLDAsZSwwLDAsMSxyLDAsMCwwLDEpLHRoaXN9LG1ha2VSb3RhdGlvblg6ZnVuY3Rpb24odCl7dmFyIGU9TWF0aC5jb3ModCkscj1NYXRoLnNpbih0KTtyZXR1cm4gdGhpcy5zZXQoMSwwLDAsMCwwLGUsLXIsMCwwLHIsZSwwLDAsMCwwLDEpLHRoaXN9LG1ha2VSb3RhdGlvblk6ZnVuY3Rpb24odCl7dmFyIGU9TWF0aC5jb3ModCkscj1NYXRoLnNpbih0KTtyZXR1cm4gdGhpcy5zZXQoZSwwLHIsMCwwLDEsMCwwLC1yLDAsZSwwLDAsMCwwLDEpLHRoaXN9LG1ha2VSb3RhdGlvblo6ZnVuY3Rpb24odCl7dmFyIGU9TWF0aC5jb3ModCkscj1NYXRoLnNpbih0KTtyZXR1cm4gdGhpcy5zZXQoZSwtciwwLDAscixlLDAsMCwwLDAsMSwwLDAsMCwwLDEpLHRoaXN9LG1ha2VSb3RhdGlvbkF4aXM6ZnVuY3Rpb24odCxlKXt2YXIgcj1NYXRoLmNvcyhlKSxuPU1hdGguc2luKGUpLGk9MS1yLHM9dC54LG89dC55LGE9dC56LHU9aSpzLGw9aSpvO3JldHVybiB0aGlzLnNldCh1KnMrcix1Km8tbiphLHUqYStuKm8sMCx1Km8rbiphLGwqbytyLGwqYS1uKnMsMCx1KmEtbipvLGwqYStuKnMsaSphKmErciwwLDAsMCwwLDEpLHRoaXN9LG1ha2VTY2FsZTpmdW5jdGlvbih0LGUscil7cmV0dXJuIHRoaXMuc2V0KHQsMCwwLDAsMCxlLDAsMCwwLDAsciwwLDAsMCwwLDEpLHRoaXN9LGNvbXBvc2U6ZnVuY3Rpb24odCxlLHIpe3JldHVybiB0aGlzLm1ha2VSb3RhdGlvbkZyb21RdWF0ZXJuaW9uKGUpLHRoaXMuc2NhbGUociksdGhpcy5zZXRQb3NpdGlvbih0KSx0aGlzfSxkZWNvbXBvc2U6ZnVuY3Rpb24oKXt2YXIgdCxlO3JldHVybiBmdW5jdGlvbihyLG4saSl7dm9pZCAwPT09dCYmKHQ9bmV3IFRIUkVFLlZlY3RvcjMsZT1uZXcgVEhSRUUuTWF0cml4NCk7dmFyIHM9dGhpcy5lbGVtZW50cyxvPXQuc2V0KHNbMF0sc1sxXSxzWzJdKS5sZW5ndGgoKSxhPXQuc2V0KHNbNF0sc1s1XSxzWzZdKS5sZW5ndGgoKSx1PXQuc2V0KHNbOF0sc1s5XSxzWzEwXSkubGVuZ3RoKCksbD10aGlzLmRldGVybWluYW50KCk7bDwwJiYobz0tbyksci54PXNbMTJdLHIueT1zWzEzXSxyLno9c1sxNF0sZS5lbGVtZW50cy5zZXQodGhpcy5lbGVtZW50cyk7dmFyIGg9MS9vLGM9MS9hLG09MS91O3JldHVybiBlLmVsZW1lbnRzWzBdKj1oLGUuZWxlbWVudHNbMV0qPWgsZS5lbGVtZW50c1syXSo9aCxlLmVsZW1lbnRzWzRdKj1jLGUuZWxlbWVudHNbNV0qPWMsZS5lbGVtZW50c1s2XSo9YyxlLmVsZW1lbnRzWzhdKj1tLGUuZWxlbWVudHNbOV0qPW0sZS5lbGVtZW50c1sxMF0qPW0sbi5zZXRGcm9tUm90YXRpb25NYXRyaXgoZSksaS54PW8saS55PWEsaS56PXUsdGhpc319KCksbWFrZUZydXN0dW06ZnVuY3Rpb24odCxlLHIsbixpLHMpe3ZhciBvPXRoaXMuZWxlbWVudHMsYT0yKmkvKGUtdCksdT0yKmkvKG4tciksbD0oZSt0KS8oZS10KSxoPShuK3IpLyhuLXIpLGM9LShzK2kpLyhzLWkpLG09LTIqcyppLyhzLWkpO3JldHVybiBvWzBdPWEsb1s0XT0wLG9bOF09bCxvWzEyXT0wLG9bMV09MCxvWzVdPXUsb1s5XT1oLG9bMTNdPTAsb1syXT0wLG9bNl09MCxvWzEwXT1jLG9bMTRdPW0sb1szXT0wLG9bN109MCxvWzExXT0tMSxvWzE1XT0wLHRoaXN9LG1ha2VQZXJzcGVjdGl2ZTpmdW5jdGlvbih0LGUscixuKXt2YXIgaT1yKk1hdGgudGFuKFRIUkVFLk1hdGguREVHMlJBRCp0Ki41KSxzPS1pLG89cyplLGE9aSplO3JldHVybiB0aGlzLm1ha2VGcnVzdHVtKG8sYSxzLGkscixuKX0sbWFrZU9ydGhvZ3JhcGhpYzpmdW5jdGlvbih0LGUscixuLGkscyl7dmFyIG89dGhpcy5lbGVtZW50cyxhPTEvKGUtdCksdT0xLyhyLW4pLGw9MS8ocy1pKSxoPShlK3QpKmEsYz0ocituKSp1LG09KHMraSkqbDtyZXR1cm4gb1swXT0yKmEsb1s0XT0wLG9bOF09MCxvWzEyXT0taCxvWzFdPTAsb1s1XT0yKnUsb1s5XT0wLG9bMTNdPS1jLG9bMl09MCxvWzZdPTAsb1sxMF09LTIqbCxvWzE0XT0tbSxvWzNdPTAsb1s3XT0wLG9bMTFdPTAsb1sxNV09MSx0aGlzfSxlcXVhbHM6ZnVuY3Rpb24odCl7Zm9yKHZhciBlPXRoaXMuZWxlbWVudHMscj10LmVsZW1lbnRzLG49MDtuPDE2O24rKylpZihlW25dIT09cltuXSlyZXR1cm4hMTtyZXR1cm4hMH0sZnJvbUFycmF5OmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLmVsZW1lbnRzLnNldCh0KSx0aGlzfSx0b0FycmF5OmZ1bmN0aW9uKHQsZSl7dm9pZCAwPT09dCYmKHQ9W10pLHZvaWQgMD09PWUmJihlPTApO3ZhciByPXRoaXMuZWxlbWVudHM7cmV0dXJuIHRbZV09clswXSx0W2UrMV09clsxXSx0W2UrMl09clsyXSx0W2UrM109clszXSx0W2UrNF09cls0XSx0W2UrNV09cls1XSx0W2UrNl09cls2XSx0W2UrN109cls3XSx0W2UrOF09cls4XSx0W2UrOV09cls5XSx0W2UrMTBdPXJbMTBdLHRbZSsxMV09clsxMV0sdFtlKzEyXT1yWzEyXSx0W2UrMTNdPXJbMTNdLHRbZSsxNF09clsxNF0sdFtlKzE1XT1yWzE1XSx0fX07IiwiVEhSRUUuUXVhdGVybmlvbj1mdW5jdGlvbih0LGkscyxoKXt0aGlzLl94PXR8fDAsdGhpcy5feT1pfHwwLHRoaXMuX3o9c3x8MCx0aGlzLl93PXZvaWQgMCE9PWg/aDoxfSxUSFJFRS5RdWF0ZXJuaW9uLnByb3RvdHlwZT17Y29uc3RydWN0b3I6VEhSRUUuUXVhdGVybmlvbixnZXQgeCgpe3JldHVybiB0aGlzLl94fSxzZXQgeCh0KXt0aGlzLl94PXQsdGhpcy5vbkNoYW5nZUNhbGxiYWNrKCl9LGdldCB5KCl7cmV0dXJuIHRoaXMuX3l9LHNldCB5KHQpe3RoaXMuX3k9dCx0aGlzLm9uQ2hhbmdlQ2FsbGJhY2soKX0sZ2V0IHooKXtyZXR1cm4gdGhpcy5fen0sc2V0IHoodCl7dGhpcy5fej10LHRoaXMub25DaGFuZ2VDYWxsYmFjaygpfSxnZXQgdygpe3JldHVybiB0aGlzLl93fSxzZXQgdyh0KXt0aGlzLl93PXQsdGhpcy5vbkNoYW5nZUNhbGxiYWNrKCl9LHNldDpmdW5jdGlvbih0LGkscyxoKXtyZXR1cm4gdGhpcy5feD10LHRoaXMuX3k9aSx0aGlzLl96PXMsdGhpcy5fdz1oLHRoaXMub25DaGFuZ2VDYWxsYmFjaygpLHRoaXN9LGNsb25lOmZ1bmN0aW9uKCl7cmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKHRoaXMuX3gsdGhpcy5feSx0aGlzLl96LHRoaXMuX3cpfSxjb3B5OmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLl94PXQueCx0aGlzLl95PXQueSx0aGlzLl96PXQueix0aGlzLl93PXQudyx0aGlzLm9uQ2hhbmdlQ2FsbGJhY2soKSx0aGlzfSxzZXRGcm9tRXVsZXI6ZnVuY3Rpb24odCxpKXtpZih0IGluc3RhbmNlb2YgVEhSRUUuRXVsZXI9PSExKXRocm93IG5ldyBFcnJvcihcIlRIUkVFLlF1YXRlcm5pb246IC5zZXRGcm9tRXVsZXIoKSBub3cgZXhwZWN0cyBhIEV1bGVyIHJvdGF0aW9uIHJhdGhlciB0aGFuIGEgVmVjdG9yMyBhbmQgb3JkZXIuXCIpO3ZhciBzPU1hdGguY29zKHQuX3gvMiksaD1NYXRoLmNvcyh0Ll95LzIpLG49TWF0aC5jb3ModC5fei8yKSxfPU1hdGguc2luKHQuX3gvMikscj1NYXRoLnNpbih0Ll95LzIpLGU9TWF0aC5zaW4odC5fei8yKSxhPXQub3JkZXI7cmV0dXJuXCJYWVpcIj09PWE/KHRoaXMuX3g9XypoKm4rcypyKmUsdGhpcy5feT1zKnIqbi1fKmgqZSx0aGlzLl96PXMqaCplK18qcipuLHRoaXMuX3c9cypoKm4tXypyKmUpOlwiWVhaXCI9PT1hPyh0aGlzLl94PV8qaCpuK3MqciplLHRoaXMuX3k9cypyKm4tXypoKmUsdGhpcy5fej1zKmgqZS1fKnIqbix0aGlzLl93PXMqaCpuK18qciplKTpcIlpYWVwiPT09YT8odGhpcy5feD1fKmgqbi1zKnIqZSx0aGlzLl95PXMqcipuK18qaCplLHRoaXMuX3o9cypoKmUrXypyKm4sdGhpcy5fdz1zKmgqbi1fKnIqZSk6XCJaWVhcIj09PWE/KHRoaXMuX3g9XypoKm4tcypyKmUsdGhpcy5feT1zKnIqbitfKmgqZSx0aGlzLl96PXMqaCplLV8qcipuLHRoaXMuX3c9cypoKm4rXypyKmUpOlwiWVpYXCI9PT1hPyh0aGlzLl94PV8qaCpuK3MqciplLHRoaXMuX3k9cypyKm4rXypoKmUsdGhpcy5fej1zKmgqZS1fKnIqbix0aGlzLl93PXMqaCpuLV8qciplKTpcIlhaWVwiPT09YSYmKHRoaXMuX3g9XypoKm4tcypyKmUsdGhpcy5feT1zKnIqbi1fKmgqZSx0aGlzLl96PXMqaCplK18qcipuLHRoaXMuX3c9cypoKm4rXypyKmUpLGkhPT0hMSYmdGhpcy5vbkNoYW5nZUNhbGxiYWNrKCksdGhpc30sc2V0RnJvbUF4aXNBbmdsZTpmdW5jdGlvbih0LGkpe3ZhciBzPWkvMixoPU1hdGguc2luKHMpO3JldHVybiB0aGlzLl94PXQueCpoLHRoaXMuX3k9dC55KmgsdGhpcy5fej10LnoqaCx0aGlzLl93PU1hdGguY29zKHMpLHRoaXMub25DaGFuZ2VDYWxsYmFjaygpLHRoaXN9LHNldEZyb21Sb3RhdGlvbk1hdHJpeDpmdW5jdGlvbih0KXt2YXIgaSxzPXQuZWxlbWVudHMsaD1zWzBdLG49c1s0XSxfPXNbOF0scj1zWzFdLGU9c1s1XSxhPXNbOV0sbz1zWzJdLHU9c1s2XSxjPXNbMTBdLGw9aCtlK2M7cmV0dXJuIGw+MD8oaT0uNS9NYXRoLnNxcnQobCsxKSx0aGlzLl93PS4yNS9pLHRoaXMuX3g9KHUtYSkqaSx0aGlzLl95PShfLW8pKmksdGhpcy5fej0oci1uKSppKTpoPmUmJmg+Yz8oaT0yKk1hdGguc3FydCgxK2gtZS1jKSx0aGlzLl93PSh1LWEpL2ksdGhpcy5feD0uMjUqaSx0aGlzLl95PShuK3IpL2ksdGhpcy5fej0oXytvKS9pKTplPmM/KGk9MipNYXRoLnNxcnQoMStlLWgtYyksdGhpcy5fdz0oXy1vKS9pLHRoaXMuX3g9KG4rcikvaSx0aGlzLl95PS4yNSppLHRoaXMuX3o9KGErdSkvaSk6KGk9MipNYXRoLnNxcnQoMStjLWgtZSksdGhpcy5fdz0oci1uKS9pLHRoaXMuX3g9KF8rbykvaSx0aGlzLl95PShhK3UpL2ksdGhpcy5fej0uMjUqaSksdGhpcy5vbkNoYW5nZUNhbGxiYWNrKCksdGhpc30sc2V0RnJvbVVuaXRWZWN0b3JzOmZ1bmN0aW9uKCl7dmFyIHQsaSxzPTFlLTY7cmV0dXJuIGZ1bmN0aW9uKGgsbil7cmV0dXJuIHZvaWQgMD09PXQmJih0PW5ldyBUSFJFRS5WZWN0b3IzKSxpPWguZG90KG4pKzEsaTxzPyhpPTAsTWF0aC5hYnMoaC54KT5NYXRoLmFicyhoLnopP3Quc2V0KC1oLnksaC54LDApOnQuc2V0KDAsLWgueixoLnkpKTp0LmNyb3NzVmVjdG9ycyhoLG4pLHRoaXMuX3g9dC54LHRoaXMuX3k9dC55LHRoaXMuX3o9dC56LHRoaXMuX3c9aSx0aGlzLm5vcm1hbGl6ZSgpfX0oKSxpbnZlcnNlOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuY29uanVnYXRlKCkubm9ybWFsaXplKCl9LGNvbmp1Z2F0ZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLl94Kj0tMSx0aGlzLl95Kj0tMSx0aGlzLl96Kj0tMSx0aGlzLm9uQ2hhbmdlQ2FsbGJhY2soKSx0aGlzfSxkb3Q6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuX3gqdC5feCt0aGlzLl95KnQuX3krdGhpcy5feip0Ll96K3RoaXMuX3cqdC5fd30sbGVuZ3RoU3E6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5feCp0aGlzLl94K3RoaXMuX3kqdGhpcy5feSt0aGlzLl96KnRoaXMuX3ordGhpcy5fdyp0aGlzLl93fSxsZW5ndGg6ZnVuY3Rpb24oKXtyZXR1cm4gTWF0aC5zcXJ0KHRoaXMuX3gqdGhpcy5feCt0aGlzLl95KnRoaXMuX3krdGhpcy5feip0aGlzLl96K3RoaXMuX3cqdGhpcy5fdyl9LG5vcm1hbGl6ZTpmdW5jdGlvbigpe3ZhciB0PXRoaXMubGVuZ3RoKCk7cmV0dXJuIDA9PT10Pyh0aGlzLl94PTAsdGhpcy5feT0wLHRoaXMuX3o9MCx0aGlzLl93PTEpOih0PTEvdCx0aGlzLl94PXRoaXMuX3gqdCx0aGlzLl95PXRoaXMuX3kqdCx0aGlzLl96PXRoaXMuX3oqdCx0aGlzLl93PXRoaXMuX3cqdCksdGhpcy5vbkNoYW5nZUNhbGxiYWNrKCksdGhpc30sbXVsdGlwbHk6ZnVuY3Rpb24odCxpKXtyZXR1cm4gdm9pZCAwIT09aT8oY29uc29sZS53YXJuKFwiVEhSRUUuUXVhdGVybmlvbjogLm11bHRpcGx5KCkgbm93IG9ubHkgYWNjZXB0cyBvbmUgYXJndW1lbnQuIFVzZSAubXVsdGlwbHlRdWF0ZXJuaW9ucyggYSwgYiApIGluc3RlYWQuXCIpLHRoaXMubXVsdGlwbHlRdWF0ZXJuaW9ucyh0LGkpKTp0aGlzLm11bHRpcGx5UXVhdGVybmlvbnModGhpcyx0KX0scHJlbXVsdGlwbHk6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMubXVsdGlwbHlRdWF0ZXJuaW9ucyh0LHRoaXMpfSxtdWx0aXBseVF1YXRlcm5pb25zOmZ1bmN0aW9uKHQsaSl7dmFyIHM9dC5feCxoPXQuX3ksbj10Ll96LF89dC5fdyxyPWkuX3gsZT1pLl95LGE9aS5feixvPWkuX3c7cmV0dXJuIHRoaXMuX3g9cypvK18qcitoKmEtbiplLHRoaXMuX3k9aCpvK18qZStuKnItcyphLHRoaXMuX3o9bipvK18qYStzKmUtaCpyLHRoaXMuX3c9XypvLXMqci1oKmUtbiphLHRoaXMub25DaGFuZ2VDYWxsYmFjaygpLHRoaXN9LHNsZXJwOmZ1bmN0aW9uKHQsaSl7aWYoMD09PWkpcmV0dXJuIHRoaXM7aWYoMT09PWkpcmV0dXJuIHRoaXMuY29weSh0KTt2YXIgcz10aGlzLl94LGg9dGhpcy5feSxuPXRoaXMuX3osXz10aGlzLl93LHI9Xyp0Ll93K3MqdC5feCtoKnQuX3krbip0Ll96O2lmKHI8MD8odGhpcy5fdz0tdC5fdyx0aGlzLl94PS10Ll94LHRoaXMuX3k9LXQuX3ksdGhpcy5fej0tdC5feixyPS1yKTp0aGlzLmNvcHkodCkscj49MSlyZXR1cm4gdGhpcy5fdz1fLHRoaXMuX3g9cyx0aGlzLl95PWgsdGhpcy5fej1uLHRoaXM7dmFyIGU9TWF0aC5zcXJ0KDEtcipyKTtpZihNYXRoLmFicyhlKTwuMDAxKXJldHVybiB0aGlzLl93PS41KihfK3RoaXMuX3cpLHRoaXMuX3g9LjUqKHMrdGhpcy5feCksdGhpcy5feT0uNSooaCt0aGlzLl95KSx0aGlzLl96PS41KihuK3RoaXMuX3opLHRoaXM7dmFyIGE9TWF0aC5hdGFuMihlLHIpLG89TWF0aC5zaW4oKDEtaSkqYSkvZSx1PU1hdGguc2luKGkqYSkvZTtyZXR1cm4gdGhpcy5fdz1fKm8rdGhpcy5fdyp1LHRoaXMuX3g9cypvK3RoaXMuX3gqdSx0aGlzLl95PWgqbyt0aGlzLl95KnUsdGhpcy5fej1uKm8rdGhpcy5feip1LHRoaXMub25DaGFuZ2VDYWxsYmFjaygpLHRoaXN9LGVxdWFsczpmdW5jdGlvbih0KXtyZXR1cm4gdC5feD09PXRoaXMuX3gmJnQuX3k9PT10aGlzLl95JiZ0Ll96PT09dGhpcy5feiYmdC5fdz09PXRoaXMuX3d9LGZyb21BcnJheTpmdW5jdGlvbih0LGkpe3JldHVybiB2b2lkIDA9PT1pJiYoaT0wKSx0aGlzLl94PXRbaV0sdGhpcy5feT10W2krMV0sdGhpcy5fej10W2krMl0sdGhpcy5fdz10W2krM10sdGhpcy5vbkNoYW5nZUNhbGxiYWNrKCksdGhpc30sdG9BcnJheTpmdW5jdGlvbih0LGkpe3JldHVybiB2b2lkIDA9PT10JiYodD1bXSksdm9pZCAwPT09aSYmKGk9MCksdFtpXT10aGlzLl94LHRbaSsxXT10aGlzLl95LHRbaSsyXT10aGlzLl96LHRbaSszXT10aGlzLl93LHR9LG9uQ2hhbmdlOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLm9uQ2hhbmdlQ2FsbGJhY2s9dCx0aGlzfSxvbkNoYW5nZUNhbGxiYWNrOmZ1bmN0aW9uKCl7fX0sT2JqZWN0LmFzc2lnbihUSFJFRS5RdWF0ZXJuaW9uLHtzbGVycDpmdW5jdGlvbih0LGkscyxoKXtyZXR1cm4gcy5jb3B5KHQpLnNsZXJwKGksaCl9LHNsZXJwRmxhdDpmdW5jdGlvbih0LGkscyxoLG4sXyxyKXt2YXIgZT1zW2grMF0sYT1zW2grMV0sbz1zW2grMl0sdT1zW2grM10sYz1uW18rMF0sbD1uW18rMV0seT1uW18rMl0seD1uW18rM107aWYodSE9PXh8fGUhPT1jfHxhIT09bHx8byE9PXkpe3ZhciB6PTEtcix3PWUqYythKmwrbyp5K3UqeCxmPXc+PTA/MTotMSxiPTEtdyp3O2lmKGI+TnVtYmVyLkVQU0lMT04pe3ZhciBDPU1hdGguc3FydChiKSxnPU1hdGguYXRhbjIoQyx3KmYpO3o9TWF0aC5zaW4oeipnKS9DLHI9TWF0aC5zaW4ocipnKS9DfXZhciBNPXIqZjtpZihlPWUqeitjKk0sYT1hKnorbCpNLG89byp6K3kqTSx1PXUqeit4Kk0sej09PTEtcil7dmFyIEU9MS9NYXRoLnNxcnQoZSplK2EqYStvKm8rdSp1KTtlKj1FLGEqPUUsbyo9RSx1Kj1FfX10W2ldPWUsdFtpKzFdPWEsdFtpKzJdPW8sdFtpKzNdPXV9fSk7IiwiVEhSRUUuRXVsZXI9ZnVuY3Rpb24odCxpLGgsbil7dGhpcy5feD10fHwwLHRoaXMuX3k9aXx8MCx0aGlzLl96PWh8fDAsdGhpcy5fb3JkZXI9bnx8VEhSRUUuRXVsZXIuRGVmYXVsdE9yZGVyfSxUSFJFRS5FdWxlci5Sb3RhdGlvbk9yZGVycz1bXCJYWVpcIixcIllaWFwiLFwiWlhZXCIsXCJYWllcIixcIllYWlwiLFwiWllYXCJdLFRIUkVFLkV1bGVyLkRlZmF1bHRPcmRlcj1cIlhZWlwiLFRIUkVFLkV1bGVyLnByb3RvdHlwZT17Y29uc3RydWN0b3I6VEhSRUUuRXVsZXIsZ2V0IHgoKXtyZXR1cm4gdGhpcy5feH0sc2V0IHgodCl7dGhpcy5feD10LHRoaXMub25DaGFuZ2VDYWxsYmFjaygpfSxnZXQgeSgpe3JldHVybiB0aGlzLl95fSxzZXQgeSh0KXt0aGlzLl95PXQsdGhpcy5vbkNoYW5nZUNhbGxiYWNrKCl9LGdldCB6KCl7cmV0dXJuIHRoaXMuX3p9LHNldCB6KHQpe3RoaXMuX3o9dCx0aGlzLm9uQ2hhbmdlQ2FsbGJhY2soKX0sZ2V0IG9yZGVyKCl7cmV0dXJuIHRoaXMuX29yZGVyfSxzZXQgb3JkZXIodCl7dGhpcy5fb3JkZXI9dCx0aGlzLm9uQ2hhbmdlQ2FsbGJhY2soKX0sc2V0OmZ1bmN0aW9uKHQsaSxoLG4pe3JldHVybiB0aGlzLl94PXQsdGhpcy5feT1pLHRoaXMuX3o9aCx0aGlzLl9vcmRlcj1ufHx0aGlzLl9vcmRlcix0aGlzLm9uQ2hhbmdlQ2FsbGJhY2soKSx0aGlzfSxjbG9uZTpmdW5jdGlvbigpe3JldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3Rvcih0aGlzLl94LHRoaXMuX3ksdGhpcy5feix0aGlzLl9vcmRlcil9LGNvcHk6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuX3g9dC5feCx0aGlzLl95PXQuX3ksdGhpcy5fej10Ll96LHRoaXMuX29yZGVyPXQuX29yZGVyLHRoaXMub25DaGFuZ2VDYWxsYmFjaygpLHRoaXN9LHNldEZyb21Sb3RhdGlvbk1hdHJpeDpmdW5jdGlvbih0LGksaCl7dmFyIG49VEhSRUUuTWF0aC5jbGFtcCxhPXQuZWxlbWVudHMscz1hWzBdLHI9YVs0XSxlPWFbOF0sbz1hWzFdLF89YVs1XSxjPWFbOV0sdT1hWzJdLGw9YVs2XSxNPWFbMTBdO3JldHVybiBpPWl8fHRoaXMuX29yZGVyLFwiWFlaXCI9PT1pPyh0aGlzLl95PU1hdGguYXNpbihuKGUsLTEsMSkpLE1hdGguYWJzKGUpPC45OTk5OT8odGhpcy5feD1NYXRoLmF0YW4yKC1jLE0pLHRoaXMuX3o9TWF0aC5hdGFuMigtcixzKSk6KHRoaXMuX3g9TWF0aC5hdGFuMihsLF8pLHRoaXMuX3o9MCkpOlwiWVhaXCI9PT1pPyh0aGlzLl94PU1hdGguYXNpbigtbihjLC0xLDEpKSxNYXRoLmFicyhjKTwuOTk5OTk/KHRoaXMuX3k9TWF0aC5hdGFuMihlLE0pLHRoaXMuX3o9TWF0aC5hdGFuMihvLF8pKToodGhpcy5feT1NYXRoLmF0YW4yKC11LHMpLHRoaXMuX3o9MCkpOlwiWlhZXCI9PT1pPyh0aGlzLl94PU1hdGguYXNpbihuKGwsLTEsMSkpLE1hdGguYWJzKGwpPC45OTk5OT8odGhpcy5feT1NYXRoLmF0YW4yKC11LE0pLHRoaXMuX3o9TWF0aC5hdGFuMigtcixfKSk6KHRoaXMuX3k9MCx0aGlzLl96PU1hdGguYXRhbjIobyxzKSkpOlwiWllYXCI9PT1pPyh0aGlzLl95PU1hdGguYXNpbigtbih1LC0xLDEpKSxNYXRoLmFicyh1KTwuOTk5OTk/KHRoaXMuX3g9TWF0aC5hdGFuMihsLE0pLHRoaXMuX3o9TWF0aC5hdGFuMihvLHMpKToodGhpcy5feD0wLHRoaXMuX3o9TWF0aC5hdGFuMigtcixfKSkpOlwiWVpYXCI9PT1pPyh0aGlzLl96PU1hdGguYXNpbihuKG8sLTEsMSkpLE1hdGguYWJzKG8pPC45OTk5OT8odGhpcy5feD1NYXRoLmF0YW4yKC1jLF8pLHRoaXMuX3k9TWF0aC5hdGFuMigtdSxzKSk6KHRoaXMuX3g9MCx0aGlzLl95PU1hdGguYXRhbjIoZSxNKSkpOlwiWFpZXCI9PT1pPyh0aGlzLl96PU1hdGguYXNpbigtbihyLC0xLDEpKSxNYXRoLmFicyhyKTwuOTk5OTk/KHRoaXMuX3g9TWF0aC5hdGFuMihsLF8pLHRoaXMuX3k9TWF0aC5hdGFuMihlLHMpKToodGhpcy5feD1NYXRoLmF0YW4yKC1jLE0pLHRoaXMuX3k9MCkpOmNvbnNvbGUud2FybihcIlRIUkVFLkV1bGVyOiAuc2V0RnJvbVJvdGF0aW9uTWF0cml4KCkgZ2l2ZW4gdW5zdXBwb3J0ZWQgb3JkZXI6IFwiK2kpLHRoaXMuX29yZGVyPWksaCE9PSExJiZ0aGlzLm9uQ2hhbmdlQ2FsbGJhY2soKSx0aGlzfSxzZXRGcm9tUXVhdGVybmlvbjpmdW5jdGlvbigpe3ZhciB0O3JldHVybiBmdW5jdGlvbihpLGgsbil7cmV0dXJuIHZvaWQgMD09PXQmJih0PW5ldyBUSFJFRS5NYXRyaXg0KSx0Lm1ha2VSb3RhdGlvbkZyb21RdWF0ZXJuaW9uKGkpLHRoaXMuc2V0RnJvbVJvdGF0aW9uTWF0cml4KHQsaCxuKX19KCksc2V0RnJvbVZlY3RvcjM6ZnVuY3Rpb24odCxpKXtyZXR1cm4gdGhpcy5zZXQodC54LHQueSx0LnosaXx8dGhpcy5fb3JkZXIpfSxyZW9yZGVyOmZ1bmN0aW9uKCl7dmFyIHQ9bmV3IFRIUkVFLlF1YXRlcm5pb247cmV0dXJuIGZ1bmN0aW9uKGkpe3JldHVybiB0LnNldEZyb21FdWxlcih0aGlzKSx0aGlzLnNldEZyb21RdWF0ZXJuaW9uKHQsaSl9fSgpLGVxdWFsczpmdW5jdGlvbih0KXtyZXR1cm4gdC5feD09PXRoaXMuX3gmJnQuX3k9PT10aGlzLl95JiZ0Ll96PT09dGhpcy5feiYmdC5fb3JkZXI9PT10aGlzLl9vcmRlcn0sZnJvbUFycmF5OmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLl94PXRbMF0sdGhpcy5feT10WzFdLHRoaXMuX3o9dFsyXSx2b2lkIDAhPT10WzNdJiYodGhpcy5fb3JkZXI9dFszXSksdGhpcy5vbkNoYW5nZUNhbGxiYWNrKCksdGhpc30sdG9BcnJheTpmdW5jdGlvbih0LGkpe3JldHVybiB2b2lkIDA9PT10JiYodD1bXSksdm9pZCAwPT09aSYmKGk9MCksdFtpXT10aGlzLl94LHRbaSsxXT10aGlzLl95LHRbaSsyXT10aGlzLl96LHRbaSszXT10aGlzLl9vcmRlcix0fSx0b1ZlY3RvcjM6ZnVuY3Rpb24odCl7cmV0dXJuIHQ/dC5zZXQodGhpcy5feCx0aGlzLl95LHRoaXMuX3opOm5ldyBUSFJFRS5WZWN0b3IzKHRoaXMuX3gsdGhpcy5feSx0aGlzLl96KX0sb25DaGFuZ2U6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMub25DaGFuZ2VDYWxsYmFjaz10LHRoaXN9LG9uQ2hhbmdlQ2FsbGJhY2s6ZnVuY3Rpb24oKXt9fTsiLCIvKiFhcnQtdGVtcGxhdGUgLSBUZW1wbGF0ZSBFbmdpbmUgfCBodHRwOi8vYXVpLmdpdGh1Yi5jb20vYXJ0VGVtcGxhdGUvKi9cbiFmdW5jdGlvbigpe2Z1bmN0aW9uIGEoYSl7cmV0dXJuIGEucmVwbGFjZSh0LFwiXCIpLnJlcGxhY2UodSxcIixcIikucmVwbGFjZSh2LFwiXCIpLnJlcGxhY2UodyxcIlwiKS5yZXBsYWNlKHgsXCJcIikuc3BsaXQoeSl9ZnVuY3Rpb24gYihhKXtyZXR1cm5cIidcIithLnJlcGxhY2UoLygnfFxcXFwpL2csXCJcXFxcJDFcIikucmVwbGFjZSgvXFxyL2csXCJcXFxcclwiKS5yZXBsYWNlKC9cXG4vZyxcIlxcXFxuXCIpK1wiJ1wifWZ1bmN0aW9uIGMoYyxkKXtmdW5jdGlvbiBlKGEpe3JldHVybiBtKz1hLnNwbGl0KC9cXG4vKS5sZW5ndGgtMSxrJiYoYT1hLnJlcGxhY2UoL1xccysvZyxcIiBcIikucmVwbGFjZSgvPCEtLVtcXHdcXFddKj8tLT4vZyxcIlwiKSksYSYmKGE9c1sxXStiKGEpK3NbMl0rXCJcXG5cIiksYX1mdW5jdGlvbiBmKGIpe3ZhciBjPW07aWYoaj9iPWooYixkKTpnJiYoYj1iLnJlcGxhY2UoL1xcbi9nLGZ1bmN0aW9uKCl7cmV0dXJuIG0rKyxcIiRsaW5lPVwiK20rXCI7XCJ9KSksMD09PWIuaW5kZXhPZihcIj1cIikpe3ZhciBlPWwmJiEvXj1bPSNdLy50ZXN0KGIpO2lmKGI9Yi5yZXBsYWNlKC9ePVs9I10/fFtcXHM7XSokL2csXCJcIiksZSl7dmFyIGY9Yi5yZXBsYWNlKC9cXHMqXFwoW15cXCldK1xcKS8sXCJcIik7bltmXXx8L14oaW5jbHVkZXxwcmludCkkLy50ZXN0KGYpfHwoYj1cIiRlc2NhcGUoXCIrYitcIilcIil9ZWxzZSBiPVwiJHN0cmluZyhcIitiK1wiKVwiO2I9c1sxXStiK3NbMl19cmV0dXJuIGcmJihiPVwiJGxpbmU9XCIrYytcIjtcIitiKSxyKGEoYiksZnVuY3Rpb24oYSl7aWYoYSYmIXBbYV0pe3ZhciBiO2I9XCJwcmludFwiPT09YT91OlwiaW5jbHVkZVwiPT09YT92Om5bYV0/XCIkdXRpbHMuXCIrYTpvW2FdP1wiJGhlbHBlcnMuXCIrYTpcIiRkYXRhLlwiK2Esdys9YStcIj1cIitiK1wiLFwiLHBbYV09ITB9fSksYitcIlxcblwifXZhciBnPWQuZGVidWcsaD1kLm9wZW5UYWcsaT1kLmNsb3NlVGFnLGo9ZC5wYXJzZXIsaz1kLmNvbXByZXNzLGw9ZC5lc2NhcGUsbT0xLHA9eyRkYXRhOjEsJGZpbGVuYW1lOjEsJHV0aWxzOjEsJGhlbHBlcnM6MSwkb3V0OjEsJGxpbmU6MX0scT1cIlwiLnRyaW0scz1xP1tcIiRvdXQ9Jyc7XCIsXCIkb3V0Kz1cIixcIjtcIixcIiRvdXRcIl06W1wiJG91dD1bXTtcIixcIiRvdXQucHVzaChcIixcIik7XCIsXCIkb3V0LmpvaW4oJycpXCJdLHQ9cT9cIiRvdXQrPXRleHQ7cmV0dXJuICRvdXQ7XCI6XCIkb3V0LnB1c2godGV4dCk7XCIsdT1cImZ1bmN0aW9uKCl7dmFyIHRleHQ9JycuY29uY2F0LmFwcGx5KCcnLGFyZ3VtZW50cyk7XCIrdCtcIn1cIix2PVwiZnVuY3Rpb24oZmlsZW5hbWUsZGF0YSl7ZGF0YT1kYXRhfHwkZGF0YTt2YXIgdGV4dD0kdXRpbHMuJGluY2x1ZGUoZmlsZW5hbWUsZGF0YSwkZmlsZW5hbWUpO1wiK3QrXCJ9XCIsdz1cIid1c2Ugc3RyaWN0Jzt2YXIgJHV0aWxzPXRoaXMsJGhlbHBlcnM9JHV0aWxzLiRoZWxwZXJzLFwiKyhnP1wiJGxpbmU9MCxcIjpcIlwiKSx4PXNbMF0seT1cInJldHVybiBuZXcgU3RyaW5nKFwiK3NbM10rXCIpO1wiO3IoYy5zcGxpdChoKSxmdW5jdGlvbihhKXthPWEuc3BsaXQoaSk7dmFyIGI9YVswXSxjPWFbMV07MT09PWEubGVuZ3RoP3grPWUoYik6KHgrPWYoYiksYyYmKHgrPWUoYykpKX0pO3ZhciB6PXcreCt5O2cmJih6PVwidHJ5e1wiK3orXCJ9Y2F0Y2goZSl7dGhyb3cge2ZpbGVuYW1lOiRmaWxlbmFtZSxuYW1lOidSZW5kZXIgRXJyb3InLG1lc3NhZ2U6ZS5tZXNzYWdlLGxpbmU6JGxpbmUsc291cmNlOlwiK2IoYykrXCIuc3BsaXQoL1xcXFxuLylbJGxpbmUtMV0ucmVwbGFjZSgvXlxcXFxzKy8sJycpfTt9XCIpO3RyeXt2YXIgQT1uZXcgRnVuY3Rpb24oXCIkZGF0YVwiLFwiJGZpbGVuYW1lXCIseik7cmV0dXJuIEEucHJvdG90eXBlPW4sQX1jYXRjaChCKXt0aHJvdyBCLnRlbXA9XCJmdW5jdGlvbiBhbm9ueW1vdXMoJGRhdGEsJGZpbGVuYW1lKSB7XCIreitcIn1cIixCfX12YXIgZD1mdW5jdGlvbihhLGIpe3JldHVyblwic3RyaW5nXCI9PXR5cGVvZiBiP3EoYix7ZmlsZW5hbWU6YX0pOmcoYSxiKX07ZC52ZXJzaW9uPVwiMy4wLjBcIixkLmNvbmZpZz1mdW5jdGlvbihhLGIpe2VbYV09Yn07dmFyIGU9ZC5kZWZhdWx0cz17b3BlblRhZzpcIjwlXCIsY2xvc2VUYWc6XCIlPlwiLGVzY2FwZTohMCxjYWNoZTohMCxjb21wcmVzczohMSxwYXJzZXI6bnVsbH0sZj1kLmNhY2hlPXt9O2QucmVuZGVyPWZ1bmN0aW9uKGEsYil7cmV0dXJuIHEoYSxiKX07dmFyIGc9ZC5yZW5kZXJGaWxlPWZ1bmN0aW9uKGEsYil7dmFyIGM9ZC5nZXQoYSl8fHAoe2ZpbGVuYW1lOmEsbmFtZTpcIlJlbmRlciBFcnJvclwiLG1lc3NhZ2U6XCJUZW1wbGF0ZSBub3QgZm91bmRcIn0pO3JldHVybiBiP2MoYik6Y307ZC5nZXQ9ZnVuY3Rpb24oYSl7dmFyIGI7aWYoZlthXSliPWZbYV07ZWxzZSBpZihcIm9iamVjdFwiPT10eXBlb2YgZG9jdW1lbnQpe3ZhciBjPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGEpO2lmKGMpe3ZhciBkPShjLnZhbHVlfHxjLmlubmVySFRNTCkucmVwbGFjZSgvXlxccyp8XFxzKiQvZyxcIlwiKTtiPXEoZCx7ZmlsZW5hbWU6YX0pfX1yZXR1cm4gYn07dmFyIGg9ZnVuY3Rpb24oYSxiKXtyZXR1cm5cInN0cmluZ1wiIT10eXBlb2YgYSYmKGI9dHlwZW9mIGEsXCJudW1iZXJcIj09PWI/YSs9XCJcIjphPVwiZnVuY3Rpb25cIj09PWI/aChhLmNhbGwoYSkpOlwiXCIpLGF9LGk9e1wiPFwiOlwiJiM2MDtcIixcIj5cIjpcIiYjNjI7XCIsJ1wiJzpcIiYjMzQ7XCIsXCInXCI6XCImIzM5O1wiLFwiJlwiOlwiJiMzODtcIn0saj1mdW5jdGlvbihhKXtyZXR1cm4gaVthXX0saz1mdW5jdGlvbihhKXtyZXR1cm4gaChhKS5yZXBsYWNlKC8mKD8hW1xcdyNdKzspfFs8PlwiJ10vZyxqKX0sbD1BcnJheS5pc0FycmF5fHxmdW5jdGlvbihhKXtyZXR1cm5cIltvYmplY3QgQXJyYXldXCI9PT17fS50b1N0cmluZy5jYWxsKGEpfSxtPWZ1bmN0aW9uKGEsYil7dmFyIGMsZDtpZihsKGEpKWZvcihjPTAsZD1hLmxlbmd0aDtkPmM7YysrKWIuY2FsbChhLGFbY10sYyxhKTtlbHNlIGZvcihjIGluIGEpYi5jYWxsKGEsYVtjXSxjKX0sbj1kLnV0aWxzPXskaGVscGVyczp7fSwkaW5jbHVkZTpnLCRzdHJpbmc6aCwkZXNjYXBlOmssJGVhY2g6bX07ZC5oZWxwZXI9ZnVuY3Rpb24oYSxiKXtvW2FdPWJ9O3ZhciBvPWQuaGVscGVycz1uLiRoZWxwZXJzO2Qub25lcnJvcj1mdW5jdGlvbihhKXt2YXIgYj1cIlRlbXBsYXRlIEVycm9yXFxuXFxuXCI7Zm9yKHZhciBjIGluIGEpYis9XCI8XCIrYytcIj5cXG5cIithW2NdK1wiXFxuXFxuXCI7XCJvYmplY3RcIj09dHlwZW9mIGNvbnNvbGUmJmNvbnNvbGUuZXJyb3IoYil9O3ZhciBwPWZ1bmN0aW9uKGEpe3JldHVybiBkLm9uZXJyb3IoYSksZnVuY3Rpb24oKXtyZXR1cm5cIntUZW1wbGF0ZSBFcnJvcn1cIn19LHE9ZC5jb21waWxlPWZ1bmN0aW9uKGEsYil7ZnVuY3Rpb24gZChjKXt0cnl7cmV0dXJuIG5ldyBpKGMsaCkrXCJcIn1jYXRjaChkKXtyZXR1cm4gYi5kZWJ1Zz9wKGQpKCk6KGIuZGVidWc9ITAscShhLGIpKGMpKX19Yj1ifHx7fTtmb3IodmFyIGcgaW4gZSl2b2lkIDA9PT1iW2ddJiYoYltnXT1lW2ddKTt2YXIgaD1iLmZpbGVuYW1lO3RyeXt2YXIgaT1jKGEsYil9Y2F0Y2goail7cmV0dXJuIGouZmlsZW5hbWU9aHx8XCJhbm9ueW1vdXNcIixqLm5hbWU9XCJTeW50YXggRXJyb3JcIixwKGopfXJldHVybiBkLnByb3RvdHlwZT1pLnByb3RvdHlwZSxkLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuIGkudG9TdHJpbmcoKX0saCYmYi5jYWNoZSYmKGZbaF09ZCksZH0scj1uLiRlYWNoLHM9XCJicmVhayxjYXNlLGNhdGNoLGNvbnRpbnVlLGRlYnVnZ2VyLGRlZmF1bHQsZGVsZXRlLGRvLGVsc2UsZmFsc2UsZmluYWxseSxmb3IsZnVuY3Rpb24saWYsaW4saW5zdGFuY2VvZixuZXcsbnVsbCxyZXR1cm4sc3dpdGNoLHRoaXMsdGhyb3csdHJ1ZSx0cnksdHlwZW9mLHZhcix2b2lkLHdoaWxlLHdpdGgsYWJzdHJhY3QsYm9vbGVhbixieXRlLGNoYXIsY2xhc3MsY29uc3QsZG91YmxlLGVudW0sZXhwb3J0LGV4dGVuZHMsZmluYWwsZmxvYXQsZ290byxpbXBsZW1lbnRzLGltcG9ydCxpbnQsaW50ZXJmYWNlLGxvbmcsbmF0aXZlLHBhY2thZ2UscHJpdmF0ZSxwcm90ZWN0ZWQscHVibGljLHNob3J0LHN0YXRpYyxzdXBlcixzeW5jaHJvbml6ZWQsdGhyb3dzLHRyYW5zaWVudCx2b2xhdGlsZSxhcmd1bWVudHMsbGV0LHlpZWxkLHVuZGVmaW5lZFwiLHQ9L1xcL1xcKltcXHdcXFddKj9cXCpcXC98XFwvXFwvW15cXG5dKlxcbnxcXC9cXC9bXlxcbl0qJHxcIig/OlteXCJcXFxcXXxcXFxcW1xcd1xcV10pKlwifCcoPzpbXidcXFxcXXxcXFxcW1xcd1xcV10pKid8XFxzKlxcLlxccypbJFxcd1xcLl0rL2csdT0vW15cXHckXSsvZyx2PW5ldyBSZWdFeHAoW1wiXFxcXGJcIitzLnJlcGxhY2UoLywvZyxcIlxcXFxifFxcXFxiXCIpK1wiXFxcXGJcIl0uam9pbihcInxcIiksXCJnXCIpLHc9L15cXGRbXixdKnwsXFxkW14sXSovZyx4PS9eLCt8LCskL2cseT0vXiR8LCsvO1wiZnVuY3Rpb25cIj09dHlwZW9mIGRlZmluZT9kZWZpbmUoZnVuY3Rpb24oKXtyZXR1cm4gZH0pOlwidW5kZWZpbmVkXCIhPXR5cGVvZiBleHBvcnRzP21vZHVsZS5leHBvcnRzPWQ6dGhpcy50ZW1wbGF0ZT1kfSgpOyIsIiFmdW5jdGlvbihnbG9iYWwpIHtcblxuICBpZiAoZ2xvYmFsLnRlbXBsYXRlKSB7XG4gICAgZ2xvYmFsLnRlbXBsYXRlLmNvbmZpZygnb3BlblRhZycsJzwjJyk7XG4gICAgZ2xvYmFsLnRlbXBsYXRlLmNvbmZpZygnY2xvc2VUYWcnLCcjPicpO1xuICB9XG5cbiAgZ2xvYmFsLnNub3QgPSB7fTtcblxuICBnbG9iYWwuc25vdC51dGlsID0ge1xuICAgIGxlZnRfcG9zOiBsZWZ0X3BvcyxcbiAgICB0b3BfcG9zOiB0b3BfcG9zLFxuICAgIHN0YW5kYXJkbGl6YXRpb246IHN0YW5kYXJkbGl6YXRpb24sXG4gICAgaXNfbW9iaWxlOiBpc19tb2JpbGUsXG4gICAgaXNfd2VjaGF0X2xvZ2luOiBpc193ZWNoYXRfbG9naW4sXG4gICAgZ2V0X3dpbmRvd193aWR0aDogZ2V0X3dpbmRvd193aWR0aCxcbiAgICBnZXRfd2luZG93X2hlaWdodDogZ2V0X3dpbmRvd19oZWlnaHQsXG4gICAgcG9zaXRpb25fdG9fcm90YXRpb246IHBvc2l0aW9uX3RvX3JvdGF0aW9uLFxuICAgIGRpc3RhbmNlMkQ6IGRpc3RhbmNlMkQsXG4gICAgZGlzdGFuY2UzRDogZGlzdGFuY2UzRCxcbiAgICBlcHNpbG9uOiBlcHNpbG9uLFxuICAgIGNzc190ZXh0X3RvX21hdHJpeDogY3NzX3RleHRfdG9fbWF0cml4LFxuICAgIG1hdHJpeF90b19jc3NfdGV4dDogbWF0cml4X3RvX2Nzc190ZXh0LFxuICAgIHdlYmdsX2RldGVjdDogd2ViZ2xfZGV0ZWN0LFxuICAgIHdlYmdsX2VuYWJsZWQ6IHdlYmdsX2RldGVjdCgpLFxuICAgIGxvYWRfanM6IGxvYWRfanMsXG4gICAgcm90YXRpb25fdG9fcG9zaXRpb246IHJvdGF0aW9uX3RvX3Bvc2l0aW9uLFxuXG4gICAgdl9zZXRfZnJvbV9tYXRyaXhfcG9zaXRpb246IHZfc2V0X2Zyb21fbWF0cml4X3Bvc2l0aW9uLFxuICAgIG1fbWFrZV9yb3RhdGlvbl9heGlzOiBtX21ha2Vfcm90YXRpb25fYXhpcyxcbiAgICBtX211bHRpcGx5OiBtX211bHRpcGx5LFxuICAgIG1fc2V0X3Bvc2l0aW9uOiBtX3NldF9wb3NpdGlvbixcbiAgICBtX21ha2Vfcm90YXRpb25fZnJvbV9xdWF0ZXJuaW9uOiBtX21ha2Vfcm90YXRpb25fZnJvbV9xdWF0ZXJuaW9uLFxuXG4gICAgbWVyZ2VfanNvbjogbWVyZ2VfanNvbixcbiAgICBvY3RyZWVfY29sbGlzaW9uOiBvY3RyZWVfY29sbGlzaW9uLFxuXG4gIH07XG5cbiAgZnVuY3Rpb24gdG9wX3BvcyhlbGVtKSB7XG4gICAgdmFyIGN1cnRvcCA9IDA7XG4gICAgaWYgKGVsZW0ub2Zmc2V0UGFyZW50KSB7XG4gICAgICBkbyB7IFxuICAgICAgICAgIGN1cnRvcCArPSBlbGVtLm9mZnNldFRvcDsgXG4gICAgICB9IHdoaWxlIChlbGVtID0gZWxlbS5vZmZzZXRQYXJlbnQpO1xuICAgIH1cbiAgICByZXR1cm4gY3VydG9wO1xuICB9O1xuXG4gIGZ1bmN0aW9uIGxlZnRfcG9zKGVsZW0pIHtcbiAgICB2YXIgY3VybGVmdCA9IDA7XG4gICAgaWYgKGVsZW0ub2Zmc2V0UGFyZW50KSB7XG4gICAgICAgIGRvIHsgXG4gICAgICAgICAgICBjdXJsZWZ0ICs9IGVsZW0ub2Zmc2V0TGVmdDsgXG4gICAgICAgIH0gd2hpbGUgKGVsZW0gPSBlbGVtLm9mZnNldFBhcmVudCk7XG4gICAgfVxuICAgIHJldHVybiBjdXJsZWZ0O1xuICB9O1xuICBcbiAgZnVuY3Rpb24gaXNfbW9iaWxlKCkge1xuICAgIHJldHVybiBnZXRfd2luZG93X3dpZHRoKCkgPCA1MDA7XG4gIH1cbiAgXG4gIGZ1bmN0aW9uIGlzX3dlY2hhdF9sb2dpbigpIHtcbiAgICByZXR1cm4gd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignTWljcm9NZXNzZW5nZXInKSA+PSAwID8gdHJ1ZSA6IGZhbHNlO1xuICB9XG4gIFxuICBmdW5jdGlvbiBnZXRfd2luZG93X3dpZHRoKCkge1xuICAgIHJldHVybiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGg7XG4gIH1cbiAgXG4gIGZ1bmN0aW9uIGdldF93aW5kb3dfaGVpZ2h0KCkge1xuICAgIHJldHVybiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0O1xuICB9XG4gIFxuICBmdW5jdGlvbiBwb3NpdGlvbl90b19yb3RhdGlvbih4LCB5LCB6KSB7XG4gICAgdmFyIHIgPSBkaXN0YW5jZTNEKHgsIHksIHosIDAsIDAsIDApO1xuICAgIHZhciByeCA9IE1hdGguYXNpbih6IC8gcik7XG4gICAgdmFyIHJ5ID0gTWF0aC5hc2luKHkgLyByIC8gTWF0aC5jb3MocngpKTtcbiAgICBpZiAoeCA8IDApIHtcbiAgICAgICAgcnkgPSByeSA+IDAgPyBNYXRoLlBJIC0gcnkgOiAtIE1hdGguUEkgLSByeTtcbiAgICB9XG4gIFxuICAgIHJldHVybiB7XG4gICAgICByeDogLSByeCAqIDE4MCAvIE1hdGguUEksXG4gICAgICByeTogKHJ5IDwgMCA/IHJ5ICsgTWF0aC5QSSAqIDIgOiByeSkgKiAxODAgLyBNYXRoLlBJXG4gICAgfTtcbiAgfVxuICBcbiAgZnVuY3Rpb24gZGlzdGFuY2UyRChhLCBiLCBjLCBkKSB7XG4gICAgcmV0dXJuIE1hdGgucG93KChhIC0gYykgKiAoYSAtIGMpICsgKGIgLSBkKSAqIChiIC0gZCksIDAuNSk7XG4gIH1cbiAgXG4gIGZ1bmN0aW9uIGRpc3RhbmNlM0QoYSwgYiwgYywgZCwgZSwgZikge1xuICAgIHJldHVybiBNYXRoLnBvdygoYSAtIGQpICogKGEgLSBkKSArIChiIC0gZSkgKiAoYiAtIGUpICsgKGMgLSBmKSAqIChjIC0gZiksIDAuNSk7XG4gIH1cbiAgXG4gIGZ1bmN0aW9uIGVwc2lsb24odmFsdWUpIHtcbiAgICByZXR1cm4gTWF0aC5hYnModmFsdWUpIDwgMC4wMDAwMDEgPyAwIDogdmFsdWUudG9GaXhlZCg1KTtcbiAgfTtcbiAgXG4gIGZ1bmN0aW9uIGNzc190ZXh0X3RvX21hdHJpeCh0KSB7XG4gICAgdmFyIG0gPSBuZXcgV2ViS2l0Q1NTTWF0cml4KHQpO1xuICAgIHJldHVybiBbXG4gICAgICBlcHNpbG9uKG0ubTExKSwgZXBzaWxvbihtLm0xMiksIGVwc2lsb24obS5tMTMpLCBlcHNpbG9uKG0ubTE0KSxcbiAgICAgIGVwc2lsb24obS5tMjEpLCBlcHNpbG9uKG0ubTIyKSwgZXBzaWxvbihtLm0yMyksIGVwc2lsb24obS5tMjQpLFxuICAgICAgZXBzaWxvbihtLm0zMSksIGVwc2lsb24obS5tMzIpLCBlcHNpbG9uKG0ubTMzKSwgZXBzaWxvbihtLm0zNCksXG4gICAgICBlcHNpbG9uKG0ubTQxKSwgZXBzaWxvbihtLm00MiksIGVwc2lsb24obS5tNDMpLCBlcHNpbG9uKG0ubTQ0KVxuICAgIF07XG4gIH1cbiAgXG4gIGZ1bmN0aW9uIG1hdHJpeF90b19jc3NfdGV4dChhLCBiLCBjLCBkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZSwgZiwgZywgaCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGksIGosIGssIGwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtLCBuLCBvLCBwKSB7XG4gICAgICBpZiAodHlwZW9mKGEpID09ICdvYmplY3QnKSB7XG4gICAgICAgICAgcmV0dXJuICdtYXRyaXgzZCgnICsgKGEuam9pbignLCcpKSArICcpJztcbiAgICAgIH1cbiAgICAgIHJldHVybiAnbWF0cml4M2QoJyArIGEgKyAnLCcgKyBiICsgJywnICsgYyArICcsJyArIGQrJywnICsgZSArICcsJyArIGYgKyAnLCcgKyBnICsgJywnICsgaCArICcsJyArIGkgKyAnLCcgKyBqICsgJywnICsgayArICcsJyArIGwgKyAnLCcgKyBtICsgJywnICsgbiArICcsJyArIG8rICcsJyArIHAgKyAnKSc7XG4gIH1cbiAgXG4gIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWU9IChmdW5jdGlvbiAoKSB7IFxuICAgIHJldHVybiB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8IFxuICAgIHdpbmRvdy53ZWJraXRSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHwgXG4gICAgd2luZG93Lm1velJlcXVlc3RBbmltYXRpb25GcmFtZSB8fCBcbiAgICB3aW5kb3cub1JlcXVlc3RBbmltYXRpb25GcmFtZSB8fCBcbiAgICAvLyBpZiBhbGwgZWxzZSBmYWlscywgdXNlIHNldFRpbWVvdXQgXG4gICAgZnVuY3Rpb24gKGNhbGxiYWNrKSB7IFxuICAgICAgcmV0dXJuIHdpbmRvdy5zZXRUaW1lb3V0KGNhbGxiYWNrLCAxMDAwIC8gNjApOyAvLyBzaG9vdCBmb3IgNjAgZnBzIFxuICAgIH07IFxuICB9KSgpOyBcbiAgXG4gIGZ1bmN0aW9uIHdlYmdsX2RldGVjdChyZXR1cm5fY29udGV4dCkge1xuICAgIGlmICghIXdpbmRvdy5XZWJHTFJlbmRlcmluZ0NvbnRleHQpIHtcbiAgICAgIHZhciBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xuICAgICAgdmFyIG5hbWVzID0gWyd3ZWJnbCcsICdleHBlcmltZW50YWwtd2ViZ2wnLCAnbW96LXdlYmdsJywgJ3dlYmtpdC0zZCddO1xuICAgICAgdmFyIGNvbnRleHQgPSBmYWxzZTtcbiAgXG4gICAgICBmb3IgKHZhciBpID0gMDtpIDwgNDsgaSsrKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KG5hbWVzW2ldKTtcbiAgICAgICAgICBpZiAoY29udGV4dCAmJiB0eXBlb2YgY29udGV4dC5nZXRQYXJhbWV0ZXIgPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgLy8gV2ViR0wgaXMgZW5hYmxlZFxuICAgICAgICAgICAgaWYgKHJldHVybl9jb250ZXh0KSB7XG4gICAgICAgICAgICAgIC8vIHJldHVybiBXZWJHTCBvYmplY3QgaWYgdGhlIGZ1bmN0aW9uJ3MgYXJndW1lbnQgaXMgcHJlc2VudFxuICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIG5hbWU6IG5hbWVzW2ldLFxuICAgICAgICAgICAgICAgIGdsOiBjb250ZXh0XG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBlbHNlLCByZXR1cm4ganVzdCB0cnVlXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2goZSkge31cbiAgICAgIH1cbiAgXG4gICAgICAvLyBXZWJHTCBpcyBzdXBwb3J0ZWQsIGJ1dCBkaXNhYmxlZFxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgXG4gICAgLy8gV2ViR0wgbm90IHN1cHBvcnRlZFxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBcbiAgZnVuY3Rpb24gbG9hZF9qcyhmaWxlLCBjYWxsYmFjaykge1xuICAgIHZhciBfZG9jID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2hlYWQnKVswXTtcbiAgICB2YXIganMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcbiAgICBqcy5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCAndGV4dC9qYXZhc2NyaXB0Jyk7XG4gICAganMuc2V0QXR0cmlidXRlKCdzcmMnLCBmaWxlKTtcbiAgICBfZG9jLmFwcGVuZENoaWxkKGpzKTtcbiAgICBpZiAoIS8qQGNjX29uIUAqLzApIHsgLy9pZiBub3QgaWVcbiAgICAgIC8vZmlyZWZveDLjgIFmaXJlZm94M+OAgXNhZmFyaTMuMSvjgIFvcGVyYTkuNisgc3VwcG9ydCBqcy5vbmxvYWRcbiAgICAgIGpzLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy9pZTbjgIFpZTcgc3VwcG9ydCBqcy5vbnJlYWR5c3RhdGVjaGFuZ2VcbiAgICAgIGpzLm9uUmVhZHlTdGF0ZUNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGpzLnJlYWR5U3RhdGUgPT0gJ2xvYWRlZCcgfHwganMucmVhZHlTdGF0ZSA9PSAnY29tcGxldGUnKSB7XG4gICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuICBcbiAgZnVuY3Rpb24gcm90YXRpb25fdG9fcG9zaXRpb24oeiwgcngsIHJ5LCByeikge1xuICAgIHogPSAtIHo7XG4gICAgcnggPSAtIHJ4O1xuICBcbiAgICB2YXIgeCA9IHNub3QuYmdfc2l6ZSAvIDI7XG4gICAgdmFyIHkgPSBzbm90LmJnX3NpemUgLyAyO1xuICBcbiAgICB2YXIgdHJhbnNmb3JtID0gY3NzX3RleHRfdG9fbWF0cml4KCd0cmFuc2xhdGUzZCgnICsgeCArICdweCwnICsgeSArICdweCwwKSByb3RhdGVZKCcgKyAoMCkgKyAnZGVnKSByb3RhdGVYKCcgKyAoMCkgKyAnZGVnKSByb3RhdGVZKCcgKyAocnkgPyAtIHJ5IDogMCkgKyAnZGVnKSByb3RhdGVYKCcgKyAocnggPyAtIHJ4IDogMCkgKyAnZGVnKSByb3RhdGVaKCcgKyAocnogPyByeiA6IDApICsnZGVnKSB0cmFuc2xhdGVaKCcgKyB6ICsgJ3B4KScgKTtcbiAgICByZXR1cm4gWyAtIHRyYW5zZm9ybVsxMl0gKyBzbm90LmJnX3NpemUgLyAyLCB0cmFuc2Zvcm1bMTNdIC0gc25vdC5iZ19zaXplIC8gMiwgLSB0cmFuc2Zvcm1bMTRdXTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG1fbWFrZV9yb3RhdGlvbl9heGlzKHBvaW50LCByb3RhdGlvbikge1xuICAgIHJldHVybiBuZXcgVEhSRUUuTWF0cml4NCgpLm1ha2VSb3RhdGlvbkF4aXMocG9pbnQsIHJvdGF0aW9uKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG1fbXVsdGlwbHkoKSB7XG4gICAgdmFyIG1hdHMgPSBhcmd1bWVudHM7XG5cbiAgICB2YXIgbCA9IG1hdHMubGVuZ3RoO1xuICAgIHdoaWxlIChsID4gMSkge1xuICAgICAgdmFyIGxhc3QyID0gbWF0c1tsIC0gMl07XG4gICAgICB2YXIgbGFzdDEgPSBtYXRzW2wgLSAxXTtcbiAgICAgIG1hdHNbbCAtIDJdID0gbmV3IFRIUkVFLk1hdHJpeDQoKS5tdWx0aXBseU1hdHJpY2VzKFxuICAgICAgICBsYXN0MixcbiAgICAgICAgbGFzdDFcbiAgICAgICk7XG4gICAgICBsLS07XG4gICAgfVxuICAgIHJldHVybiBtYXRzWzBdO1xuICB9XG5cbiAgZnVuY3Rpb24gdl9zZXRfZnJvbV9tYXRyaXhfcG9zaXRpb24obWF0NCkge1xuICAgIHJldHVybiBuZXcgVEhSRUUuVmVjdG9yMygpLnNldEZyb21NYXRyaXhQb3NpdGlvbihtYXQ0KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG1fc2V0X3Bvc2l0aW9uKHApIHtcbiAgICByZXR1cm4gbmV3IFRIUkVFLk1hdHJpeDQoKS5zZXRQb3NpdGlvbihwKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG1fbWFrZV9yb3RhdGlvbl9mcm9tX3F1YXRlcm5pb24ocSkge1xuICAgIHJldHVybiBuZXcgVEhSRUUuTWF0cml4NCgpLm1ha2VSb3RhdGlvbkZyb21RdWF0ZXJuaW9uKHEpO1xuICB9XG5cbiAgZnVuY3Rpb24gbWVyZ2VfanNvbihvYmosIGpzb24pIHtcbiAgICBmb3IgKHZhciBpIGluIGpzb24pIHtcbiAgICAgIGlmIChvYmpbaV0gPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIG9ialtpXSA9IGpzb25baV07XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gc3RhbmRhcmRsaXphdGlvbihwb2ludCwgcikge1xuICAgIHIgPSByIHx8IDE7XG4gICAgdmFyIGRpc3RhbmNlX3RvX29yaWdpbiA9IGRpc3RhbmNlM0QoMCwgMCwgMCwgcG9pbnQueCwgcG9pbnQueSwgcG9pbnQueik7XG4gICAgcG9pbnQueCAqPSByIC8gZGlzdGFuY2VfdG9fb3JpZ2luO1xuICAgIHBvaW50LnkgKj0gciAvIGRpc3RhbmNlX3RvX29yaWdpbjtcbiAgICBwb2ludC56ICo9IHIgLyBkaXN0YW5jZV90b19vcmlnaW47XG4gIH1cblxuICBmdW5jdGlvbiBpc19wb2ludF9pbnNpZGUocG9pbnQsIGEsIGIpIHtcbiAgICBpZiAocG9pbnQueCA+PSBiLnggJiYgcG9pbnQueSA+PSBiLnkgJiYgcG9pbnQueiA+PSBiLnogJiZcbiAgICAgICAgcG9pbnQueCA8IGEueCAmJiBwb2ludC55IDwgYS55ICYmIHBvaW50LnogPCBhLnopIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgZnVuY3Rpb24gZ2V0X2luc2lkZV9wb2ludHMocG9pbnRzLCBhLCBiKSB7XG4gICAgbGV0IGNhbmRpZGF0ZXMgPSBbXTtcbiAgICBmb3IgKGxldCBpIGluIHBvaW50cykge1xuICAgICAgaWYgKGlzX3BvaW50X2luc2lkZShwb2ludHNbaV0sIGEsIGIpKSB7XG4gICAgICAgIGNhbmRpZGF0ZXMucHVzaChwb2ludHNbaV0pO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gY2FuZGlkYXRlcztcbiAgfVxuICAvKlxuICAgKiBzZWUgLi4vaW1hZ2VzL29jdHJlZS5wbmdcbiAgICpcbiAgICogYS54ID4gYi54XG4gICAqIGEueSA+IGIueVxuICAgKiBhLnogPiBiLnpcbiAgICovXG4gIGZ1bmN0aW9uIG9jdHJlZV9jb2xsaXNpb24oYSwgYiwgcG9pbnRzX2EsIHBvaW50c19iLCByZXMsIGRlcHRoID0gMSkge1xuICAgIGlmICghcG9pbnRzX2EubGVuZ3RoIHx8ICFwb2ludHNfYi5sZW5ndGgpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKGRlcHRoID4gNykge1xuICAgICAgcmVzLnB1c2goe1xuICAgICAgICBwb2ludHNfYTogcG9pbnRzX2EsXG4gICAgICAgIHBvaW50c19iOiBwb2ludHNfYixcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgLy8gcmFuZG9tIHNwbGl0XG4gICAgbGV0IGhhbGYgPSB7XG4gICAgICB4OiAoYS54IC0gYi54KSAvIChNYXRoLnJhbmRvbSgpICogMC4yIC0gMC4xICsgMiksXG4gICAgICB5OiAoYS55IC0gYi55KSAvIChNYXRoLnJhbmRvbSgpICogMC4yIC0gMC4xICsgMiksXG4gICAgICB6OiAoYS56IC0gYi56KSAvIChNYXRoLnJhbmRvbSgpICogMC4yIC0gMC4xICsgMiksXG4gICAgfTtcbiAgICBsZXQgYl94eXogPSB7XG4gICAgICB4OiBiLnggKyBoYWxmLngsXG4gICAgICB5OiBiLnkgKyBoYWxmLnksXG4gICAgICB6OiBiLnogKyBoYWxmLnosXG4gICAgfTtcbiAgICBsZXQgYl94ID0ge1xuICAgICAgeDogYl94eXoueCxcbiAgICAgIHk6IGIueSxcbiAgICAgIHo6IGIueixcbiAgICB9O1xuICAgIGxldCBiX3kgPSB7XG4gICAgICB4OiBiLngsXG4gICAgICB5OiBiX3h5ei55LFxuICAgICAgejogYi56LFxuICAgIH07XG4gICAgbGV0IGJfeiA9IHtcbiAgICAgIHg6IGIueCxcbiAgICAgIHk6IGIueSxcbiAgICAgIHo6IGJfeHl6LnosXG4gICAgfTtcbiAgICBsZXQgYl94eiA9IHtcbiAgICAgIHg6IGJfeHl6LngsXG4gICAgICB5OiBiLnksXG4gICAgICB6OiBiX3h5ei56LFxuICAgIH07XG4gICAgbGV0IGJfeHkgPSB7XG4gICAgICB4OiBiX3h5ei54LFxuICAgICAgeTogYl94eXoueSxcbiAgICAgIHo6IGIueixcbiAgICB9O1xuICAgIGxldCBiX3l6ID0ge1xuICAgICAgeDogYi54LFxuICAgICAgeTogYl94eXoueSxcbiAgICAgIHo6IGJfeHl6LnosXG4gICAgfTtcblxuICAgIGxldCBhX3ogPSB7XG4gICAgICB4OiBhLngsXG4gICAgICB5OiBhLnksXG4gICAgICB6OiBhLnogLSBoYWxmLnosXG4gICAgfTtcbiAgICBsZXQgYV94ID0ge1xuICAgICAgeDogYS54IC0gaGFsZi54LFxuICAgICAgeTogYS55LFxuICAgICAgejogYS56LFxuICAgIH07XG4gICAgbGV0IGFfeSA9IHtcbiAgICAgIHg6IGEueCxcbiAgICAgIHk6IGEueSAtIGhhbGYueSxcbiAgICAgIHo6IGEueixcbiAgICB9O1xuICAgIGxldCBhX3h5ID0ge1xuICAgICAgeDogYV94LngsXG4gICAgICB5OiBhX3kueSxcbiAgICAgIHo6IGEueixcbiAgICB9O1xuICAgIGxldCBhX3l6ID0ge1xuICAgICAgeDogYS54LFxuICAgICAgeTogYV95LnksXG4gICAgICB6OiBhX3oueixcbiAgICB9O1xuICAgIGxldCBhX3h6ID0ge1xuICAgICAgeDogYV94LngsXG4gICAgICB5OiBhLnksXG4gICAgICB6OiBhX3oueixcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gc3ViX2NvbGxpc2lvbihhLCBiKSB7XG4gICAgICBsZXQgY2FuZGlkYXRlc19hID0gZ2V0X2luc2lkZV9wb2ludHMocG9pbnRzX2EsIGEsIGIpO1xuICAgICAgbGV0IGNhbmRpZGF0ZXNfYiA9IGdldF9pbnNpZGVfcG9pbnRzKHBvaW50c19iLCBhLCBiKTtcbiAgICAgIHJldHVybiBvY3RyZWVfY29sbGlzaW9uKGEsIGIsIGNhbmRpZGF0ZXNfYSwgY2FuZGlkYXRlc19iLCByZXMsIGRlcHRoICsgMSk7XG4gICAgfVxuXG4gICAgbGV0IHBhaXJzID0gW1xuICAgICAgW2FfeCwgYl95el0sXG4gICAgICBbYSwgYl94eXpdLFxuICAgICAgW2FfeHksIGJfel0sXG4gICAgICBbYV95LCBiX3h6XSxcblxuICAgICAgW2FfeHosIGJfeV0sXG4gICAgICBbYV96LCBiX3h5XSxcbiAgICAgIFtiX3h5eiwgYl0sXG4gICAgICBbYV95eiwgYl94XSxcbiAgICBdO1xuXG4gICAgbGV0IGZvdW5kID0gZmFsc2U7XG4gICAgZm9yIChsZXQgaSBpbiBwYWlycykge1xuICAgICAgaWYgKHN1Yl9jb2xsaXNpb24ocGFpcnNbaV1bMF0sIHBhaXJzW2ldWzFdKSkge1xuICAgICAgICBmb3VuZCA9IHRydWU7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGZvdW5kO1xuICB9XG5cbn0od2luZG93KTtcbiIsIiFmdW5jdGlvbihnbG9iYWwpIHtcblxuICB2YXIgUEkgPSBNYXRoLlBJO1xuICB2YXIgc2luID0gTWF0aC5zaW47XG4gIHZhciBjb3MgPSBNYXRoLmNvcztcbiAgdmFyIHRhbiA9IE1hdGgudGFuO1xuICB2YXIgYWNvcyA9IE1hdGguYWNvcztcbiAgdmFyIGF0YW4gPSBNYXRoLmF0YW47XG4gIHZhciBwb3cgPSBNYXRoLnBvdztcbiAgdmFyIGZsb29yID0gTWF0aC5mbG9vcjtcbiAgdmFyIHNxcnQgPSBNYXRoLnNxcnQ7XG5cbiAgdmFyIHNub3QgPSB7XG4gICAgZGVidWc6IGZhbHNlLFxuICAgIGNvbnRhaW5lcjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nub3QtY29udGFpbmVyJyksXG4gICAgZG9tOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc25vdC13cmFwJyksXG5cbiAgICBjYW1lcmFfbG9va19hdDoge1xuICAgICAgeDogMCxcbiAgICAgIHk6IDAsXG4gICAgICB6OiAxLFxuICAgIH0sXG4gICAgY29udHJvbHM6IHtcbiAgICAgIHNjcmVlbl9vcmllbnRhdGlvbjogMCxcbiAgICAgIGd5cm9fZGF0YToge1xuICAgICAgICBhbHBoYTogMCxcbiAgICAgICAgYmV0YTogOTAgKiBQSSAvIDE4MCxcbiAgICAgICAgZ2FtbWE6IDBcbiAgICAgIH0sXG4gICAgfSxcbiAgICBtb3VzZV9zZW5zaXRpdml0eTogMC4zLFxuICAgIGF1dG9fcm90YXRpb246IDAsXG4gICAgZnJhbWVzOiAwLFxuICAgIGJnX3JvdGF0aW9uOiBbMCwgMCwgMCwgMCwgMCwgMF0sXG5cbiAgICBwYXVzZV9hbmltYXRpb246IGZhbHNlLFxuXG5cbiAgICBiZ19zaXplOiAxMDI0LFxuXG4gICAgZ2VuZXJhdG9yOiB7fSxcbiAgICBneXJvOiBmYWxzZSxcbiAgICByeTogMCwgICAgICAgIC8vIFJvdGF0ZSAqIGRlZ3JlZSBhcm91bmQgeSBheGlzXG4gICAgcng6IDAsICAgICAgICAvLyBSb3RhdGUgKiBkZWdyZWUgYXJvdW5kIHggYXhpc1xuICAgIGRlc3Rfcng6IDAsXG4gICAgZGVzdF9yeTogMCxcbiAgICBkZXN0X3J6OiAwLFxuXG4gICAgbWF4X2ZvdjogMTIwLCAvLyBNYXggZmllbGQgb2YgdmlldyAoZGVncmVlKVxuICAgIG1pbl9mb3Y6IDYwLCAgIC8vIE1pbiBmaWVsZCBvZiB2aWV3IChkZWdyZWUpXG4gICAgZm92OiA5MCwgICAgICAvLyBEZWZhdWx0IGZpZWxkIG9mIHZpZXdcbiAgICBzbW9vdGg6IDAuMTcsXG4gICAgbWluX2RldGVjdF9kaXN0YW5jZTogMjAsXG4gICAgb25fY2xpY2s6IGZ1bmN0aW9uKCkge30sXG4gICAgb25fc3ByaXRlX2NsaWNrOiBmdW5jdGlvbigpIHt9LFxuICB9O1xuICB2YXIgY2FtZXJhX2RvbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzbm90LWNhbWVyYScpO1xuICB2YXIgcHJldl9neXJvO1xuXG4gIHZhciBjYW1lcmFfYmFzZV90cmFuc2Zvcm07XG4gIHZhciBwcmV2aW91c19xdWF0ID0gbmV3IFRIUkVFLlF1YXRlcm5pb24oKTtcblxuICBmdW5jdGlvbiBfcG9pbnRTdGFuZGFyZGxpemF0aW9uKHgsIHksIHopIHtcbiAgICB2YXIgcmF0aW8gPSAyMDAgLyBkaXN0YW5jZTNEKHgsIHksIHosIDAsIDAsIDApO1xuICAgIHJldHVybiBbeCAqIHJhdGlvLCB5ICogcmF0aW8sIHogKiByYXRpb107XG4gIH1cblxuICBpZiAoZ2xvYmFsLnNub3QpIHtcbiAgICBmb3IgKHZhciBpIGluIHNub3QpIHtcbiAgICAgIGdsb2JhbC5zbm90W2ldID0gc25vdFtpXTtcbiAgICB9XG4gICAgc25vdCA9IGdsb2JhbC5zbm90O1xuICB9IGVsc2Uge1xuICAgIGNvbnNvbGUuZXJyb3IoJ3Nub3QtdXRpbHMuanMgaXMgbWlzc2luZycpO1xuICAgIHJldHVybjtcbiAgfVxuICB2YXIgbV9tYWtlX3JvdGF0aW9uX2F4aXMgPSBzbm90LnV0aWwubV9tYWtlX3JvdGF0aW9uX2F4aXM7XG4gIHZhciBtX211bHRpcGx5ID0gc25vdC51dGlsLm1fbXVsdGlwbHk7XG4gIHZhciBtX3NldF9wb3NpdGlvbiA9IHNub3QudXRpbC5tX3NldF9wb3NpdGlvbjtcbiAgdmFyIG1fbWFrZV9yb3RhdGlvbl9mcm9tX3F1YXRlcm5pb24gPSBzbm90LnV0aWwubV9tYWtlX3JvdGF0aW9uX2Zyb21fcXVhdGVybmlvbjtcbiAgdmFyIHZfc2V0X2Zyb21fbWF0cml4X3Bvc2l0aW9uID0gc25vdC51dGlsLnZfc2V0X2Zyb21fbWF0cml4X3Bvc2l0aW9uO1xuXG4gIHZhciB1dGlsID0gZ2xvYmFsLnNub3QudXRpbDtcbiAgdmFyIGVwc2lsb24gPSB1dGlsLmVwc2lsb247XG4gIHZhciBkaXN0YW5jZTNEID0gdXRpbC5kaXN0YW5jZTNEO1xuICB2YXIgZGlzdGFuY2UyRCA9IHV0aWwuZGlzdGFuY2UyRDtcblxuICB2YXIgc2V0X2ZvdiA9IGZ1bmN0aW9uIChkZWdyZWUpIHtcbiAgICBpZiAoZGVncmVlIDwgc25vdC5taW5fZm92IHx8IGRlZ3JlZSA+IHNub3QubWF4X2Zvdikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBzbm90LmZvdiA9IGRlZ3JlZTtcbiAgICBzbm90LmNvbnRhaW5lci5zdHlsZVsnLXdlYmtpdC10cmFuc2Zvcm0nXSA9ICdzY2FsZSgnICsgdGFuKHNub3QubWF4X2ZvdiAvIDIgKiBQSSAvIDE4MCkgLyB0YW4oc25vdC5mb3YgLyAyICogUEkgLyAxODApICsgJyknO1xuICB9XG5cbiAgZnVuY3Rpb24gcmVzZXQoKSB7XG4gICAgdmFyIHNwcml0ZXMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdzcHJpdGUnKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNwcml0ZXMubGVuZ3RoOyArKyBpKSB7XG4gICAgICBzcHJpdGVzW2ldLnJlbW92ZSgpO1xuICAgIH1cbiAgfVxuXG4gIHZhciBpbml0ID0gZnVuY3Rpb24oY29uZmlnKSB7XG4gICAgcmVzZXQoKTtcblxuICAgIGNhbmNlbEFuaW1hdGlvbkZyYW1lKHNub3QuX2FuaW1hdGVJZCk7XG5cbiAgICBmb3IgKHZhciBpIGluIGNvbmZpZykge1xuICAgICAgaWYgKGkgPT0gJ2dlbmVyYXRvcicpIHtcbiAgICAgICAgdXRpbC5tZXJnZV9qc29uKHNub3QuZ2VuZXJhdG9yLCBjb25maWcuZ2VuZXJhdG9yKTtcbiAgICAgIH1cbiAgICAgIHNub3RbaV0gPSBjb25maWdbaV07XG4gICAgfVxuICAgIHByZXZfZ3lybyA9IHNub3QuZ3lybztcblxuICAgIHNub3QuZGVzdF9yeCA9IHNub3Qucng7XG4gICAgc25vdC5kZXN0X3J5ID0gc25vdC5yeTtcblxuICAgIHNub3Qud2lkdGggPSBzbm90LmRvbS5vZmZzZXRXaWR0aDtcbiAgICBzbm90LmhlaWdodCA9IHNub3QuZG9tLm9mZnNldEhlaWdodDtcblxuICAgIC8vY29tcHV0ZSB0aGUgbWF4IEhvcml6b250YWwgRmllbGQgb2Ygdmlld1xuICAgIC8vcGVyc3BlY3RpdmU9IHByb2plY3RpdmVTY3JlZW5XaWR0aC8yXG4gICAgLy8gICAgICAgICAgID0gd2lkdGgvMi90YW4obWF4X2Zvdi8yKVxuICAgIHNub3QucGVyc3BlY3RpdmUgPSBzbm90LndpZHRoIC8gMiAvIHRhbihzbm90Lm1heF9mb3YgLyAyICogUEkgLyAxODApO1xuXG4gICAgc25vdC5jb250YWluZXIuc3R5bGVbJy13ZWJraXQtcGVyc3BlY3RpdmUnXSA9IHNub3QucGVyc3BlY3RpdmUgKyAncHgnO1xuXG4gICAgLy9jYW1lcmEgb2Zmc2V0XG4gICAgLy8gWiBpcyBkZXB0aChmcm9udCkgWSBpcyBoZWlnaHQgWCBpcyByaWdodFxuICAgIC8vXG4gICAgLy8gdHJhbnNsYXRlWiBzZXRGT1ZcbiAgICAvLyByb3RhdGVYIHJvdGF0ZSBhcm91bmQgWCBheGlzXG4gICAgLy8gcm90YXRlWSByb3RhdGUgYXJvdW5kIFkgYXhpc1xuICAgIC8vIHRyYW5zbGF0ZVggdHJhbnNsYXRlIHRoZSBDYW1lcmEgdG8gY2VudGVyXG4gICAgLy8gdHJhbnNsYXRlWVxuICAgIGNhbWVyYV9iYXNlX3RyYW5zZm9ybSA9ICd0cmFuc2xhdGVYKCcgKyBlcHNpbG9uKC0gKHNub3QuYmdfc2l6ZSAtIHNub3Qud2lkdGgpIC8gMikgKyAncHgpIHRyYW5zbGF0ZVkoJyArIGVwc2lsb24oLSAoc25vdC5iZ19zaXplIC0gc25vdC5oZWlnaHQpIC8gMikgKyAncHgpJztcbiAgICBjYW1lcmFfZG9tLnN0eWxlWyctd2Via2l0LXRyYW5zZm9ybSddID0gJ3RyYW5zbGF0ZVooLScgKyBzbm90LnBlcnNwZWN0aXZlICsgJ3B4KSByb3RhdGVZKCcgKyBlcHNpbG9uKHNub3QucngpICsgJ2RlZykgcm90YXRlWCgnICsgZXBzaWxvbihzbm90LnJ5KSArICdkZWcpJyArIGNhbWVyYV9iYXNlX3RyYW5zZm9ybTtcblxuICAgIHNldF9mb3Yoc25vdC5mb3YpO1xuXG4gICAgaWYgKGNvbmZpZy5iZ19pbWdzKSB7XG4gICAgICBsb2FkX2JnX2ltZ3MoY29uZmlnLmJnX2ltZ3MsIGNvbmZpZy5iZ19yb3RhdGlvbiB8fCBzbm90LmJnX3JvdGF0aW9uKTtcbiAgICB9XG5cbiAgICBpZiAoY29uZmlnKSB7XG4gICAgICBsb2FkX3Nwcml0ZXMoY29uZmlnLnNwcml0ZXMpO1xuICAgIH1cblxuICAgIGlmICh1dGlsLmlzX21vYmlsZSgpKSB7XG4gICAgfVxuXG4gICAgaWYgKGNvbmZpZy5jYWxsYmFjaykge1xuICAgICAgY29uZmlnLmNhbGxiYWNrKCk7XG4gICAgfVxuICAgIHNub3QuaW5pdF9jb250cm9scygpO1xuICAgIHVwZGF0ZSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gbG9hZF9iZ19pbWdzKGJnX2ltZ3MsIGJnX3JvdGF0aW9uKSB7XG4gICAgdmFyIGJnX2NvbmZpZyA9IHtcbiAgICAgIGZyb250IDogJ3JvdGF0ZVkoOTBkZWcpJyArICcgICAgICAgICAgICAgICAgcm90YXRlWignICsgYmdfcm90YXRpb25bMF0gKyAnZGVnKSAgdHJhbnNsYXRlWigtJyArIChzbm90LmJnX3NpemUgLyAyKSArICdweCknLFxuICAgICAgYm90dG9tOiAncm90YXRlWSg5MGRlZyknICsgJ3JvdGF0ZVgoOTBkZWcpICByb3RhdGVaKCcgKyBiZ19yb3RhdGlvblsxXSArICdkZWcpICB0cmFuc2xhdGVaKC0nICsgKHNub3QuYmdfc2l6ZSAvIDIpICsgJ3B4KSByb3RhdGVaKDkwZGVnKScsXG4gICAgICBsZWZ0ICA6ICdyb3RhdGVZKDkwZGVnKScgKyAncm90YXRlWSg5MGRlZykgIHJvdGF0ZVooJyArIGJnX3JvdGF0aW9uWzJdICsgJ2RlZykgIHRyYW5zbGF0ZVooLScgKyAoc25vdC5iZ19zaXplIC8gMikgKyAncHgpJyxcbiAgICAgIGJhY2sgIDogJ3JvdGF0ZVkoOTBkZWcpJyArICdyb3RhdGVZKDE4MGRlZykgcm90YXRlWignICsgYmdfcm90YXRpb25bM10gKyAnZGVnKSAgdHJhbnNsYXRlWigtJyArIChzbm90LmJnX3NpemUgLyAyKSArICdweCknLFxuICAgICAgdG9wICAgOiAncm90YXRlWSg5MGRlZyknICsgJ3JvdGF0ZVgoLTkwZGVnKSByb3RhdGVaKCcgKyBiZ19yb3RhdGlvbls0XSArICdkZWcpICB0cmFuc2xhdGVaKC0nICsgKHNub3QuYmdfc2l6ZSAvIDIpICsgJ3B4KSByb3RhdGVaKC05MGRlZyknLFxuICAgICAgcmlnaHQgOiAncm90YXRlWSg5MGRlZyknICsgJ3JvdGF0ZVkoLTkwZGVnKSByb3RhdGVaKCcgKyBiZ19yb3RhdGlvbls1XSArICdkZWcpICB0cmFuc2xhdGVaKC0nICsgKHNub3QuYmdfc2l6ZSAvIDIpICsgJ3B4KSdcbiAgICB9O1xuXG4gICAgdmFyIGJnX2RvbTtcbiAgICB2YXIgY291bnQgPSAwO1xuICAgIGZvciAodmFyIGkgaW4gYmdfY29uZmlnKSB7XG4gICAgICBiZ19kb20gPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdzbm90LWJnICcgKyBpKVswXTtcbiAgICAgIGJnX2RvbS5zdHlsZVsnLXdlYmtpdC10cmFuc2Zvcm0nXSA9IGJnX2NvbmZpZ1tpXTtcbiAgICAgIGJnX2RvbS5zdHlsZVsnd2lkdGgnXSA9IHNub3QuYmdfc2l6ZSArIDIgKyAncHgnOyAgICAgICAgLy8gMiBtb3JlIHBpeGVscyBmb3Igb3ZlcmxhcHBpbmcgZ2FwcyAoIGNocm9tZSdzIGJ1ZyApXG4gICAgICBiZ19kb20uc3R5bGVbJ2hlaWdodCddID0gc25vdC5iZ19zaXplICsgMiArICdweCc7ICAgICAgIC8vIDIgbW9yZSBwaXhlbHMgZm9yIG92ZXJsYXBwaW5nIGdhcHMgKCBjaHJvbWUncyBidWcgKVxuXG4gICAgICBiZ19kb20uc2V0QXR0cmlidXRlKCdzcmMnLCBiZ19pbWdzW2NvdW50XSk7XG4gICAgICBiZ19kb20uc2V0QXR0cmlidXRlKCdkYXRhLWluZGV4JywgY291bnQpO1xuICAgICAgKytjb3VudDtcbiAgICB9XG4gIH1cblxuICB2YXIgbG9hZF9zcHJpdGVzID0gZnVuY3Rpb24oc3ByaXRlcykge1xuICAgIGZvciAodmFyIGkgaW4gc3ByaXRlcykge1xuICAgICAgdmFyIHQgPSBzcHJpdGVzW2ldO1xuICAgICAgaWYgKHQuc3RhbmRhcmRsaXphdGlvbikge1xuICAgICAgICB2YXIgc3RhbmRhcmQgPSBfcG9pbnRTdGFuZGFyZGxpemF0aW9uKHQueCx0LnksdC56KTtcbiAgICAgICAgdC54PXN0YW5kYXJkWzBdO1xuICAgICAgICB0Lnk9c3RhbmRhcmRbMV07XG4gICAgICAgIHQuej1zdGFuZGFyZFsyXTtcbiAgICAgIH1cblxuICAgICAgdmFyIHRlbXBfd3JhcHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgdGVtcF93cmFwcGVyLmlubmVySFRNTCA9IHRlbXBsYXRlKHNub3QuZ2VuZXJhdG9yW3QuZ2VuZXJhdG9yXSwgdCk7XG4gICAgICB2YXIgZWxlbWVudCA9IHRlbXBfd3JhcHBlci5maXJzdENoaWxkO1xuICAgICAgZWxlbWVudC5kYXRhID0gc3ByaXRlc1tpXTtcbiAgICAgIGFkZF9zcHJpdGVfYnlfcG9zaXRpb24oZWxlbWVudCwgdCk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gYWRkX3Nwcml0ZV9ieV9wb3NpdGlvbihlbGVtZW50LCBwKSB7XG5cbiAgICB2YXIgeCA9IC0gcC54O1xuICAgIHZhciB6ID0gLSBwLno7XG4gICAgdmFyIHkgPSAtIHAueTtcblxuICAgIHZhciBzcHJpdGVDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBzcHJpdGVDb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdpbmxpbmUtYmxvY2snO1xuICAgIHNwcml0ZUNvbnRhaW5lci5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7XG4gICAgc3ByaXRlQ29udGFpbmVyLmNsYXNzTmFtZSA9ICdzcHJpdGUtY29udGFpbmVyJztcbiAgICBzcHJpdGVDb250YWluZXIuaWQgPSBlbGVtZW50LmRhdGEuaWQ7XG5cbiAgICBzcHJpdGVDb250YWluZXIuc3R5bGVbJy13ZWJraXQtdHJhbnNmb3JtLW9yaWdpbi14J10gPSAnMCc7XG4gICAgc3ByaXRlQ29udGFpbmVyLnN0eWxlWyctd2Via2l0LXRyYW5zZm9ybS1vcmlnaW4teSddID0gJzAnO1xuXG4gICAgdmFyIGFyYyA9IHggPT0gMCAmJiB6ID09IDAgPyAwIDogYWNvcyggeiAvIHBvdyh4ICogeCArIHogKiB6LCAwLjUpKTtcblxuICAgIGFyYyA9IHggPCAwID8gMiAqIFBJIC0gYXJjIDogYXJjO1xuICAgIGFyYyA9IGFyYyAqIDE4MCAvIFBJO1xuXG4gICAgdmFyIHIgPSBkaXN0YW5jZTNEKHgsIHksIHosIDAsIDAsIDApO1xuICAgIHggKz0gc25vdC5iZ19zaXplIC8gMjtcbiAgICB5ICs9IHNub3QuYmdfc2l6ZSAvIDI7XG5cbiAgICBzcHJpdGVDb250YWluZXIuc3R5bGVbJy13ZWJraXQtdHJhbnNmb3JtJ10gPSAndHJhbnNsYXRlM2QoJyArIGVwc2lsb24oeCkgKyAncHgsJyArIGVwc2lsb24oeSkgKyAncHgsJyArIGVwc2lsb24oeikgKyAncHgpIHJvdGF0ZVkoJyArIGVwc2lsb24oYXJjKSArICdkZWcpIHJvdGF0ZVgoJyArIGVwc2lsb24oLSAoeSAtIHNub3QuYmdfc2l6ZSAvIDIpIC8gciAqIDkwKSsnZGVnKSByb3RhdGVZKDE4MGRlZyknO1xuXG4gICAgdmFyIHNwcml0ZVdyYXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBzcHJpdGVXcmFwLmNsYXNzTmFtZT0nc3ByaXRlLXdyYXAnO1xuICAgIHNwcml0ZVdyYXAuYXBwZW5kQ2hpbGQoZWxlbWVudCk7XG4gICAgc3ByaXRlV3JhcC5zZXRBdHRyaWJ1dGUoJ2RhdGEtdmlzaWJsZScsIGVsZW1lbnQuZGF0YS52aXNpYmxlID09IGZhbHNlID8gZmFsc2UgOiB0cnVlKTtcblxuICAgIHNwcml0ZUNvbnRhaW5lci5hcHBlbmRDaGlsZChzcHJpdGVXcmFwKTtcbiAgICBjYW1lcmFfZG9tLmFwcGVuZENoaWxkKHNwcml0ZUNvbnRhaW5lcik7XG4gIH1cblxuICB2YXIgdXBkYXRlX3Nwcml0ZV92aXNpYmlsaXR5ID0gZnVuY3Rpb24oaWQpIHtcbiAgICB2YXIgdmlzaWJsZSA9IHNub3Quc3ByaXRlc1tpZF0udmlzaWJsZTtcbiAgICB2YXIgc3ByaXRlQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpO1xuICAgIHNwcml0ZUNvbnRhaW5lci5maXJzdENoaWxkLnNldEF0dHJpYnV0ZSgnZGF0YS12aXNpYmxlJywgdmlzaWJsZSA/IHRydWUgOiBmYWxzZSk7XG4gIH1cblxuICB2YXIgdXBkYXRlX3Nwcml0ZV9wb3NpdGlvbiA9IGZ1bmN0aW9uKGlkKSB7XG4gICAgdmFyIHggPSBzbm90LnNwcml0ZXNbaWRdLng7XG4gICAgdmFyIHkgPSBzbm90LnNwcml0ZXNbaWRdLnk7XG4gICAgdmFyIHogPSBzbm90LnNwcml0ZXNbaWRdLno7XG4gICAgej0tejtcbiAgICB5PS15O1xuICAgIHZhciBhcmMgPSB4ID09IDAgJiYgeiA9PSAwID8gMCA6IGFjb3MoIHogLyBwb3coeCAqIHggKyB6ICogeiwgMC41KSk7XG5cbiAgICBhcmMgPSB4IDwgMCA/IDIgKiBQSSAtIGFyYyA6IGFyYztcbiAgICBhcmMgPSBhcmMgKiAxODAvIFBJO1xuXG4gICAgdmFyIHIgPSBkaXN0YW5jZTNEKHgsIHksIHosIDAsIDAsIDApO1xuICAgIHggKz0gc25vdC5iZ19zaXplIC8gMjtcbiAgICB5ICs9IHNub3QuYmdfc2l6ZSAvIDI7XG5cbiAgICB2YXIgc3ByaXRlQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpO1xuXG4gICAgc3ByaXRlQ29udGFpbmVyLnN0eWxlWyctd2Via2l0LXRyYW5zZm9ybSddID0gJ3RyYW5zbGF0ZTNkKCcgKyBlcHNpbG9uKHgpICsgJ3B4LCcgKyBlcHNpbG9uKHkpICsgJ3B4LCcgKyBlcHNpbG9uKHopICsgJ3B4KSByb3RhdGVZKCcgKyBlcHNpbG9uKGFyYykgKyAnZGVnKSByb3RhdGVYKCcgKyBlcHNpbG9uKC0gKHkgLSBzbm90LmJnX3NpemUgLyAyKSAvIHIgKiA5MCkgKyAnZGVnKSByb3RhdGVZKDE4MGRlZyknO1xuICB9XG5cbiAgZnVuY3Rpb24gcnVuKCkge1xuICAgIHNub3QuX2FuaW1hdGVJZCA9IHJlcXVlc3RBbmltYXRpb25GcmFtZShydW4pO1xuICAgIGlmICghc25vdC5wYXVzZV9hbmltYXRpb24pIHtcbiAgICAgIHVwZGF0ZSgpO1xuICAgIH1cbiAgfVxuXG4gIHZhciBjYW1lcmFfZXVsZXIgPSBuZXcgVEhSRUUuRXVsZXIoKTtcbiAgdmFyIHRhcmdldF9xdWF0ID0gbmV3IFRIUkVFLlF1YXRlcm5pb24oKTtcbiAgdmFyIHJvdGF0ZV85MF9xdWF0ID0gbmV3IFRIUkVFLlF1YXRlcm5pb24oLSBzcXJ0KCAwLjUgKSwgMCwgMCwgc3FydCggMC41ICkpXG4gIHZhciBhZGp1c3Rfc2NyZWVuX3F1YXRzID0ge1xuICAgIDA6IG5ldyBUSFJFRS5RdWF0ZXJuaW9uKCkuc2V0RnJvbUF4aXNBbmdsZShuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAxKSwgMCksXG4gICAgOTA6IG5ldyBUSFJFRS5RdWF0ZXJuaW9uKCkuc2V0RnJvbUF4aXNBbmdsZShuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAxKSwgLSA5MCksXG4gICAgMTgwOiBuZXcgVEhSRUUuUXVhdGVybmlvbigpLnNldEZyb21BeGlzQW5nbGUobmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgMSksIC0gMTgwKSxcbiAgICAnLTkwJzogbmV3IFRIUkVFLlF1YXRlcm5pb24oKS5zZXRGcm9tQXhpc0FuZ2xlKG5ldyBUSFJFRS5WZWN0b3IzKDAsIDAsIDEpLCA5MCksXG4gIH07XG4gIHZhciBsb29rX2F0X2V1bGVyID0gbmV3IFRIUkVFLkV1bGVyKCk7XG5cbiAgZnVuY3Rpb24gdXBkYXRlX2NhbWVyYSh4LCB5LCB6KSB7XG5cbiAgICBjYW1lcmFfZXVsZXIuc2V0KHksIHgsIHosICdZWFonKTsgLy8gJ1pYWScgZm9yIHRoZSBkZXZpY2UsIGJ1dCAnWVhaJyBmb3IgdXNcblxuICAgIHRhcmdldF9xdWF0LnNldEZyb21FdWxlcihjYW1lcmFfZXVsZXIpOyAvLyBvcmllbnQgdGhlIGRldmljZVxuXG4gICAgdGFyZ2V0X3F1YXQubXVsdGlwbHkocm90YXRlXzkwX3F1YXQpOyAvLyBjYW1lcmEgbG9va3Mgb3V0IHRoZSBiYWNrIG9mIHRoZSBkZXZpY2UsIG5vdCB0aGUgdG9wXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAtIFBJLzIgYXJvdW5kIHRoZSB4LWF4aXNcbiAgICB0YXJnZXRfcXVhdC5tdWx0aXBseShhZGp1c3Rfc2NyZWVuX3F1YXRzW3Nub3QuY29udHJvbHMuc2NyZWVuX29yaWVudGF0aW9uXSk7IC8vIGFkanVzdCBmb3Igc2NyZWVuIG9yaWVudGF0aW9uXG5cbiAgICB2YXIgc2xlcnBfcXVhdCA9IG5ldyBUSFJFRS5RdWF0ZXJuaW9uKCk7XG4gICAgVEhSRUUuUXVhdGVybmlvbi5zbGVycCh0YXJnZXRfcXVhdCwgcHJldmlvdXNfcXVhdCwgc2xlcnBfcXVhdCwgMSAtIHNub3Quc21vb3RoKTtcbiAgICBwcmV2aW91c19xdWF0ID0gc2xlcnBfcXVhdDtcbiAgICB2YXIgbG9va19hdF9xdWF0ID0gc2xlcnBfcXVhdC5jbG9uZSgpO1xuICAgIGxvb2tfYXRfcXVhdC54ICo9IC0xO1xuICAgIGxvb2tfYXRfcXVhdC56ICo9IC0xO1xuICAgIHZhciBsb29rX2F0X21hdCA9IG1fbWFrZV9yb3RhdGlvbl9mcm9tX3F1YXRlcm5pb24obG9va19hdF9xdWF0Lm5vcm1hbGl6ZSgpKS50cmFuc3Bvc2UoKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxvb2tfYXRfbWF0LmVsZW1lbnRzLmxlbmd0aDsgKytpKSB7XG4gICAgICBsb29rX2F0X21hdC5lbGVtZW50c1tpXSA9IGVwc2lsb24obG9va19hdF9tYXQuZWxlbWVudHNbaV0pO1xuICAgIH1cbiAgICB2YXIgbG9va19hdF9yb3QgPSBsb29rX2F0X2V1bGVyLnNldEZyb21Sb3RhdGlvbk1hdHJpeChsb29rX2F0X21hdCwgJ1haWScpO1xuXG4gICAgc25vdC5yeCA9IGxvb2tfYXRfcm90Ll94ICogMTgwIC8gUEk7XG4gICAgc25vdC5yeSA9IC0gbG9va19hdF9yb3QuX3kgKiAxODAgLyBQSTtcbiAgICBzbm90LnJ6ID0gbG9va19hdF9yb3QuX3ogKiAxODAgLyBQSTtcblxuICAgIHNub3QuY2FtZXJhX2xvb2tfYXQgPSB2X3NldF9mcm9tX21hdHJpeF9wb3NpdGlvbihtX211bHRpcGx5KFxuICAgICAgbV9tYWtlX3JvdGF0aW9uX2F4aXMoe3g6IDAsIHk6IDEsIHo6IDB9LCBsb29rX2F0X3JvdC5feSksXG4gICAgICBtX21ha2Vfcm90YXRpb25fYXhpcyh7eDogMCwgeTogMCwgejogMX0sIGxvb2tfYXRfcm90Ll96KSxcbiAgICAgIG1fbWFrZV9yb3RhdGlvbl9heGlzKHt4OiAxLCB5OiAwLCB6OiAwfSwgLSBsb29rX2F0X3JvdC5feCksXG4gICAgICBtX3NldF9wb3NpdGlvbih7eDogMCwgeTogMCwgejogMX0pXG4gICAgKSk7IC8vIGJhZCBwZXJmb3JtYW5jZSBoZXJlXG5cbiAgICBjYW1lcmFfZG9tLnN0eWxlLnRyYW5zZm9ybSA9ICd0cmFuc2xhdGVaKCcgKyBlcHNpbG9uKHNub3QucGVyc3BlY3RpdmUpICsgJ3B4KScgKyBcIiBtYXRyaXgzZChcIiArIGxvb2tfYXRfbWF0LmVsZW1lbnRzICsgXCIpXCIrIGNhbWVyYV9iYXNlX3RyYW5zZm9ybTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHVwZGF0ZSgpIHtcbiAgICBzbm90LmZyYW1lcysrO1xuXG4gICAgaWYgKHNub3QuZ3lybykge1xuICAgICAgaWYgKHNub3QuY29udHJvbHMuZ3lyb19kYXRhLmFscGhhID09PSAtMSAmJiBzbm90LmNvbnRyb2xzLmd5cm9fZGF0YS5iZXRhID09PSAtMSAmJiBzbm90LmNvbnRyb2xzLmd5cm9fZGF0YS5nYW1tYSA9PT0gLSAxKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdXBkYXRlX2NhbWVyYShzbm90LmNvbnRyb2xzLmd5cm9fZGF0YS5hbHBoYSwgc25vdC5jb250cm9scy5neXJvX2RhdGEuYmV0YSwgLSBzbm90LmNvbnRyb2xzLmd5cm9fZGF0YS5nYW1tYSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChwcmV2X2d5cm8pIHtcbiAgICAgICAgc25vdC5kZXN0X3J4ID0gMDtcbiAgICAgICAgc25vdC5kZXN0X3J5ID0gMDtcbiAgICAgIH1cbiAgICAgIHNub3QuZGVzdF9yeSAtPSBzbm90LmF1dG9fcm90YXRpb247XG4gICAgICB1cGRhdGVfY2FtZXJhKC0gc25vdC5kZXN0X3J5ICogUEkgLyAxODAsIHNub3QuZGVzdF9yeCAqIFBJIC8gMTgwICsgUEkvMiwgMCk7XG4gICAgfVxuICAgIHByZXZfZ3lybyA9IHNub3QuZ3lybztcblxuICAgIGZvciAodmFyIGkgaW4gc25vdC5zcHJpdGVzKSB7XG4gICAgICB2YXIgc3ByaXRlID0gc25vdC5zcHJpdGVzW2ldO1xuICAgICAgaWYgKHNwcml0ZS5uZWVkX3VwZGF0ZV9wb3NpdGlvbikge1xuICAgICAgICBzcHJpdGUubmVlZF91cGRhdGVfcG9zaXRpb24gPSBmYWxzZTtcbiAgICAgICAgdXBkYXRlX3Nwcml0ZV9wb3NpdGlvbihzcHJpdGUuaWQpO1xuICAgICAgfVxuICAgICAgaWYgKHNwcml0ZS5uZWVkX3VwZGF0ZV92aXNpYmlsaXR5KSB7XG4gICAgICAgIHNwcml0ZS5uZWVkX3VwZGF0ZV92aXNpYmlsaXR5ID0gZmFsc2U7XG4gICAgICAgIHVwZGF0ZV9zcHJpdGVfdmlzaWJpbGl0eShzcHJpdGUuaWQpO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoc25vdC5kZWJ1Zykge1xuICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZ2dlcicpLmlubmVySFRNTCA9ICdyeDonICsgcGFyc2VJbnQoc25vdC5yeCkgKyAnICcgK1xuICAgICAgICAgICAgICAgICAgICAgICAgJ3J5OicgKyBwYXJzZUludChzbm90LnJ5KSArICcgJyArXG4gICAgICAgICAgICAgICAgICAgICAgICAncno6JyArIHBhcnNlSW50KHNub3QucnopO1xuICAgIH1cbiAgfVxuXG5cbiAgdmFyIHNldF9yeCA9IGZ1bmN0aW9uKHJ4LCBzbW9vdGgpIHtcbiAgICAvL1RPRE9cbiAgfVxuXG4gIHZhciBzZXRfcnk9ZnVuY3Rpb24ocnksc21vb3RoKXtcbiAgICAvL1RPRE9cbiAgfVxuXG4gIHNub3QuY29udHJvbHMubW91c2VfY2xpY2sgPSBmdW5jdGlvbih4LCB5KSB7XG4gICAgdmFyIFIgPSAxMDA7XG4gICAgdmFyIGZvdiA9IHNub3QuZm92O1xuICAgIHZhciBiZ19zaXplID0gc25vdC5iZ19zaXplO1xuICAgIHZhciBhcmNGYWN0b3IgPSBNYXRoLlBJIC8gMTgwO1xuICAgIHZhciByeiA9IHNub3QucnogKiBhcmNGYWN0b3I7XG4gICAgdmFyIHdpZHRoID0gc25vdC53aWR0aDtcbiAgICB2YXIgaGVpZ2h0ID0gc25vdC5oZWlnaHQ7XG5cbiAgICB2YXIgcnkgPSAoeCAvIHdpZHRoIC0gMC41KSAqIGZvdjtcbiAgICB2YXIgcnggPSAoeSAvIGhlaWdodC0wLjUpICogZm92ICogaGVpZ2h0IC8gd2lkdGg7XG4gICAgdmFyIHIgPSBjb3MoZm92IC8gMiAqIGFyY0ZhY3RvcikgKiBiZ19zaXplO1xuICAgIHZhciByYXRpb3ggPSAoeCAtIHdpZHRoIC8gMikgLyB3aWR0aCAqIDI7XG4gICAgdmFyIHJhdGlveSA9ICh5IC0gaGVpZ2h0IC8gMikgLyB3aWR0aCAqIDI7XG4gICAgdmFyIFAgPSBzaW4oZm92IC8gMiAqIGFyY0ZhY3RvcikgKiBiZ19zaXplO1xuXG4gICAgcnkgPSBhdGFuKHJhdGlveCAqIFAgLyByKTtcbiAgICByeCA9IGF0YW4ocmF0aW95ICogUCAvIHIpO1xuXG4gICAgcnkgKj0gMTgwIC8gUEk7XG4gICAgcnggKj0gMTgwIC8gUEk7XG5cbiAgICB2YXIgeHl6MiA9IHV0aWwucm90YXRpb25fdG9fcG9zaXRpb24oUiwgcngsIDApO1xuXG4gICAgdmFyIHJyID0gZGlzdGFuY2UzRCgtIHRhbihyeSAqIGFyY0ZhY3RvcikgKiB4eXoyWzJdLCAtIHh5ejJbMV0sIHh5ejJbMl0sIDAsIDAsIDApO1xuICAgIHZhciByYXRpbyA9IFIgLyBycjtcblxuICAgIHZhciBuZXdfeCA9IC0gdGFuKHJ5ICogUEkgLyAxODApICogeHl6MlsyXSAqIHJhdGlvO1xuICAgIHZhciBuZXdfeSA9IC0geHl6MlsxXSAqIHJhdGlvO1xuICAgIHZhciBuZXdfeiA9IHh5ejJbMl0gKiByYXRpbztcblxuICAgIHZhciBwb3MgPSB2X3NldF9mcm9tX21hdHJpeF9wb3NpdGlvbihtX211bHRpcGx5KFxuICAgICAgbV9tYWtlX3JvdGF0aW9uX2F4aXMoe3g6IDAsIHk6IDEsIHo6IDB9LCBzbm90LnJ5ICogUEkgLyAxODApLFxuICAgICAgbV9tYWtlX3JvdGF0aW9uX2F4aXMoe3g6IDAsIHk6IDAsIHo6IDF9LCAtIHNub3QucnogKiBQSSAvIDE4MCksXG4gICAgICBtX21ha2Vfcm90YXRpb25fYXhpcyh7eDogMSwgeTogMCwgejogMH0sIC0gc25vdC5yeCAqIFBJIC8gMTgwKSxcbiAgICAgIG1fc2V0X3Bvc2l0aW9uKHt4OiBuZXdfeCwgeTogbmV3X3ksIHo6IG5ld196fSlcbiAgICApKTtcblxuICAgIGF4ID0gcG9zLng7XG4gICAgYXkgPSBwb3MueTtcbiAgICBheiA9IHBvcy56O1xuXG4gICAgdmFyIG1pbl9vZmZzZXQgPSAwLjQ7XG4gICAgdmFyIG1pbl9kaXN0YW5jZSA9IHNub3QubWluX2RldGVjdF9kaXN0YW5jZTtcbiAgICB2YXIgbmVhcmVzdDtcblxuICAgIHZhciBzcHJpdGVDb250YWluZXJzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnc3ByaXRlLWNvbnRhaW5lcicpO1xuICAgIGZvciAodmFyIGkgPSAwIDtpIDwgc3ByaXRlQ29udGFpbmVycy5sZW5ndGg7ICsraSkge1xuICAgICAgdmFyIHNlbGYgPSBzcHJpdGVDb250YWluZXJzW2ldO1xuICAgICAgdmFyIG1hdHJpeCA9IHV0aWwuY3NzX3RleHRfdG9fbWF0cml4KHNlbGYuc3R5bGUud2Via2l0VHJhbnNmb3JtKTtcbiAgICAgIHZhciByYXRlXyA9IDEwMCAvIGRpc3RhbmNlM0QoMCwgMCwgMCwgc25vdC5iZ19zaXplIC8gMiAtIG1hdHJpeFsxMl0sIG1hdHJpeFsxM10gLSBzbm90LmJnX3NpemUgLyAyLCAtIG1hdHJpeFsxNF0pO1xuXG4gICAgICB2YXIgZGlzdGFuY2UgPSBkaXN0YW5jZTNEKGF4LCAtIGF5LCBheiwgKHNub3QuYmdfc2l6ZSAvIDIgLSBtYXRyaXhbMTJdKSAqIHJhdGVfLCByYXRlXyAqIChtYXRyaXhbMTNdIC0gc25vdC5iZ19zaXplIC8gMiksIHJhdGVfICogKCAtIG1hdHJpeFsxNF0pKTtcbiAgICAgIGlmIChkaXN0YW5jZSA8IG1pbl9kaXN0YW5jZSkge1xuICAgICAgICBtaW5fZGlzdGFuY2UgPSBkaXN0YW5jZTtcbiAgICAgICAgbmVhcmVzdCA9IHNlbGYuY2hpbGRyZW5bMF07XG4gICAgICB9XG4gICAgfVxuXG4gICAgdmFyIHJvdGF0aW9uID0gdXRpbC5wb3NpdGlvbl90b19yb3RhdGlvbihheCwgYXosIGF5KTtcbiAgICBpZiAobmVhcmVzdCkge1xuICAgICAgc25vdC5vbl9zcHJpdGVfY2xpY2soc25vdC5zcHJpdGVzW25lYXJlc3QucGFyZW50RWxlbWVudC5pZF0sIG5lYXJlc3QpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzbm90Lm9uX2NsaWNrKHtcbiAgICAgICAgeDogYXgsXG4gICAgICAgIHk6IGF5LFxuICAgICAgICB6OiBheixcbiAgICAgIH0sIHtcbiAgICAgICAgcng6IHJvdGF0aW9uWzBdLFxuICAgICAgICByeTogcm90YXRpb25bMV1cbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHV0aWwubWVyZ2VfanNvbihzbm90LCB7XG4gICAgc2V0X2Zvdjogc2V0X2ZvdixcbiAgICBzZXRfcng6IHNldF9yeCxcbiAgICBzZXRfcnk6IHNldF9yeSxcbiAgICBpbml0OiBpbml0LFxuICAgIHJ1bjogcnVuLFxuICAgIHVwZGF0ZTogdXBkYXRlLFxuICAgIGxvYWRfc3ByaXRlczogbG9hZF9zcHJpdGVzLFxuICB9KTtcbn0od2luZG93KTtcbiIsIiFmdW5jdGlvbihnbG9iYWwpIHtcblxuICB2YXIgZG9tX29mZnNldF90b3A7XG4gIHZhciBkb21fb2Zmc2V0X2xlZnQ7XG4gIHNub3QuaW5pdF9jb250cm9scyA9IGZ1bmN0aW9uKCkge1xuXG4gICAgZG9tX29mZnNldF9sZWZ0ID0gdXRpbC5sZWZ0X3Bvcyhzbm90LmRvbSk7XG4gICAgZG9tX29mZnNldF90b3AgPSB1dGlsLnRvcF9wb3Moc25vdC5kb20pO1xuICAgIHNub3QuY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCBtb3VzZV9kb3duLCBmYWxzZSk7XG4gICAgc25vdC5jb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJyAsIG1vdXNlX21vdmUsIGZhbHNlKTtcbiAgICBzbm90LmNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcgICwgbW91c2VfdXAgICwgZmFsc2UpO1xuXG4gICAgc25vdC5jb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJyAsIG1vdXNlX2Rvd24gLCBmYWxzZSk7XG4gICAgc25vdC5jb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJyAsIG1vdXNlX21vdmUgLCBmYWxzZSk7XG4gICAgc25vdC5jb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcgICAsIG1vdXNlX3VwICAgLCBmYWxzZSk7XG4gICAgc25vdC5jb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V3aGVlbCcsIG1vdXNlX3doZWVsLCBmYWxzZSk7XG5cbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignb3JpZW50YXRpb25jaGFuZ2UnLCBmdW5jdGlvbihldikge1xuICAgICAgc25vdC5jb250cm9scy5zY3JlZW5fb3JpZW50YXRpb24gPSB3aW5kb3cub3JpZW50YXRpb24gfHwgMDtcbiAgICB9LCBmYWxzZSk7XG5cbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignZGV2aWNlb3JpZW50YXRpb24nLCBmdW5jdGlvbihldikge1xuICAgICAgaWYgKGV2LmFscGhhICE9PSBudWxsKSB7XG4gICAgICAgIHNub3QuY29udHJvbHMuZ3lyb19kYXRhLmJldGEgPSBldi5iZXRhICAqIE1hdGguUEkgLyAxODAgO1xuICAgICAgICBzbm90LmNvbnRyb2xzLmd5cm9fZGF0YS5nYW1tYSA9IGV2LmdhbW1hICAqIE1hdGguUEkgLyAxODA7XG4gICAgICAgIHNub3QuY29udHJvbHMuZ3lyb19kYXRhLmFscGhhID0gZXYuYWxwaGEgICogTWF0aC5QSSAvIDE4MDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNub3QuY29udHJvbHMuZ3lyb19kYXRhLmJldGEgPSBzbm90LmNvbnRyb2xzLmd5cm9fZGF0YS5nYW1tYSA9IHNub3QuY29udHJvbHMuZ3lyb19kYXRhLmFscGhhID0gLTE7XG4gICAgICB9XG4gICAgfSwgdHJ1ZSk7XG4gIH1cblxuICB2YXIgdXRpbCA9IHNub3QudXRpbDtcbiAgdmFyIGRpc3RhbmNlM0QgPSB1dGlsLmRpc3RhbmNlM0Q7XG4gIHZhciBkaXN0YW5jZTJEID0gdXRpbC5kaXN0YW5jZTJEO1xuICB2YXIgZmxvb3IgPSBNYXRoLmZsb29yO1xuICB2YXIgY29zID0gTWF0aC5jb3M7XG4gIHZhciBzaW4gPSBNYXRoLnNpbjtcbiAgdmFyIGF0YW4gPSBNYXRoLmF0YW47XG4gIHZhciB0YW4gPSBNYXRoLnRhbjtcbiAgdmFyIFBJID0gTWF0aC5QSTtcblxuICB2YXIgbV9tYWtlX3JvdGF0aW9uX2F4aXMgPSBzbm90LnV0aWwubV9tYWtlX3JvdGF0aW9uX2F4aXM7XG4gIHZhciBtX211bHRpcGx5ID0gc25vdC51dGlsLm1fbXVsdGlwbHk7XG4gIHZhciBtX3NldF9wb3NpdGlvbiA9IHNub3QudXRpbC5tX3NldF9wb3NpdGlvbjtcbiAgdmFyIG1fbWFrZV9yb3RhdGlvbl9mcm9tX3F1YXRlcm5pb24gPSBzbm90LnV0aWwubV9tYWtlX3JvdGF0aW9uX2Zyb21fcXVhdGVybmlvbjtcbiAgdmFyIHZfc2V0X2Zyb21fbWF0cml4X3Bvc2l0aW9uID0gc25vdC51dGlsLnZfc2V0X2Zyb21fbWF0cml4X3Bvc2l0aW9uO1xuXG4gIHZhciB0b3VjaGVzID0ge1xuICAgIGZ4OiAwLCAgIC8vIEZpcnN0ICBmaW5nZXIgeFxuICAgIGZ5OiAwLCAgIC8vIEZpcnN0ICBmaW5nZXIgeVxuICAgIHN4OiAwLCAgIC8vIFNlY29uZCBmaW5nZXIgeFxuICAgIHN5OiAwICAgIC8vIFNlY29uZCBmaW5nZXIgeVxuICB9O1xuXG4gIHZhciBtb3VzZV9tb3ZlID0gZnVuY3Rpb24oZXZlbnQpIHtcblxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICB2YXIgeCA9IE1hdGguZmxvb3IoZXZlbnQuY2xpZW50WCA+PSAwID8gZXZlbnQuY2xpZW50WCA6IGV2ZW50LnRvdWNoZXNbMF0ucGFnZVgpO1xuICAgIHZhciB5ID0gTWF0aC5mbG9vcihldmVudC5jbGllbnRZID49IDAgPyBldmVudC5jbGllbnRZIDogZXZlbnQudG91Y2hlc1swXS5wYWdlWSk7XG4gICAgeCAtPSBkb21fb2Zmc2V0X2xlZnQ7XG4gICAgeSAtPSBkb21fb2Zmc2V0X3RvcDtcblxuICAgIHRvdWNoZXMuY2xpY2sgPSBmYWxzZTtcblxuICAgIGlmICghdG91Y2hlcy5pc190b3VjaGluZykge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGlmIChldmVudC50b3VjaGVzICYmIGV2ZW50LnRvdWNoZXMubGVuZ3RoID4gMSkge1xuXG4gICAgICB2YXIgY2Z4ID0geDsgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEN1cnJlbnQgZnJpc3QgIGZpbmdlciB4XG4gICAgICB2YXIgY2Z5ID0geTsgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEN1cnJlbnQgZmlyc3QgIGZpbmdlciB5XG4gICAgICB2YXIgY3N4ID0gZXZlbnQudG91Y2hlc1sxXS5wYWdlWDsgICAgIC8vIEN1cnJlbnQgc2Vjb25kIGZpbmdlciB4XG4gICAgICB2YXIgY3N5ID0gZXZlbnQudG91Y2hlc1sxXS5wYWdlWTsgICAgIC8vIEN1cnJlbnQgc2Vjb25kIGZpbmdlciB5XG5cbiAgICAgIHZhciBkaXMgPSBkaXN0YW5jZTJEKHRvdWNoZXMuZngsIHRvdWNoZXMuZnksIHRvdWNoZXMuc3gsIHRvdWNoZXMuc3kpIC0gZGlzdGFuY2UyRChjZngsIGNmeSwgY3N4LCBjc3kpO1xuXG4gICAgICB2YXIgcmF0aW8gPSAwLjEyO1xuICAgICAgc25vdC5zZXRfZm92KHNub3QuZm92ICsgZGlzICogcmF0aW8pO1xuXG4gICAgICB0b3VjaGVzLmZ4ID0gY2Z4O1xuICAgICAgdG91Y2hlcy5meSA9IGNmeTtcbiAgICAgIHRvdWNoZXMuc3ggPSBjc3g7XG4gICAgICB0b3VjaGVzLnN5ID0gY3N5O1xuXG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgdmFyIHJhdGlvID0gc25vdC5tb3VzZV9zZW5zaXRpdml0eTtcblxuICAgIHNub3QuZGVzdF9yeSA9IHNub3QuZGVzdF9yeSArICh0b3VjaGVzLmZ4IC0geCkgKiByYXRpbztcbiAgICBzbm90LmRlc3RfcnggPSBzbm90LmRlc3RfcnggLSAodG91Y2hlcy5meSAtIHkpICogcmF0aW87XG5cbiAgICB0b3VjaGVzLmZ4ID0geDtcbiAgICB0b3VjaGVzLmZ5ID0geTtcblxuICAgIHNub3QuZGVzdF9yeCA9IHNub3QuZGVzdF9yeCA+IDkwID8gOTAgOiBzbm90LmRlc3Rfcng7XG4gICAgc25vdC5kZXN0X3J4ID0gc25vdC5kZXN0X3J4IDwgLTkwID8gLTkwIDogc25vdC5kZXN0X3J4O1xuXG4gIH07XG5cbiAgdmFyIG1vdXNlX2Rvd24gPSBmdW5jdGlvbiAoZXZlbnQpIHtcblxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICB2YXIgeCA9IGZsb29yKGV2ZW50LmNsaWVudFggPj0gMCA/IGV2ZW50LmNsaWVudFggOiBldmVudC50b3VjaGVzWzBdLmNsaWVudFgpO1xuICAgIHZhciB5ID0gZmxvb3IoZXZlbnQuY2xpZW50WSA+PSAwID8gZXZlbnQuY2xpZW50WSA6IGV2ZW50LnRvdWNoZXNbMF0uY2xpZW50WSk7XG4gICAgeCAtPSBkb21fb2Zmc2V0X2xlZnQ7XG4gICAgeSAtPSBkb21fb2Zmc2V0X3RvcDtcblxuICAgIHRvdWNoZXMubW91c2VfZG93bl94ID0geDtcbiAgICB0b3VjaGVzLm1vdXNlX2Rvd25feSA9IHk7XG4gICAgdG91Y2hlcy5meCA9IHg7XG4gICAgdG91Y2hlcy5meSA9IHk7XG4gICAgdG91Y2hlcy5jbGljayA9IHRydWU7XG5cbiAgICBpZiAoZXZlbnQudG91Y2hlcyAmJiBldmVudC50b3VjaGVzLmxlbmd0aCA+IDEpIHtcblxuICAgICAgdG91Y2hlcy5zeCA9IGV2ZW50LnRvdWNoZXNbMV0ucGFnZVg7XG4gICAgICB0b3VjaGVzLnN5ID0gZXZlbnQudG91Y2hlc1sxXS5wYWdlWTtcblxuICAgIH1cblxuICAgIHRvdWNoZXMuaXNfdG91Y2hpbmcgPSB0cnVlO1xuICB9XG5cbiAgdmFyIG1vdXNlX3doZWVsID0gZnVuY3Rpb24gKGV2ZW50KSB7XG5cbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuXG4gICAgdmFyIG9mZnNldCA9IGV2ZW50LmRlbHRhWTtcbiAgICBzbm90LnNldF9mb3Yoc25vdC5mb3YgKyBvZmZzZXQgKiAwLjA2KTtcblxuICB9XG5cbiAgdmFyIG1vdXNlX3VwID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuXG4gICAgdmFyIHggPSBmbG9vcihldmVudC5jbGllbnRYID49IDAgPyBldmVudC5jbGllbnRYIDogZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVgpO1xuICAgIHZhciB5ID0gZmxvb3IoZXZlbnQuY2xpZW50WSA+PSAwID8gZXZlbnQuY2xpZW50WSA6IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VZKTtcbiAgICB4IC09IGRvbV9vZmZzZXRfbGVmdDtcbiAgICB5IC09IGRvbV9vZmZzZXRfdG9wO1xuXG4gICAgLy9TY3JlZW4gY29vcmRpbmF0ZSB0byBTcGhlcmUgM2QgY29vcmRpbmF0ZVxuICAgIGlmIChkaXN0YW5jZTJEKHRvdWNoZXMubW91c2VfZG93bl94LCB0b3VjaGVzLm1vdXNlX2Rvd25feSwgeCwgeSkgPCA1KSB7XG4gICAgICBzbm90LmNvbnRyb2xzLm1vdXNlX2NsaWNrKHgsIHkpO1xuICAgIH1cbiAgICB0b3VjaGVzLmlzX3RvdWNoaW5nID0gZmFsc2U7XG4gIH1cblxufSh3aW5kb3cpO1xuIl19
