THREE={},THREE.Math={clamp:function(E,n,t){return E>t?t:E<n?n:E}};
THREE.Vector3=function(t,i,s){this.x=t||0,this.y=i||0,this.z=s||0},THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(t,i,s){return this.x=t,this.y=i,this.z=s,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+t)}},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,i){return void 0!==i?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,i)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this},addScaledVector:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this},sub:function(t,i){return void 0!==i?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,i)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this},multiply:function(t,i){return void 0!==i?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,i)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return isFinite(t)?(this.x*=t,this.y*=t,this.z*=t):(this.x=0,this.y=0,this.z=0),this},multiplyVectors:function(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this},applyEuler:function(){var t;return function(i){return i instanceof THREE.Euler==!1&&console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),void 0===t&&(t=new THREE.Quaternion),this.applyQuaternion(t.setFromEuler(i))}}(),applyAxisAngle:function(){var t;return function(i,s){return void 0===t&&(t=new THREE.Quaternion),this.applyQuaternion(t.setFromAxisAngle(i,s))}}(),applyMatrix3:function(t){var i=this.x,s=this.y,n=this.z,r=t.elements;return this.x=r[0]*i+r[3]*s+r[6]*n,this.y=r[1]*i+r[4]*s+r[7]*n,this.z=r[2]*i+r[5]*s+r[8]*n,this},applyMatrix4:function(t){var i=this.x,s=this.y,n=this.z,r=t.elements;return this.x=r[0]*i+r[4]*s+r[8]*n+r[12],this.y=r[1]*i+r[5]*s+r[9]*n+r[13],this.z=r[2]*i+r[6]*s+r[10]*n+r[14],this},applyProjection:function(t){var i=this.x,s=this.y,n=this.z,r=t.elements,h=1/(r[3]*i+r[7]*s+r[11]*n+r[15]);return this.x=(r[0]*i+r[4]*s+r[8]*n+r[12])*h,this.y=(r[1]*i+r[5]*s+r[9]*n+r[13])*h,this.z=(r[2]*i+r[6]*s+r[10]*n+r[14])*h,this},applyQuaternion:function(t){var i=this.x,s=this.y,n=this.z,r=t.x,h=t.y,e=t.z,o=t.w,a=o*i+h*n-e*s,u=o*s+e*i-r*n,c=o*n+r*s-h*i,y=-r*i-h*s-e*n;return this.x=a*o+y*-r+u*-e-c*-h,this.y=u*o+y*-h+c*-r-a*-e,this.z=c*o+y*-e+a*-h-u*-r,this},project:function(){var t;return function(i){return void 0===t&&(t=new THREE.Matrix4),t.multiplyMatrices(i.projectionMatrix,t.getInverse(i.matrixWorld)),this.applyProjection(t)}}(),unproject:function(){var t;return function(i){return void 0===t&&(t=new THREE.Matrix4),t.multiplyMatrices(i.matrixWorld,t.getInverse(i.projectionMatrix)),this.applyProjection(t)}}(),transformDirection:function(t){var i=this.x,s=this.y,n=this.z,r=t.elements;return this.x=r[0]*i+r[4]*s+r[8]*n,this.y=r[1]*i+r[5]*s+r[9]*n,this.z=r[2]*i+r[6]*s+r[10]*n,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this},clampScalar:function(){var t,i;return function(s,n){return void 0===t&&(t=new THREE.Vector3,i=new THREE.Vector3),t.set(s,s,s),i.set(n,n,n),this.clamp(t,i)}}(),clampLength:function(t,i){var s=this.length();return this.multiplyScalar(Math.max(t,Math.min(i,s))/s)},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){return this.multiplyScalar(t/this.length())},lerp:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this},lerpVectors:function(t,i,s){return this.subVectors(i,t).multiplyScalar(s).add(t)},cross:function(t,i){if(void 0!==i)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,i);var s=this.x,n=this.y,r=this.z;return this.x=n*t.z-r*t.y,this.y=r*t.x-s*t.z,this.z=s*t.y-n*t.x,this},crossVectors:function(t,i){var s=t.x,n=t.y,r=t.z,h=i.x,e=i.y,o=i.z;return this.x=n*o-r*e,this.y=r*h-s*o,this.z=s*e-n*h,this},projectOnVector:function(t){var i=t.dot(this)/t.lengthSq();return this.copy(t).multiplyScalar(i)},projectOnPlane:function(){var t;return function(i){return void 0===t&&(t=new THREE.Vector3),t.copy(this).projectOnVector(i),this.sub(t)}}(),reflect:function(){var t;return function(i){return void 0===t&&(t=new THREE.Vector3),this.sub(t.copy(i).multiplyScalar(2*this.dot(i)))}}(),angleTo:function(t){var i=this.dot(t)/Math.sqrt(this.lengthSq()*t.lengthSq());return Math.acos(THREE.Math.clamp(i,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var i=this.x-t.x,s=this.y-t.y,n=this.z-t.z;return i*i+s*s+n*n},distanceToManhattan:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){var i=Math.sin(t.phi)*t.radius;return this.x=i*Math.sin(t.theta),this.y=Math.cos(t.phi)*t.radius,this.z=i*Math.cos(t.theta),this},setFromMatrixPosition:function(t){return this.setFromMatrixColumn(t,3)},setFromMatrixScale:function(t){var i=this.setFromMatrixColumn(t,0).length(),s=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=i,this.y=s,this.z=n,this},setFromMatrixColumn:function(t,i){if("number"==typeof t){console.warn("THREE.Vector3: setFromMatrixColumn now expects ( matrix, index ).");var s=t;t=i,i=s}return this.fromArray(t.elements,4*i)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,i){return void 0===i&&(i=0),this.x=t[i],this.y=t[i+1],this.z=t[i+2],this},toArray:function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t},fromAttribute:function(t,i,s){return void 0===s&&(s=0),i=i*t.itemSize+s,this.x=t.array[i],this.y=t.array[i+1],this.z=t.array[i+2],this}};
THREE.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")},THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(t,e,r,n,i,s,o,a,u,l,h,c,m,f,v,y){var E=this.elements;return E[0]=t,E[4]=e,E[8]=r,E[12]=n,E[1]=i,E[5]=s,E[9]=o,E[13]=a,E[2]=u,E[6]=l,E[10]=h,E[14]=c,E[3]=m,E[7]=f,E[11]=v,E[15]=y,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new THREE.Matrix4).fromArray(this.elements)},copy:function(t){return this.elements.set(t.elements),this},copyPosition:function(t){var e=this.elements,r=t.elements;return e[12]=r[12],e[13]=r[13],e[14]=r[14],this},extractBasis:function(t,e,r){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,r){return this.set(t.x,e.x,r.x,0,t.y,e.y,r.y,0,t.z,e.z,r.z,0,0,0,0,1),this},extractRotation:function(){var t;return function(e){void 0===t&&(t=new THREE.Vector3);var r=this.elements,n=e.elements,i=1/t.setFromMatrixColumn(e,0).length(),s=1/t.setFromMatrixColumn(e,1).length(),o=1/t.setFromMatrixColumn(e,2).length();return r[0]=n[0]*i,r[1]=n[1]*i,r[2]=n[2]*i,r[4]=n[4]*s,r[5]=n[5]*s,r[6]=n[6]*s,r[8]=n[8]*o,r[9]=n[9]*o,r[10]=n[10]*o,this}}(),makeRotationFromEuler:function(t){t instanceof THREE.Euler==!1&&console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=this.elements,r=t.x,n=t.y,i=t.z,s=Math.cos(r),o=Math.sin(r),a=Math.cos(n),u=Math.sin(n),l=Math.cos(i),h=Math.sin(i);if("XYZ"===t.order){var c=s*l,m=s*h,f=o*l,v=o*h;e[0]=a*l,e[4]=-a*h,e[8]=u,e[1]=m+f*u,e[5]=c-v*u,e[9]=-o*a,e[2]=v-c*u,e[6]=f+m*u,e[10]=s*a}else if("YXZ"===t.order){var y=a*l,E=a*h,M=u*l,x=u*h;e[0]=y+x*o,e[4]=M*o-E,e[8]=s*u,e[1]=s*h,e[5]=s*l,e[9]=-o,e[2]=E*o-M,e[6]=x+y*o,e[10]=s*a}else if("ZXY"===t.order){var y=a*l,E=a*h,M=u*l,x=u*h;e[0]=y-x*o,e[4]=-s*h,e[8]=M+E*o,e[1]=E+M*o,e[5]=s*l,e[9]=x-y*o,e[2]=-s*u,e[6]=o,e[10]=s*a}else if("ZYX"===t.order){var c=s*l,m=s*h,f=o*l,v=o*h;e[0]=a*l,e[4]=f*u-m,e[8]=c*u+v,e[1]=a*h,e[5]=v*u+c,e[9]=m*u-f,e[2]=-u,e[6]=o*a,e[10]=s*a}else if("YZX"===t.order){var d=s*a,p=s*u,R=o*a,T=o*u;e[0]=a*l,e[4]=T-d*h,e[8]=R*h+p,e[1]=h,e[5]=s*l,e[9]=-o*l,e[2]=-u*l,e[6]=p*h+R,e[10]=d-T*h}else if("XZY"===t.order){var d=s*a,p=s*u,R=o*a,T=o*u;e[0]=a*l,e[4]=-h,e[8]=u*l,e[1]=d*h+T,e[5]=s*l,e[9]=p*h-R,e[2]=R*h-p,e[6]=o*l,e[10]=T*h+d}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:function(t){var e=this.elements,r=t.x,n=t.y,i=t.z,s=t.w,o=r+r,a=n+n,u=i+i,l=r*o,h=r*a,c=r*u,m=n*a,f=n*u,v=i*u,y=s*o,E=s*a,M=s*u;return e[0]=1-(m+v),e[4]=h-M,e[8]=c+E,e[1]=h+M,e[5]=1-(l+v),e[9]=f-y,e[2]=c-E,e[6]=f+y,e[10]=1-(l+m),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},lookAt:function(){var t,e,r;return function(n,i,s){void 0===t&&(t=new THREE.Vector3,e=new THREE.Vector3,r=new THREE.Vector3);var o=this.elements;return r.subVectors(n,i).normalize(),0===r.lengthSq()&&(r.z=1),t.crossVectors(s,r).normalize(),0===t.lengthSq()&&(r.z+=1e-4,t.crossVectors(s,r).normalize()),e.crossVectors(r,t),o[0]=t.x,o[4]=e.x,o[8]=r.x,o[1]=t.y,o[5]=e.y,o[9]=r.y,o[2]=t.z,o[6]=e.z,o[10]=r.z,this}}(),multiply:function(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var r=t.elements,n=e.elements,i=this.elements,s=r[0],o=r[4],a=r[8],u=r[12],l=r[1],h=r[5],c=r[9],m=r[13],f=r[2],v=r[6],y=r[10],E=r[14],M=r[3],x=r[7],d=r[11],p=r[15],R=n[0],T=n[4],g=n[8],z=n[12],H=n[1],w=n[5],k=n[9],A=n[13],F=n[2],V=n[6],X=n[10],Y=n[14],Z=n[3],C=n[7],P=n[11],S=n[15];return i[0]=s*R+o*H+a*F+u*Z,i[4]=s*T+o*w+a*V+u*C,i[8]=s*g+o*k+a*X+u*P,i[12]=s*z+o*A+a*Y+u*S,i[1]=l*R+h*H+c*F+m*Z,i[5]=l*T+h*w+c*V+m*C,i[9]=l*g+h*k+c*X+m*P,i[13]=l*z+h*A+c*Y+m*S,i[2]=f*R+v*H+y*F+E*Z,i[6]=f*T+v*w+y*V+E*C,i[10]=f*g+v*k+y*X+E*P,i[14]=f*z+v*A+y*Y+E*S,i[3]=M*R+x*H+d*F+p*Z,i[7]=M*T+x*w+d*V+p*C,i[11]=M*g+x*k+d*X+p*P,i[15]=M*z+x*A+d*Y+p*S,this},multiplyToArray:function(t,e,r){var n=this.elements;return this.multiplyMatrices(t,e),r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[8]=n[8],r[9]=n[9],r[10]=n[10],r[11]=n[11],r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15],this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},applyToVector3Array:function(){var t;return function(e,r,n){void 0===t&&(t=new THREE.Vector3),void 0===r&&(r=0),void 0===n&&(n=e.length);for(var i=0,s=r;i<n;i+=3,s+=3)t.fromArray(e,s),t.applyMatrix4(this),t.toArray(e,s);return e}}(),applyToBuffer:function(){var t;return function(e,r,n){void 0===t&&(t=new THREE.Vector3),void 0===r&&(r=0),void 0===n&&(n=e.length/e.itemSize);for(var i=0,s=r;i<n;i++,s++)t.x=e.getX(s),t.y=e.getY(s),t.z=e.getZ(s),t.applyMatrix4(this),e.setXYZ(t.x,t.y,t.z);return e}}(),determinant:function(){var t=this.elements,e=t[0],r=t[4],n=t[8],i=t[12],s=t[1],o=t[5],a=t[9],u=t[13],l=t[2],h=t[6],c=t[10],m=t[14],f=t[3],v=t[7],y=t[11],E=t[15];return f*(+i*a*h-n*u*h-i*o*c+r*u*c+n*o*m-r*a*m)+v*(+e*a*m-e*u*c+i*s*c-n*s*m+n*u*l-i*a*l)+y*(+e*u*h-e*o*m-i*s*h+r*s*m+i*o*l-r*u*l)+E*(-n*o*l-e*a*h+e*o*c+n*s*h-r*s*c+r*a*l)},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset is deprecated - just use .toArray instead."),this.toArray(t,e)},getPosition:function(){var t;return function(){return void 0===t&&(t=new THREE.Vector3),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),t.setFromMatrixColumn(this,3)}}(),setPosition:function(t){var e=this.elements;return e[12]=t.x,e[13]=t.y,e[14]=t.z,this},getInverse:function(t,e){var r=this.elements,n=t.elements,i=n[0],s=n[1],o=n[2],a=n[3],u=n[4],l=n[5],h=n[6],c=n[7],m=n[8],f=n[9],v=n[10],y=n[11],E=n[12],M=n[13],x=n[14],d=n[15],p=f*x*c-M*v*c+M*h*y-l*x*y-f*h*d+l*v*d,R=E*v*c-m*x*c-E*h*y+u*x*y+m*h*d-u*v*d,T=m*M*c-E*f*c+E*l*y-u*M*y-m*l*d+u*f*d,g=E*f*h-m*M*h-E*l*v+u*M*v+m*l*x-u*f*x,z=i*p+s*R+o*T+a*g;if(0===z){var H="THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0";if(e)throw new Error(H);return console.warn(H),this.identity()}var w=1/z;return r[0]=p*w,r[1]=(M*v*a-f*x*a-M*o*y+s*x*y+f*o*d-s*v*d)*w,r[2]=(l*x*a-M*h*a+M*o*c-s*x*c-l*o*d+s*h*d)*w,r[3]=(f*h*a-l*v*a-f*o*c+s*v*c+l*o*y-s*h*y)*w,r[4]=R*w,r[5]=(m*x*a-E*v*a+E*o*y-i*x*y-m*o*d+i*v*d)*w,r[6]=(E*h*a-u*x*a-E*o*c+i*x*c+u*o*d-i*h*d)*w,r[7]=(u*v*a-m*h*a+m*o*c-i*v*c-u*o*y+i*h*y)*w,r[8]=T*w,r[9]=(E*f*a-m*M*a-E*s*y+i*M*y+m*s*d-i*f*d)*w,r[10]=(u*M*a-E*l*a+E*s*c-i*M*c-u*s*d+i*l*d)*w,r[11]=(m*l*a-u*f*a-m*s*c+i*f*c+u*s*y-i*l*y)*w,r[12]=g*w,r[13]=(m*M*o-E*f*o+E*s*v-i*M*v-m*s*x+i*f*x)*w,r[14]=(E*l*o-u*M*o-E*s*h+i*M*h+u*s*x-i*l*x)*w,r[15]=(u*f*o-m*l*o+m*s*h-i*f*h-u*s*v+i*l*v)*w,this},scale:function(t){var e=this.elements,r=t.x,n=t.y,i=t.z;return e[0]*=r,e[4]*=n,e[8]*=i,e[1]*=r,e[5]*=n,e[9]*=i,e[2]*=r,e[6]*=n,e[10]*=i,e[3]*=r,e[7]*=n,e[11]*=i,this},getMaxScaleOnAxis:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,r,n))},makeTranslation:function(t,e,r){return this.set(1,0,0,t,0,1,0,e,0,0,1,r,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(1,0,0,0,0,e,-r,0,0,r,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(e,0,r,0,0,1,0,0,-r,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(e,-r,0,0,r,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var r=Math.cos(e),n=Math.sin(e),i=1-r,s=t.x,o=t.y,a=t.z,u=i*s,l=i*o;return this.set(u*s+r,u*o-n*a,u*a+n*o,0,u*o+n*a,l*o+r,l*a-n*s,0,u*a-n*o,l*a+n*s,i*a*a+r,0,0,0,0,1),this},makeScale:function(t,e,r){return this.set(t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1),this},compose:function(t,e,r){return this.makeRotationFromQuaternion(e),this.scale(r),this.setPosition(t),this},decompose:function(){var t,e;return function(r,n,i){void 0===t&&(t=new THREE.Vector3,e=new THREE.Matrix4);var s=this.elements,o=t.set(s[0],s[1],s[2]).length(),a=t.set(s[4],s[5],s[6]).length(),u=t.set(s[8],s[9],s[10]).length(),l=this.determinant();l<0&&(o=-o),r.x=s[12],r.y=s[13],r.z=s[14],e.elements.set(this.elements);var h=1/o,c=1/a,m=1/u;return e.elements[0]*=h,e.elements[1]*=h,e.elements[2]*=h,e.elements[4]*=c,e.elements[5]*=c,e.elements[6]*=c,e.elements[8]*=m,e.elements[9]*=m,e.elements[10]*=m,n.setFromRotationMatrix(e),i.x=o,i.y=a,i.z=u,this}}(),makeFrustum:function(t,e,r,n,i,s){var o=this.elements,a=2*i/(e-t),u=2*i/(n-r),l=(e+t)/(e-t),h=(n+r)/(n-r),c=-(s+i)/(s-i),m=-2*s*i/(s-i);return o[0]=a,o[4]=0,o[8]=l,o[12]=0,o[1]=0,o[5]=u,o[9]=h,o[13]=0,o[2]=0,o[6]=0,o[10]=c,o[14]=m,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makePerspective:function(t,e,r,n){var i=r*Math.tan(THREE.Math.DEG2RAD*t*.5),s=-i,o=s*e,a=i*e;return this.makeFrustum(o,a,s,i,r,n)},makeOrthographic:function(t,e,r,n,i,s){var o=this.elements,a=1/(e-t),u=1/(r-n),l=1/(s-i),h=(e+t)*a,c=(r+n)*u,m=(s+i)*l;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-h,o[1]=0,o[5]=2*u,o[9]=0,o[13]=-c,o[2]=0,o[6]=0,o[10]=-2*l,o[14]=-m,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},equals:function(t){for(var e=this.elements,r=t.elements,n=0;n<16;n++)if(e[n]!==r[n])return!1;return!0},fromArray:function(t){return this.elements.set(t),this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t[e+9]=r[9],t[e+10]=r[10],t[e+11]=r[11],t[e+12]=r[12],t[e+13]=r[13],t[e+14]=r[14],t[e+15]=r[15],t}};
THREE.Quaternion=function(t,i,s,h){this._x=t||0,this._y=i||0,this._z=s||0,this._w=void 0!==h?h:1},THREE.Quaternion.prototype={constructor:THREE.Quaternion,get x(){return this._x},set x(t){this._x=t,this.onChangeCallback()},get y(){return this._y},set y(t){this._y=t,this.onChangeCallback()},get z(){return this._z},set z(t){this._z=t,this.onChangeCallback()},get w(){return this._w},set w(t){this._w=t,this.onChangeCallback()},set:function(t,i,s,h){return this._x=t,this._y=i,this._z=s,this._w=h,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this.onChangeCallback(),this},setFromEuler:function(t,i){if(t instanceof THREE.Euler==!1)throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var s=Math.cos(t._x/2),h=Math.cos(t._y/2),n=Math.cos(t._z/2),_=Math.sin(t._x/2),r=Math.sin(t._y/2),e=Math.sin(t._z/2),a=t.order;return"XYZ"===a?(this._x=_*h*n+s*r*e,this._y=s*r*n-_*h*e,this._z=s*h*e+_*r*n,this._w=s*h*n-_*r*e):"YXZ"===a?(this._x=_*h*n+s*r*e,this._y=s*r*n-_*h*e,this._z=s*h*e-_*r*n,this._w=s*h*n+_*r*e):"ZXY"===a?(this._x=_*h*n-s*r*e,this._y=s*r*n+_*h*e,this._z=s*h*e+_*r*n,this._w=s*h*n-_*r*e):"ZYX"===a?(this._x=_*h*n-s*r*e,this._y=s*r*n+_*h*e,this._z=s*h*e-_*r*n,this._w=s*h*n+_*r*e):"YZX"===a?(this._x=_*h*n+s*r*e,this._y=s*r*n+_*h*e,this._z=s*h*e-_*r*n,this._w=s*h*n-_*r*e):"XZY"===a&&(this._x=_*h*n-s*r*e,this._y=s*r*n-_*h*e,this._z=s*h*e+_*r*n,this._w=s*h*n+_*r*e),i!==!1&&this.onChangeCallback(),this},setFromAxisAngle:function(t,i){var s=i/2,h=Math.sin(s);return this._x=t.x*h,this._y=t.y*h,this._z=t.z*h,this._w=Math.cos(s),this.onChangeCallback(),this},setFromRotationMatrix:function(t){var i,s=t.elements,h=s[0],n=s[4],_=s[8],r=s[1],e=s[5],a=s[9],o=s[2],u=s[6],c=s[10],l=h+e+c;return l>0?(i=.5/Math.sqrt(l+1),this._w=.25/i,this._x=(u-a)*i,this._y=(_-o)*i,this._z=(r-n)*i):h>e&&h>c?(i=2*Math.sqrt(1+h-e-c),this._w=(u-a)/i,this._x=.25*i,this._y=(n+r)/i,this._z=(_+o)/i):e>c?(i=2*Math.sqrt(1+e-h-c),this._w=(_-o)/i,this._x=(n+r)/i,this._y=.25*i,this._z=(a+u)/i):(i=2*Math.sqrt(1+c-h-e),this._w=(r-n)/i,this._x=(_+o)/i,this._y=(a+u)/i,this._z=.25*i),this.onChangeCallback(),this},setFromUnitVectors:function(){var t,i,s=1e-6;return function(h,n){return void 0===t&&(t=new THREE.Vector3),i=h.dot(n)+1,i<s?(i=0,Math.abs(h.x)>Math.abs(h.z)?t.set(-h.y,h.x,0):t.set(0,-h.z,h.y)):t.crossVectors(h,n),this._x=t.x,this._y=t.y,this._z=t.z,this._w=i,this.normalize()}}(),inverse:function(){return this.conjugate().normalize()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this.onChangeCallback(),this},multiply:function(t,i){return void 0!==i?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,i)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,i){var s=t._x,h=t._y,n=t._z,_=t._w,r=i._x,e=i._y,a=i._z,o=i._w;return this._x=s*o+_*r+h*a-n*e,this._y=h*o+_*e+n*r-s*a,this._z=n*o+_*a+s*e-h*r,this._w=_*o-s*r-h*e-n*a,this.onChangeCallback(),this},slerp:function(t,i){if(0===i)return this;if(1===i)return this.copy(t);var s=this._x,h=this._y,n=this._z,_=this._w,r=_*t._w+s*t._x+h*t._y+n*t._z;if(r<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,r=-r):this.copy(t),r>=1)return this._w=_,this._x=s,this._y=h,this._z=n,this;var e=Math.sqrt(1-r*r);if(Math.abs(e)<.001)return this._w=.5*(_+this._w),this._x=.5*(s+this._x),this._y=.5*(h+this._y),this._z=.5*(n+this._z),this;var a=Math.atan2(e,r),o=Math.sin((1-i)*a)/e,u=Math.sin(i*a)/e;return this._w=_*o+this._w*u,this._x=s*o+this._x*u,this._y=h*o+this._y*u,this._z=n*o+this._z*u,this.onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,i){return void 0===i&&(i=0),this._x=t[i],this._y=t[i+1],this._z=t[i+2],this._w=t[i+3],this.onChangeCallback(),this},toArray:function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._w,t},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}},Object.assign(THREE.Quaternion,{slerp:function(t,i,s,h){return s.copy(t).slerp(i,h)},slerpFlat:function(t,i,s,h,n,_,r){var e=s[h+0],a=s[h+1],o=s[h+2],u=s[h+3],c=n[_+0],l=n[_+1],y=n[_+2],x=n[_+3];if(u!==x||e!==c||a!==l||o!==y){var z=1-r,w=e*c+a*l+o*y+u*x,f=w>=0?1:-1,b=1-w*w;if(b>Number.EPSILON){var C=Math.sqrt(b),g=Math.atan2(C,w*f);z=Math.sin(z*g)/C,r=Math.sin(r*g)/C}var M=r*f;if(e=e*z+c*M,a=a*z+l*M,o=o*z+y*M,u=u*z+x*M,z===1-r){var E=1/Math.sqrt(e*e+a*a+o*o+u*u);e*=E,a*=E,o*=E,u*=E}}t[i]=e,t[i+1]=a,t[i+2]=o,t[i+3]=u}});
THREE.Euler=function(t,i,h,n){this._x=t||0,this._y=i||0,this._z=h||0,this._order=n||THREE.Euler.DefaultOrder},THREE.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],THREE.Euler.DefaultOrder="XYZ",THREE.Euler.prototype={constructor:THREE.Euler,get x(){return this._x},set x(t){this._x=t,this.onChangeCallback()},get y(){return this._y},set y(t){this._y=t,this.onChangeCallback()},get z(){return this._z},set z(t){this._z=t,this.onChangeCallback()},get order(){return this._order},set order(t){this._order=t,this.onChangeCallback()},set:function(t,i,h,n){return this._x=t,this._y=i,this._z=h,this._order=n||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this.onChangeCallback(),this},setFromRotationMatrix:function(t,i,h){var n=THREE.Math.clamp,a=t.elements,s=a[0],r=a[4],e=a[8],o=a[1],_=a[5],c=a[9],u=a[2],l=a[6],M=a[10];return i=i||this._order,"XYZ"===i?(this._y=Math.asin(n(e,-1,1)),Math.abs(e)<.99999?(this._x=Math.atan2(-c,M),this._z=Math.atan2(-r,s)):(this._x=Math.atan2(l,_),this._z=0)):"YXZ"===i?(this._x=Math.asin(-n(c,-1,1)),Math.abs(c)<.99999?(this._y=Math.atan2(e,M),this._z=Math.atan2(o,_)):(this._y=Math.atan2(-u,s),this._z=0)):"ZXY"===i?(this._x=Math.asin(n(l,-1,1)),Math.abs(l)<.99999?(this._y=Math.atan2(-u,M),this._z=Math.atan2(-r,_)):(this._y=0,this._z=Math.atan2(o,s))):"ZYX"===i?(this._y=Math.asin(-n(u,-1,1)),Math.abs(u)<.99999?(this._x=Math.atan2(l,M),this._z=Math.atan2(o,s)):(this._x=0,this._z=Math.atan2(-r,_))):"YZX"===i?(this._z=Math.asin(n(o,-1,1)),Math.abs(o)<.99999?(this._x=Math.atan2(-c,_),this._y=Math.atan2(-u,s)):(this._x=0,this._y=Math.atan2(e,M))):"XZY"===i?(this._z=Math.asin(-n(r,-1,1)),Math.abs(r)<.99999?(this._x=Math.atan2(l,_),this._y=Math.atan2(e,s)):(this._x=Math.atan2(-c,M),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+i),this._order=i,h!==!1&&this.onChangeCallback(),this},setFromQuaternion:function(){var t;return function(i,h,n){return void 0===t&&(t=new THREE.Matrix4),t.makeRotationFromQuaternion(i),this.setFromRotationMatrix(t,h,n)}}(),setFromVector3:function(t,i){return this.set(t.x,t.y,t.z,i||this._order)},reorder:function(){var t=new THREE.Quaternion;return function(i){return t.setFromEuler(this),this.setFromQuaternion(t,i)}}(),equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this.onChangeCallback(),this},toArray:function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new THREE.Vector3(this._x,this._y,this._z)},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}};


/*!art-template - Template Engine | http://aui.github.com/artTemplate/*/
!function(){function a(a){return a.replace(t,"").replace(u,",").replace(v,"").replace(w,"").replace(x,"").split(y)}function b(a){return"'"+a.replace(/('|\\)/g,"\\$1").replace(/\r/g,"\\r").replace(/\n/g,"\\n")+"'"}function c(c,d){function e(a){return m+=a.split(/\n/).length-1,k&&(a=a.replace(/\s+/g," ").replace(/<!--[\w\W]*?-->/g,"")),a&&(a=s[1]+b(a)+s[2]+"\n"),a}function f(b){var c=m;if(j?b=j(b,d):g&&(b=b.replace(/\n/g,function(){return m++,"$line="+m+";"})),0===b.indexOf("=")){var e=l&&!/^=[=#]/.test(b);if(b=b.replace(/^=[=#]?|[\s;]*$/g,""),e){var f=b.replace(/\s*\([^\)]+\)/,"");n[f]||/^(include|print)$/.test(f)||(b="$escape("+b+")")}else b="$string("+b+")";b=s[1]+b+s[2]}return g&&(b="$line="+c+";"+b),r(a(b),function(a){if(a&&!p[a]){var b;b="print"===a?u:"include"===a?v:n[a]?"$utils."+a:o[a]?"$helpers."+a:"$data."+a,w+=a+"="+b+",",p[a]=!0}}),b+"\n"}var g=d.debug,h=d.openTag,i=d.closeTag,j=d.parser,k=d.compress,l=d.escape,m=1,p={$data:1,$filename:1,$utils:1,$helpers:1,$out:1,$line:1},q="".trim,s=q?["$out='';","$out+=",";","$out"]:["$out=[];","$out.push(",");","$out.join('')"],t=q?"$out+=text;return $out;":"$out.push(text);",u="function(){var text=''.concat.apply('',arguments);"+t+"}",v="function(filename,data){data=data||$data;var text=$utils.$include(filename,data,$filename);"+t+"}",w="'use strict';var $utils=this,$helpers=$utils.$helpers,"+(g?"$line=0,":""),x=s[0],y="return new String("+s[3]+");";r(c.split(h),function(a){a=a.split(i);var b=a[0],c=a[1];1===a.length?x+=e(b):(x+=f(b),c&&(x+=e(c)))});var z=w+x+y;g&&(z="try{"+z+"}catch(e){throw {filename:$filename,name:'Render Error',message:e.message,line:$line,source:"+b(c)+".split(/\\n/)[$line-1].replace(/^\\s+/,'')};}");try{var A=new Function("$data","$filename",z);return A.prototype=n,A}catch(B){throw B.temp="function anonymous($data,$filename) {"+z+"}",B}}var d=function(a,b){return"string"==typeof b?q(b,{filename:a}):g(a,b)};d.version="3.0.0",d.config=function(a,b){e[a]=b};var e=d.defaults={openTag:"<%",closeTag:"%>",escape:!0,cache:!0,compress:!1,parser:null},f=d.cache={};d.render=function(a,b){return q(a,b)};var g=d.renderFile=function(a,b){var c=d.get(a)||p({filename:a,name:"Render Error",message:"Template not found"});return b?c(b):c};d.get=function(a){var b;if(f[a])b=f[a];else if("object"==typeof document){var c=document.getElementById(a);if(c){var d=(c.value||c.innerHTML).replace(/^\s*|\s*$/g,"");b=q(d,{filename:a})}}return b};var h=function(a,b){return"string"!=typeof a&&(b=typeof a,"number"===b?a+="":a="function"===b?h(a.call(a)):""),a},i={"<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","&":"&#38;"},j=function(a){return i[a]},k=function(a){return h(a).replace(/&(?![\w#]+;)|[<>"']/g,j)},l=Array.isArray||function(a){return"[object Array]"==={}.toString.call(a)},m=function(a,b){var c,d;if(l(a))for(c=0,d=a.length;d>c;c++)b.call(a,a[c],c,a);else for(c in a)b.call(a,a[c],c)},n=d.utils={$helpers:{},$include:g,$string:h,$escape:k,$each:m};d.helper=function(a,b){o[a]=b};var o=d.helpers=n.$helpers;d.onerror=function(a){var b="Template Error\n\n";for(var c in a)b+="<"+c+">\n"+a[c]+"\n\n";"object"==typeof console&&console.error(b)};var p=function(a){return d.onerror(a),function(){return"{Template Error}"}},q=d.compile=function(a,b){function d(c){try{return new i(c,h)+""}catch(d){return b.debug?p(d)():(b.debug=!0,q(a,b)(c))}}b=b||{};for(var g in e)void 0===b[g]&&(b[g]=e[g]);var h=b.filename;try{var i=c(a,b)}catch(j){return j.filename=h||"anonymous",j.name="Syntax Error",p(j)}return d.prototype=i.prototype,d.toString=function(){return i.toString()},h&&b.cache&&(f[h]=d),d},r=n.$each,s="break,case,catch,continue,debugger,default,delete,do,else,false,finally,for,function,if,in,instanceof,new,null,return,switch,this,throw,true,try,typeof,var,void,while,with,abstract,boolean,byte,char,class,const,double,enum,export,extends,final,float,goto,implements,import,int,interface,long,native,package,private,protected,public,short,static,super,synchronized,throws,transient,volatile,arguments,let,yield,undefined",t=/\/\*[\w\W]*?\*\/|\/\/[^\n]*\n|\/\/[^\n]*$|"(?:[^"\\]|\\[\w\W])*"|'(?:[^'\\]|\\[\w\W])*'|\s*\.\s*[$\w\.]+/g,u=/[^\w$]+/g,v=new RegExp(["\\b"+s.replace(/,/g,"\\b|\\b")+"\\b"].join("|"),"g"),w=/^\d[^,]*|,\d[^,]*/g,x=/^,+|,+$/g,y=/^$|,+/;"function"==typeof define?define(function(){return d}):"undefined"!=typeof exports?module.exports=d:this.template=d}();
!function(global) {

  if (global.template) {
    global.template.config('openTag','<#');
    global.template.config('closeTag','#>');
  }

  global.snot = {};

  global.snot.util = {
    left_pos: left_pos,
    top_pos: top_pos,
    standardlization: standardlization,
    is_mobile: is_mobile,
    is_wechat_login: is_wechat_login,
    get_window_width: get_window_width,
    get_window_height: get_window_height,
    position_to_rotation: position_to_rotation,
    distance2D: distance2D,
    distance3D: distance3D,
    epsilon: epsilon,
    css_text_to_matrix: css_text_to_matrix,
    matrix_to_css_text: matrix_to_css_text,
    webgl_detect: webgl_detect,
    webgl_enabled: webgl_detect(),
    load_js: load_js,
    rotation_to_position: rotation_to_position,

    v_set_from_matrix_position: v_set_from_matrix_position,
    m_make_rotation_axis: m_make_rotation_axis,
    m_multiply: m_multiply,
    m_set_position: m_set_position,
    m_make_rotation_from_quaternion: m_make_rotation_from_quaternion,

    merge_json: merge_json,
    octree_collision: octree_collision,

  };

  function top_pos(elem) {
    var curtop = 0;
    if (elem.offsetParent) {
      do { 
          curtop += elem.offsetTop; 
      } while (elem = elem.offsetParent);
    }
    return curtop;
  };

  function left_pos(elem) {
    var curleft = 0;
    if (elem.offsetParent) {
        do { 
            curleft += elem.offsetLeft; 
        } while (elem = elem.offsetParent);
    }
    return curleft;
  };
  
  function is_mobile() {
    return get_window_width() < 500;
  }
  
  function is_wechat_login() {
    return window.navigator.userAgent.indexOf('MicroMessenger') >= 0 ? true : false;
  }
  
  function get_window_width() {
    return document.documentElement.clientWidth;
  }
  
  function get_window_height() {
    return document.documentElement.clientHeight;
  }
  
  function position_to_rotation(x, y, z) {
    var r = distance3D(x, y, z, 0, 0, 0);
    var rx = Math.asin(z / r);
    var ry = Math.asin(y / r / Math.cos(rx));
    if (x < 0) {
        ry = ry > 0 ? Math.PI - ry : - Math.PI - ry;
    }
  
    return {
      rx: - rx * 180 / Math.PI,
      ry: (ry < 0 ? ry + Math.PI * 2 : ry) * 180 / Math.PI
    };
  }
  
  function distance2D(a, b, c, d) {
    return Math.pow((a - c) * (a - c) + (b - d) * (b - d), 0.5);
  }
  
  function distance3D(a, b, c, d, e, f) {
    return Math.pow((a - d) * (a - d) + (b - e) * (b - e) + (c - f) * (c - f), 0.5);
  }
  
  function epsilon(value) {
    return Math.abs(value) < 0.000001 ? 0 : value.toFixed(5);
  };
  
  function css_text_to_matrix(t) {
    var m = new WebKitCSSMatrix(t);
    return [
      epsilon(m.m11), epsilon(m.m12), epsilon(m.m13), epsilon(m.m14),
      epsilon(m.m21), epsilon(m.m22), epsilon(m.m23), epsilon(m.m24),
      epsilon(m.m31), epsilon(m.m32), epsilon(m.m33), epsilon(m.m34),
      epsilon(m.m41), epsilon(m.m42), epsilon(m.m43), epsilon(m.m44)
    ];
  }
  
  function matrix_to_css_text(a, b, c, d,
                              e, f, g, h,
                              i, j, k, l,
                              m, n, o, p) {
      if (typeof(a) == 'object') {
          return 'matrix3d(' + (a.join(',')) + ')';
      }
      return 'matrix3d(' + a + ',' + b + ',' + c + ',' + d+',' + e + ',' + f + ',' + g + ',' + h + ',' + i + ',' + j + ',' + k + ',' + l + ',' + m + ',' + n + ',' + o+ ',' + p + ')';
  }
  
  window.requestAnimationFrame= (function () { 
    return window.requestAnimationFrame || 
    window.webkitRequestAnimationFrame || 
    window.mozRequestAnimationFrame || 
    window.oRequestAnimationFrame || 
    // if all else fails, use setTimeout 
    function (callback) { 
      return window.setTimeout(callback, 1000 / 60); // shoot for 60 fps 
    }; 
  })(); 
  
  function webgl_detect(return_context) {
    if (!!window.WebGLRenderingContext) {
      var canvas = document.createElement("canvas");
      var names = ['webgl', 'experimental-webgl', 'moz-webgl', 'webkit-3d'];
      var context = false;
  
      for (var i = 0;i < 4; i++) {
        try {
          context = canvas.getContext(names[i]);
          if (context && typeof context.getParameter == 'function') {
            // WebGL is enabled
            if (return_context) {
              // return WebGL object if the function's argument is present
              return {
                name: names[i],
                gl: context
              };
            }
            // else, return just true
            return true;
          }
        } catch(e) {}
      }
  
      // WebGL is supported, but disabled
      return false;
    }
  
    // WebGL not supported
    return false;
  }
  
  function load_js(file, callback) {
    var _doc = document.getElementsByTagName('head')[0];
    var js = document.createElement('script');
    js.setAttribute('type', 'text/javascript');
    js.setAttribute('src', file);
    _doc.appendChild(js);
    if (!/*@cc_on!@*/0) { //if not ie
      //firefox2、firefox3、safari3.1+、opera9.6+ support js.onload
      js.onload = function () {
        callback();
      }
    } else {
      //ie6、ie7 support js.onreadystatechange
      js.onReadyStateChange = function () {
        if (js.readyState == 'loaded' || js.readyState == 'complete') {
          callback();
        }
      }
    }
  }
  
  function rotation_to_position(z, rx, ry, rz) {
    z = - z;
    rx = - rx;
  
    var x = snot.bg_size / 2;
    var y = snot.bg_size / 2;
  
    var transform = css_text_to_matrix('translate3d(' + x + 'px,' + y + 'px,0) rotateY(' + (0) + 'deg) rotateX(' + (0) + 'deg) rotateY(' + (ry ? - ry : 0) + 'deg) rotateX(' + (rx ? - rx : 0) + 'deg) rotateZ(' + (rz ? rz : 0) +'deg) translateZ(' + z + 'px)' );
    return [ - transform[12] + snot.bg_size / 2, transform[13] - snot.bg_size / 2, - transform[14]];
  }

  function m_make_rotation_axis(point, rotation) {
    return new THREE.Matrix4().makeRotationAxis(point, rotation);
  }

  function m_multiply() {
    var mats = arguments;

    var l = mats.length;
    while (l > 1) {
      var last2 = mats[l - 2];
      var last1 = mats[l - 1];
      mats[l - 2] = new THREE.Matrix4().multiplyMatrices(
        last2,
        last1
      );
      l--;
    }
    return mats[0];
  }

  function v_set_from_matrix_position(mat4) {
    return new THREE.Vector3().setFromMatrixPosition(mat4);
  }

  function m_set_position(p) {
    return new THREE.Matrix4().setPosition(p);
  }

  function m_make_rotation_from_quaternion(q) {
    return new THREE.Matrix4().makeRotationFromQuaternion(q);
  }

  function merge_json(obj, json) {
    for (var i in json) {
      if (obj[i] == undefined) {
        obj[i] = json[i];
      }
    }
  }

  function standardlization(point, r) {
    r = r || 1;
    var distance_to_origin = distance3D(0, 0, 0, point.x, point.y, point.z);
    point.x *= r / distance_to_origin;
    point.y *= r / distance_to_origin;
    point.z *= r / distance_to_origin;
  }

  function is_point_inside(point, a, b) {
    if (point.x >= b.x && point.y >= b.y && point.z >= b.z &&
        point.x < a.x && point.y < a.y && point.z < a.z) {
      return true;
    }
    return false;
  }
  function get_inside_points(points, a, b) {
    var candidates = [];
    for (var i in points) {
      if (is_point_inside(points[i], a, b)) {
        candidates.push(points[i]);
      }
    }
    return candidates;
  }
  /*
   * see ../images/octree.png
   *
   * a.x > b.x
   * a.y > b.y
   * a.z > b.z
   */
  function octree_collision(a, b, points_a, points_b, res, depth = 1) {
    if (!points_a.length || !points_b.length) {
      return false;
    }
    if (depth > 7) {
      res.push({
        points_a: points_a,
        points_b: points_b,
      });
      return true;
    }

    // random split
    var half = {
      x: (a.x - b.x) / (Math.random() * 0.2 - 0.1 + 2),
      y: (a.y - b.y) / (Math.random() * 0.2 - 0.1 + 2),
      z: (a.z - b.z) / (Math.random() * 0.2 - 0.1 + 2),
    };
    var b_xyz = {
      x: b.x + half.x,
      y: b.y + half.y,
      z: b.z + half.z,
    };
    var b_x = {
      x: b_xyz.x,
      y: b.y,
      z: b.z,
    };
    var b_y = {
      x: b.x,
      y: b_xyz.y,
      z: b.z,
    };
    var b_z = {
      x: b.x,
      y: b.y,
      z: b_xyz.z,
    };
    var b_xz = {
      x: b_xyz.x,
      y: b.y,
      z: b_xyz.z,
    };
    var b_xy = {
      x: b_xyz.x,
      y: b_xyz.y,
      z: b.z,
    };
    var b_yz = {
      x: b.x,
      y: b_xyz.y,
      z: b_xyz.z,
    };

    var a_z = {
      x: a.x,
      y: a.y,
      z: a.z - half.z,
    };
    var a_x = {
      x: a.x - half.x,
      y: a.y,
      z: a.z,
    };
    var a_y = {
      x: a.x,
      y: a.y - half.y,
      z: a.z,
    };
    var a_xy = {
      x: a_x.x,
      y: a_y.y,
      z: a.z,
    };
    var a_yz = {
      x: a.x,
      y: a_y.y,
      z: a_z.z,
    };
    var a_xz = {
      x: a_x.x,
      y: a.y,
      z: a_z.z,
    };

    function sub_collision(a, b) {
      var candidates_a = get_inside_points(points_a, a, b);
      var candidates_b = get_inside_points(points_b, a, b);
      return octree_collision(a, b, candidates_a, candidates_b, res, depth + 1);
    }

    var pairs = [
      [a_x, b_yz],
      [a, b_xyz],
      [a_xy, b_z],
      [a_y, b_xz],

      [a_xz, b_y],
      [a_z, b_xy],
      [b_xyz, b],
      [a_yz, b_x],
    ];

    var found = false;
    for (var i in pairs) {
      if (sub_collision(pairs[i][0], pairs[i][1])) {
        found = true;
      }
    }

    return found;
  }

}(window);

!function(global) {

  var PI = Math.PI;
  var sin = Math.sin;
  var cos = Math.cos;
  var tan = Math.tan;
  var acos = Math.acos;
  var atan = Math.atan;
  var pow = Math.pow;
  var floor = Math.floor;
  var sqrt = Math.sqrt;

  var snot = {
    debug: false,
    container: document.getElementById('snot-container'),
    dom: document.getElementById('snot-wrap'),

    camera_look_at: {
      x: 0,
      y: 0,
      z: 1,
    },
    controls: {
      screen_orientation: 0,
      gyro_data: {
        alpha: 0,
        beta: 90 * PI / 180,
        gamma: 0
      },
    },
    mouse_sensitivity: 0.3,
    auto_rotation: 0,
    frames: 0,
    bg_rotation: [0, 0, 0, 0, 0, 0],

    pause_animation: false,


    bg_size: 1024,

    generator: {},
    gyro: false,
    ry: 0,        // Rotate * degree around y axis
    rx: 0,        // Rotate * degree around x axis
    dest_rx: 0,
    dest_ry: 0,
    dest_rz: 0,

    max_fov: 120, // Max field of view (degree)
    min_fov: 60,   // Min field of view (degree)
    fov: 90,      // Default field of view
    smooth: 0.83,
    min_detect_distance: 20,
    on_click: function() {},
    on_sprite_click: function() {},
  };
  var camera_dom = document.getElementById('snot-camera');
  var prev_gyro;

  var camera_base_transform;
  var previous_quat = new THREE.Quaternion();

  function _pointStandardlization(x, y, z) {
    var ratio = 200 / distance3D(x, y, z, 0, 0, 0);
    return [x * ratio, y * ratio, z * ratio];
  }

  if (global.snot) {
    for (var i in snot) {
      global.snot[i] = snot[i];
    }
    snot = global.snot;
  } else {
    console.error('snot-utils.js is missing');
    return;
  }
  var m_make_rotation_axis = snot.util.m_make_rotation_axis;
  var m_multiply = snot.util.m_multiply;
  var m_set_position = snot.util.m_set_position;
  var m_make_rotation_from_quaternion = snot.util.m_make_rotation_from_quaternion;
  var v_set_from_matrix_position = snot.util.v_set_from_matrix_position;

  var util = global.snot.util;
  var epsilon = util.epsilon;
  var distance3D = util.distance3D;
  var distance2D = util.distance2D;

  var set_fov = function (degree) {
    if (degree < snot.min_fov || degree > snot.max_fov) {
      return;
    }
    snot.fov = degree;
    snot.container.style['-webkit-transform'] = 'scale(' + tan(snot.max_fov / 2 * PI / 180) / tan(snot.fov / 2 * PI / 180) + ')';
  }

  function reset() {
    var sprites = document.getElementsByClassName('sprite');
    for (var i = 0; i < sprites.length; ++ i) {
      sprites[i].remove();
    }
  }

  var init = function(config) {
    reset();

    cancelAnimationFrame(snot._animateId);

    for (var i in config) {
      if (i == 'generator') {
        util.merge_json(snot.generator, config.generator);
      }
      snot[i] = config[i];
    }
    prev_gyro = snot.gyro;

    snot.dest_rx = snot.rx;
    snot.dest_ry = snot.ry;

    snot.width = snot.dom.offsetWidth;
    snot.height = snot.dom.offsetHeight;

    //compute the max Horizontal Field of view
    //perspective= projectiveScreenWidth/2
    //           = width/2/tan(max_fov/2)
    snot.perspective = snot.width / 2 / tan(snot.max_fov / 2 * PI / 180);

    snot.container.style['-webkit-perspective'] = snot.perspective + 'px';

    //camera offset
    // Z is depth(front) Y is height X is right
    //
    // translateZ setFOV
    // rotateX rotate around X axis
    // rotateY rotate around Y axis
    // translateX translate the Camera to center
    // translateY
    camera_base_transform = 'translateX(' + epsilon(- (snot.bg_size - snot.width) / 2) + 'px) translateY(' + epsilon(- (snot.bg_size - snot.height) / 2) + 'px)';
    camera_dom.style['-webkit-transform'] = 'translateZ(-' + snot.perspective + 'px) rotateY(' + epsilon(snot.rx) + 'deg) rotateX(' + epsilon(snot.ry) + 'deg)' + camera_base_transform;

    set_fov(snot.fov);

    if (config.bg_imgs) {
      load_bg_imgs(config.bg_imgs, config.bg_rotation || snot.bg_rotation);
    }

    if (config) {
      load_sprites(config.sprites);
    }

    if (util.is_mobile()) {
    }

    if (config.callback) {
      config.callback();
    }
    snot.init_controls();
    update();
  }

  function load_bg_imgs(bg_imgs, bg_rotation) {
    var bg_config = {
      front : 'rotateY(90deg)' + '                rotateZ(' + bg_rotation[0] + 'deg)  translateZ(-' + (snot.bg_size / 2) + 'px)',
      bottom: 'rotateY(90deg)' + 'rotateX(90deg)  rotateZ(' + bg_rotation[1] + 'deg)  translateZ(-' + (snot.bg_size / 2) + 'px) rotateZ(90deg)',
      left  : 'rotateY(90deg)' + 'rotateY(90deg)  rotateZ(' + bg_rotation[2] + 'deg)  translateZ(-' + (snot.bg_size / 2) + 'px)',
      back  : 'rotateY(90deg)' + 'rotateY(180deg) rotateZ(' + bg_rotation[3] + 'deg)  translateZ(-' + (snot.bg_size / 2) + 'px)',
      top   : 'rotateY(90deg)' + 'rotateX(-90deg) rotateZ(' + bg_rotation[4] + 'deg)  translateZ(-' + (snot.bg_size / 2) + 'px) rotateZ(-90deg)',
      right : 'rotateY(90deg)' + 'rotateY(-90deg) rotateZ(' + bg_rotation[5] + 'deg)  translateZ(-' + (snot.bg_size / 2) + 'px)'
    };

    var bg_dom;
    var count = 0;
    for (var i in bg_config) {
      bg_dom = document.getElementsByClassName('snot-bg ' + i)[0];
      bg_dom.style['-webkit-transform'] = bg_config[i];
      bg_dom.style['width'] = snot.bg_size + 2 + 'px';        // 2 more pixels for overlapping gaps ( chrome's bug )
      bg_dom.style['height'] = snot.bg_size + 2 + 'px';       // 2 more pixels for overlapping gaps ( chrome's bug )

      bg_dom.setAttribute('src', bg_imgs[count]);
      bg_dom.setAttribute('data-index', count);
      ++count;
    }
  }

  var load_sprites = function(sprites) {
    for (var i in sprites) {
      var t = sprites[i];
      if (t.standardlization) {
        var standard = _pointStandardlization(t.x,t.y,t.z);
        t.x=standard[0];
        t.y=standard[1];
        t.z=standard[2];
      }

      var temp_wrapper = document.createElement('div');
      temp_wrapper.innerHTML = template(snot.generator[t.generator], t);
      var element = temp_wrapper.firstChild;
      element.data = sprites[i];
      add_sprite_by_position(element, t);
    }
  }

  function add_sprite_by_position(element, p) {

    var x = - p.x;
    var z = - p.z;
    var y = - p.y;

    var spriteContainer = document.createElement('div');
    spriteContainer.style.display = 'inline-block';
    spriteContainer.style.position = 'absolute';
    spriteContainer.className = 'sprite-container';
    spriteContainer.id = element.data.id;

    spriteContainer.style['-webkit-transform-origin-x'] = '0';
    spriteContainer.style['-webkit-transform-origin-y'] = '0';

    var arc = x == 0 && z == 0 ? 0 : acos( z / pow(x * x + z * z, 0.5));

    arc = x < 0 ? 2 * PI - arc : arc;
    arc = arc * 180 / PI;

    var r = distance3D(x, y, z, 0, 0, 0);
    x += snot.bg_size / 2;
    y += snot.bg_size / 2;

    spriteContainer.style['-webkit-transform'] = 'translate3d(' + epsilon(x) + 'px,' + epsilon(y) + 'px,' + epsilon(z) + 'px) rotateY(' + epsilon(arc) + 'deg) rotateX(' + epsilon(- (y - snot.bg_size / 2) / r * 90)+'deg) rotateY(180deg)';

    var spriteWrap = document.createElement('div');
    spriteWrap.className='sprite-wrap';
    spriteWrap.appendChild(element);
    spriteWrap.setAttribute('data-visible', element.data.visible == false ? false : true);

    spriteContainer.appendChild(spriteWrap);
    camera_dom.appendChild(spriteContainer);
  }

  var update_sprite_visibility = function(id) {
    var visible = snot.sprites[id].visible;
    var spriteContainer = document.getElementById(id);
    spriteContainer.firstChild.setAttribute('data-visible', visible ? true : false);
  }

  var update_sprite_position = function(id) {
    var x = snot.sprites[id].x;
    var y = snot.sprites[id].y;
    var z = snot.sprites[id].z;
    z=-z;
    y=-y;
    var arc = x == 0 && z == 0 ? 0 : acos( z / pow(x * x + z * z, 0.5));

    arc = x < 0 ? 2 * PI - arc : arc;
    arc = arc * 180/ PI;

    var r = distance3D(x, y, z, 0, 0, 0);
    x += snot.bg_size / 2;
    y += snot.bg_size / 2;

    var spriteContainer = document.getElementById(id);

    spriteContainer.style['-webkit-transform'] = 'translate3d(' + epsilon(x) + 'px,' + epsilon(y) + 'px,' + epsilon(z) + 'px) rotateY(' + epsilon(arc) + 'deg) rotateX(' + epsilon(- (y - snot.bg_size / 2) / r * 90) + 'deg) rotateY(180deg)';
  }

  function run() {
    snot._animateId = requestAnimationFrame(run);
    if (!snot.pause_animation) {
      update();
    }
  }

  var camera_euler = new THREE.Euler();
  var target_quat = new THREE.Quaternion();
  var rotate_90_quat = new THREE.Quaternion(- sqrt( 0.5 ), 0, 0, sqrt( 0.5 ))
  var adjust_screen_quats = {
    0: new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0, 0, 1), 0),
    90: new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0, 0, 1), - 90),
    180: new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0, 0, 1), - 180),
    '-90': new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0, 0, 1), 90),
  };
  var look_at_euler = new THREE.Euler();

  function update_camera(x, y, z) {

    camera_euler.set(y, x, z, 'YXZ'); // 'ZXY' for the device, but 'YXZ' for us

    target_quat.setFromEuler(camera_euler); // orient the device

    target_quat.multiply(rotate_90_quat); // camera looks out the back of the device, not the top
                                          // - PI/2 around the x-axis
    target_quat.multiply(adjust_screen_quats[snot.controls.screen_orientation]); // adjust for screen orientation

    var slerp_quat = new THREE.Quaternion();
    THREE.Quaternion.slerp(target_quat, previous_quat, slerp_quat, snot.smooth);
    previous_quat = slerp_quat;
    var look_at_quat = slerp_quat.clone();
    look_at_quat.x *= -1;
    look_at_quat.z *= -1;
    var look_at_mat = m_make_rotation_from_quaternion(look_at_quat.normalize()).transpose();
    for (var i = 0; i < look_at_mat.elements.length; ++i) {
      look_at_mat.elements[i] = epsilon(look_at_mat.elements[i]);
    }
    var look_at_rot = look_at_euler.setFromRotationMatrix(look_at_mat, 'XZY');

    snot.rx = look_at_rot._x * 180 / PI;
    snot.ry = - look_at_rot._y * 180 / PI;
    snot.rz = look_at_rot._z * 180 / PI;

    snot.camera_look_at = v_set_from_matrix_position(m_multiply(
      m_make_rotation_axis({x: 0, y: 1, z: 0}, look_at_rot._y),
      m_make_rotation_axis({x: 0, y: 0, z: 1}, look_at_rot._z),
      m_make_rotation_axis({x: 1, y: 0, z: 0}, - look_at_rot._x),
      m_set_position({x: 0, y: 0, z: 1})
    )); // bad performance here

    camera_dom.style.transform = 'translateZ(' + epsilon(snot.perspective) + 'px)' + " matrix3d(" + look_at_mat.elements + ")"+ camera_base_transform;
  }

  function update() {
    snot.frames++;

    if (snot.gyro) {
      if (snot.controls.gyro_data.alpha === -1 && snot.controls.gyro_data.beta === -1 && snot.controls.gyro_data.gamma === - 1) {
        return;
      }

      update_camera(snot.controls.gyro_data.alpha, snot.controls.gyro_data.beta, - snot.controls.gyro_data.gamma);
    } else {
      if (prev_gyro) {
        snot.dest_rx = 0;
        snot.dest_ry = 0;
      }
      snot.dest_ry -= snot.auto_rotation;
      update_camera(- snot.dest_ry * PI / 180, snot.dest_rx * PI / 180 + PI/2, 0);
    }
    prev_gyro = snot.gyro;

    for (var i in snot.sprites) {
      var sprite = snot.sprites[i];
      if (sprite.need_update_position) {
        sprite.need_update_position = false;
        update_sprite_position(sprite.id);
      }
      if (sprite.need_update_visibility) {
        sprite.need_update_visibility = false;
        update_sprite_visibility(sprite.id);
      }
    }
    if (snot.debug) {
      document.getElementById('logger').innerHTML = 'rx:' + parseInt(snot.rx) + ' ' +
                        'ry:' + parseInt(snot.ry) + ' ' +
                        'rz:' + parseInt(snot.rz);
    }
  }


  snot.controls.mouse_click = function(x, y) {
    var R = 100;
    var fov = snot.fov;
    var bg_size = snot.bg_size;
    var arcFactor = Math.PI / 180;
    var rz = snot.rz * arcFactor;
    var width = snot.width;
    var height = snot.height;

    var ry = (x / width - 0.5) * fov;
    var rx = (y / height-0.5) * fov * height / width;
    var r = cos(fov / 2 * arcFactor) * bg_size;
    var ratiox = (x - width / 2) / width * 2;
    var ratioy = (y - height / 2) / width * 2;
    var P = sin(fov / 2 * arcFactor) * bg_size;

    ry = atan(ratiox * P / r);
    rx = atan(ratioy * P / r);

    ry *= 180 / PI;
    rx *= 180 / PI;

    var xyz2 = util.rotation_to_position(R, rx, 0);

    var rr = distance3D(- tan(ry * arcFactor) * xyz2[2], - xyz2[1], xyz2[2], 0, 0, 0);
    var ratio = R / rr;

    var new_x = - tan(ry * PI / 180) * xyz2[2] * ratio;
    var new_y = - xyz2[1] * ratio;
    var new_z = xyz2[2] * ratio;

    var pos = v_set_from_matrix_position(m_multiply(
      m_make_rotation_axis({x: 0, y: 1, z: 0}, snot.ry * PI / 180),
      m_make_rotation_axis({x: 0, y: 0, z: 1}, - snot.rz * PI / 180),
      m_make_rotation_axis({x: 1, y: 0, z: 0}, - snot.rx * PI / 180),
      m_set_position({x: new_x, y: new_y, z: new_z})
    ));

    ax = pos.x;
    ay = pos.y;
    az = pos.z;

    var min_offset = 0.4;
    var min_distance = snot.min_detect_distance;
    var nearest;

    var spriteContainers = document.getElementsByClassName('sprite-container');
    for (var i = 0 ;i < spriteContainers.length; ++i) {
      var self = spriteContainers[i];
      var matrix = util.css_text_to_matrix(self.style.webkitTransform);
      var rate_ = 100 / distance3D(0, 0, 0, snot.bg_size / 2 - matrix[12], matrix[13] - snot.bg_size / 2, - matrix[14]);

      var distance = distance3D(ax, - ay, az, (snot.bg_size / 2 - matrix[12]) * rate_, rate_ * (matrix[13] - snot.bg_size / 2), rate_ * ( - matrix[14]));
      if (distance < min_distance) {
        min_distance = distance;
        nearest = self.children[0];
      }
    }

    var rotation = util.position_to_rotation(ax, az, ay);
    if (nearest) {
      snot.on_sprite_click(snot.sprites[nearest.parentElement.id], nearest);
    } else {
      snot.on_click({
        x: ax,
        y: ay,
        z: az,
      }, {
        rx: rotation[0],
        ry: rotation[1]
      });
    }
  }

  util.merge_json(snot, {
    set_fov: set_fov,
    init: init,
    run: run,
    update: update,
    load_sprites: load_sprites,
  });
}(window);

!function(global) {

  var dom_offset_top;
  var dom_offset_left;
  snot.init_controls = function() {

    dom_offset_left = util.left_pos(snot.dom);
    dom_offset_top = util.top_pos(snot.dom);
    snot.container.addEventListener('touchstart', mouse_down, false);
    snot.container.addEventListener('touchmove' , mouse_move, false);
    snot.container.addEventListener('touchend'  , mouse_up  , false);

    snot.container.addEventListener('mousedown' , mouse_down , false);
    snot.container.addEventListener('mousemove' , mouse_move , false);
    snot.container.addEventListener('mouseup'   , mouse_up   , false);
    snot.container.addEventListener('mousewheel', mouse_wheel, false);

    window.addEventListener('orientationchange', function(ev) {
      snot.controls.screen_orientation = window.orientation || 0;
    }, false);

    window.addEventListener('deviceorientation', function(ev) {
      if (ev.alpha !== null) {
        snot.controls.gyro_data.beta = ev.beta  * Math.PI / 180 ;
        snot.controls.gyro_data.gamma = ev.gamma  * Math.PI / 180;
        snot.controls.gyro_data.alpha = ev.alpha  * Math.PI / 180;
      } else {
        snot.controls.gyro_data.beta = snot.controls.gyro_data.gamma = snot.controls.gyro_data.alpha = -1;
      }
    }, true);
  }

  var util = snot.util;
  var distance3D = util.distance3D;
  var distance2D = util.distance2D;
  var floor = Math.floor;
  var cos = Math.cos;
  var sin = Math.sin;
  var atan = Math.atan;
  var tan = Math.tan;
  var PI = Math.PI;

  var m_make_rotation_axis = snot.util.m_make_rotation_axis;
  var m_multiply = snot.util.m_multiply;
  var m_set_position = snot.util.m_set_position;
  var m_make_rotation_from_quaternion = snot.util.m_make_rotation_from_quaternion;
  var v_set_from_matrix_position = snot.util.v_set_from_matrix_position;

  var touches = {
    fx: 0,   // First  finger x
    fy: 0,   // First  finger y
    sx: 0,   // Second finger x
    sy: 0    // Second finger y
  };

  var mouse_move = function(event) {

    event.preventDefault();
    event.stopPropagation();

    var x = Math.floor(event.clientX >= 0 ? event.clientX : event.touches[0].pageX);
    var y = Math.floor(event.clientY >= 0 ? event.clientY : event.touches[0].pageY);
    x -= dom_offset_left;
    y -= dom_offset_top;

    touches.click = false;

    if (!touches.is_touching) {
      return false;
    }

    if (event.touches && event.touches.length > 1) {

      var cfx = x;                          // Current frist  finger x
      var cfy = y;                          // Current first  finger y
      var csx = event.touches[1].pageX;     // Current second finger x
      var csy = event.touches[1].pageY;     // Current second finger y

      var dis = distance2D(touches.fx, touches.fy, touches.sx, touches.sy) - distance2D(cfx, cfy, csx, csy);

      var ratio = 0.12;
      snot.set_fov(snot.fov + dis * ratio);

      touches.fx = cfx;
      touches.fy = cfy;
      touches.sx = csx;
      touches.sy = csy;

      return false;
    }

    var ratio = snot.mouse_sensitivity;

    snot.dest_ry = snot.dest_ry + (touches.fx - x) * ratio;
    snot.dest_rx = snot.dest_rx - (touches.fy - y) * ratio;

    touches.fx = x;
    touches.fy = y;

    snot.dest_rx = snot.dest_rx > 90 ? 90 : snot.dest_rx;
    snot.dest_rx = snot.dest_rx < -90 ? -90 : snot.dest_rx;

  };

  var mouse_down = function (event) {

    event.preventDefault();
    event.stopPropagation();

    var x = floor(event.clientX >= 0 ? event.clientX : event.touches[0].clientX);
    var y = floor(event.clientY >= 0 ? event.clientY : event.touches[0].clientY);
    x -= dom_offset_left;
    y -= dom_offset_top;

    touches.mouse_down_x = x;
    touches.mouse_down_y = y;
    touches.fx = x;
    touches.fy = y;
    touches.click = true;

    if (event.touches && event.touches.length > 1) {

      touches.sx = event.touches[1].pageX;
      touches.sy = event.touches[1].pageY;

    }

    touches.is_touching = true;
  }

  var mouse_wheel = function (event) {

    event.preventDefault();
    event.stopPropagation();

    var offset = event.deltaY;
    snot.set_fov(snot.fov + offset * 0.06);

  }

  var mouse_up = function(event) {
    event.preventDefault();
    event.stopPropagation();

    var x = floor(event.clientX >= 0 ? event.clientX : event.changedTouches[0].pageX);
    var y = floor(event.clientY >= 0 ? event.clientY : event.changedTouches[0].pageY);
    x -= dom_offset_left;
    y -= dom_offset_top;

    //Screen coordinate to Sphere 3d coordinate
    if (distance2D(touches.mouse_down_x, touches.mouse_down_y, x, y) < 5) {
      snot.controls.mouse_click(x, y);
    }
    touches.is_touching = false;
  }

}(window);

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRocmVlX21hdGguanMiLCJWZWN0b3IzLmpzIiwiTWF0cml4NC5qcyIsIlF1YXRlcm5pb24uanMiLCJFdWxlci5qcyIsInRlbXBsYXRlLW5hdGl2ZS5qcyIsInNub3RfdXRpbHMuanMiLCJzbm90X2Nzc19yZW5kZXJlci5qcyIsInNub3RfY29udHJvbHMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQ0FBO0FDQUE7QUNBQTs7O0FDQUE7QUFDQTtBQ0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN1hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwYkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJzbm90X2Nzc19yZW5kZXJlci5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJUSFJFRT17fSxUSFJFRS5NYXRoPXtjbGFtcDpmdW5jdGlvbihFLG4sdCl7cmV0dXJuIEU+dD90OkU8bj9uOkV9fTsiLCJUSFJFRS5WZWN0b3IzPWZ1bmN0aW9uKHQsaSxzKXt0aGlzLng9dHx8MCx0aGlzLnk9aXx8MCx0aGlzLno9c3x8MH0sVEhSRUUuVmVjdG9yMy5wcm90b3R5cGU9e2NvbnN0cnVjdG9yOlRIUkVFLlZlY3RvcjMsc2V0OmZ1bmN0aW9uKHQsaSxzKXtyZXR1cm4gdGhpcy54PXQsdGhpcy55PWksdGhpcy56PXMsdGhpc30sc2V0U2NhbGFyOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLng9dCx0aGlzLnk9dCx0aGlzLno9dCx0aGlzfSxzZXRYOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLng9dCx0aGlzfSxzZXRZOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLnk9dCx0aGlzfSxzZXRaOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLno9dCx0aGlzfSxzZXRDb21wb25lbnQ6ZnVuY3Rpb24odCxpKXtzd2l0Y2godCl7Y2FzZSAwOnRoaXMueD1pO2JyZWFrO2Nhc2UgMTp0aGlzLnk9aTticmVhaztjYXNlIDI6dGhpcy56PWk7YnJlYWs7ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoXCJpbmRleCBpcyBvdXQgb2YgcmFuZ2U6IFwiK3QpfX0sZ2V0Q29tcG9uZW50OmZ1bmN0aW9uKHQpe3N3aXRjaCh0KXtjYXNlIDA6cmV0dXJuIHRoaXMueDtjYXNlIDE6cmV0dXJuIHRoaXMueTtjYXNlIDI6cmV0dXJuIHRoaXMuejtkZWZhdWx0OnRocm93IG5ldyBFcnJvcihcImluZGV4IGlzIG91dCBvZiByYW5nZTogXCIrdCl9fSxjbG9uZTpmdW5jdGlvbigpe3JldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3Rvcih0aGlzLngsdGhpcy55LHRoaXMueil9LGNvcHk6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMueD10LngsdGhpcy55PXQueSx0aGlzLno9dC56LHRoaXN9LGFkZDpmdW5jdGlvbih0LGkpe3JldHVybiB2b2lkIDAhPT1pPyhjb25zb2xlLndhcm4oXCJUSFJFRS5WZWN0b3IzOiAuYWRkKCkgbm93IG9ubHkgYWNjZXB0cyBvbmUgYXJndW1lbnQuIFVzZSAuYWRkVmVjdG9ycyggYSwgYiApIGluc3RlYWQuXCIpLHRoaXMuYWRkVmVjdG9ycyh0LGkpKToodGhpcy54Kz10LngsdGhpcy55Kz10LnksdGhpcy56Kz10LnosdGhpcyl9LGFkZFNjYWxhcjpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy54Kz10LHRoaXMueSs9dCx0aGlzLnorPXQsdGhpc30sYWRkVmVjdG9yczpmdW5jdGlvbih0LGkpe3JldHVybiB0aGlzLng9dC54K2kueCx0aGlzLnk9dC55K2kueSx0aGlzLno9dC56K2kueix0aGlzfSxhZGRTY2FsZWRWZWN0b3I6ZnVuY3Rpb24odCxpKXtyZXR1cm4gdGhpcy54Kz10LngqaSx0aGlzLnkrPXQueSppLHRoaXMueis9dC56KmksdGhpc30sc3ViOmZ1bmN0aW9uKHQsaSl7cmV0dXJuIHZvaWQgMCE9PWk/KGNvbnNvbGUud2FybihcIlRIUkVFLlZlY3RvcjM6IC5zdWIoKSBub3cgb25seSBhY2NlcHRzIG9uZSBhcmd1bWVudC4gVXNlIC5zdWJWZWN0b3JzKCBhLCBiICkgaW5zdGVhZC5cIiksdGhpcy5zdWJWZWN0b3JzKHQsaSkpOih0aGlzLngtPXQueCx0aGlzLnktPXQueSx0aGlzLnotPXQueix0aGlzKX0sc3ViU2NhbGFyOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLngtPXQsdGhpcy55LT10LHRoaXMuei09dCx0aGlzfSxzdWJWZWN0b3JzOmZ1bmN0aW9uKHQsaSl7cmV0dXJuIHRoaXMueD10LngtaS54LHRoaXMueT10LnktaS55LHRoaXMuej10LnotaS56LHRoaXN9LG11bHRpcGx5OmZ1bmN0aW9uKHQsaSl7cmV0dXJuIHZvaWQgMCE9PWk/KGNvbnNvbGUud2FybihcIlRIUkVFLlZlY3RvcjM6IC5tdWx0aXBseSgpIG5vdyBvbmx5IGFjY2VwdHMgb25lIGFyZ3VtZW50LiBVc2UgLm11bHRpcGx5VmVjdG9ycyggYSwgYiApIGluc3RlYWQuXCIpLHRoaXMubXVsdGlwbHlWZWN0b3JzKHQsaSkpOih0aGlzLngqPXQueCx0aGlzLnkqPXQueSx0aGlzLnoqPXQueix0aGlzKX0sbXVsdGlwbHlTY2FsYXI6ZnVuY3Rpb24odCl7cmV0dXJuIGlzRmluaXRlKHQpPyh0aGlzLngqPXQsdGhpcy55Kj10LHRoaXMueio9dCk6KHRoaXMueD0wLHRoaXMueT0wLHRoaXMuej0wKSx0aGlzfSxtdWx0aXBseVZlY3RvcnM6ZnVuY3Rpb24odCxpKXtyZXR1cm4gdGhpcy54PXQueCppLngsdGhpcy55PXQueSppLnksdGhpcy56PXQueippLnosdGhpc30sYXBwbHlFdWxlcjpmdW5jdGlvbigpe3ZhciB0O3JldHVybiBmdW5jdGlvbihpKXtyZXR1cm4gaSBpbnN0YW5jZW9mIFRIUkVFLkV1bGVyPT0hMSYmY29uc29sZS5lcnJvcihcIlRIUkVFLlZlY3RvcjM6IC5hcHBseUV1bGVyKCkgbm93IGV4cGVjdHMgYW4gRXVsZXIgcm90YXRpb24gcmF0aGVyIHRoYW4gYSBWZWN0b3IzIGFuZCBvcmRlci5cIiksdm9pZCAwPT09dCYmKHQ9bmV3IFRIUkVFLlF1YXRlcm5pb24pLHRoaXMuYXBwbHlRdWF0ZXJuaW9uKHQuc2V0RnJvbUV1bGVyKGkpKX19KCksYXBwbHlBeGlzQW5nbGU6ZnVuY3Rpb24oKXt2YXIgdDtyZXR1cm4gZnVuY3Rpb24oaSxzKXtyZXR1cm4gdm9pZCAwPT09dCYmKHQ9bmV3IFRIUkVFLlF1YXRlcm5pb24pLHRoaXMuYXBwbHlRdWF0ZXJuaW9uKHQuc2V0RnJvbUF4aXNBbmdsZShpLHMpKX19KCksYXBwbHlNYXRyaXgzOmZ1bmN0aW9uKHQpe3ZhciBpPXRoaXMueCxzPXRoaXMueSxuPXRoaXMueixyPXQuZWxlbWVudHM7cmV0dXJuIHRoaXMueD1yWzBdKmkrclszXSpzK3JbNl0qbix0aGlzLnk9clsxXSppK3JbNF0qcytyWzddKm4sdGhpcy56PXJbMl0qaStyWzVdKnMrcls4XSpuLHRoaXN9LGFwcGx5TWF0cml4NDpmdW5jdGlvbih0KXt2YXIgaT10aGlzLngscz10aGlzLnksbj10aGlzLnoscj10LmVsZW1lbnRzO3JldHVybiB0aGlzLng9clswXSppK3JbNF0qcytyWzhdKm4rclsxMl0sdGhpcy55PXJbMV0qaStyWzVdKnMrcls5XSpuK3JbMTNdLHRoaXMuej1yWzJdKmkrcls2XSpzK3JbMTBdKm4rclsxNF0sdGhpc30sYXBwbHlQcm9qZWN0aW9uOmZ1bmN0aW9uKHQpe3ZhciBpPXRoaXMueCxzPXRoaXMueSxuPXRoaXMueixyPXQuZWxlbWVudHMsaD0xLyhyWzNdKmkrcls3XSpzK3JbMTFdKm4rclsxNV0pO3JldHVybiB0aGlzLng9KHJbMF0qaStyWzRdKnMrcls4XSpuK3JbMTJdKSpoLHRoaXMueT0oclsxXSppK3JbNV0qcytyWzldKm4rclsxM10pKmgsdGhpcy56PShyWzJdKmkrcls2XSpzK3JbMTBdKm4rclsxNF0pKmgsdGhpc30sYXBwbHlRdWF0ZXJuaW9uOmZ1bmN0aW9uKHQpe3ZhciBpPXRoaXMueCxzPXRoaXMueSxuPXRoaXMueixyPXQueCxoPXQueSxlPXQueixvPXQudyxhPW8qaStoKm4tZSpzLHU9bypzK2UqaS1yKm4sYz1vKm4rcipzLWgqaSx5PS1yKmktaCpzLWUqbjtyZXR1cm4gdGhpcy54PWEqbyt5Ki1yK3UqLWUtYyotaCx0aGlzLnk9dSpvK3kqLWgrYyotci1hKi1lLHRoaXMuej1jKm8reSotZSthKi1oLXUqLXIsdGhpc30scHJvamVjdDpmdW5jdGlvbigpe3ZhciB0O3JldHVybiBmdW5jdGlvbihpKXtyZXR1cm4gdm9pZCAwPT09dCYmKHQ9bmV3IFRIUkVFLk1hdHJpeDQpLHQubXVsdGlwbHlNYXRyaWNlcyhpLnByb2plY3Rpb25NYXRyaXgsdC5nZXRJbnZlcnNlKGkubWF0cml4V29ybGQpKSx0aGlzLmFwcGx5UHJvamVjdGlvbih0KX19KCksdW5wcm9qZWN0OmZ1bmN0aW9uKCl7dmFyIHQ7cmV0dXJuIGZ1bmN0aW9uKGkpe3JldHVybiB2b2lkIDA9PT10JiYodD1uZXcgVEhSRUUuTWF0cml4NCksdC5tdWx0aXBseU1hdHJpY2VzKGkubWF0cml4V29ybGQsdC5nZXRJbnZlcnNlKGkucHJvamVjdGlvbk1hdHJpeCkpLHRoaXMuYXBwbHlQcm9qZWN0aW9uKHQpfX0oKSx0cmFuc2Zvcm1EaXJlY3Rpb246ZnVuY3Rpb24odCl7dmFyIGk9dGhpcy54LHM9dGhpcy55LG49dGhpcy56LHI9dC5lbGVtZW50cztyZXR1cm4gdGhpcy54PXJbMF0qaStyWzRdKnMrcls4XSpuLHRoaXMueT1yWzFdKmkrcls1XSpzK3JbOV0qbix0aGlzLno9clsyXSppK3JbNl0qcytyWzEwXSpuLHRoaXMubm9ybWFsaXplKCl9LGRpdmlkZTpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy54Lz10LngsdGhpcy55Lz10LnksdGhpcy56Lz10LnosdGhpc30sZGl2aWRlU2NhbGFyOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLm11bHRpcGx5U2NhbGFyKDEvdCl9LG1pbjpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy54PU1hdGgubWluKHRoaXMueCx0LngpLHRoaXMueT1NYXRoLm1pbih0aGlzLnksdC55KSx0aGlzLno9TWF0aC5taW4odGhpcy56LHQueiksdGhpc30sbWF4OmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLng9TWF0aC5tYXgodGhpcy54LHQueCksdGhpcy55PU1hdGgubWF4KHRoaXMueSx0LnkpLHRoaXMuej1NYXRoLm1heCh0aGlzLnosdC56KSx0aGlzfSxjbGFtcDpmdW5jdGlvbih0LGkpe3JldHVybiB0aGlzLng9TWF0aC5tYXgodC54LE1hdGgubWluKGkueCx0aGlzLngpKSx0aGlzLnk9TWF0aC5tYXgodC55LE1hdGgubWluKGkueSx0aGlzLnkpKSx0aGlzLno9TWF0aC5tYXgodC56LE1hdGgubWluKGkueix0aGlzLnopKSx0aGlzfSxjbGFtcFNjYWxhcjpmdW5jdGlvbigpe3ZhciB0LGk7cmV0dXJuIGZ1bmN0aW9uKHMsbil7cmV0dXJuIHZvaWQgMD09PXQmJih0PW5ldyBUSFJFRS5WZWN0b3IzLGk9bmV3IFRIUkVFLlZlY3RvcjMpLHQuc2V0KHMscyxzKSxpLnNldChuLG4sbiksdGhpcy5jbGFtcCh0LGkpfX0oKSxjbGFtcExlbmd0aDpmdW5jdGlvbih0LGkpe3ZhciBzPXRoaXMubGVuZ3RoKCk7cmV0dXJuIHRoaXMubXVsdGlwbHlTY2FsYXIoTWF0aC5tYXgodCxNYXRoLm1pbihpLHMpKS9zKX0sZmxvb3I6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy54PU1hdGguZmxvb3IodGhpcy54KSx0aGlzLnk9TWF0aC5mbG9vcih0aGlzLnkpLHRoaXMuej1NYXRoLmZsb29yKHRoaXMueiksdGhpc30sY2VpbDpmdW5jdGlvbigpe3JldHVybiB0aGlzLng9TWF0aC5jZWlsKHRoaXMueCksdGhpcy55PU1hdGguY2VpbCh0aGlzLnkpLHRoaXMuej1NYXRoLmNlaWwodGhpcy56KSx0aGlzfSxyb3VuZDpmdW5jdGlvbigpe3JldHVybiB0aGlzLng9TWF0aC5yb3VuZCh0aGlzLngpLHRoaXMueT1NYXRoLnJvdW5kKHRoaXMueSksdGhpcy56PU1hdGgucm91bmQodGhpcy56KSx0aGlzfSxyb3VuZFRvWmVybzpmdW5jdGlvbigpe3JldHVybiB0aGlzLng9dGhpcy54PDA/TWF0aC5jZWlsKHRoaXMueCk6TWF0aC5mbG9vcih0aGlzLngpLHRoaXMueT10aGlzLnk8MD9NYXRoLmNlaWwodGhpcy55KTpNYXRoLmZsb29yKHRoaXMueSksdGhpcy56PXRoaXMuejwwP01hdGguY2VpbCh0aGlzLnopOk1hdGguZmxvb3IodGhpcy56KSx0aGlzfSxuZWdhdGU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy54PS10aGlzLngsdGhpcy55PS10aGlzLnksdGhpcy56PS10aGlzLnosdGhpc30sZG90OmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLngqdC54K3RoaXMueSp0LnkrdGhpcy56KnQuen0sbGVuZ3RoU3E6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy54KnRoaXMueCt0aGlzLnkqdGhpcy55K3RoaXMueip0aGlzLnp9LGxlbmd0aDpmdW5jdGlvbigpe3JldHVybiBNYXRoLnNxcnQodGhpcy54KnRoaXMueCt0aGlzLnkqdGhpcy55K3RoaXMueip0aGlzLnopfSxsZW5ndGhNYW5oYXR0YW46ZnVuY3Rpb24oKXtyZXR1cm4gTWF0aC5hYnModGhpcy54KStNYXRoLmFicyh0aGlzLnkpK01hdGguYWJzKHRoaXMueil9LG5vcm1hbGl6ZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLmRpdmlkZVNjYWxhcih0aGlzLmxlbmd0aCgpKX0sc2V0TGVuZ3RoOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLm11bHRpcGx5U2NhbGFyKHQvdGhpcy5sZW5ndGgoKSl9LGxlcnA6ZnVuY3Rpb24odCxpKXtyZXR1cm4gdGhpcy54Kz0odC54LXRoaXMueCkqaSx0aGlzLnkrPSh0LnktdGhpcy55KSppLHRoaXMueis9KHQuei10aGlzLnopKmksdGhpc30sbGVycFZlY3RvcnM6ZnVuY3Rpb24odCxpLHMpe3JldHVybiB0aGlzLnN1YlZlY3RvcnMoaSx0KS5tdWx0aXBseVNjYWxhcihzKS5hZGQodCl9LGNyb3NzOmZ1bmN0aW9uKHQsaSl7aWYodm9pZCAwIT09aSlyZXR1cm4gY29uc29sZS53YXJuKFwiVEhSRUUuVmVjdG9yMzogLmNyb3NzKCkgbm93IG9ubHkgYWNjZXB0cyBvbmUgYXJndW1lbnQuIFVzZSAuY3Jvc3NWZWN0b3JzKCBhLCBiICkgaW5zdGVhZC5cIiksdGhpcy5jcm9zc1ZlY3RvcnModCxpKTt2YXIgcz10aGlzLngsbj10aGlzLnkscj10aGlzLno7cmV0dXJuIHRoaXMueD1uKnQuei1yKnQueSx0aGlzLnk9cip0Lngtcyp0LnosdGhpcy56PXMqdC55LW4qdC54LHRoaXN9LGNyb3NzVmVjdG9yczpmdW5jdGlvbih0LGkpe3ZhciBzPXQueCxuPXQueSxyPXQueixoPWkueCxlPWkueSxvPWkuejtyZXR1cm4gdGhpcy54PW4qby1yKmUsdGhpcy55PXIqaC1zKm8sdGhpcy56PXMqZS1uKmgsdGhpc30scHJvamVjdE9uVmVjdG9yOmZ1bmN0aW9uKHQpe3ZhciBpPXQuZG90KHRoaXMpL3QubGVuZ3RoU3EoKTtyZXR1cm4gdGhpcy5jb3B5KHQpLm11bHRpcGx5U2NhbGFyKGkpfSxwcm9qZWN0T25QbGFuZTpmdW5jdGlvbigpe3ZhciB0O3JldHVybiBmdW5jdGlvbihpKXtyZXR1cm4gdm9pZCAwPT09dCYmKHQ9bmV3IFRIUkVFLlZlY3RvcjMpLHQuY29weSh0aGlzKS5wcm9qZWN0T25WZWN0b3IoaSksdGhpcy5zdWIodCl9fSgpLHJlZmxlY3Q6ZnVuY3Rpb24oKXt2YXIgdDtyZXR1cm4gZnVuY3Rpb24oaSl7cmV0dXJuIHZvaWQgMD09PXQmJih0PW5ldyBUSFJFRS5WZWN0b3IzKSx0aGlzLnN1Yih0LmNvcHkoaSkubXVsdGlwbHlTY2FsYXIoMip0aGlzLmRvdChpKSkpfX0oKSxhbmdsZVRvOmZ1bmN0aW9uKHQpe3ZhciBpPXRoaXMuZG90KHQpL01hdGguc3FydCh0aGlzLmxlbmd0aFNxKCkqdC5sZW5ndGhTcSgpKTtyZXR1cm4gTWF0aC5hY29zKFRIUkVFLk1hdGguY2xhbXAoaSwtMSwxKSl9LGRpc3RhbmNlVG86ZnVuY3Rpb24odCl7cmV0dXJuIE1hdGguc3FydCh0aGlzLmRpc3RhbmNlVG9TcXVhcmVkKHQpKX0sZGlzdGFuY2VUb1NxdWFyZWQ6ZnVuY3Rpb24odCl7dmFyIGk9dGhpcy54LXQueCxzPXRoaXMueS10Lnksbj10aGlzLnotdC56O3JldHVybiBpKmkrcypzK24qbn0sZGlzdGFuY2VUb01hbmhhdHRhbjpmdW5jdGlvbih0KXtyZXR1cm4gTWF0aC5hYnModGhpcy54LXQueCkrTWF0aC5hYnModGhpcy55LXQueSkrTWF0aC5hYnModGhpcy56LXQueil9LHNldEZyb21TcGhlcmljYWw6ZnVuY3Rpb24odCl7dmFyIGk9TWF0aC5zaW4odC5waGkpKnQucmFkaXVzO3JldHVybiB0aGlzLng9aSpNYXRoLnNpbih0LnRoZXRhKSx0aGlzLnk9TWF0aC5jb3ModC5waGkpKnQucmFkaXVzLHRoaXMuej1pKk1hdGguY29zKHQudGhldGEpLHRoaXN9LHNldEZyb21NYXRyaXhQb3NpdGlvbjpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5zZXRGcm9tTWF0cml4Q29sdW1uKHQsMyl9LHNldEZyb21NYXRyaXhTY2FsZTpmdW5jdGlvbih0KXt2YXIgaT10aGlzLnNldEZyb21NYXRyaXhDb2x1bW4odCwwKS5sZW5ndGgoKSxzPXRoaXMuc2V0RnJvbU1hdHJpeENvbHVtbih0LDEpLmxlbmd0aCgpLG49dGhpcy5zZXRGcm9tTWF0cml4Q29sdW1uKHQsMikubGVuZ3RoKCk7cmV0dXJuIHRoaXMueD1pLHRoaXMueT1zLHRoaXMuej1uLHRoaXN9LHNldEZyb21NYXRyaXhDb2x1bW46ZnVuY3Rpb24odCxpKXtpZihcIm51bWJlclwiPT10eXBlb2YgdCl7Y29uc29sZS53YXJuKFwiVEhSRUUuVmVjdG9yMzogc2V0RnJvbU1hdHJpeENvbHVtbiBub3cgZXhwZWN0cyAoIG1hdHJpeCwgaW5kZXggKS5cIik7dmFyIHM9dDt0PWksaT1zfXJldHVybiB0aGlzLmZyb21BcnJheSh0LmVsZW1lbnRzLDQqaSl9LGVxdWFsczpmdW5jdGlvbih0KXtyZXR1cm4gdC54PT09dGhpcy54JiZ0Lnk9PT10aGlzLnkmJnQuej09PXRoaXMuen0sZnJvbUFycmF5OmZ1bmN0aW9uKHQsaSl7cmV0dXJuIHZvaWQgMD09PWkmJihpPTApLHRoaXMueD10W2ldLHRoaXMueT10W2krMV0sdGhpcy56PXRbaSsyXSx0aGlzfSx0b0FycmF5OmZ1bmN0aW9uKHQsaSl7cmV0dXJuIHZvaWQgMD09PXQmJih0PVtdKSx2b2lkIDA9PT1pJiYoaT0wKSx0W2ldPXRoaXMueCx0W2krMV09dGhpcy55LHRbaSsyXT10aGlzLnosdH0sZnJvbUF0dHJpYnV0ZTpmdW5jdGlvbih0LGkscyl7cmV0dXJuIHZvaWQgMD09PXMmJihzPTApLGk9aSp0Lml0ZW1TaXplK3MsdGhpcy54PXQuYXJyYXlbaV0sdGhpcy55PXQuYXJyYXlbaSsxXSx0aGlzLno9dC5hcnJheVtpKzJdLHRoaXN9fTsiLCJUSFJFRS5NYXRyaXg0PWZ1bmN0aW9uKCl7dGhpcy5lbGVtZW50cz1uZXcgRmxvYXQzMkFycmF5KFsxLDAsMCwwLDAsMSwwLDAsMCwwLDEsMCwwLDAsMCwxXSksYXJndW1lbnRzLmxlbmd0aD4wJiZjb25zb2xlLmVycm9yKFwiVEhSRUUuTWF0cml4NDogdGhlIGNvbnN0cnVjdG9yIG5vIGxvbmdlciByZWFkcyBhcmd1bWVudHMuIHVzZSAuc2V0KCkgaW5zdGVhZC5cIil9LFRIUkVFLk1hdHJpeDQucHJvdG90eXBlPXtjb25zdHJ1Y3RvcjpUSFJFRS5NYXRyaXg0LHNldDpmdW5jdGlvbih0LGUscixuLGkscyxvLGEsdSxsLGgsYyxtLGYsdix5KXt2YXIgRT10aGlzLmVsZW1lbnRzO3JldHVybiBFWzBdPXQsRVs0XT1lLEVbOF09cixFWzEyXT1uLEVbMV09aSxFWzVdPXMsRVs5XT1vLEVbMTNdPWEsRVsyXT11LEVbNl09bCxFWzEwXT1oLEVbMTRdPWMsRVszXT1tLEVbN109ZixFWzExXT12LEVbMTVdPXksdGhpc30saWRlbnRpdHk6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5zZXQoMSwwLDAsMCwwLDEsMCwwLDAsMCwxLDAsMCwwLDAsMSksdGhpc30sY2xvbmU6ZnVuY3Rpb24oKXtyZXR1cm4obmV3IFRIUkVFLk1hdHJpeDQpLmZyb21BcnJheSh0aGlzLmVsZW1lbnRzKX0sY29weTpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5lbGVtZW50cy5zZXQodC5lbGVtZW50cyksdGhpc30sY29weVBvc2l0aW9uOmZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMuZWxlbWVudHMscj10LmVsZW1lbnRzO3JldHVybiBlWzEyXT1yWzEyXSxlWzEzXT1yWzEzXSxlWzE0XT1yWzE0XSx0aGlzfSxleHRyYWN0QmFzaXM6ZnVuY3Rpb24odCxlLHIpe3JldHVybiB0LnNldEZyb21NYXRyaXhDb2x1bW4odGhpcywwKSxlLnNldEZyb21NYXRyaXhDb2x1bW4odGhpcywxKSxyLnNldEZyb21NYXRyaXhDb2x1bW4odGhpcywyKSx0aGlzfSxtYWtlQmFzaXM6ZnVuY3Rpb24odCxlLHIpe3JldHVybiB0aGlzLnNldCh0LngsZS54LHIueCwwLHQueSxlLnksci55LDAsdC56LGUueixyLnosMCwwLDAsMCwxKSx0aGlzfSxleHRyYWN0Um90YXRpb246ZnVuY3Rpb24oKXt2YXIgdDtyZXR1cm4gZnVuY3Rpb24oZSl7dm9pZCAwPT09dCYmKHQ9bmV3IFRIUkVFLlZlY3RvcjMpO3ZhciByPXRoaXMuZWxlbWVudHMsbj1lLmVsZW1lbnRzLGk9MS90LnNldEZyb21NYXRyaXhDb2x1bW4oZSwwKS5sZW5ndGgoKSxzPTEvdC5zZXRGcm9tTWF0cml4Q29sdW1uKGUsMSkubGVuZ3RoKCksbz0xL3Quc2V0RnJvbU1hdHJpeENvbHVtbihlLDIpLmxlbmd0aCgpO3JldHVybiByWzBdPW5bMF0qaSxyWzFdPW5bMV0qaSxyWzJdPW5bMl0qaSxyWzRdPW5bNF0qcyxyWzVdPW5bNV0qcyxyWzZdPW5bNl0qcyxyWzhdPW5bOF0qbyxyWzldPW5bOV0qbyxyWzEwXT1uWzEwXSpvLHRoaXN9fSgpLG1ha2VSb3RhdGlvbkZyb21FdWxlcjpmdW5jdGlvbih0KXt0IGluc3RhbmNlb2YgVEhSRUUuRXVsZXI9PSExJiZjb25zb2xlLmVycm9yKFwiVEhSRUUuTWF0cml4OiAubWFrZVJvdGF0aW9uRnJvbUV1bGVyKCkgbm93IGV4cGVjdHMgYSBFdWxlciByb3RhdGlvbiByYXRoZXIgdGhhbiBhIFZlY3RvcjMgYW5kIG9yZGVyLlwiKTt2YXIgZT10aGlzLmVsZW1lbnRzLHI9dC54LG49dC55LGk9dC56LHM9TWF0aC5jb3Mociksbz1NYXRoLnNpbihyKSxhPU1hdGguY29zKG4pLHU9TWF0aC5zaW4obiksbD1NYXRoLmNvcyhpKSxoPU1hdGguc2luKGkpO2lmKFwiWFlaXCI9PT10Lm9yZGVyKXt2YXIgYz1zKmwsbT1zKmgsZj1vKmwsdj1vKmg7ZVswXT1hKmwsZVs0XT0tYSpoLGVbOF09dSxlWzFdPW0rZip1LGVbNV09Yy12KnUsZVs5XT0tbyphLGVbMl09di1jKnUsZVs2XT1mK20qdSxlWzEwXT1zKmF9ZWxzZSBpZihcIllYWlwiPT09dC5vcmRlcil7dmFyIHk9YSpsLEU9YSpoLE09dSpsLHg9dSpoO2VbMF09eSt4Km8sZVs0XT1NKm8tRSxlWzhdPXMqdSxlWzFdPXMqaCxlWzVdPXMqbCxlWzldPS1vLGVbMl09RSpvLU0sZVs2XT14K3kqbyxlWzEwXT1zKmF9ZWxzZSBpZihcIlpYWVwiPT09dC5vcmRlcil7dmFyIHk9YSpsLEU9YSpoLE09dSpsLHg9dSpoO2VbMF09eS14Km8sZVs0XT0tcypoLGVbOF09TStFKm8sZVsxXT1FK00qbyxlWzVdPXMqbCxlWzldPXgteSpvLGVbMl09LXMqdSxlWzZdPW8sZVsxMF09cyphfWVsc2UgaWYoXCJaWVhcIj09PXQub3JkZXIpe3ZhciBjPXMqbCxtPXMqaCxmPW8qbCx2PW8qaDtlWzBdPWEqbCxlWzRdPWYqdS1tLGVbOF09Yyp1K3YsZVsxXT1hKmgsZVs1XT12KnUrYyxlWzldPW0qdS1mLGVbMl09LXUsZVs2XT1vKmEsZVsxMF09cyphfWVsc2UgaWYoXCJZWlhcIj09PXQub3JkZXIpe3ZhciBkPXMqYSxwPXMqdSxSPW8qYSxUPW8qdTtlWzBdPWEqbCxlWzRdPVQtZCpoLGVbOF09UipoK3AsZVsxXT1oLGVbNV09cypsLGVbOV09LW8qbCxlWzJdPS11KmwsZVs2XT1wKmgrUixlWzEwXT1kLVQqaH1lbHNlIGlmKFwiWFpZXCI9PT10Lm9yZGVyKXt2YXIgZD1zKmEscD1zKnUsUj1vKmEsVD1vKnU7ZVswXT1hKmwsZVs0XT0taCxlWzhdPXUqbCxlWzFdPWQqaCtULGVbNV09cypsLGVbOV09cCpoLVIsZVsyXT1SKmgtcCxlWzZdPW8qbCxlWzEwXT1UKmgrZH1yZXR1cm4gZVszXT0wLGVbN109MCxlWzExXT0wLGVbMTJdPTAsZVsxM109MCxlWzE0XT0wLGVbMTVdPTEsdGhpc30sbWFrZVJvdGF0aW9uRnJvbVF1YXRlcm5pb246ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy5lbGVtZW50cyxyPXQueCxuPXQueSxpPXQueixzPXQudyxvPXIrcixhPW4rbix1PWkraSxsPXIqbyxoPXIqYSxjPXIqdSxtPW4qYSxmPW4qdSx2PWkqdSx5PXMqbyxFPXMqYSxNPXMqdTtyZXR1cm4gZVswXT0xLShtK3YpLGVbNF09aC1NLGVbOF09YytFLGVbMV09aCtNLGVbNV09MS0obCt2KSxlWzldPWYteSxlWzJdPWMtRSxlWzZdPWYreSxlWzEwXT0xLShsK20pLGVbM109MCxlWzddPTAsZVsxMV09MCxlWzEyXT0wLGVbMTNdPTAsZVsxNF09MCxlWzE1XT0xLHRoaXN9LGxvb2tBdDpmdW5jdGlvbigpe3ZhciB0LGUscjtyZXR1cm4gZnVuY3Rpb24obixpLHMpe3ZvaWQgMD09PXQmJih0PW5ldyBUSFJFRS5WZWN0b3IzLGU9bmV3IFRIUkVFLlZlY3RvcjMscj1uZXcgVEhSRUUuVmVjdG9yMyk7dmFyIG89dGhpcy5lbGVtZW50cztyZXR1cm4gci5zdWJWZWN0b3JzKG4saSkubm9ybWFsaXplKCksMD09PXIubGVuZ3RoU3EoKSYmKHIuej0xKSx0LmNyb3NzVmVjdG9ycyhzLHIpLm5vcm1hbGl6ZSgpLDA9PT10Lmxlbmd0aFNxKCkmJihyLnorPTFlLTQsdC5jcm9zc1ZlY3RvcnMocyxyKS5ub3JtYWxpemUoKSksZS5jcm9zc1ZlY3RvcnMocix0KSxvWzBdPXQueCxvWzRdPWUueCxvWzhdPXIueCxvWzFdPXQueSxvWzVdPWUueSxvWzldPXIueSxvWzJdPXQueixvWzZdPWUueixvWzEwXT1yLnosdGhpc319KCksbXVsdGlwbHk6ZnVuY3Rpb24odCxlKXtyZXR1cm4gdm9pZCAwIT09ZT8oY29uc29sZS53YXJuKFwiVEhSRUUuTWF0cml4NDogLm11bHRpcGx5KCkgbm93IG9ubHkgYWNjZXB0cyBvbmUgYXJndW1lbnQuIFVzZSAubXVsdGlwbHlNYXRyaWNlcyggYSwgYiApIGluc3RlYWQuXCIpLHRoaXMubXVsdGlwbHlNYXRyaWNlcyh0LGUpKTp0aGlzLm11bHRpcGx5TWF0cmljZXModGhpcyx0KX0scHJlbXVsdGlwbHk6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMubXVsdGlwbHlNYXRyaWNlcyh0LHRoaXMpfSxtdWx0aXBseU1hdHJpY2VzOmZ1bmN0aW9uKHQsZSl7dmFyIHI9dC5lbGVtZW50cyxuPWUuZWxlbWVudHMsaT10aGlzLmVsZW1lbnRzLHM9clswXSxvPXJbNF0sYT1yWzhdLHU9clsxMl0sbD1yWzFdLGg9cls1XSxjPXJbOV0sbT1yWzEzXSxmPXJbMl0sdj1yWzZdLHk9clsxMF0sRT1yWzE0XSxNPXJbM10seD1yWzddLGQ9clsxMV0scD1yWzE1XSxSPW5bMF0sVD1uWzRdLGc9bls4XSx6PW5bMTJdLEg9blsxXSx3PW5bNV0saz1uWzldLEE9blsxM10sRj1uWzJdLFY9bls2XSxYPW5bMTBdLFk9blsxNF0sWj1uWzNdLEM9bls3XSxQPW5bMTFdLFM9blsxNV07cmV0dXJuIGlbMF09cypSK28qSCthKkYrdSpaLGlbNF09cypUK28qdythKlYrdSpDLGlbOF09cypnK28qaythKlgrdSpQLGlbMTJdPXMqeitvKkErYSpZK3UqUyxpWzFdPWwqUitoKkgrYypGK20qWixpWzVdPWwqVCtoKncrYypWK20qQyxpWzldPWwqZytoKmsrYypYK20qUCxpWzEzXT1sKnoraCpBK2MqWSttKlMsaVsyXT1mKlIrdipIK3kqRitFKlosaVs2XT1mKlQrdip3K3kqVitFKkMsaVsxMF09ZipnK3Yqayt5KlgrRSpQLGlbMTRdPWYqeit2KkEreSpZK0UqUyxpWzNdPU0qUit4KkgrZCpGK3AqWixpWzddPU0qVCt4KncrZCpWK3AqQyxpWzExXT1NKmcreCprK2QqWCtwKlAsaVsxNV09TSp6K3gqQStkKlkrcCpTLHRoaXN9LG11bHRpcGx5VG9BcnJheTpmdW5jdGlvbih0LGUscil7dmFyIG49dGhpcy5lbGVtZW50cztyZXR1cm4gdGhpcy5tdWx0aXBseU1hdHJpY2VzKHQsZSksclswXT1uWzBdLHJbMV09blsxXSxyWzJdPW5bMl0sclszXT1uWzNdLHJbNF09bls0XSxyWzVdPW5bNV0scls2XT1uWzZdLHJbN109bls3XSxyWzhdPW5bOF0scls5XT1uWzldLHJbMTBdPW5bMTBdLHJbMTFdPW5bMTFdLHJbMTJdPW5bMTJdLHJbMTNdPW5bMTNdLHJbMTRdPW5bMTRdLHJbMTVdPW5bMTVdLHRoaXN9LG11bHRpcGx5U2NhbGFyOmZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMuZWxlbWVudHM7cmV0dXJuIGVbMF0qPXQsZVs0XSo9dCxlWzhdKj10LGVbMTJdKj10LGVbMV0qPXQsZVs1XSo9dCxlWzldKj10LGVbMTNdKj10LGVbMl0qPXQsZVs2XSo9dCxlWzEwXSo9dCxlWzE0XSo9dCxlWzNdKj10LGVbN10qPXQsZVsxMV0qPXQsZVsxNV0qPXQsdGhpc30sYXBwbHlUb1ZlY3RvcjNBcnJheTpmdW5jdGlvbigpe3ZhciB0O3JldHVybiBmdW5jdGlvbihlLHIsbil7dm9pZCAwPT09dCYmKHQ9bmV3IFRIUkVFLlZlY3RvcjMpLHZvaWQgMD09PXImJihyPTApLHZvaWQgMD09PW4mJihuPWUubGVuZ3RoKTtmb3IodmFyIGk9MCxzPXI7aTxuO2krPTMscys9Myl0LmZyb21BcnJheShlLHMpLHQuYXBwbHlNYXRyaXg0KHRoaXMpLHQudG9BcnJheShlLHMpO3JldHVybiBlfX0oKSxhcHBseVRvQnVmZmVyOmZ1bmN0aW9uKCl7dmFyIHQ7cmV0dXJuIGZ1bmN0aW9uKGUscixuKXt2b2lkIDA9PT10JiYodD1uZXcgVEhSRUUuVmVjdG9yMyksdm9pZCAwPT09ciYmKHI9MCksdm9pZCAwPT09biYmKG49ZS5sZW5ndGgvZS5pdGVtU2l6ZSk7Zm9yKHZhciBpPTAscz1yO2k8bjtpKysscysrKXQueD1lLmdldFgocyksdC55PWUuZ2V0WShzKSx0Lno9ZS5nZXRaKHMpLHQuYXBwbHlNYXRyaXg0KHRoaXMpLGUuc2V0WFlaKHQueCx0LnksdC56KTtyZXR1cm4gZX19KCksZGV0ZXJtaW5hbnQ6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLmVsZW1lbnRzLGU9dFswXSxyPXRbNF0sbj10WzhdLGk9dFsxMl0scz10WzFdLG89dFs1XSxhPXRbOV0sdT10WzEzXSxsPXRbMl0saD10WzZdLGM9dFsxMF0sbT10WzE0XSxmPXRbM10sdj10WzddLHk9dFsxMV0sRT10WzE1XTtyZXR1cm4gZiooK2kqYSpoLW4qdSpoLWkqbypjK3IqdSpjK24qbyptLXIqYSptKSt2KigrZSphKm0tZSp1KmMraSpzKmMtbipzKm0rbip1KmwtaSphKmwpK3kqKCtlKnUqaC1lKm8qbS1pKnMqaCtyKnMqbStpKm8qbC1yKnUqbCkrRSooLW4qbypsLWUqYSpoK2UqbypjK24qcypoLXIqcypjK3IqYSpsKX0sdHJhbnNwb3NlOmZ1bmN0aW9uKCl7dmFyIHQsZT10aGlzLmVsZW1lbnRzO3JldHVybiB0PWVbMV0sZVsxXT1lWzRdLGVbNF09dCx0PWVbMl0sZVsyXT1lWzhdLGVbOF09dCx0PWVbNl0sZVs2XT1lWzldLGVbOV09dCx0PWVbM10sZVszXT1lWzEyXSxlWzEyXT10LHQ9ZVs3XSxlWzddPWVbMTNdLGVbMTNdPXQsdD1lWzExXSxlWzExXT1lWzE0XSxlWzE0XT10LHRoaXN9LGZsYXR0ZW5Ub0FycmF5T2Zmc2V0OmZ1bmN0aW9uKHQsZSl7cmV0dXJuIGNvbnNvbGUud2FybihcIlRIUkVFLk1hdHJpeDM6IC5mbGF0dGVuVG9BcnJheU9mZnNldCBpcyBkZXByZWNhdGVkIC0ganVzdCB1c2UgLnRvQXJyYXkgaW5zdGVhZC5cIiksdGhpcy50b0FycmF5KHQsZSl9LGdldFBvc2l0aW9uOmZ1bmN0aW9uKCl7dmFyIHQ7cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuIHZvaWQgMD09PXQmJih0PW5ldyBUSFJFRS5WZWN0b3IzKSxjb25zb2xlLndhcm4oXCJUSFJFRS5NYXRyaXg0OiAuZ2V0UG9zaXRpb24oKSBoYXMgYmVlbiByZW1vdmVkLiBVc2UgVmVjdG9yMy5zZXRGcm9tTWF0cml4UG9zaXRpb24oIG1hdHJpeCApIGluc3RlYWQuXCIpLHQuc2V0RnJvbU1hdHJpeENvbHVtbih0aGlzLDMpfX0oKSxzZXRQb3NpdGlvbjpmdW5jdGlvbih0KXt2YXIgZT10aGlzLmVsZW1lbnRzO3JldHVybiBlWzEyXT10LngsZVsxM109dC55LGVbMTRdPXQueix0aGlzfSxnZXRJbnZlcnNlOmZ1bmN0aW9uKHQsZSl7dmFyIHI9dGhpcy5lbGVtZW50cyxuPXQuZWxlbWVudHMsaT1uWzBdLHM9blsxXSxvPW5bMl0sYT1uWzNdLHU9bls0XSxsPW5bNV0saD1uWzZdLGM9bls3XSxtPW5bOF0sZj1uWzldLHY9blsxMF0seT1uWzExXSxFPW5bMTJdLE09blsxM10seD1uWzE0XSxkPW5bMTVdLHA9Zip4KmMtTSp2KmMrTSpoKnktbCp4KnktZipoKmQrbCp2KmQsUj1FKnYqYy1tKngqYy1FKmgqeSt1KngqeSttKmgqZC11KnYqZCxUPW0qTSpjLUUqZipjK0UqbCp5LXUqTSp5LW0qbCpkK3UqZipkLGc9RSpmKmgtbSpNKmgtRSpsKnYrdSpNKnYrbSpsKngtdSpmKngsej1pKnArcypSK28qVCthKmc7aWYoMD09PXope3ZhciBIPVwiVEhSRUUuTWF0cml4NC5nZXRJbnZlcnNlKCk6IGNhbid0IGludmVydCBtYXRyaXgsIGRldGVybWluYW50IGlzIDBcIjtpZihlKXRocm93IG5ldyBFcnJvcihIKTtyZXR1cm4gY29uc29sZS53YXJuKEgpLHRoaXMuaWRlbnRpdHkoKX12YXIgdz0xL3o7cmV0dXJuIHJbMF09cCp3LHJbMV09KE0qdiphLWYqeCphLU0qbyp5K3MqeCp5K2YqbypkLXMqdipkKSp3LHJbMl09KGwqeCphLU0qaCphK00qbypjLXMqeCpjLWwqbypkK3MqaCpkKSp3LHJbM109KGYqaCphLWwqdiphLWYqbypjK3MqdipjK2wqbyp5LXMqaCp5KSp3LHJbNF09Uip3LHJbNV09KG0qeCphLUUqdiphK0Uqbyp5LWkqeCp5LW0qbypkK2kqdipkKSp3LHJbNl09KEUqaCphLXUqeCphLUUqbypjK2kqeCpjK3UqbypkLWkqaCpkKSp3LHJbN109KHUqdiphLW0qaCphK20qbypjLWkqdipjLXUqbyp5K2kqaCp5KSp3LHJbOF09VCp3LHJbOV09KEUqZiphLW0qTSphLUUqcyp5K2kqTSp5K20qcypkLWkqZipkKSp3LHJbMTBdPSh1Kk0qYS1FKmwqYStFKnMqYy1pKk0qYy11KnMqZCtpKmwqZCkqdyxyWzExXT0obSpsKmEtdSpmKmEtbSpzKmMraSpmKmMrdSpzKnktaSpsKnkpKncsclsxMl09Zyp3LHJbMTNdPShtKk0qby1FKmYqbytFKnMqdi1pKk0qdi1tKnMqeCtpKmYqeCkqdyxyWzE0XT0oRSpsKm8tdSpNKm8tRSpzKmgraSpNKmgrdSpzKngtaSpsKngpKncsclsxNV09KHUqZipvLW0qbCpvK20qcypoLWkqZipoLXUqcyp2K2kqbCp2KSp3LHRoaXN9LHNjYWxlOmZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMuZWxlbWVudHMscj10Lngsbj10LnksaT10Lno7cmV0dXJuIGVbMF0qPXIsZVs0XSo9bixlWzhdKj1pLGVbMV0qPXIsZVs1XSo9bixlWzldKj1pLGVbMl0qPXIsZVs2XSo9bixlWzEwXSo9aSxlWzNdKj1yLGVbN10qPW4sZVsxMV0qPWksdGhpc30sZ2V0TWF4U2NhbGVPbkF4aXM6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLmVsZW1lbnRzLGU9dFswXSp0WzBdK3RbMV0qdFsxXSt0WzJdKnRbMl0scj10WzRdKnRbNF0rdFs1XSp0WzVdK3RbNl0qdFs2XSxuPXRbOF0qdFs4XSt0WzldKnRbOV0rdFsxMF0qdFsxMF07cmV0dXJuIE1hdGguc3FydChNYXRoLm1heChlLHIsbikpfSxtYWtlVHJhbnNsYXRpb246ZnVuY3Rpb24odCxlLHIpe3JldHVybiB0aGlzLnNldCgxLDAsMCx0LDAsMSwwLGUsMCwwLDEsciwwLDAsMCwxKSx0aGlzfSxtYWtlUm90YXRpb25YOmZ1bmN0aW9uKHQpe3ZhciBlPU1hdGguY29zKHQpLHI9TWF0aC5zaW4odCk7cmV0dXJuIHRoaXMuc2V0KDEsMCwwLDAsMCxlLC1yLDAsMCxyLGUsMCwwLDAsMCwxKSx0aGlzfSxtYWtlUm90YXRpb25ZOmZ1bmN0aW9uKHQpe3ZhciBlPU1hdGguY29zKHQpLHI9TWF0aC5zaW4odCk7cmV0dXJuIHRoaXMuc2V0KGUsMCxyLDAsMCwxLDAsMCwtciwwLGUsMCwwLDAsMCwxKSx0aGlzfSxtYWtlUm90YXRpb25aOmZ1bmN0aW9uKHQpe3ZhciBlPU1hdGguY29zKHQpLHI9TWF0aC5zaW4odCk7cmV0dXJuIHRoaXMuc2V0KGUsLXIsMCwwLHIsZSwwLDAsMCwwLDEsMCwwLDAsMCwxKSx0aGlzfSxtYWtlUm90YXRpb25BeGlzOmZ1bmN0aW9uKHQsZSl7dmFyIHI9TWF0aC5jb3MoZSksbj1NYXRoLnNpbihlKSxpPTEtcixzPXQueCxvPXQueSxhPXQueix1PWkqcyxsPWkqbztyZXR1cm4gdGhpcy5zZXQodSpzK3IsdSpvLW4qYSx1KmErbipvLDAsdSpvK24qYSxsKm8rcixsKmEtbipzLDAsdSphLW4qbyxsKmErbipzLGkqYSphK3IsMCwwLDAsMCwxKSx0aGlzfSxtYWtlU2NhbGU6ZnVuY3Rpb24odCxlLHIpe3JldHVybiB0aGlzLnNldCh0LDAsMCwwLDAsZSwwLDAsMCwwLHIsMCwwLDAsMCwxKSx0aGlzfSxjb21wb3NlOmZ1bmN0aW9uKHQsZSxyKXtyZXR1cm4gdGhpcy5tYWtlUm90YXRpb25Gcm9tUXVhdGVybmlvbihlKSx0aGlzLnNjYWxlKHIpLHRoaXMuc2V0UG9zaXRpb24odCksdGhpc30sZGVjb21wb3NlOmZ1bmN0aW9uKCl7dmFyIHQsZTtyZXR1cm4gZnVuY3Rpb24ocixuLGkpe3ZvaWQgMD09PXQmJih0PW5ldyBUSFJFRS5WZWN0b3IzLGU9bmV3IFRIUkVFLk1hdHJpeDQpO3ZhciBzPXRoaXMuZWxlbWVudHMsbz10LnNldChzWzBdLHNbMV0sc1syXSkubGVuZ3RoKCksYT10LnNldChzWzRdLHNbNV0sc1s2XSkubGVuZ3RoKCksdT10LnNldChzWzhdLHNbOV0sc1sxMF0pLmxlbmd0aCgpLGw9dGhpcy5kZXRlcm1pbmFudCgpO2w8MCYmKG89LW8pLHIueD1zWzEyXSxyLnk9c1sxM10sci56PXNbMTRdLGUuZWxlbWVudHMuc2V0KHRoaXMuZWxlbWVudHMpO3ZhciBoPTEvbyxjPTEvYSxtPTEvdTtyZXR1cm4gZS5lbGVtZW50c1swXSo9aCxlLmVsZW1lbnRzWzFdKj1oLGUuZWxlbWVudHNbMl0qPWgsZS5lbGVtZW50c1s0XSo9YyxlLmVsZW1lbnRzWzVdKj1jLGUuZWxlbWVudHNbNl0qPWMsZS5lbGVtZW50c1s4XSo9bSxlLmVsZW1lbnRzWzldKj1tLGUuZWxlbWVudHNbMTBdKj1tLG4uc2V0RnJvbVJvdGF0aW9uTWF0cml4KGUpLGkueD1vLGkueT1hLGkuej11LHRoaXN9fSgpLG1ha2VGcnVzdHVtOmZ1bmN0aW9uKHQsZSxyLG4saSxzKXt2YXIgbz10aGlzLmVsZW1lbnRzLGE9MippLyhlLXQpLHU9MippLyhuLXIpLGw9KGUrdCkvKGUtdCksaD0obityKS8obi1yKSxjPS0ocytpKS8ocy1pKSxtPS0yKnMqaS8ocy1pKTtyZXR1cm4gb1swXT1hLG9bNF09MCxvWzhdPWwsb1sxMl09MCxvWzFdPTAsb1s1XT11LG9bOV09aCxvWzEzXT0wLG9bMl09MCxvWzZdPTAsb1sxMF09YyxvWzE0XT1tLG9bM109MCxvWzddPTAsb1sxMV09LTEsb1sxNV09MCx0aGlzfSxtYWtlUGVyc3BlY3RpdmU6ZnVuY3Rpb24odCxlLHIsbil7dmFyIGk9cipNYXRoLnRhbihUSFJFRS5NYXRoLkRFRzJSQUQqdCouNSkscz0taSxvPXMqZSxhPWkqZTtyZXR1cm4gdGhpcy5tYWtlRnJ1c3R1bShvLGEscyxpLHIsbil9LG1ha2VPcnRob2dyYXBoaWM6ZnVuY3Rpb24odCxlLHIsbixpLHMpe3ZhciBvPXRoaXMuZWxlbWVudHMsYT0xLyhlLXQpLHU9MS8oci1uKSxsPTEvKHMtaSksaD0oZSt0KSphLGM9KHIrbikqdSxtPShzK2kpKmw7cmV0dXJuIG9bMF09MiphLG9bNF09MCxvWzhdPTAsb1sxMl09LWgsb1sxXT0wLG9bNV09Mip1LG9bOV09MCxvWzEzXT0tYyxvWzJdPTAsb1s2XT0wLG9bMTBdPS0yKmwsb1sxNF09LW0sb1szXT0wLG9bN109MCxvWzExXT0wLG9bMTVdPTEsdGhpc30sZXF1YWxzOmZ1bmN0aW9uKHQpe2Zvcih2YXIgZT10aGlzLmVsZW1lbnRzLHI9dC5lbGVtZW50cyxuPTA7bjwxNjtuKyspaWYoZVtuXSE9PXJbbl0pcmV0dXJuITE7cmV0dXJuITB9LGZyb21BcnJheTpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5lbGVtZW50cy5zZXQodCksdGhpc30sdG9BcnJheTpmdW5jdGlvbih0LGUpe3ZvaWQgMD09PXQmJih0PVtdKSx2b2lkIDA9PT1lJiYoZT0wKTt2YXIgcj10aGlzLmVsZW1lbnRzO3JldHVybiB0W2VdPXJbMF0sdFtlKzFdPXJbMV0sdFtlKzJdPXJbMl0sdFtlKzNdPXJbM10sdFtlKzRdPXJbNF0sdFtlKzVdPXJbNV0sdFtlKzZdPXJbNl0sdFtlKzddPXJbN10sdFtlKzhdPXJbOF0sdFtlKzldPXJbOV0sdFtlKzEwXT1yWzEwXSx0W2UrMTFdPXJbMTFdLHRbZSsxMl09clsxMl0sdFtlKzEzXT1yWzEzXSx0W2UrMTRdPXJbMTRdLHRbZSsxNV09clsxNV0sdH19OyIsIlRIUkVFLlF1YXRlcm5pb249ZnVuY3Rpb24odCxpLHMsaCl7dGhpcy5feD10fHwwLHRoaXMuX3k9aXx8MCx0aGlzLl96PXN8fDAsdGhpcy5fdz12b2lkIDAhPT1oP2g6MX0sVEhSRUUuUXVhdGVybmlvbi5wcm90b3R5cGU9e2NvbnN0cnVjdG9yOlRIUkVFLlF1YXRlcm5pb24sZ2V0IHgoKXtyZXR1cm4gdGhpcy5feH0sc2V0IHgodCl7dGhpcy5feD10LHRoaXMub25DaGFuZ2VDYWxsYmFjaygpfSxnZXQgeSgpe3JldHVybiB0aGlzLl95fSxzZXQgeSh0KXt0aGlzLl95PXQsdGhpcy5vbkNoYW5nZUNhbGxiYWNrKCl9LGdldCB6KCl7cmV0dXJuIHRoaXMuX3p9LHNldCB6KHQpe3RoaXMuX3o9dCx0aGlzLm9uQ2hhbmdlQ2FsbGJhY2soKX0sZ2V0IHcoKXtyZXR1cm4gdGhpcy5fd30sc2V0IHcodCl7dGhpcy5fdz10LHRoaXMub25DaGFuZ2VDYWxsYmFjaygpfSxzZXQ6ZnVuY3Rpb24odCxpLHMsaCl7cmV0dXJuIHRoaXMuX3g9dCx0aGlzLl95PWksdGhpcy5fej1zLHRoaXMuX3c9aCx0aGlzLm9uQ2hhbmdlQ2FsbGJhY2soKSx0aGlzfSxjbG9uZTpmdW5jdGlvbigpe3JldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3Rvcih0aGlzLl94LHRoaXMuX3ksdGhpcy5feix0aGlzLl93KX0sY29weTpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5feD10LngsdGhpcy5feT10LnksdGhpcy5fej10LnosdGhpcy5fdz10LncsdGhpcy5vbkNoYW5nZUNhbGxiYWNrKCksdGhpc30sc2V0RnJvbUV1bGVyOmZ1bmN0aW9uKHQsaSl7aWYodCBpbnN0YW5jZW9mIFRIUkVFLkV1bGVyPT0hMSl0aHJvdyBuZXcgRXJyb3IoXCJUSFJFRS5RdWF0ZXJuaW9uOiAuc2V0RnJvbUV1bGVyKCkgbm93IGV4cGVjdHMgYSBFdWxlciByb3RhdGlvbiByYXRoZXIgdGhhbiBhIFZlY3RvcjMgYW5kIG9yZGVyLlwiKTt2YXIgcz1NYXRoLmNvcyh0Ll94LzIpLGg9TWF0aC5jb3ModC5feS8yKSxuPU1hdGguY29zKHQuX3ovMiksXz1NYXRoLnNpbih0Ll94LzIpLHI9TWF0aC5zaW4odC5feS8yKSxlPU1hdGguc2luKHQuX3ovMiksYT10Lm9yZGVyO3JldHVyblwiWFlaXCI9PT1hPyh0aGlzLl94PV8qaCpuK3MqciplLHRoaXMuX3k9cypyKm4tXypoKmUsdGhpcy5fej1zKmgqZStfKnIqbix0aGlzLl93PXMqaCpuLV8qciplKTpcIllYWlwiPT09YT8odGhpcy5feD1fKmgqbitzKnIqZSx0aGlzLl95PXMqcipuLV8qaCplLHRoaXMuX3o9cypoKmUtXypyKm4sdGhpcy5fdz1zKmgqbitfKnIqZSk6XCJaWFlcIj09PWE/KHRoaXMuX3g9XypoKm4tcypyKmUsdGhpcy5feT1zKnIqbitfKmgqZSx0aGlzLl96PXMqaCplK18qcipuLHRoaXMuX3c9cypoKm4tXypyKmUpOlwiWllYXCI9PT1hPyh0aGlzLl94PV8qaCpuLXMqciplLHRoaXMuX3k9cypyKm4rXypoKmUsdGhpcy5fej1zKmgqZS1fKnIqbix0aGlzLl93PXMqaCpuK18qciplKTpcIllaWFwiPT09YT8odGhpcy5feD1fKmgqbitzKnIqZSx0aGlzLl95PXMqcipuK18qaCplLHRoaXMuX3o9cypoKmUtXypyKm4sdGhpcy5fdz1zKmgqbi1fKnIqZSk6XCJYWllcIj09PWEmJih0aGlzLl94PV8qaCpuLXMqciplLHRoaXMuX3k9cypyKm4tXypoKmUsdGhpcy5fej1zKmgqZStfKnIqbix0aGlzLl93PXMqaCpuK18qciplKSxpIT09ITEmJnRoaXMub25DaGFuZ2VDYWxsYmFjaygpLHRoaXN9LHNldEZyb21BeGlzQW5nbGU6ZnVuY3Rpb24odCxpKXt2YXIgcz1pLzIsaD1NYXRoLnNpbihzKTtyZXR1cm4gdGhpcy5feD10LngqaCx0aGlzLl95PXQueSpoLHRoaXMuX3o9dC56KmgsdGhpcy5fdz1NYXRoLmNvcyhzKSx0aGlzLm9uQ2hhbmdlQ2FsbGJhY2soKSx0aGlzfSxzZXRGcm9tUm90YXRpb25NYXRyaXg6ZnVuY3Rpb24odCl7dmFyIGkscz10LmVsZW1lbnRzLGg9c1swXSxuPXNbNF0sXz1zWzhdLHI9c1sxXSxlPXNbNV0sYT1zWzldLG89c1syXSx1PXNbNl0sYz1zWzEwXSxsPWgrZStjO3JldHVybiBsPjA/KGk9LjUvTWF0aC5zcXJ0KGwrMSksdGhpcy5fdz0uMjUvaSx0aGlzLl94PSh1LWEpKmksdGhpcy5feT0oXy1vKSppLHRoaXMuX3o9KHItbikqaSk6aD5lJiZoPmM/KGk9MipNYXRoLnNxcnQoMStoLWUtYyksdGhpcy5fdz0odS1hKS9pLHRoaXMuX3g9LjI1KmksdGhpcy5feT0obityKS9pLHRoaXMuX3o9KF8rbykvaSk6ZT5jPyhpPTIqTWF0aC5zcXJ0KDErZS1oLWMpLHRoaXMuX3c9KF8tbykvaSx0aGlzLl94PShuK3IpL2ksdGhpcy5feT0uMjUqaSx0aGlzLl96PShhK3UpL2kpOihpPTIqTWF0aC5zcXJ0KDErYy1oLWUpLHRoaXMuX3c9KHItbikvaSx0aGlzLl94PShfK28pL2ksdGhpcy5feT0oYSt1KS9pLHRoaXMuX3o9LjI1KmkpLHRoaXMub25DaGFuZ2VDYWxsYmFjaygpLHRoaXN9LHNldEZyb21Vbml0VmVjdG9yczpmdW5jdGlvbigpe3ZhciB0LGkscz0xZS02O3JldHVybiBmdW5jdGlvbihoLG4pe3JldHVybiB2b2lkIDA9PT10JiYodD1uZXcgVEhSRUUuVmVjdG9yMyksaT1oLmRvdChuKSsxLGk8cz8oaT0wLE1hdGguYWJzKGgueCk+TWF0aC5hYnMoaC56KT90LnNldCgtaC55LGgueCwwKTp0LnNldCgwLC1oLnosaC55KSk6dC5jcm9zc1ZlY3RvcnMoaCxuKSx0aGlzLl94PXQueCx0aGlzLl95PXQueSx0aGlzLl96PXQueix0aGlzLl93PWksdGhpcy5ub3JtYWxpemUoKX19KCksaW52ZXJzZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLmNvbmp1Z2F0ZSgpLm5vcm1hbGl6ZSgpfSxjb25qdWdhdGU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5feCo9LTEsdGhpcy5feSo9LTEsdGhpcy5feio9LTEsdGhpcy5vbkNoYW5nZUNhbGxiYWNrKCksdGhpc30sZG90OmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLl94KnQuX3grdGhpcy5feSp0Ll95K3RoaXMuX3oqdC5feit0aGlzLl93KnQuX3d9LGxlbmd0aFNxOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX3gqdGhpcy5feCt0aGlzLl95KnRoaXMuX3krdGhpcy5feip0aGlzLl96K3RoaXMuX3cqdGhpcy5fd30sbGVuZ3RoOmZ1bmN0aW9uKCl7cmV0dXJuIE1hdGguc3FydCh0aGlzLl94KnRoaXMuX3grdGhpcy5feSp0aGlzLl95K3RoaXMuX3oqdGhpcy5feit0aGlzLl93KnRoaXMuX3cpfSxub3JtYWxpemU6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLmxlbmd0aCgpO3JldHVybiAwPT09dD8odGhpcy5feD0wLHRoaXMuX3k9MCx0aGlzLl96PTAsdGhpcy5fdz0xKToodD0xL3QsdGhpcy5feD10aGlzLl94KnQsdGhpcy5feT10aGlzLl95KnQsdGhpcy5fej10aGlzLl96KnQsdGhpcy5fdz10aGlzLl93KnQpLHRoaXMub25DaGFuZ2VDYWxsYmFjaygpLHRoaXN9LG11bHRpcGx5OmZ1bmN0aW9uKHQsaSl7cmV0dXJuIHZvaWQgMCE9PWk/KGNvbnNvbGUud2FybihcIlRIUkVFLlF1YXRlcm5pb246IC5tdWx0aXBseSgpIG5vdyBvbmx5IGFjY2VwdHMgb25lIGFyZ3VtZW50LiBVc2UgLm11bHRpcGx5UXVhdGVybmlvbnMoIGEsIGIgKSBpbnN0ZWFkLlwiKSx0aGlzLm11bHRpcGx5UXVhdGVybmlvbnModCxpKSk6dGhpcy5tdWx0aXBseVF1YXRlcm5pb25zKHRoaXMsdCl9LHByZW11bHRpcGx5OmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLm11bHRpcGx5UXVhdGVybmlvbnModCx0aGlzKX0sbXVsdGlwbHlRdWF0ZXJuaW9uczpmdW5jdGlvbih0LGkpe3ZhciBzPXQuX3gsaD10Ll95LG49dC5feixfPXQuX3cscj1pLl94LGU9aS5feSxhPWkuX3osbz1pLl93O3JldHVybiB0aGlzLl94PXMqbytfKnIraCphLW4qZSx0aGlzLl95PWgqbytfKmUrbipyLXMqYSx0aGlzLl96PW4qbytfKmErcyplLWgqcix0aGlzLl93PV8qby1zKnItaCplLW4qYSx0aGlzLm9uQ2hhbmdlQ2FsbGJhY2soKSx0aGlzfSxzbGVycDpmdW5jdGlvbih0LGkpe2lmKDA9PT1pKXJldHVybiB0aGlzO2lmKDE9PT1pKXJldHVybiB0aGlzLmNvcHkodCk7dmFyIHM9dGhpcy5feCxoPXRoaXMuX3ksbj10aGlzLl96LF89dGhpcy5fdyxyPV8qdC5fdytzKnQuX3graCp0Ll95K24qdC5fejtpZihyPDA/KHRoaXMuX3c9LXQuX3csdGhpcy5feD0tdC5feCx0aGlzLl95PS10Ll95LHRoaXMuX3o9LXQuX3oscj0tcik6dGhpcy5jb3B5KHQpLHI+PTEpcmV0dXJuIHRoaXMuX3c9Xyx0aGlzLl94PXMsdGhpcy5feT1oLHRoaXMuX3o9bix0aGlzO3ZhciBlPU1hdGguc3FydCgxLXIqcik7aWYoTWF0aC5hYnMoZSk8LjAwMSlyZXR1cm4gdGhpcy5fdz0uNSooXyt0aGlzLl93KSx0aGlzLl94PS41KihzK3RoaXMuX3gpLHRoaXMuX3k9LjUqKGgrdGhpcy5feSksdGhpcy5fej0uNSoobit0aGlzLl96KSx0aGlzO3ZhciBhPU1hdGguYXRhbjIoZSxyKSxvPU1hdGguc2luKCgxLWkpKmEpL2UsdT1NYXRoLnNpbihpKmEpL2U7cmV0dXJuIHRoaXMuX3c9XypvK3RoaXMuX3cqdSx0aGlzLl94PXMqbyt0aGlzLl94KnUsdGhpcy5feT1oKm8rdGhpcy5feSp1LHRoaXMuX3o9bipvK3RoaXMuX3oqdSx0aGlzLm9uQ2hhbmdlQ2FsbGJhY2soKSx0aGlzfSxlcXVhbHM6ZnVuY3Rpb24odCl7cmV0dXJuIHQuX3g9PT10aGlzLl94JiZ0Ll95PT09dGhpcy5feSYmdC5fej09PXRoaXMuX3omJnQuX3c9PT10aGlzLl93fSxmcm9tQXJyYXk6ZnVuY3Rpb24odCxpKXtyZXR1cm4gdm9pZCAwPT09aSYmKGk9MCksdGhpcy5feD10W2ldLHRoaXMuX3k9dFtpKzFdLHRoaXMuX3o9dFtpKzJdLHRoaXMuX3c9dFtpKzNdLHRoaXMub25DaGFuZ2VDYWxsYmFjaygpLHRoaXN9LHRvQXJyYXk6ZnVuY3Rpb24odCxpKXtyZXR1cm4gdm9pZCAwPT09dCYmKHQ9W10pLHZvaWQgMD09PWkmJihpPTApLHRbaV09dGhpcy5feCx0W2krMV09dGhpcy5feSx0W2krMl09dGhpcy5feix0W2krM109dGhpcy5fdyx0fSxvbkNoYW5nZTpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5vbkNoYW5nZUNhbGxiYWNrPXQsdGhpc30sb25DaGFuZ2VDYWxsYmFjazpmdW5jdGlvbigpe319LE9iamVjdC5hc3NpZ24oVEhSRUUuUXVhdGVybmlvbix7c2xlcnA6ZnVuY3Rpb24odCxpLHMsaCl7cmV0dXJuIHMuY29weSh0KS5zbGVycChpLGgpfSxzbGVycEZsYXQ6ZnVuY3Rpb24odCxpLHMsaCxuLF8scil7dmFyIGU9c1toKzBdLGE9c1toKzFdLG89c1toKzJdLHU9c1toKzNdLGM9bltfKzBdLGw9bltfKzFdLHk9bltfKzJdLHg9bltfKzNdO2lmKHUhPT14fHxlIT09Y3x8YSE9PWx8fG8hPT15KXt2YXIgej0xLXIsdz1lKmMrYSpsK28qeSt1KngsZj13Pj0wPzE6LTEsYj0xLXcqdztpZihiPk51bWJlci5FUFNJTE9OKXt2YXIgQz1NYXRoLnNxcnQoYiksZz1NYXRoLmF0YW4yKEMsdypmKTt6PU1hdGguc2luKHoqZykvQyxyPU1hdGguc2luKHIqZykvQ312YXIgTT1yKmY7aWYoZT1lKnorYypNLGE9YSp6K2wqTSxvPW8qeit5Kk0sdT11KnoreCpNLHo9PT0xLXIpe3ZhciBFPTEvTWF0aC5zcXJ0KGUqZSthKmErbypvK3UqdSk7ZSo9RSxhKj1FLG8qPUUsdSo9RX19dFtpXT1lLHRbaSsxXT1hLHRbaSsyXT1vLHRbaSszXT11fX0pOyIsIlRIUkVFLkV1bGVyPWZ1bmN0aW9uKHQsaSxoLG4pe3RoaXMuX3g9dHx8MCx0aGlzLl95PWl8fDAsdGhpcy5fej1ofHwwLHRoaXMuX29yZGVyPW58fFRIUkVFLkV1bGVyLkRlZmF1bHRPcmRlcn0sVEhSRUUuRXVsZXIuUm90YXRpb25PcmRlcnM9W1wiWFlaXCIsXCJZWlhcIixcIlpYWVwiLFwiWFpZXCIsXCJZWFpcIixcIlpZWFwiXSxUSFJFRS5FdWxlci5EZWZhdWx0T3JkZXI9XCJYWVpcIixUSFJFRS5FdWxlci5wcm90b3R5cGU9e2NvbnN0cnVjdG9yOlRIUkVFLkV1bGVyLGdldCB4KCl7cmV0dXJuIHRoaXMuX3h9LHNldCB4KHQpe3RoaXMuX3g9dCx0aGlzLm9uQ2hhbmdlQ2FsbGJhY2soKX0sZ2V0IHkoKXtyZXR1cm4gdGhpcy5feX0sc2V0IHkodCl7dGhpcy5feT10LHRoaXMub25DaGFuZ2VDYWxsYmFjaygpfSxnZXQgeigpe3JldHVybiB0aGlzLl96fSxzZXQgeih0KXt0aGlzLl96PXQsdGhpcy5vbkNoYW5nZUNhbGxiYWNrKCl9LGdldCBvcmRlcigpe3JldHVybiB0aGlzLl9vcmRlcn0sc2V0IG9yZGVyKHQpe3RoaXMuX29yZGVyPXQsdGhpcy5vbkNoYW5nZUNhbGxiYWNrKCl9LHNldDpmdW5jdGlvbih0LGksaCxuKXtyZXR1cm4gdGhpcy5feD10LHRoaXMuX3k9aSx0aGlzLl96PWgsdGhpcy5fb3JkZXI9bnx8dGhpcy5fb3JkZXIsdGhpcy5vbkNoYW5nZUNhbGxiYWNrKCksdGhpc30sY2xvbmU6ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IodGhpcy5feCx0aGlzLl95LHRoaXMuX3osdGhpcy5fb3JkZXIpfSxjb3B5OmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLl94PXQuX3gsdGhpcy5feT10Ll95LHRoaXMuX3o9dC5feix0aGlzLl9vcmRlcj10Ll9vcmRlcix0aGlzLm9uQ2hhbmdlQ2FsbGJhY2soKSx0aGlzfSxzZXRGcm9tUm90YXRpb25NYXRyaXg6ZnVuY3Rpb24odCxpLGgpe3ZhciBuPVRIUkVFLk1hdGguY2xhbXAsYT10LmVsZW1lbnRzLHM9YVswXSxyPWFbNF0sZT1hWzhdLG89YVsxXSxfPWFbNV0sYz1hWzldLHU9YVsyXSxsPWFbNl0sTT1hWzEwXTtyZXR1cm4gaT1pfHx0aGlzLl9vcmRlcixcIlhZWlwiPT09aT8odGhpcy5feT1NYXRoLmFzaW4obihlLC0xLDEpKSxNYXRoLmFicyhlKTwuOTk5OTk/KHRoaXMuX3g9TWF0aC5hdGFuMigtYyxNKSx0aGlzLl96PU1hdGguYXRhbjIoLXIscykpOih0aGlzLl94PU1hdGguYXRhbjIobCxfKSx0aGlzLl96PTApKTpcIllYWlwiPT09aT8odGhpcy5feD1NYXRoLmFzaW4oLW4oYywtMSwxKSksTWF0aC5hYnMoYyk8Ljk5OTk5Pyh0aGlzLl95PU1hdGguYXRhbjIoZSxNKSx0aGlzLl96PU1hdGguYXRhbjIobyxfKSk6KHRoaXMuX3k9TWF0aC5hdGFuMigtdSxzKSx0aGlzLl96PTApKTpcIlpYWVwiPT09aT8odGhpcy5feD1NYXRoLmFzaW4obihsLC0xLDEpKSxNYXRoLmFicyhsKTwuOTk5OTk/KHRoaXMuX3k9TWF0aC5hdGFuMigtdSxNKSx0aGlzLl96PU1hdGguYXRhbjIoLXIsXykpOih0aGlzLl95PTAsdGhpcy5fej1NYXRoLmF0YW4yKG8scykpKTpcIlpZWFwiPT09aT8odGhpcy5feT1NYXRoLmFzaW4oLW4odSwtMSwxKSksTWF0aC5hYnModSk8Ljk5OTk5Pyh0aGlzLl94PU1hdGguYXRhbjIobCxNKSx0aGlzLl96PU1hdGguYXRhbjIobyxzKSk6KHRoaXMuX3g9MCx0aGlzLl96PU1hdGguYXRhbjIoLXIsXykpKTpcIllaWFwiPT09aT8odGhpcy5fej1NYXRoLmFzaW4obihvLC0xLDEpKSxNYXRoLmFicyhvKTwuOTk5OTk/KHRoaXMuX3g9TWF0aC5hdGFuMigtYyxfKSx0aGlzLl95PU1hdGguYXRhbjIoLXUscykpOih0aGlzLl94PTAsdGhpcy5feT1NYXRoLmF0YW4yKGUsTSkpKTpcIlhaWVwiPT09aT8odGhpcy5fej1NYXRoLmFzaW4oLW4ociwtMSwxKSksTWF0aC5hYnMocik8Ljk5OTk5Pyh0aGlzLl94PU1hdGguYXRhbjIobCxfKSx0aGlzLl95PU1hdGguYXRhbjIoZSxzKSk6KHRoaXMuX3g9TWF0aC5hdGFuMigtYyxNKSx0aGlzLl95PTApKTpjb25zb2xlLndhcm4oXCJUSFJFRS5FdWxlcjogLnNldEZyb21Sb3RhdGlvbk1hdHJpeCgpIGdpdmVuIHVuc3VwcG9ydGVkIG9yZGVyOiBcIitpKSx0aGlzLl9vcmRlcj1pLGghPT0hMSYmdGhpcy5vbkNoYW5nZUNhbGxiYWNrKCksdGhpc30sc2V0RnJvbVF1YXRlcm5pb246ZnVuY3Rpb24oKXt2YXIgdDtyZXR1cm4gZnVuY3Rpb24oaSxoLG4pe3JldHVybiB2b2lkIDA9PT10JiYodD1uZXcgVEhSRUUuTWF0cml4NCksdC5tYWtlUm90YXRpb25Gcm9tUXVhdGVybmlvbihpKSx0aGlzLnNldEZyb21Sb3RhdGlvbk1hdHJpeCh0LGgsbil9fSgpLHNldEZyb21WZWN0b3IzOmZ1bmN0aW9uKHQsaSl7cmV0dXJuIHRoaXMuc2V0KHQueCx0LnksdC56LGl8fHRoaXMuX29yZGVyKX0scmVvcmRlcjpmdW5jdGlvbigpe3ZhciB0PW5ldyBUSFJFRS5RdWF0ZXJuaW9uO3JldHVybiBmdW5jdGlvbihpKXtyZXR1cm4gdC5zZXRGcm9tRXVsZXIodGhpcyksdGhpcy5zZXRGcm9tUXVhdGVybmlvbih0LGkpfX0oKSxlcXVhbHM6ZnVuY3Rpb24odCl7cmV0dXJuIHQuX3g9PT10aGlzLl94JiZ0Ll95PT09dGhpcy5feSYmdC5fej09PXRoaXMuX3omJnQuX29yZGVyPT09dGhpcy5fb3JkZXJ9LGZyb21BcnJheTpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5feD10WzBdLHRoaXMuX3k9dFsxXSx0aGlzLl96PXRbMl0sdm9pZCAwIT09dFszXSYmKHRoaXMuX29yZGVyPXRbM10pLHRoaXMub25DaGFuZ2VDYWxsYmFjaygpLHRoaXN9LHRvQXJyYXk6ZnVuY3Rpb24odCxpKXtyZXR1cm4gdm9pZCAwPT09dCYmKHQ9W10pLHZvaWQgMD09PWkmJihpPTApLHRbaV09dGhpcy5feCx0W2krMV09dGhpcy5feSx0W2krMl09dGhpcy5feix0W2krM109dGhpcy5fb3JkZXIsdH0sdG9WZWN0b3IzOmZ1bmN0aW9uKHQpe3JldHVybiB0P3Quc2V0KHRoaXMuX3gsdGhpcy5feSx0aGlzLl96KTpuZXcgVEhSRUUuVmVjdG9yMyh0aGlzLl94LHRoaXMuX3ksdGhpcy5feil9LG9uQ2hhbmdlOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLm9uQ2hhbmdlQ2FsbGJhY2s9dCx0aGlzfSxvbkNoYW5nZUNhbGxiYWNrOmZ1bmN0aW9uKCl7fX07IiwiLyohYXJ0LXRlbXBsYXRlIC0gVGVtcGxhdGUgRW5naW5lIHwgaHR0cDovL2F1aS5naXRodWIuY29tL2FydFRlbXBsYXRlLyovXG4hZnVuY3Rpb24oKXtmdW5jdGlvbiBhKGEpe3JldHVybiBhLnJlcGxhY2UodCxcIlwiKS5yZXBsYWNlKHUsXCIsXCIpLnJlcGxhY2UodixcIlwiKS5yZXBsYWNlKHcsXCJcIikucmVwbGFjZSh4LFwiXCIpLnNwbGl0KHkpfWZ1bmN0aW9uIGIoYSl7cmV0dXJuXCInXCIrYS5yZXBsYWNlKC8oJ3xcXFxcKS9nLFwiXFxcXCQxXCIpLnJlcGxhY2UoL1xcci9nLFwiXFxcXHJcIikucmVwbGFjZSgvXFxuL2csXCJcXFxcblwiKStcIidcIn1mdW5jdGlvbiBjKGMsZCl7ZnVuY3Rpb24gZShhKXtyZXR1cm4gbSs9YS5zcGxpdCgvXFxuLykubGVuZ3RoLTEsayYmKGE9YS5yZXBsYWNlKC9cXHMrL2csXCIgXCIpLnJlcGxhY2UoLzwhLS1bXFx3XFxXXSo/LS0+L2csXCJcIikpLGEmJihhPXNbMV0rYihhKStzWzJdK1wiXFxuXCIpLGF9ZnVuY3Rpb24gZihiKXt2YXIgYz1tO2lmKGo/Yj1qKGIsZCk6ZyYmKGI9Yi5yZXBsYWNlKC9cXG4vZyxmdW5jdGlvbigpe3JldHVybiBtKyssXCIkbGluZT1cIittK1wiO1wifSkpLDA9PT1iLmluZGV4T2YoXCI9XCIpKXt2YXIgZT1sJiYhL149Wz0jXS8udGVzdChiKTtpZihiPWIucmVwbGFjZSgvXj1bPSNdP3xbXFxzO10qJC9nLFwiXCIpLGUpe3ZhciBmPWIucmVwbGFjZSgvXFxzKlxcKFteXFwpXStcXCkvLFwiXCIpO25bZl18fC9eKGluY2x1ZGV8cHJpbnQpJC8udGVzdChmKXx8KGI9XCIkZXNjYXBlKFwiK2IrXCIpXCIpfWVsc2UgYj1cIiRzdHJpbmcoXCIrYitcIilcIjtiPXNbMV0rYitzWzJdfXJldHVybiBnJiYoYj1cIiRsaW5lPVwiK2MrXCI7XCIrYikscihhKGIpLGZ1bmN0aW9uKGEpe2lmKGEmJiFwW2FdKXt2YXIgYjtiPVwicHJpbnRcIj09PWE/dTpcImluY2x1ZGVcIj09PWE/djpuW2FdP1wiJHV0aWxzLlwiK2E6b1thXT9cIiRoZWxwZXJzLlwiK2E6XCIkZGF0YS5cIithLHcrPWErXCI9XCIrYitcIixcIixwW2FdPSEwfX0pLGIrXCJcXG5cIn12YXIgZz1kLmRlYnVnLGg9ZC5vcGVuVGFnLGk9ZC5jbG9zZVRhZyxqPWQucGFyc2VyLGs9ZC5jb21wcmVzcyxsPWQuZXNjYXBlLG09MSxwPXskZGF0YToxLCRmaWxlbmFtZToxLCR1dGlsczoxLCRoZWxwZXJzOjEsJG91dDoxLCRsaW5lOjF9LHE9XCJcIi50cmltLHM9cT9bXCIkb3V0PScnO1wiLFwiJG91dCs9XCIsXCI7XCIsXCIkb3V0XCJdOltcIiRvdXQ9W107XCIsXCIkb3V0LnB1c2goXCIsXCIpO1wiLFwiJG91dC5qb2luKCcnKVwiXSx0PXE/XCIkb3V0Kz10ZXh0O3JldHVybiAkb3V0O1wiOlwiJG91dC5wdXNoKHRleHQpO1wiLHU9XCJmdW5jdGlvbigpe3ZhciB0ZXh0PScnLmNvbmNhdC5hcHBseSgnJyxhcmd1bWVudHMpO1wiK3QrXCJ9XCIsdj1cImZ1bmN0aW9uKGZpbGVuYW1lLGRhdGEpe2RhdGE9ZGF0YXx8JGRhdGE7dmFyIHRleHQ9JHV0aWxzLiRpbmNsdWRlKGZpbGVuYW1lLGRhdGEsJGZpbGVuYW1lKTtcIit0K1wifVwiLHc9XCIndXNlIHN0cmljdCc7dmFyICR1dGlscz10aGlzLCRoZWxwZXJzPSR1dGlscy4kaGVscGVycyxcIisoZz9cIiRsaW5lPTAsXCI6XCJcIikseD1zWzBdLHk9XCJyZXR1cm4gbmV3IFN0cmluZyhcIitzWzNdK1wiKTtcIjtyKGMuc3BsaXQoaCksZnVuY3Rpb24oYSl7YT1hLnNwbGl0KGkpO3ZhciBiPWFbMF0sYz1hWzFdOzE9PT1hLmxlbmd0aD94Kz1lKGIpOih4Kz1mKGIpLGMmJih4Kz1lKGMpKSl9KTt2YXIgej13K3greTtnJiYoej1cInRyeXtcIit6K1wifWNhdGNoKGUpe3Rocm93IHtmaWxlbmFtZTokZmlsZW5hbWUsbmFtZTonUmVuZGVyIEVycm9yJyxtZXNzYWdlOmUubWVzc2FnZSxsaW5lOiRsaW5lLHNvdXJjZTpcIitiKGMpK1wiLnNwbGl0KC9cXFxcbi8pWyRsaW5lLTFdLnJlcGxhY2UoL15cXFxccysvLCcnKX07fVwiKTt0cnl7dmFyIEE9bmV3IEZ1bmN0aW9uKFwiJGRhdGFcIixcIiRmaWxlbmFtZVwiLHopO3JldHVybiBBLnByb3RvdHlwZT1uLEF9Y2F0Y2goQil7dGhyb3cgQi50ZW1wPVwiZnVuY3Rpb24gYW5vbnltb3VzKCRkYXRhLCRmaWxlbmFtZSkge1wiK3orXCJ9XCIsQn19dmFyIGQ9ZnVuY3Rpb24oYSxiKXtyZXR1cm5cInN0cmluZ1wiPT10eXBlb2YgYj9xKGIse2ZpbGVuYW1lOmF9KTpnKGEsYil9O2QudmVyc2lvbj1cIjMuMC4wXCIsZC5jb25maWc9ZnVuY3Rpb24oYSxiKXtlW2FdPWJ9O3ZhciBlPWQuZGVmYXVsdHM9e29wZW5UYWc6XCI8JVwiLGNsb3NlVGFnOlwiJT5cIixlc2NhcGU6ITAsY2FjaGU6ITAsY29tcHJlc3M6ITEscGFyc2VyOm51bGx9LGY9ZC5jYWNoZT17fTtkLnJlbmRlcj1mdW5jdGlvbihhLGIpe3JldHVybiBxKGEsYil9O3ZhciBnPWQucmVuZGVyRmlsZT1mdW5jdGlvbihhLGIpe3ZhciBjPWQuZ2V0KGEpfHxwKHtmaWxlbmFtZTphLG5hbWU6XCJSZW5kZXIgRXJyb3JcIixtZXNzYWdlOlwiVGVtcGxhdGUgbm90IGZvdW5kXCJ9KTtyZXR1cm4gYj9jKGIpOmN9O2QuZ2V0PWZ1bmN0aW9uKGEpe3ZhciBiO2lmKGZbYV0pYj1mW2FdO2Vsc2UgaWYoXCJvYmplY3RcIj09dHlwZW9mIGRvY3VtZW50KXt2YXIgYz1kb2N1bWVudC5nZXRFbGVtZW50QnlJZChhKTtpZihjKXt2YXIgZD0oYy52YWx1ZXx8Yy5pbm5lckhUTUwpLnJlcGxhY2UoL15cXHMqfFxccyokL2csXCJcIik7Yj1xKGQse2ZpbGVuYW1lOmF9KX19cmV0dXJuIGJ9O3ZhciBoPWZ1bmN0aW9uKGEsYil7cmV0dXJuXCJzdHJpbmdcIiE9dHlwZW9mIGEmJihiPXR5cGVvZiBhLFwibnVtYmVyXCI9PT1iP2ErPVwiXCI6YT1cImZ1bmN0aW9uXCI9PT1iP2goYS5jYWxsKGEpKTpcIlwiKSxhfSxpPXtcIjxcIjpcIiYjNjA7XCIsXCI+XCI6XCImIzYyO1wiLCdcIic6XCImIzM0O1wiLFwiJ1wiOlwiJiMzOTtcIixcIiZcIjpcIiYjMzg7XCJ9LGo9ZnVuY3Rpb24oYSl7cmV0dXJuIGlbYV19LGs9ZnVuY3Rpb24oYSl7cmV0dXJuIGgoYSkucmVwbGFjZSgvJig/IVtcXHcjXSs7KXxbPD5cIiddL2csail9LGw9QXJyYXkuaXNBcnJheXx8ZnVuY3Rpb24oYSl7cmV0dXJuXCJbb2JqZWN0IEFycmF5XVwiPT09e30udG9TdHJpbmcuY2FsbChhKX0sbT1mdW5jdGlvbihhLGIpe3ZhciBjLGQ7aWYobChhKSlmb3IoYz0wLGQ9YS5sZW5ndGg7ZD5jO2MrKyliLmNhbGwoYSxhW2NdLGMsYSk7ZWxzZSBmb3IoYyBpbiBhKWIuY2FsbChhLGFbY10sYyl9LG49ZC51dGlscz17JGhlbHBlcnM6e30sJGluY2x1ZGU6Zywkc3RyaW5nOmgsJGVzY2FwZTprLCRlYWNoOm19O2QuaGVscGVyPWZ1bmN0aW9uKGEsYil7b1thXT1ifTt2YXIgbz1kLmhlbHBlcnM9bi4kaGVscGVycztkLm9uZXJyb3I9ZnVuY3Rpb24oYSl7dmFyIGI9XCJUZW1wbGF0ZSBFcnJvclxcblxcblwiO2Zvcih2YXIgYyBpbiBhKWIrPVwiPFwiK2MrXCI+XFxuXCIrYVtjXStcIlxcblxcblwiO1wib2JqZWN0XCI9PXR5cGVvZiBjb25zb2xlJiZjb25zb2xlLmVycm9yKGIpfTt2YXIgcD1mdW5jdGlvbihhKXtyZXR1cm4gZC5vbmVycm9yKGEpLGZ1bmN0aW9uKCl7cmV0dXJuXCJ7VGVtcGxhdGUgRXJyb3J9XCJ9fSxxPWQuY29tcGlsZT1mdW5jdGlvbihhLGIpe2Z1bmN0aW9uIGQoYyl7dHJ5e3JldHVybiBuZXcgaShjLGgpK1wiXCJ9Y2F0Y2goZCl7cmV0dXJuIGIuZGVidWc/cChkKSgpOihiLmRlYnVnPSEwLHEoYSxiKShjKSl9fWI9Ynx8e307Zm9yKHZhciBnIGluIGUpdm9pZCAwPT09YltnXSYmKGJbZ109ZVtnXSk7dmFyIGg9Yi5maWxlbmFtZTt0cnl7dmFyIGk9YyhhLGIpfWNhdGNoKGope3JldHVybiBqLmZpbGVuYW1lPWh8fFwiYW5vbnltb3VzXCIsai5uYW1lPVwiU3ludGF4IEVycm9yXCIscChqKX1yZXR1cm4gZC5wcm90b3R5cGU9aS5wcm90b3R5cGUsZC50b1N0cmluZz1mdW5jdGlvbigpe3JldHVybiBpLnRvU3RyaW5nKCl9LGgmJmIuY2FjaGUmJihmW2hdPWQpLGR9LHI9bi4kZWFjaCxzPVwiYnJlYWssY2FzZSxjYXRjaCxjb250aW51ZSxkZWJ1Z2dlcixkZWZhdWx0LGRlbGV0ZSxkbyxlbHNlLGZhbHNlLGZpbmFsbHksZm9yLGZ1bmN0aW9uLGlmLGluLGluc3RhbmNlb2YsbmV3LG51bGwscmV0dXJuLHN3aXRjaCx0aGlzLHRocm93LHRydWUsdHJ5LHR5cGVvZix2YXIsdm9pZCx3aGlsZSx3aXRoLGFic3RyYWN0LGJvb2xlYW4sYnl0ZSxjaGFyLGNsYXNzLGNvbnN0LGRvdWJsZSxlbnVtLGV4cG9ydCxleHRlbmRzLGZpbmFsLGZsb2F0LGdvdG8saW1wbGVtZW50cyxpbXBvcnQsaW50LGludGVyZmFjZSxsb25nLG5hdGl2ZSxwYWNrYWdlLHByaXZhdGUscHJvdGVjdGVkLHB1YmxpYyxzaG9ydCxzdGF0aWMsc3VwZXIsc3luY2hyb25pemVkLHRocm93cyx0cmFuc2llbnQsdm9sYXRpbGUsYXJndW1lbnRzLGxldCx5aWVsZCx1bmRlZmluZWRcIix0PS9cXC9cXCpbXFx3XFxXXSo/XFwqXFwvfFxcL1xcL1teXFxuXSpcXG58XFwvXFwvW15cXG5dKiR8XCIoPzpbXlwiXFxcXF18XFxcXFtcXHdcXFddKSpcInwnKD86W14nXFxcXF18XFxcXFtcXHdcXFddKSonfFxccypcXC5cXHMqWyRcXHdcXC5dKy9nLHU9L1teXFx3JF0rL2csdj1uZXcgUmVnRXhwKFtcIlxcXFxiXCIrcy5yZXBsYWNlKC8sL2csXCJcXFxcYnxcXFxcYlwiKStcIlxcXFxiXCJdLmpvaW4oXCJ8XCIpLFwiZ1wiKSx3PS9eXFxkW14sXSp8LFxcZFteLF0qL2cseD0vXiwrfCwrJC9nLHk9L14kfCwrLztcImZ1bmN0aW9uXCI9PXR5cGVvZiBkZWZpbmU/ZGVmaW5lKGZ1bmN0aW9uKCl7cmV0dXJuIGR9KTpcInVuZGVmaW5lZFwiIT10eXBlb2YgZXhwb3J0cz9tb2R1bGUuZXhwb3J0cz1kOnRoaXMudGVtcGxhdGU9ZH0oKTsiLCIhZnVuY3Rpb24oZ2xvYmFsKSB7XG5cbiAgaWYgKGdsb2JhbC50ZW1wbGF0ZSkge1xuICAgIGdsb2JhbC50ZW1wbGF0ZS5jb25maWcoJ29wZW5UYWcnLCc8IycpO1xuICAgIGdsb2JhbC50ZW1wbGF0ZS5jb25maWcoJ2Nsb3NlVGFnJywnIz4nKTtcbiAgfVxuXG4gIGdsb2JhbC5zbm90ID0ge307XG5cbiAgZ2xvYmFsLnNub3QudXRpbCA9IHtcbiAgICBsZWZ0X3BvczogbGVmdF9wb3MsXG4gICAgdG9wX3BvczogdG9wX3BvcyxcbiAgICBzdGFuZGFyZGxpemF0aW9uOiBzdGFuZGFyZGxpemF0aW9uLFxuICAgIGlzX21vYmlsZTogaXNfbW9iaWxlLFxuICAgIGlzX3dlY2hhdF9sb2dpbjogaXNfd2VjaGF0X2xvZ2luLFxuICAgIGdldF93aW5kb3dfd2lkdGg6IGdldF93aW5kb3dfd2lkdGgsXG4gICAgZ2V0X3dpbmRvd19oZWlnaHQ6IGdldF93aW5kb3dfaGVpZ2h0LFxuICAgIHBvc2l0aW9uX3RvX3JvdGF0aW9uOiBwb3NpdGlvbl90b19yb3RhdGlvbixcbiAgICBkaXN0YW5jZTJEOiBkaXN0YW5jZTJELFxuICAgIGRpc3RhbmNlM0Q6IGRpc3RhbmNlM0QsXG4gICAgZXBzaWxvbjogZXBzaWxvbixcbiAgICBjc3NfdGV4dF90b19tYXRyaXg6IGNzc190ZXh0X3RvX21hdHJpeCxcbiAgICBtYXRyaXhfdG9fY3NzX3RleHQ6IG1hdHJpeF90b19jc3NfdGV4dCxcbiAgICB3ZWJnbF9kZXRlY3Q6IHdlYmdsX2RldGVjdCxcbiAgICB3ZWJnbF9lbmFibGVkOiB3ZWJnbF9kZXRlY3QoKSxcbiAgICBsb2FkX2pzOiBsb2FkX2pzLFxuICAgIHJvdGF0aW9uX3RvX3Bvc2l0aW9uOiByb3RhdGlvbl90b19wb3NpdGlvbixcblxuICAgIHZfc2V0X2Zyb21fbWF0cml4X3Bvc2l0aW9uOiB2X3NldF9mcm9tX21hdHJpeF9wb3NpdGlvbixcbiAgICBtX21ha2Vfcm90YXRpb25fYXhpczogbV9tYWtlX3JvdGF0aW9uX2F4aXMsXG4gICAgbV9tdWx0aXBseTogbV9tdWx0aXBseSxcbiAgICBtX3NldF9wb3NpdGlvbjogbV9zZXRfcG9zaXRpb24sXG4gICAgbV9tYWtlX3JvdGF0aW9uX2Zyb21fcXVhdGVybmlvbjogbV9tYWtlX3JvdGF0aW9uX2Zyb21fcXVhdGVybmlvbixcblxuICAgIG1lcmdlX2pzb246IG1lcmdlX2pzb24sXG4gICAgb2N0cmVlX2NvbGxpc2lvbjogb2N0cmVlX2NvbGxpc2lvbixcblxuICB9O1xuXG4gIGZ1bmN0aW9uIHRvcF9wb3MoZWxlbSkge1xuICAgIHZhciBjdXJ0b3AgPSAwO1xuICAgIGlmIChlbGVtLm9mZnNldFBhcmVudCkge1xuICAgICAgZG8geyBcbiAgICAgICAgICBjdXJ0b3AgKz0gZWxlbS5vZmZzZXRUb3A7IFxuICAgICAgfSB3aGlsZSAoZWxlbSA9IGVsZW0ub2Zmc2V0UGFyZW50KTtcbiAgICB9XG4gICAgcmV0dXJuIGN1cnRvcDtcbiAgfTtcblxuICBmdW5jdGlvbiBsZWZ0X3BvcyhlbGVtKSB7XG4gICAgdmFyIGN1cmxlZnQgPSAwO1xuICAgIGlmIChlbGVtLm9mZnNldFBhcmVudCkge1xuICAgICAgICBkbyB7IFxuICAgICAgICAgICAgY3VybGVmdCArPSBlbGVtLm9mZnNldExlZnQ7IFxuICAgICAgICB9IHdoaWxlIChlbGVtID0gZWxlbS5vZmZzZXRQYXJlbnQpO1xuICAgIH1cbiAgICByZXR1cm4gY3VybGVmdDtcbiAgfTtcbiAgXG4gIGZ1bmN0aW9uIGlzX21vYmlsZSgpIHtcbiAgICByZXR1cm4gZ2V0X3dpbmRvd193aWR0aCgpIDwgNTAwO1xuICB9XG4gIFxuICBmdW5jdGlvbiBpc193ZWNoYXRfbG9naW4oKSB7XG4gICAgcmV0dXJuIHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoJ01pY3JvTWVzc2VuZ2VyJykgPj0gMCA/IHRydWUgOiBmYWxzZTtcbiAgfVxuICBcbiAgZnVuY3Rpb24gZ2V0X3dpbmRvd193aWR0aCgpIHtcbiAgICByZXR1cm4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoO1xuICB9XG4gIFxuICBmdW5jdGlvbiBnZXRfd2luZG93X2hlaWdodCgpIHtcbiAgICByZXR1cm4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodDtcbiAgfVxuICBcbiAgZnVuY3Rpb24gcG9zaXRpb25fdG9fcm90YXRpb24oeCwgeSwgeikge1xuICAgIHZhciByID0gZGlzdGFuY2UzRCh4LCB5LCB6LCAwLCAwLCAwKTtcbiAgICB2YXIgcnggPSBNYXRoLmFzaW4oeiAvIHIpO1xuICAgIHZhciByeSA9IE1hdGguYXNpbih5IC8gciAvIE1hdGguY29zKHJ4KSk7XG4gICAgaWYgKHggPCAwKSB7XG4gICAgICAgIHJ5ID0gcnkgPiAwID8gTWF0aC5QSSAtIHJ5IDogLSBNYXRoLlBJIC0gcnk7XG4gICAgfVxuICBcbiAgICByZXR1cm4ge1xuICAgICAgcng6IC0gcnggKiAxODAgLyBNYXRoLlBJLFxuICAgICAgcnk6IChyeSA8IDAgPyByeSArIE1hdGguUEkgKiAyIDogcnkpICogMTgwIC8gTWF0aC5QSVxuICAgIH07XG4gIH1cbiAgXG4gIGZ1bmN0aW9uIGRpc3RhbmNlMkQoYSwgYiwgYywgZCkge1xuICAgIHJldHVybiBNYXRoLnBvdygoYSAtIGMpICogKGEgLSBjKSArIChiIC0gZCkgKiAoYiAtIGQpLCAwLjUpO1xuICB9XG4gIFxuICBmdW5jdGlvbiBkaXN0YW5jZTNEKGEsIGIsIGMsIGQsIGUsIGYpIHtcbiAgICByZXR1cm4gTWF0aC5wb3coKGEgLSBkKSAqIChhIC0gZCkgKyAoYiAtIGUpICogKGIgLSBlKSArIChjIC0gZikgKiAoYyAtIGYpLCAwLjUpO1xuICB9XG4gIFxuICBmdW5jdGlvbiBlcHNpbG9uKHZhbHVlKSB7XG4gICAgcmV0dXJuIE1hdGguYWJzKHZhbHVlKSA8IDAuMDAwMDAxID8gMCA6IHZhbHVlLnRvRml4ZWQoNSk7XG4gIH07XG4gIFxuICBmdW5jdGlvbiBjc3NfdGV4dF90b19tYXRyaXgodCkge1xuICAgIHZhciBtID0gbmV3IFdlYktpdENTU01hdHJpeCh0KTtcbiAgICByZXR1cm4gW1xuICAgICAgZXBzaWxvbihtLm0xMSksIGVwc2lsb24obS5tMTIpLCBlcHNpbG9uKG0ubTEzKSwgZXBzaWxvbihtLm0xNCksXG4gICAgICBlcHNpbG9uKG0ubTIxKSwgZXBzaWxvbihtLm0yMiksIGVwc2lsb24obS5tMjMpLCBlcHNpbG9uKG0ubTI0KSxcbiAgICAgIGVwc2lsb24obS5tMzEpLCBlcHNpbG9uKG0ubTMyKSwgZXBzaWxvbihtLm0zMyksIGVwc2lsb24obS5tMzQpLFxuICAgICAgZXBzaWxvbihtLm00MSksIGVwc2lsb24obS5tNDIpLCBlcHNpbG9uKG0ubTQzKSwgZXBzaWxvbihtLm00NClcbiAgICBdO1xuICB9XG4gIFxuICBmdW5jdGlvbiBtYXRyaXhfdG9fY3NzX3RleHQoYSwgYiwgYywgZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUsIGYsIGcsIGgsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLCBqLCBrLCBsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbSwgbiwgbywgcCkge1xuICAgICAgaWYgKHR5cGVvZihhKSA9PSAnb2JqZWN0Jykge1xuICAgICAgICAgIHJldHVybiAnbWF0cml4M2QoJyArIChhLmpvaW4oJywnKSkgKyAnKSc7XG4gICAgICB9XG4gICAgICByZXR1cm4gJ21hdHJpeDNkKCcgKyBhICsgJywnICsgYiArICcsJyArIGMgKyAnLCcgKyBkKycsJyArIGUgKyAnLCcgKyBmICsgJywnICsgZyArICcsJyArIGggKyAnLCcgKyBpICsgJywnICsgaiArICcsJyArIGsgKyAnLCcgKyBsICsgJywnICsgbSArICcsJyArIG4gKyAnLCcgKyBvKyAnLCcgKyBwICsgJyknO1xuICB9XG4gIFxuICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lPSAoZnVuY3Rpb24gKCkgeyBcbiAgICByZXR1cm4gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSB8fCBcbiAgICB3aW5kb3cud2Via2l0UmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8IFxuICAgIHdpbmRvdy5tb3pSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHwgXG4gICAgd2luZG93Lm9SZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHwgXG4gICAgLy8gaWYgYWxsIGVsc2UgZmFpbHMsIHVzZSBzZXRUaW1lb3V0IFxuICAgIGZ1bmN0aW9uIChjYWxsYmFjaykgeyBcbiAgICAgIHJldHVybiB3aW5kb3cuc2V0VGltZW91dChjYWxsYmFjaywgMTAwMCAvIDYwKTsgLy8gc2hvb3QgZm9yIDYwIGZwcyBcbiAgICB9OyBcbiAgfSkoKTsgXG4gIFxuICBmdW5jdGlvbiB3ZWJnbF9kZXRlY3QocmV0dXJuX2NvbnRleHQpIHtcbiAgICBpZiAoISF3aW5kb3cuV2ViR0xSZW5kZXJpbmdDb250ZXh0KSB7XG4gICAgICB2YXIgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcbiAgICAgIHZhciBuYW1lcyA9IFsnd2ViZ2wnLCAnZXhwZXJpbWVudGFsLXdlYmdsJywgJ21vei13ZWJnbCcsICd3ZWJraXQtM2QnXTtcbiAgICAgIHZhciBjb250ZXh0ID0gZmFsc2U7XG4gIFxuICAgICAgZm9yICh2YXIgaSA9IDA7aSA8IDQ7IGkrKykge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dChuYW1lc1tpXSk7XG4gICAgICAgICAgaWYgKGNvbnRleHQgJiYgdHlwZW9mIGNvbnRleHQuZ2V0UGFyYW1ldGVyID09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIC8vIFdlYkdMIGlzIGVuYWJsZWRcbiAgICAgICAgICAgIGlmIChyZXR1cm5fY29udGV4dCkge1xuICAgICAgICAgICAgICAvLyByZXR1cm4gV2ViR0wgb2JqZWN0IGlmIHRoZSBmdW5jdGlvbidzIGFyZ3VtZW50IGlzIHByZXNlbnRcbiAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBuYW1lOiBuYW1lc1tpXSxcbiAgICAgICAgICAgICAgICBnbDogY29udGV4dFxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gZWxzZSwgcmV0dXJuIGp1c3QgdHJ1ZVxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoKGUpIHt9XG4gICAgICB9XG4gIFxuICAgICAgLy8gV2ViR0wgaXMgc3VwcG9ydGVkLCBidXQgZGlzYWJsZWRcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIFxuICAgIC8vIFdlYkdMIG5vdCBzdXBwb3J0ZWRcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgXG4gIGZ1bmN0aW9uIGxvYWRfanMoZmlsZSwgY2FsbGJhY2spIHtcbiAgICB2YXIgX2RvYyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdoZWFkJylbMF07XG4gICAgdmFyIGpzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7XG4gICAganMuc2V0QXR0cmlidXRlKCd0eXBlJywgJ3RleHQvamF2YXNjcmlwdCcpO1xuICAgIGpzLnNldEF0dHJpYnV0ZSgnc3JjJywgZmlsZSk7XG4gICAgX2RvYy5hcHBlbmRDaGlsZChqcyk7XG4gICAgaWYgKCEvKkBjY19vbiFAKi8wKSB7IC8vaWYgbm90IGllXG4gICAgICAvL2ZpcmVmb3gy44CBZmlyZWZveDPjgIFzYWZhcmkzLjEr44CBb3BlcmE5LjYrIHN1cHBvcnQganMub25sb2FkXG4gICAgICBqcy5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vaWU244CBaWU3IHN1cHBvcnQganMub25yZWFkeXN0YXRlY2hhbmdlXG4gICAgICBqcy5vblJlYWR5U3RhdGVDaGFuZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChqcy5yZWFkeVN0YXRlID09ICdsb2FkZWQnIHx8IGpzLnJlYWR5U3RhdGUgPT0gJ2NvbXBsZXRlJykge1xuICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgXG4gIGZ1bmN0aW9uIHJvdGF0aW9uX3RvX3Bvc2l0aW9uKHosIHJ4LCByeSwgcnopIHtcbiAgICB6ID0gLSB6O1xuICAgIHJ4ID0gLSByeDtcbiAgXG4gICAgdmFyIHggPSBzbm90LmJnX3NpemUgLyAyO1xuICAgIHZhciB5ID0gc25vdC5iZ19zaXplIC8gMjtcbiAgXG4gICAgdmFyIHRyYW5zZm9ybSA9IGNzc190ZXh0X3RvX21hdHJpeCgndHJhbnNsYXRlM2QoJyArIHggKyAncHgsJyArIHkgKyAncHgsMCkgcm90YXRlWSgnICsgKDApICsgJ2RlZykgcm90YXRlWCgnICsgKDApICsgJ2RlZykgcm90YXRlWSgnICsgKHJ5ID8gLSByeSA6IDApICsgJ2RlZykgcm90YXRlWCgnICsgKHJ4ID8gLSByeCA6IDApICsgJ2RlZykgcm90YXRlWignICsgKHJ6ID8gcnogOiAwKSArJ2RlZykgdHJhbnNsYXRlWignICsgeiArICdweCknICk7XG4gICAgcmV0dXJuIFsgLSB0cmFuc2Zvcm1bMTJdICsgc25vdC5iZ19zaXplIC8gMiwgdHJhbnNmb3JtWzEzXSAtIHNub3QuYmdfc2l6ZSAvIDIsIC0gdHJhbnNmb3JtWzE0XV07XG4gIH1cblxuICBmdW5jdGlvbiBtX21ha2Vfcm90YXRpb25fYXhpcyhwb2ludCwgcm90YXRpb24pIHtcbiAgICByZXR1cm4gbmV3IFRIUkVFLk1hdHJpeDQoKS5tYWtlUm90YXRpb25BeGlzKHBvaW50LCByb3RhdGlvbik7XG4gIH1cblxuICBmdW5jdGlvbiBtX211bHRpcGx5KCkge1xuICAgIHZhciBtYXRzID0gYXJndW1lbnRzO1xuXG4gICAgdmFyIGwgPSBtYXRzLmxlbmd0aDtcbiAgICB3aGlsZSAobCA+IDEpIHtcbiAgICAgIHZhciBsYXN0MiA9IG1hdHNbbCAtIDJdO1xuICAgICAgdmFyIGxhc3QxID0gbWF0c1tsIC0gMV07XG4gICAgICBtYXRzW2wgLSAyXSA9IG5ldyBUSFJFRS5NYXRyaXg0KCkubXVsdGlwbHlNYXRyaWNlcyhcbiAgICAgICAgbGFzdDIsXG4gICAgICAgIGxhc3QxXG4gICAgICApO1xuICAgICAgbC0tO1xuICAgIH1cbiAgICByZXR1cm4gbWF0c1swXTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHZfc2V0X2Zyb21fbWF0cml4X3Bvc2l0aW9uKG1hdDQpIHtcbiAgICByZXR1cm4gbmV3IFRIUkVFLlZlY3RvcjMoKS5zZXRGcm9tTWF0cml4UG9zaXRpb24obWF0NCk7XG4gIH1cblxuICBmdW5jdGlvbiBtX3NldF9wb3NpdGlvbihwKSB7XG4gICAgcmV0dXJuIG5ldyBUSFJFRS5NYXRyaXg0KCkuc2V0UG9zaXRpb24ocCk7XG4gIH1cblxuICBmdW5jdGlvbiBtX21ha2Vfcm90YXRpb25fZnJvbV9xdWF0ZXJuaW9uKHEpIHtcbiAgICByZXR1cm4gbmV3IFRIUkVFLk1hdHJpeDQoKS5tYWtlUm90YXRpb25Gcm9tUXVhdGVybmlvbihxKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG1lcmdlX2pzb24ob2JqLCBqc29uKSB7XG4gICAgZm9yICh2YXIgaSBpbiBqc29uKSB7XG4gICAgICBpZiAob2JqW2ldID09IHVuZGVmaW5lZCkge1xuICAgICAgICBvYmpbaV0gPSBqc29uW2ldO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHN0YW5kYXJkbGl6YXRpb24ocG9pbnQsIHIpIHtcbiAgICByID0gciB8fCAxO1xuICAgIHZhciBkaXN0YW5jZV90b19vcmlnaW4gPSBkaXN0YW5jZTNEKDAsIDAsIDAsIHBvaW50LngsIHBvaW50LnksIHBvaW50LnopO1xuICAgIHBvaW50LnggKj0gciAvIGRpc3RhbmNlX3RvX29yaWdpbjtcbiAgICBwb2ludC55ICo9IHIgLyBkaXN0YW5jZV90b19vcmlnaW47XG4gICAgcG9pbnQueiAqPSByIC8gZGlzdGFuY2VfdG9fb3JpZ2luO1xuICB9XG5cbiAgZnVuY3Rpb24gaXNfcG9pbnRfaW5zaWRlKHBvaW50LCBhLCBiKSB7XG4gICAgaWYgKHBvaW50LnggPj0gYi54ICYmIHBvaW50LnkgPj0gYi55ICYmIHBvaW50LnogPj0gYi56ICYmXG4gICAgICAgIHBvaW50LnggPCBhLnggJiYgcG9pbnQueSA8IGEueSAmJiBwb2ludC56IDwgYS56KSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGZ1bmN0aW9uIGdldF9pbnNpZGVfcG9pbnRzKHBvaW50cywgYSwgYikge1xuICAgIHZhciBjYW5kaWRhdGVzID0gW107XG4gICAgZm9yICh2YXIgaSBpbiBwb2ludHMpIHtcbiAgICAgIGlmIChpc19wb2ludF9pbnNpZGUocG9pbnRzW2ldLCBhLCBiKSkge1xuICAgICAgICBjYW5kaWRhdGVzLnB1c2gocG9pbnRzW2ldKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGNhbmRpZGF0ZXM7XG4gIH1cbiAgLypcbiAgICogc2VlIC4uL2ltYWdlcy9vY3RyZWUucG5nXG4gICAqXG4gICAqIGEueCA+IGIueFxuICAgKiBhLnkgPiBiLnlcbiAgICogYS56ID4gYi56XG4gICAqL1xuICBmdW5jdGlvbiBvY3RyZWVfY29sbGlzaW9uKGEsIGIsIHBvaW50c19hLCBwb2ludHNfYiwgcmVzLCBkZXB0aCA9IDEpIHtcbiAgICBpZiAoIXBvaW50c19hLmxlbmd0aCB8fCAhcG9pbnRzX2IubGVuZ3RoKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmIChkZXB0aCA+IDcpIHtcbiAgICAgIHJlcy5wdXNoKHtcbiAgICAgICAgcG9pbnRzX2E6IHBvaW50c19hLFxuICAgICAgICBwb2ludHNfYjogcG9pbnRzX2IsXG4gICAgICB9KTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIC8vIHJhbmRvbSBzcGxpdFxuICAgIHZhciBoYWxmID0ge1xuICAgICAgeDogKGEueCAtIGIueCkgLyAoTWF0aC5yYW5kb20oKSAqIDAuMiAtIDAuMSArIDIpLFxuICAgICAgeTogKGEueSAtIGIueSkgLyAoTWF0aC5yYW5kb20oKSAqIDAuMiAtIDAuMSArIDIpLFxuICAgICAgejogKGEueiAtIGIueikgLyAoTWF0aC5yYW5kb20oKSAqIDAuMiAtIDAuMSArIDIpLFxuICAgIH07XG4gICAgdmFyIGJfeHl6ID0ge1xuICAgICAgeDogYi54ICsgaGFsZi54LFxuICAgICAgeTogYi55ICsgaGFsZi55LFxuICAgICAgejogYi56ICsgaGFsZi56LFxuICAgIH07XG4gICAgdmFyIGJfeCA9IHtcbiAgICAgIHg6IGJfeHl6LngsXG4gICAgICB5OiBiLnksXG4gICAgICB6OiBiLnosXG4gICAgfTtcbiAgICB2YXIgYl95ID0ge1xuICAgICAgeDogYi54LFxuICAgICAgeTogYl94eXoueSxcbiAgICAgIHo6IGIueixcbiAgICB9O1xuICAgIHZhciBiX3ogPSB7XG4gICAgICB4OiBiLngsXG4gICAgICB5OiBiLnksXG4gICAgICB6OiBiX3h5ei56LFxuICAgIH07XG4gICAgdmFyIGJfeHogPSB7XG4gICAgICB4OiBiX3h5ei54LFxuICAgICAgeTogYi55LFxuICAgICAgejogYl94eXoueixcbiAgICB9O1xuICAgIHZhciBiX3h5ID0ge1xuICAgICAgeDogYl94eXoueCxcbiAgICAgIHk6IGJfeHl6LnksXG4gICAgICB6OiBiLnosXG4gICAgfTtcbiAgICB2YXIgYl95eiA9IHtcbiAgICAgIHg6IGIueCxcbiAgICAgIHk6IGJfeHl6LnksXG4gICAgICB6OiBiX3h5ei56LFxuICAgIH07XG5cbiAgICB2YXIgYV96ID0ge1xuICAgICAgeDogYS54LFxuICAgICAgeTogYS55LFxuICAgICAgejogYS56IC0gaGFsZi56LFxuICAgIH07XG4gICAgdmFyIGFfeCA9IHtcbiAgICAgIHg6IGEueCAtIGhhbGYueCxcbiAgICAgIHk6IGEueSxcbiAgICAgIHo6IGEueixcbiAgICB9O1xuICAgIHZhciBhX3kgPSB7XG4gICAgICB4OiBhLngsXG4gICAgICB5OiBhLnkgLSBoYWxmLnksXG4gICAgICB6OiBhLnosXG4gICAgfTtcbiAgICB2YXIgYV94eSA9IHtcbiAgICAgIHg6IGFfeC54LFxuICAgICAgeTogYV95LnksXG4gICAgICB6OiBhLnosXG4gICAgfTtcbiAgICB2YXIgYV95eiA9IHtcbiAgICAgIHg6IGEueCxcbiAgICAgIHk6IGFfeS55LFxuICAgICAgejogYV96LnosXG4gICAgfTtcbiAgICB2YXIgYV94eiA9IHtcbiAgICAgIHg6IGFfeC54LFxuICAgICAgeTogYS55LFxuICAgICAgejogYV96LnosXG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIHN1Yl9jb2xsaXNpb24oYSwgYikge1xuICAgICAgdmFyIGNhbmRpZGF0ZXNfYSA9IGdldF9pbnNpZGVfcG9pbnRzKHBvaW50c19hLCBhLCBiKTtcbiAgICAgIHZhciBjYW5kaWRhdGVzX2IgPSBnZXRfaW5zaWRlX3BvaW50cyhwb2ludHNfYiwgYSwgYik7XG4gICAgICByZXR1cm4gb2N0cmVlX2NvbGxpc2lvbihhLCBiLCBjYW5kaWRhdGVzX2EsIGNhbmRpZGF0ZXNfYiwgcmVzLCBkZXB0aCArIDEpO1xuICAgIH1cblxuICAgIHZhciBwYWlycyA9IFtcbiAgICAgIFthX3gsIGJfeXpdLFxuICAgICAgW2EsIGJfeHl6XSxcbiAgICAgIFthX3h5LCBiX3pdLFxuICAgICAgW2FfeSwgYl94el0sXG5cbiAgICAgIFthX3h6LCBiX3ldLFxuICAgICAgW2FfeiwgYl94eV0sXG4gICAgICBbYl94eXosIGJdLFxuICAgICAgW2FfeXosIGJfeF0sXG4gICAgXTtcblxuICAgIHZhciBmb3VuZCA9IGZhbHNlO1xuICAgIGZvciAodmFyIGkgaW4gcGFpcnMpIHtcbiAgICAgIGlmIChzdWJfY29sbGlzaW9uKHBhaXJzW2ldWzBdLCBwYWlyc1tpXVsxXSkpIHtcbiAgICAgICAgZm91bmQgPSB0cnVlO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBmb3VuZDtcbiAgfVxuXG59KHdpbmRvdyk7XG4iLCIhZnVuY3Rpb24oZ2xvYmFsKSB7XG5cbiAgdmFyIFBJID0gTWF0aC5QSTtcbiAgdmFyIHNpbiA9IE1hdGguc2luO1xuICB2YXIgY29zID0gTWF0aC5jb3M7XG4gIHZhciB0YW4gPSBNYXRoLnRhbjtcbiAgdmFyIGFjb3MgPSBNYXRoLmFjb3M7XG4gIHZhciBhdGFuID0gTWF0aC5hdGFuO1xuICB2YXIgcG93ID0gTWF0aC5wb3c7XG4gIHZhciBmbG9vciA9IE1hdGguZmxvb3I7XG4gIHZhciBzcXJ0ID0gTWF0aC5zcXJ0O1xuXG4gIHZhciBzbm90ID0ge1xuICAgIGRlYnVnOiBmYWxzZSxcbiAgICBjb250YWluZXI6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzbm90LWNvbnRhaW5lcicpLFxuICAgIGRvbTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nub3Qtd3JhcCcpLFxuXG4gICAgY2FtZXJhX2xvb2tfYXQ6IHtcbiAgICAgIHg6IDAsXG4gICAgICB5OiAwLFxuICAgICAgejogMSxcbiAgICB9LFxuICAgIGNvbnRyb2xzOiB7XG4gICAgICBzY3JlZW5fb3JpZW50YXRpb246IDAsXG4gICAgICBneXJvX2RhdGE6IHtcbiAgICAgICAgYWxwaGE6IDAsXG4gICAgICAgIGJldGE6IDkwICogUEkgLyAxODAsXG4gICAgICAgIGdhbW1hOiAwXG4gICAgICB9LFxuICAgIH0sXG4gICAgbW91c2Vfc2Vuc2l0aXZpdHk6IDAuMyxcbiAgICBhdXRvX3JvdGF0aW9uOiAwLFxuICAgIGZyYW1lczogMCxcbiAgICBiZ19yb3RhdGlvbjogWzAsIDAsIDAsIDAsIDAsIDBdLFxuXG4gICAgcGF1c2VfYW5pbWF0aW9uOiBmYWxzZSxcblxuXG4gICAgYmdfc2l6ZTogMTAyNCxcblxuICAgIGdlbmVyYXRvcjoge30sXG4gICAgZ3lybzogZmFsc2UsXG4gICAgcnk6IDAsICAgICAgICAvLyBSb3RhdGUgKiBkZWdyZWUgYXJvdW5kIHkgYXhpc1xuICAgIHJ4OiAwLCAgICAgICAgLy8gUm90YXRlICogZGVncmVlIGFyb3VuZCB4IGF4aXNcbiAgICBkZXN0X3J4OiAwLFxuICAgIGRlc3Rfcnk6IDAsXG4gICAgZGVzdF9yejogMCxcblxuICAgIG1heF9mb3Y6IDEyMCwgLy8gTWF4IGZpZWxkIG9mIHZpZXcgKGRlZ3JlZSlcbiAgICBtaW5fZm92OiA2MCwgICAvLyBNaW4gZmllbGQgb2YgdmlldyAoZGVncmVlKVxuICAgIGZvdjogOTAsICAgICAgLy8gRGVmYXVsdCBmaWVsZCBvZiB2aWV3XG4gICAgc21vb3RoOiAwLjgzLFxuICAgIG1pbl9kZXRlY3RfZGlzdGFuY2U6IDIwLFxuICAgIG9uX2NsaWNrOiBmdW5jdGlvbigpIHt9LFxuICAgIG9uX3Nwcml0ZV9jbGljazogZnVuY3Rpb24oKSB7fSxcbiAgfTtcbiAgdmFyIGNhbWVyYV9kb20gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc25vdC1jYW1lcmEnKTtcbiAgdmFyIHByZXZfZ3lybztcblxuICB2YXIgY2FtZXJhX2Jhc2VfdHJhbnNmb3JtO1xuICB2YXIgcHJldmlvdXNfcXVhdCA9IG5ldyBUSFJFRS5RdWF0ZXJuaW9uKCk7XG5cbiAgZnVuY3Rpb24gX3BvaW50U3RhbmRhcmRsaXphdGlvbih4LCB5LCB6KSB7XG4gICAgdmFyIHJhdGlvID0gMjAwIC8gZGlzdGFuY2UzRCh4LCB5LCB6LCAwLCAwLCAwKTtcbiAgICByZXR1cm4gW3ggKiByYXRpbywgeSAqIHJhdGlvLCB6ICogcmF0aW9dO1xuICB9XG5cbiAgaWYgKGdsb2JhbC5zbm90KSB7XG4gICAgZm9yICh2YXIgaSBpbiBzbm90KSB7XG4gICAgICBnbG9iYWwuc25vdFtpXSA9IHNub3RbaV07XG4gICAgfVxuICAgIHNub3QgPSBnbG9iYWwuc25vdDtcbiAgfSBlbHNlIHtcbiAgICBjb25zb2xlLmVycm9yKCdzbm90LXV0aWxzLmpzIGlzIG1pc3NpbmcnKTtcbiAgICByZXR1cm47XG4gIH1cbiAgdmFyIG1fbWFrZV9yb3RhdGlvbl9heGlzID0gc25vdC51dGlsLm1fbWFrZV9yb3RhdGlvbl9heGlzO1xuICB2YXIgbV9tdWx0aXBseSA9IHNub3QudXRpbC5tX211bHRpcGx5O1xuICB2YXIgbV9zZXRfcG9zaXRpb24gPSBzbm90LnV0aWwubV9zZXRfcG9zaXRpb247XG4gIHZhciBtX21ha2Vfcm90YXRpb25fZnJvbV9xdWF0ZXJuaW9uID0gc25vdC51dGlsLm1fbWFrZV9yb3RhdGlvbl9mcm9tX3F1YXRlcm5pb247XG4gIHZhciB2X3NldF9mcm9tX21hdHJpeF9wb3NpdGlvbiA9IHNub3QudXRpbC52X3NldF9mcm9tX21hdHJpeF9wb3NpdGlvbjtcblxuICB2YXIgdXRpbCA9IGdsb2JhbC5zbm90LnV0aWw7XG4gIHZhciBlcHNpbG9uID0gdXRpbC5lcHNpbG9uO1xuICB2YXIgZGlzdGFuY2UzRCA9IHV0aWwuZGlzdGFuY2UzRDtcbiAgdmFyIGRpc3RhbmNlMkQgPSB1dGlsLmRpc3RhbmNlMkQ7XG5cbiAgdmFyIHNldF9mb3YgPSBmdW5jdGlvbiAoZGVncmVlKSB7XG4gICAgaWYgKGRlZ3JlZSA8IHNub3QubWluX2ZvdiB8fCBkZWdyZWUgPiBzbm90Lm1heF9mb3YpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgc25vdC5mb3YgPSBkZWdyZWU7XG4gICAgc25vdC5jb250YWluZXIuc3R5bGVbJy13ZWJraXQtdHJhbnNmb3JtJ10gPSAnc2NhbGUoJyArIHRhbihzbm90Lm1heF9mb3YgLyAyICogUEkgLyAxODApIC8gdGFuKHNub3QuZm92IC8gMiAqIFBJIC8gMTgwKSArICcpJztcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlc2V0KCkge1xuICAgIHZhciBzcHJpdGVzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnc3ByaXRlJyk7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzcHJpdGVzLmxlbmd0aDsgKysgaSkge1xuICAgICAgc3ByaXRlc1tpXS5yZW1vdmUoKTtcbiAgICB9XG4gIH1cblxuICB2YXIgaW5pdCA9IGZ1bmN0aW9uKGNvbmZpZykge1xuICAgIHJlc2V0KCk7XG5cbiAgICBjYW5jZWxBbmltYXRpb25GcmFtZShzbm90Ll9hbmltYXRlSWQpO1xuXG4gICAgZm9yICh2YXIgaSBpbiBjb25maWcpIHtcbiAgICAgIGlmIChpID09ICdnZW5lcmF0b3InKSB7XG4gICAgICAgIHV0aWwubWVyZ2VfanNvbihzbm90LmdlbmVyYXRvciwgY29uZmlnLmdlbmVyYXRvcik7XG4gICAgICB9XG4gICAgICBzbm90W2ldID0gY29uZmlnW2ldO1xuICAgIH1cbiAgICBwcmV2X2d5cm8gPSBzbm90Lmd5cm87XG5cbiAgICBzbm90LmRlc3RfcnggPSBzbm90LnJ4O1xuICAgIHNub3QuZGVzdF9yeSA9IHNub3Qucnk7XG5cbiAgICBzbm90LndpZHRoID0gc25vdC5kb20ub2Zmc2V0V2lkdGg7XG4gICAgc25vdC5oZWlnaHQgPSBzbm90LmRvbS5vZmZzZXRIZWlnaHQ7XG5cbiAgICAvL2NvbXB1dGUgdGhlIG1heCBIb3Jpem9udGFsIEZpZWxkIG9mIHZpZXdcbiAgICAvL3BlcnNwZWN0aXZlPSBwcm9qZWN0aXZlU2NyZWVuV2lkdGgvMlxuICAgIC8vICAgICAgICAgICA9IHdpZHRoLzIvdGFuKG1heF9mb3YvMilcbiAgICBzbm90LnBlcnNwZWN0aXZlID0gc25vdC53aWR0aCAvIDIgLyB0YW4oc25vdC5tYXhfZm92IC8gMiAqIFBJIC8gMTgwKTtcblxuICAgIHNub3QuY29udGFpbmVyLnN0eWxlWyctd2Via2l0LXBlcnNwZWN0aXZlJ10gPSBzbm90LnBlcnNwZWN0aXZlICsgJ3B4JztcblxuICAgIC8vY2FtZXJhIG9mZnNldFxuICAgIC8vIFogaXMgZGVwdGgoZnJvbnQpIFkgaXMgaGVpZ2h0IFggaXMgcmlnaHRcbiAgICAvL1xuICAgIC8vIHRyYW5zbGF0ZVogc2V0Rk9WXG4gICAgLy8gcm90YXRlWCByb3RhdGUgYXJvdW5kIFggYXhpc1xuICAgIC8vIHJvdGF0ZVkgcm90YXRlIGFyb3VuZCBZIGF4aXNcbiAgICAvLyB0cmFuc2xhdGVYIHRyYW5zbGF0ZSB0aGUgQ2FtZXJhIHRvIGNlbnRlclxuICAgIC8vIHRyYW5zbGF0ZVlcbiAgICBjYW1lcmFfYmFzZV90cmFuc2Zvcm0gPSAndHJhbnNsYXRlWCgnICsgZXBzaWxvbigtIChzbm90LmJnX3NpemUgLSBzbm90LndpZHRoKSAvIDIpICsgJ3B4KSB0cmFuc2xhdGVZKCcgKyBlcHNpbG9uKC0gKHNub3QuYmdfc2l6ZSAtIHNub3QuaGVpZ2h0KSAvIDIpICsgJ3B4KSc7XG4gICAgY2FtZXJhX2RvbS5zdHlsZVsnLXdlYmtpdC10cmFuc2Zvcm0nXSA9ICd0cmFuc2xhdGVaKC0nICsgc25vdC5wZXJzcGVjdGl2ZSArICdweCkgcm90YXRlWSgnICsgZXBzaWxvbihzbm90LnJ4KSArICdkZWcpIHJvdGF0ZVgoJyArIGVwc2lsb24oc25vdC5yeSkgKyAnZGVnKScgKyBjYW1lcmFfYmFzZV90cmFuc2Zvcm07XG5cbiAgICBzZXRfZm92KHNub3QuZm92KTtcblxuICAgIGlmIChjb25maWcuYmdfaW1ncykge1xuICAgICAgbG9hZF9iZ19pbWdzKGNvbmZpZy5iZ19pbWdzLCBjb25maWcuYmdfcm90YXRpb24gfHwgc25vdC5iZ19yb3RhdGlvbik7XG4gICAgfVxuXG4gICAgaWYgKGNvbmZpZykge1xuICAgICAgbG9hZF9zcHJpdGVzKGNvbmZpZy5zcHJpdGVzKTtcbiAgICB9XG5cbiAgICBpZiAodXRpbC5pc19tb2JpbGUoKSkge1xuICAgIH1cblxuICAgIGlmIChjb25maWcuY2FsbGJhY2spIHtcbiAgICAgIGNvbmZpZy5jYWxsYmFjaygpO1xuICAgIH1cbiAgICBzbm90LmluaXRfY29udHJvbHMoKTtcbiAgICB1cGRhdGUoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGxvYWRfYmdfaW1ncyhiZ19pbWdzLCBiZ19yb3RhdGlvbikge1xuICAgIHZhciBiZ19jb25maWcgPSB7XG4gICAgICBmcm9udCA6ICdyb3RhdGVZKDkwZGVnKScgKyAnICAgICAgICAgICAgICAgIHJvdGF0ZVooJyArIGJnX3JvdGF0aW9uWzBdICsgJ2RlZykgIHRyYW5zbGF0ZVooLScgKyAoc25vdC5iZ19zaXplIC8gMikgKyAncHgpJyxcbiAgICAgIGJvdHRvbTogJ3JvdGF0ZVkoOTBkZWcpJyArICdyb3RhdGVYKDkwZGVnKSAgcm90YXRlWignICsgYmdfcm90YXRpb25bMV0gKyAnZGVnKSAgdHJhbnNsYXRlWigtJyArIChzbm90LmJnX3NpemUgLyAyKSArICdweCkgcm90YXRlWig5MGRlZyknLFxuICAgICAgbGVmdCAgOiAncm90YXRlWSg5MGRlZyknICsgJ3JvdGF0ZVkoOTBkZWcpICByb3RhdGVaKCcgKyBiZ19yb3RhdGlvblsyXSArICdkZWcpICB0cmFuc2xhdGVaKC0nICsgKHNub3QuYmdfc2l6ZSAvIDIpICsgJ3B4KScsXG4gICAgICBiYWNrICA6ICdyb3RhdGVZKDkwZGVnKScgKyAncm90YXRlWSgxODBkZWcpIHJvdGF0ZVooJyArIGJnX3JvdGF0aW9uWzNdICsgJ2RlZykgIHRyYW5zbGF0ZVooLScgKyAoc25vdC5iZ19zaXplIC8gMikgKyAncHgpJyxcbiAgICAgIHRvcCAgIDogJ3JvdGF0ZVkoOTBkZWcpJyArICdyb3RhdGVYKC05MGRlZykgcm90YXRlWignICsgYmdfcm90YXRpb25bNF0gKyAnZGVnKSAgdHJhbnNsYXRlWigtJyArIChzbm90LmJnX3NpemUgLyAyKSArICdweCkgcm90YXRlWigtOTBkZWcpJyxcbiAgICAgIHJpZ2h0IDogJ3JvdGF0ZVkoOTBkZWcpJyArICdyb3RhdGVZKC05MGRlZykgcm90YXRlWignICsgYmdfcm90YXRpb25bNV0gKyAnZGVnKSAgdHJhbnNsYXRlWigtJyArIChzbm90LmJnX3NpemUgLyAyKSArICdweCknXG4gICAgfTtcblxuICAgIHZhciBiZ19kb207XG4gICAgdmFyIGNvdW50ID0gMDtcbiAgICBmb3IgKHZhciBpIGluIGJnX2NvbmZpZykge1xuICAgICAgYmdfZG9tID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnc25vdC1iZyAnICsgaSlbMF07XG4gICAgICBiZ19kb20uc3R5bGVbJy13ZWJraXQtdHJhbnNmb3JtJ10gPSBiZ19jb25maWdbaV07XG4gICAgICBiZ19kb20uc3R5bGVbJ3dpZHRoJ10gPSBzbm90LmJnX3NpemUgKyAyICsgJ3B4JzsgICAgICAgIC8vIDIgbW9yZSBwaXhlbHMgZm9yIG92ZXJsYXBwaW5nIGdhcHMgKCBjaHJvbWUncyBidWcgKVxuICAgICAgYmdfZG9tLnN0eWxlWydoZWlnaHQnXSA9IHNub3QuYmdfc2l6ZSArIDIgKyAncHgnOyAgICAgICAvLyAyIG1vcmUgcGl4ZWxzIGZvciBvdmVybGFwcGluZyBnYXBzICggY2hyb21lJ3MgYnVnIClcblxuICAgICAgYmdfZG9tLnNldEF0dHJpYnV0ZSgnc3JjJywgYmdfaW1nc1tjb3VudF0pO1xuICAgICAgYmdfZG9tLnNldEF0dHJpYnV0ZSgnZGF0YS1pbmRleCcsIGNvdW50KTtcbiAgICAgICsrY291bnQ7XG4gICAgfVxuICB9XG5cbiAgdmFyIGxvYWRfc3ByaXRlcyA9IGZ1bmN0aW9uKHNwcml0ZXMpIHtcbiAgICBmb3IgKHZhciBpIGluIHNwcml0ZXMpIHtcbiAgICAgIHZhciB0ID0gc3ByaXRlc1tpXTtcbiAgICAgIGlmICh0LnN0YW5kYXJkbGl6YXRpb24pIHtcbiAgICAgICAgdmFyIHN0YW5kYXJkID0gX3BvaW50U3RhbmRhcmRsaXphdGlvbih0LngsdC55LHQueik7XG4gICAgICAgIHQueD1zdGFuZGFyZFswXTtcbiAgICAgICAgdC55PXN0YW5kYXJkWzFdO1xuICAgICAgICB0Lno9c3RhbmRhcmRbMl07XG4gICAgICB9XG5cbiAgICAgIHZhciB0ZW1wX3dyYXBwZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgIHRlbXBfd3JhcHBlci5pbm5lckhUTUwgPSB0ZW1wbGF0ZShzbm90LmdlbmVyYXRvclt0LmdlbmVyYXRvcl0sIHQpO1xuICAgICAgdmFyIGVsZW1lbnQgPSB0ZW1wX3dyYXBwZXIuZmlyc3RDaGlsZDtcbiAgICAgIGVsZW1lbnQuZGF0YSA9IHNwcml0ZXNbaV07XG4gICAgICBhZGRfc3ByaXRlX2J5X3Bvc2l0aW9uKGVsZW1lbnQsIHQpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGFkZF9zcHJpdGVfYnlfcG9zaXRpb24oZWxlbWVudCwgcCkge1xuXG4gICAgdmFyIHggPSAtIHAueDtcbiAgICB2YXIgeiA9IC0gcC56O1xuICAgIHZhciB5ID0gLSBwLnk7XG5cbiAgICB2YXIgc3ByaXRlQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgc3ByaXRlQ29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSAnaW5saW5lLWJsb2NrJztcbiAgICBzcHJpdGVDb250YWluZXIuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnO1xuICAgIHNwcml0ZUNvbnRhaW5lci5jbGFzc05hbWUgPSAnc3ByaXRlLWNvbnRhaW5lcic7XG4gICAgc3ByaXRlQ29udGFpbmVyLmlkID0gZWxlbWVudC5kYXRhLmlkO1xuXG4gICAgc3ByaXRlQ29udGFpbmVyLnN0eWxlWyctd2Via2l0LXRyYW5zZm9ybS1vcmlnaW4teCddID0gJzAnO1xuICAgIHNwcml0ZUNvbnRhaW5lci5zdHlsZVsnLXdlYmtpdC10cmFuc2Zvcm0tb3JpZ2luLXknXSA9ICcwJztcblxuICAgIHZhciBhcmMgPSB4ID09IDAgJiYgeiA9PSAwID8gMCA6IGFjb3MoIHogLyBwb3coeCAqIHggKyB6ICogeiwgMC41KSk7XG5cbiAgICBhcmMgPSB4IDwgMCA/IDIgKiBQSSAtIGFyYyA6IGFyYztcbiAgICBhcmMgPSBhcmMgKiAxODAgLyBQSTtcblxuICAgIHZhciByID0gZGlzdGFuY2UzRCh4LCB5LCB6LCAwLCAwLCAwKTtcbiAgICB4ICs9IHNub3QuYmdfc2l6ZSAvIDI7XG4gICAgeSArPSBzbm90LmJnX3NpemUgLyAyO1xuXG4gICAgc3ByaXRlQ29udGFpbmVyLnN0eWxlWyctd2Via2l0LXRyYW5zZm9ybSddID0gJ3RyYW5zbGF0ZTNkKCcgKyBlcHNpbG9uKHgpICsgJ3B4LCcgKyBlcHNpbG9uKHkpICsgJ3B4LCcgKyBlcHNpbG9uKHopICsgJ3B4KSByb3RhdGVZKCcgKyBlcHNpbG9uKGFyYykgKyAnZGVnKSByb3RhdGVYKCcgKyBlcHNpbG9uKC0gKHkgLSBzbm90LmJnX3NpemUgLyAyKSAvIHIgKiA5MCkrJ2RlZykgcm90YXRlWSgxODBkZWcpJztcblxuICAgIHZhciBzcHJpdGVXcmFwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgc3ByaXRlV3JhcC5jbGFzc05hbWU9J3Nwcml0ZS13cmFwJztcbiAgICBzcHJpdGVXcmFwLmFwcGVuZENoaWxkKGVsZW1lbnQpO1xuICAgIHNwcml0ZVdyYXAuc2V0QXR0cmlidXRlKCdkYXRhLXZpc2libGUnLCBlbGVtZW50LmRhdGEudmlzaWJsZSA9PSBmYWxzZSA/IGZhbHNlIDogdHJ1ZSk7XG5cbiAgICBzcHJpdGVDb250YWluZXIuYXBwZW5kQ2hpbGQoc3ByaXRlV3JhcCk7XG4gICAgY2FtZXJhX2RvbS5hcHBlbmRDaGlsZChzcHJpdGVDb250YWluZXIpO1xuICB9XG5cbiAgdmFyIHVwZGF0ZV9zcHJpdGVfdmlzaWJpbGl0eSA9IGZ1bmN0aW9uKGlkKSB7XG4gICAgdmFyIHZpc2libGUgPSBzbm90LnNwcml0ZXNbaWRdLnZpc2libGU7XG4gICAgdmFyIHNwcml0ZUNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTtcbiAgICBzcHJpdGVDb250YWluZXIuZmlyc3RDaGlsZC5zZXRBdHRyaWJ1dGUoJ2RhdGEtdmlzaWJsZScsIHZpc2libGUgPyB0cnVlIDogZmFsc2UpO1xuICB9XG5cbiAgdmFyIHVwZGF0ZV9zcHJpdGVfcG9zaXRpb24gPSBmdW5jdGlvbihpZCkge1xuICAgIHZhciB4ID0gc25vdC5zcHJpdGVzW2lkXS54O1xuICAgIHZhciB5ID0gc25vdC5zcHJpdGVzW2lkXS55O1xuICAgIHZhciB6ID0gc25vdC5zcHJpdGVzW2lkXS56O1xuICAgIHo9LXo7XG4gICAgeT0teTtcbiAgICB2YXIgYXJjID0geCA9PSAwICYmIHogPT0gMCA/IDAgOiBhY29zKCB6IC8gcG93KHggKiB4ICsgeiAqIHosIDAuNSkpO1xuXG4gICAgYXJjID0geCA8IDAgPyAyICogUEkgLSBhcmMgOiBhcmM7XG4gICAgYXJjID0gYXJjICogMTgwLyBQSTtcblxuICAgIHZhciByID0gZGlzdGFuY2UzRCh4LCB5LCB6LCAwLCAwLCAwKTtcbiAgICB4ICs9IHNub3QuYmdfc2l6ZSAvIDI7XG4gICAgeSArPSBzbm90LmJnX3NpemUgLyAyO1xuXG4gICAgdmFyIHNwcml0ZUNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTtcblxuICAgIHNwcml0ZUNvbnRhaW5lci5zdHlsZVsnLXdlYmtpdC10cmFuc2Zvcm0nXSA9ICd0cmFuc2xhdGUzZCgnICsgZXBzaWxvbih4KSArICdweCwnICsgZXBzaWxvbih5KSArICdweCwnICsgZXBzaWxvbih6KSArICdweCkgcm90YXRlWSgnICsgZXBzaWxvbihhcmMpICsgJ2RlZykgcm90YXRlWCgnICsgZXBzaWxvbigtICh5IC0gc25vdC5iZ19zaXplIC8gMikgLyByICogOTApICsgJ2RlZykgcm90YXRlWSgxODBkZWcpJztcbiAgfVxuXG4gIGZ1bmN0aW9uIHJ1bigpIHtcbiAgICBzbm90Ll9hbmltYXRlSWQgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUocnVuKTtcbiAgICBpZiAoIXNub3QucGF1c2VfYW5pbWF0aW9uKSB7XG4gICAgICB1cGRhdGUoKTtcbiAgICB9XG4gIH1cblxuICB2YXIgY2FtZXJhX2V1bGVyID0gbmV3IFRIUkVFLkV1bGVyKCk7XG4gIHZhciB0YXJnZXRfcXVhdCA9IG5ldyBUSFJFRS5RdWF0ZXJuaW9uKCk7XG4gIHZhciByb3RhdGVfOTBfcXVhdCA9IG5ldyBUSFJFRS5RdWF0ZXJuaW9uKC0gc3FydCggMC41ICksIDAsIDAsIHNxcnQoIDAuNSApKVxuICB2YXIgYWRqdXN0X3NjcmVlbl9xdWF0cyA9IHtcbiAgICAwOiBuZXcgVEhSRUUuUXVhdGVybmlvbigpLnNldEZyb21BeGlzQW5nbGUobmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgMSksIDApLFxuICAgIDkwOiBuZXcgVEhSRUUuUXVhdGVybmlvbigpLnNldEZyb21BeGlzQW5nbGUobmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgMSksIC0gOTApLFxuICAgIDE4MDogbmV3IFRIUkVFLlF1YXRlcm5pb24oKS5zZXRGcm9tQXhpc0FuZ2xlKG5ldyBUSFJFRS5WZWN0b3IzKDAsIDAsIDEpLCAtIDE4MCksXG4gICAgJy05MCc6IG5ldyBUSFJFRS5RdWF0ZXJuaW9uKCkuc2V0RnJvbUF4aXNBbmdsZShuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAxKSwgOTApLFxuICB9O1xuICB2YXIgbG9va19hdF9ldWxlciA9IG5ldyBUSFJFRS5FdWxlcigpO1xuXG4gIGZ1bmN0aW9uIHVwZGF0ZV9jYW1lcmEoeCwgeSwgeikge1xuXG4gICAgY2FtZXJhX2V1bGVyLnNldCh5LCB4LCB6LCAnWVhaJyk7IC8vICdaWFknIGZvciB0aGUgZGV2aWNlLCBidXQgJ1lYWicgZm9yIHVzXG5cbiAgICB0YXJnZXRfcXVhdC5zZXRGcm9tRXVsZXIoY2FtZXJhX2V1bGVyKTsgLy8gb3JpZW50IHRoZSBkZXZpY2VcblxuICAgIHRhcmdldF9xdWF0Lm11bHRpcGx5KHJvdGF0ZV85MF9xdWF0KTsgLy8gY2FtZXJhIGxvb2tzIG91dCB0aGUgYmFjayBvZiB0aGUgZGV2aWNlLCBub3QgdGhlIHRvcFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gLSBQSS8yIGFyb3VuZCB0aGUgeC1heGlzXG4gICAgdGFyZ2V0X3F1YXQubXVsdGlwbHkoYWRqdXN0X3NjcmVlbl9xdWF0c1tzbm90LmNvbnRyb2xzLnNjcmVlbl9vcmllbnRhdGlvbl0pOyAvLyBhZGp1c3QgZm9yIHNjcmVlbiBvcmllbnRhdGlvblxuXG4gICAgdmFyIHNsZXJwX3F1YXQgPSBuZXcgVEhSRUUuUXVhdGVybmlvbigpO1xuICAgIFRIUkVFLlF1YXRlcm5pb24uc2xlcnAodGFyZ2V0X3F1YXQsIHByZXZpb3VzX3F1YXQsIHNsZXJwX3F1YXQsIHNub3Quc21vb3RoKTtcbiAgICBwcmV2aW91c19xdWF0ID0gc2xlcnBfcXVhdDtcbiAgICB2YXIgbG9va19hdF9xdWF0ID0gc2xlcnBfcXVhdC5jbG9uZSgpO1xuICAgIGxvb2tfYXRfcXVhdC54ICo9IC0xO1xuICAgIGxvb2tfYXRfcXVhdC56ICo9IC0xO1xuICAgIHZhciBsb29rX2F0X21hdCA9IG1fbWFrZV9yb3RhdGlvbl9mcm9tX3F1YXRlcm5pb24obG9va19hdF9xdWF0Lm5vcm1hbGl6ZSgpKS50cmFuc3Bvc2UoKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxvb2tfYXRfbWF0LmVsZW1lbnRzLmxlbmd0aDsgKytpKSB7XG4gICAgICBsb29rX2F0X21hdC5lbGVtZW50c1tpXSA9IGVwc2lsb24obG9va19hdF9tYXQuZWxlbWVudHNbaV0pO1xuICAgIH1cbiAgICB2YXIgbG9va19hdF9yb3QgPSBsb29rX2F0X2V1bGVyLnNldEZyb21Sb3RhdGlvbk1hdHJpeChsb29rX2F0X21hdCwgJ1haWScpO1xuXG4gICAgc25vdC5yeCA9IGxvb2tfYXRfcm90Ll94ICogMTgwIC8gUEk7XG4gICAgc25vdC5yeSA9IC0gbG9va19hdF9yb3QuX3kgKiAxODAgLyBQSTtcbiAgICBzbm90LnJ6ID0gbG9va19hdF9yb3QuX3ogKiAxODAgLyBQSTtcblxuICAgIHNub3QuY2FtZXJhX2xvb2tfYXQgPSB2X3NldF9mcm9tX21hdHJpeF9wb3NpdGlvbihtX211bHRpcGx5KFxuICAgICAgbV9tYWtlX3JvdGF0aW9uX2F4aXMoe3g6IDAsIHk6IDEsIHo6IDB9LCBsb29rX2F0X3JvdC5feSksXG4gICAgICBtX21ha2Vfcm90YXRpb25fYXhpcyh7eDogMCwgeTogMCwgejogMX0sIGxvb2tfYXRfcm90Ll96KSxcbiAgICAgIG1fbWFrZV9yb3RhdGlvbl9heGlzKHt4OiAxLCB5OiAwLCB6OiAwfSwgLSBsb29rX2F0X3JvdC5feCksXG4gICAgICBtX3NldF9wb3NpdGlvbih7eDogMCwgeTogMCwgejogMX0pXG4gICAgKSk7IC8vIGJhZCBwZXJmb3JtYW5jZSBoZXJlXG5cbiAgICBjYW1lcmFfZG9tLnN0eWxlLnRyYW5zZm9ybSA9ICd0cmFuc2xhdGVaKCcgKyBlcHNpbG9uKHNub3QucGVyc3BlY3RpdmUpICsgJ3B4KScgKyBcIiBtYXRyaXgzZChcIiArIGxvb2tfYXRfbWF0LmVsZW1lbnRzICsgXCIpXCIrIGNhbWVyYV9iYXNlX3RyYW5zZm9ybTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHVwZGF0ZSgpIHtcbiAgICBzbm90LmZyYW1lcysrO1xuXG4gICAgaWYgKHNub3QuZ3lybykge1xuICAgICAgaWYgKHNub3QuY29udHJvbHMuZ3lyb19kYXRhLmFscGhhID09PSAtMSAmJiBzbm90LmNvbnRyb2xzLmd5cm9fZGF0YS5iZXRhID09PSAtMSAmJiBzbm90LmNvbnRyb2xzLmd5cm9fZGF0YS5nYW1tYSA9PT0gLSAxKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdXBkYXRlX2NhbWVyYShzbm90LmNvbnRyb2xzLmd5cm9fZGF0YS5hbHBoYSwgc25vdC5jb250cm9scy5neXJvX2RhdGEuYmV0YSwgLSBzbm90LmNvbnRyb2xzLmd5cm9fZGF0YS5nYW1tYSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChwcmV2X2d5cm8pIHtcbiAgICAgICAgc25vdC5kZXN0X3J4ID0gMDtcbiAgICAgICAgc25vdC5kZXN0X3J5ID0gMDtcbiAgICAgIH1cbiAgICAgIHNub3QuZGVzdF9yeSAtPSBzbm90LmF1dG9fcm90YXRpb247XG4gICAgICB1cGRhdGVfY2FtZXJhKC0gc25vdC5kZXN0X3J5ICogUEkgLyAxODAsIHNub3QuZGVzdF9yeCAqIFBJIC8gMTgwICsgUEkvMiwgMCk7XG4gICAgfVxuICAgIHByZXZfZ3lybyA9IHNub3QuZ3lybztcblxuICAgIGZvciAodmFyIGkgaW4gc25vdC5zcHJpdGVzKSB7XG4gICAgICB2YXIgc3ByaXRlID0gc25vdC5zcHJpdGVzW2ldO1xuICAgICAgaWYgKHNwcml0ZS5uZWVkX3VwZGF0ZV9wb3NpdGlvbikge1xuICAgICAgICBzcHJpdGUubmVlZF91cGRhdGVfcG9zaXRpb24gPSBmYWxzZTtcbiAgICAgICAgdXBkYXRlX3Nwcml0ZV9wb3NpdGlvbihzcHJpdGUuaWQpO1xuICAgICAgfVxuICAgICAgaWYgKHNwcml0ZS5uZWVkX3VwZGF0ZV92aXNpYmlsaXR5KSB7XG4gICAgICAgIHNwcml0ZS5uZWVkX3VwZGF0ZV92aXNpYmlsaXR5ID0gZmFsc2U7XG4gICAgICAgIHVwZGF0ZV9zcHJpdGVfdmlzaWJpbGl0eShzcHJpdGUuaWQpO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoc25vdC5kZWJ1Zykge1xuICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZ2dlcicpLmlubmVySFRNTCA9ICdyeDonICsgcGFyc2VJbnQoc25vdC5yeCkgKyAnICcgK1xuICAgICAgICAgICAgICAgICAgICAgICAgJ3J5OicgKyBwYXJzZUludChzbm90LnJ5KSArICcgJyArXG4gICAgICAgICAgICAgICAgICAgICAgICAncno6JyArIHBhcnNlSW50KHNub3QucnopO1xuICAgIH1cbiAgfVxuXG5cbiAgc25vdC5jb250cm9scy5tb3VzZV9jbGljayA9IGZ1bmN0aW9uKHgsIHkpIHtcbiAgICB2YXIgUiA9IDEwMDtcbiAgICB2YXIgZm92ID0gc25vdC5mb3Y7XG4gICAgdmFyIGJnX3NpemUgPSBzbm90LmJnX3NpemU7XG4gICAgdmFyIGFyY0ZhY3RvciA9IE1hdGguUEkgLyAxODA7XG4gICAgdmFyIHJ6ID0gc25vdC5yeiAqIGFyY0ZhY3RvcjtcbiAgICB2YXIgd2lkdGggPSBzbm90LndpZHRoO1xuICAgIHZhciBoZWlnaHQgPSBzbm90LmhlaWdodDtcblxuICAgIHZhciByeSA9ICh4IC8gd2lkdGggLSAwLjUpICogZm92O1xuICAgIHZhciByeCA9ICh5IC8gaGVpZ2h0LTAuNSkgKiBmb3YgKiBoZWlnaHQgLyB3aWR0aDtcbiAgICB2YXIgciA9IGNvcyhmb3YgLyAyICogYXJjRmFjdG9yKSAqIGJnX3NpemU7XG4gICAgdmFyIHJhdGlveCA9ICh4IC0gd2lkdGggLyAyKSAvIHdpZHRoICogMjtcbiAgICB2YXIgcmF0aW95ID0gKHkgLSBoZWlnaHQgLyAyKSAvIHdpZHRoICogMjtcbiAgICB2YXIgUCA9IHNpbihmb3YgLyAyICogYXJjRmFjdG9yKSAqIGJnX3NpemU7XG5cbiAgICByeSA9IGF0YW4ocmF0aW94ICogUCAvIHIpO1xuICAgIHJ4ID0gYXRhbihyYXRpb3kgKiBQIC8gcik7XG5cbiAgICByeSAqPSAxODAgLyBQSTtcbiAgICByeCAqPSAxODAgLyBQSTtcblxuICAgIHZhciB4eXoyID0gdXRpbC5yb3RhdGlvbl90b19wb3NpdGlvbihSLCByeCwgMCk7XG5cbiAgICB2YXIgcnIgPSBkaXN0YW5jZTNEKC0gdGFuKHJ5ICogYXJjRmFjdG9yKSAqIHh5ejJbMl0sIC0geHl6MlsxXSwgeHl6MlsyXSwgMCwgMCwgMCk7XG4gICAgdmFyIHJhdGlvID0gUiAvIHJyO1xuXG4gICAgdmFyIG5ld194ID0gLSB0YW4ocnkgKiBQSSAvIDE4MCkgKiB4eXoyWzJdICogcmF0aW87XG4gICAgdmFyIG5ld195ID0gLSB4eXoyWzFdICogcmF0aW87XG4gICAgdmFyIG5ld196ID0geHl6MlsyXSAqIHJhdGlvO1xuXG4gICAgdmFyIHBvcyA9IHZfc2V0X2Zyb21fbWF0cml4X3Bvc2l0aW9uKG1fbXVsdGlwbHkoXG4gICAgICBtX21ha2Vfcm90YXRpb25fYXhpcyh7eDogMCwgeTogMSwgejogMH0sIHNub3QucnkgKiBQSSAvIDE4MCksXG4gICAgICBtX21ha2Vfcm90YXRpb25fYXhpcyh7eDogMCwgeTogMCwgejogMX0sIC0gc25vdC5yeiAqIFBJIC8gMTgwKSxcbiAgICAgIG1fbWFrZV9yb3RhdGlvbl9heGlzKHt4OiAxLCB5OiAwLCB6OiAwfSwgLSBzbm90LnJ4ICogUEkgLyAxODApLFxuICAgICAgbV9zZXRfcG9zaXRpb24oe3g6IG5ld194LCB5OiBuZXdfeSwgejogbmV3X3p9KVxuICAgICkpO1xuXG4gICAgYXggPSBwb3MueDtcbiAgICBheSA9IHBvcy55O1xuICAgIGF6ID0gcG9zLno7XG5cbiAgICB2YXIgbWluX29mZnNldCA9IDAuNDtcbiAgICB2YXIgbWluX2Rpc3RhbmNlID0gc25vdC5taW5fZGV0ZWN0X2Rpc3RhbmNlO1xuICAgIHZhciBuZWFyZXN0O1xuXG4gICAgdmFyIHNwcml0ZUNvbnRhaW5lcnMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdzcHJpdGUtY29udGFpbmVyJyk7XG4gICAgZm9yICh2YXIgaSA9IDAgO2kgPCBzcHJpdGVDb250YWluZXJzLmxlbmd0aDsgKytpKSB7XG4gICAgICB2YXIgc2VsZiA9IHNwcml0ZUNvbnRhaW5lcnNbaV07XG4gICAgICB2YXIgbWF0cml4ID0gdXRpbC5jc3NfdGV4dF90b19tYXRyaXgoc2VsZi5zdHlsZS53ZWJraXRUcmFuc2Zvcm0pO1xuICAgICAgdmFyIHJhdGVfID0gMTAwIC8gZGlzdGFuY2UzRCgwLCAwLCAwLCBzbm90LmJnX3NpemUgLyAyIC0gbWF0cml4WzEyXSwgbWF0cml4WzEzXSAtIHNub3QuYmdfc2l6ZSAvIDIsIC0gbWF0cml4WzE0XSk7XG5cbiAgICAgIHZhciBkaXN0YW5jZSA9IGRpc3RhbmNlM0QoYXgsIC0gYXksIGF6LCAoc25vdC5iZ19zaXplIC8gMiAtIG1hdHJpeFsxMl0pICogcmF0ZV8sIHJhdGVfICogKG1hdHJpeFsxM10gLSBzbm90LmJnX3NpemUgLyAyKSwgcmF0ZV8gKiAoIC0gbWF0cml4WzE0XSkpO1xuICAgICAgaWYgKGRpc3RhbmNlIDwgbWluX2Rpc3RhbmNlKSB7XG4gICAgICAgIG1pbl9kaXN0YW5jZSA9IGRpc3RhbmNlO1xuICAgICAgICBuZWFyZXN0ID0gc2VsZi5jaGlsZHJlblswXTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB2YXIgcm90YXRpb24gPSB1dGlsLnBvc2l0aW9uX3RvX3JvdGF0aW9uKGF4LCBheiwgYXkpO1xuICAgIGlmIChuZWFyZXN0KSB7XG4gICAgICBzbm90Lm9uX3Nwcml0ZV9jbGljayhzbm90LnNwcml0ZXNbbmVhcmVzdC5wYXJlbnRFbGVtZW50LmlkXSwgbmVhcmVzdCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNub3Qub25fY2xpY2soe1xuICAgICAgICB4OiBheCxcbiAgICAgICAgeTogYXksXG4gICAgICAgIHo6IGF6LFxuICAgICAgfSwge1xuICAgICAgICByeDogcm90YXRpb25bMF0sXG4gICAgICAgIHJ5OiByb3RhdGlvblsxXVxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgdXRpbC5tZXJnZV9qc29uKHNub3QsIHtcbiAgICBzZXRfZm92OiBzZXRfZm92LFxuICAgIGluaXQ6IGluaXQsXG4gICAgcnVuOiBydW4sXG4gICAgdXBkYXRlOiB1cGRhdGUsXG4gICAgbG9hZF9zcHJpdGVzOiBsb2FkX3Nwcml0ZXMsXG4gIH0pO1xufSh3aW5kb3cpO1xuIiwiIWZ1bmN0aW9uKGdsb2JhbCkge1xuXG4gIHZhciBkb21fb2Zmc2V0X3RvcDtcbiAgdmFyIGRvbV9vZmZzZXRfbGVmdDtcbiAgc25vdC5pbml0X2NvbnRyb2xzID0gZnVuY3Rpb24oKSB7XG5cbiAgICBkb21fb2Zmc2V0X2xlZnQgPSB1dGlsLmxlZnRfcG9zKHNub3QuZG9tKTtcbiAgICBkb21fb2Zmc2V0X3RvcCA9IHV0aWwudG9wX3Bvcyhzbm90LmRvbSk7XG4gICAgc25vdC5jb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIG1vdXNlX2Rvd24sIGZhbHNlKTtcbiAgICBzbm90LmNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnICwgbW91c2VfbW92ZSwgZmFsc2UpO1xuICAgIHNub3QuY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJyAgLCBtb3VzZV91cCAgLCBmYWxzZSk7XG5cbiAgICBzbm90LmNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nICwgbW91c2VfZG93biAsIGZhbHNlKTtcbiAgICBzbm90LmNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnICwgbW91c2VfbW92ZSAsIGZhbHNlKTtcbiAgICBzbm90LmNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJyAgICwgbW91c2VfdXAgICAsIGZhbHNlKTtcbiAgICBzbm90LmNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXdoZWVsJywgbW91c2Vfd2hlZWwsIGZhbHNlKTtcblxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdvcmllbnRhdGlvbmNoYW5nZScsIGZ1bmN0aW9uKGV2KSB7XG4gICAgICBzbm90LmNvbnRyb2xzLnNjcmVlbl9vcmllbnRhdGlvbiA9IHdpbmRvdy5vcmllbnRhdGlvbiB8fCAwO1xuICAgIH0sIGZhbHNlKTtcblxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdkZXZpY2VvcmllbnRhdGlvbicsIGZ1bmN0aW9uKGV2KSB7XG4gICAgICBpZiAoZXYuYWxwaGEgIT09IG51bGwpIHtcbiAgICAgICAgc25vdC5jb250cm9scy5neXJvX2RhdGEuYmV0YSA9IGV2LmJldGEgICogTWF0aC5QSSAvIDE4MCA7XG4gICAgICAgIHNub3QuY29udHJvbHMuZ3lyb19kYXRhLmdhbW1hID0gZXYuZ2FtbWEgICogTWF0aC5QSSAvIDE4MDtcbiAgICAgICAgc25vdC5jb250cm9scy5neXJvX2RhdGEuYWxwaGEgPSBldi5hbHBoYSAgKiBNYXRoLlBJIC8gMTgwO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc25vdC5jb250cm9scy5neXJvX2RhdGEuYmV0YSA9IHNub3QuY29udHJvbHMuZ3lyb19kYXRhLmdhbW1hID0gc25vdC5jb250cm9scy5neXJvX2RhdGEuYWxwaGEgPSAtMTtcbiAgICAgIH1cbiAgICB9LCB0cnVlKTtcbiAgfVxuXG4gIHZhciB1dGlsID0gc25vdC51dGlsO1xuICB2YXIgZGlzdGFuY2UzRCA9IHV0aWwuZGlzdGFuY2UzRDtcbiAgdmFyIGRpc3RhbmNlMkQgPSB1dGlsLmRpc3RhbmNlMkQ7XG4gIHZhciBmbG9vciA9IE1hdGguZmxvb3I7XG4gIHZhciBjb3MgPSBNYXRoLmNvcztcbiAgdmFyIHNpbiA9IE1hdGguc2luO1xuICB2YXIgYXRhbiA9IE1hdGguYXRhbjtcbiAgdmFyIHRhbiA9IE1hdGgudGFuO1xuICB2YXIgUEkgPSBNYXRoLlBJO1xuXG4gIHZhciBtX21ha2Vfcm90YXRpb25fYXhpcyA9IHNub3QudXRpbC5tX21ha2Vfcm90YXRpb25fYXhpcztcbiAgdmFyIG1fbXVsdGlwbHkgPSBzbm90LnV0aWwubV9tdWx0aXBseTtcbiAgdmFyIG1fc2V0X3Bvc2l0aW9uID0gc25vdC51dGlsLm1fc2V0X3Bvc2l0aW9uO1xuICB2YXIgbV9tYWtlX3JvdGF0aW9uX2Zyb21fcXVhdGVybmlvbiA9IHNub3QudXRpbC5tX21ha2Vfcm90YXRpb25fZnJvbV9xdWF0ZXJuaW9uO1xuICB2YXIgdl9zZXRfZnJvbV9tYXRyaXhfcG9zaXRpb24gPSBzbm90LnV0aWwudl9zZXRfZnJvbV9tYXRyaXhfcG9zaXRpb247XG5cbiAgdmFyIHRvdWNoZXMgPSB7XG4gICAgZng6IDAsICAgLy8gRmlyc3QgIGZpbmdlciB4XG4gICAgZnk6IDAsICAgLy8gRmlyc3QgIGZpbmdlciB5XG4gICAgc3g6IDAsICAgLy8gU2Vjb25kIGZpbmdlciB4XG4gICAgc3k6IDAgICAgLy8gU2Vjb25kIGZpbmdlciB5XG4gIH07XG5cbiAgdmFyIG1vdXNlX21vdmUgPSBmdW5jdGlvbihldmVudCkge1xuXG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcblxuICAgIHZhciB4ID0gTWF0aC5mbG9vcihldmVudC5jbGllbnRYID49IDAgPyBldmVudC5jbGllbnRYIDogZXZlbnQudG91Y2hlc1swXS5wYWdlWCk7XG4gICAgdmFyIHkgPSBNYXRoLmZsb29yKGV2ZW50LmNsaWVudFkgPj0gMCA/IGV2ZW50LmNsaWVudFkgOiBldmVudC50b3VjaGVzWzBdLnBhZ2VZKTtcbiAgICB4IC09IGRvbV9vZmZzZXRfbGVmdDtcbiAgICB5IC09IGRvbV9vZmZzZXRfdG9wO1xuXG4gICAgdG91Y2hlcy5jbGljayA9IGZhbHNlO1xuXG4gICAgaWYgKCF0b3VjaGVzLmlzX3RvdWNoaW5nKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgaWYgKGV2ZW50LnRvdWNoZXMgJiYgZXZlbnQudG91Y2hlcy5sZW5ndGggPiAxKSB7XG5cbiAgICAgIHZhciBjZnggPSB4OyAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ3VycmVudCBmcmlzdCAgZmluZ2VyIHhcbiAgICAgIHZhciBjZnkgPSB5OyAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ3VycmVudCBmaXJzdCAgZmluZ2VyIHlcbiAgICAgIHZhciBjc3ggPSBldmVudC50b3VjaGVzWzFdLnBhZ2VYOyAgICAgLy8gQ3VycmVudCBzZWNvbmQgZmluZ2VyIHhcbiAgICAgIHZhciBjc3kgPSBldmVudC50b3VjaGVzWzFdLnBhZ2VZOyAgICAgLy8gQ3VycmVudCBzZWNvbmQgZmluZ2VyIHlcblxuICAgICAgdmFyIGRpcyA9IGRpc3RhbmNlMkQodG91Y2hlcy5meCwgdG91Y2hlcy5meSwgdG91Y2hlcy5zeCwgdG91Y2hlcy5zeSkgLSBkaXN0YW5jZTJEKGNmeCwgY2Z5LCBjc3gsIGNzeSk7XG5cbiAgICAgIHZhciByYXRpbyA9IDAuMTI7XG4gICAgICBzbm90LnNldF9mb3Yoc25vdC5mb3YgKyBkaXMgKiByYXRpbyk7XG5cbiAgICAgIHRvdWNoZXMuZnggPSBjZng7XG4gICAgICB0b3VjaGVzLmZ5ID0gY2Z5O1xuICAgICAgdG91Y2hlcy5zeCA9IGNzeDtcbiAgICAgIHRvdWNoZXMuc3kgPSBjc3k7XG5cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICB2YXIgcmF0aW8gPSBzbm90Lm1vdXNlX3NlbnNpdGl2aXR5O1xuXG4gICAgc25vdC5kZXN0X3J5ID0gc25vdC5kZXN0X3J5ICsgKHRvdWNoZXMuZnggLSB4KSAqIHJhdGlvO1xuICAgIHNub3QuZGVzdF9yeCA9IHNub3QuZGVzdF9yeCAtICh0b3VjaGVzLmZ5IC0geSkgKiByYXRpbztcblxuICAgIHRvdWNoZXMuZnggPSB4O1xuICAgIHRvdWNoZXMuZnkgPSB5O1xuXG4gICAgc25vdC5kZXN0X3J4ID0gc25vdC5kZXN0X3J4ID4gOTAgPyA5MCA6IHNub3QuZGVzdF9yeDtcbiAgICBzbm90LmRlc3RfcnggPSBzbm90LmRlc3RfcnggPCAtOTAgPyAtOTAgOiBzbm90LmRlc3Rfcng7XG5cbiAgfTtcblxuICB2YXIgbW91c2VfZG93biA9IGZ1bmN0aW9uIChldmVudCkge1xuXG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcblxuICAgIHZhciB4ID0gZmxvb3IoZXZlbnQuY2xpZW50WCA+PSAwID8gZXZlbnQuY2xpZW50WCA6IGV2ZW50LnRvdWNoZXNbMF0uY2xpZW50WCk7XG4gICAgdmFyIHkgPSBmbG9vcihldmVudC5jbGllbnRZID49IDAgPyBldmVudC5jbGllbnRZIDogZXZlbnQudG91Y2hlc1swXS5jbGllbnRZKTtcbiAgICB4IC09IGRvbV9vZmZzZXRfbGVmdDtcbiAgICB5IC09IGRvbV9vZmZzZXRfdG9wO1xuXG4gICAgdG91Y2hlcy5tb3VzZV9kb3duX3ggPSB4O1xuICAgIHRvdWNoZXMubW91c2VfZG93bl95ID0geTtcbiAgICB0b3VjaGVzLmZ4ID0geDtcbiAgICB0b3VjaGVzLmZ5ID0geTtcbiAgICB0b3VjaGVzLmNsaWNrID0gdHJ1ZTtcblxuICAgIGlmIChldmVudC50b3VjaGVzICYmIGV2ZW50LnRvdWNoZXMubGVuZ3RoID4gMSkge1xuXG4gICAgICB0b3VjaGVzLnN4ID0gZXZlbnQudG91Y2hlc1sxXS5wYWdlWDtcbiAgICAgIHRvdWNoZXMuc3kgPSBldmVudC50b3VjaGVzWzFdLnBhZ2VZO1xuXG4gICAgfVxuXG4gICAgdG91Y2hlcy5pc190b3VjaGluZyA9IHRydWU7XG4gIH1cblxuICB2YXIgbW91c2Vfd2hlZWwgPSBmdW5jdGlvbiAoZXZlbnQpIHtcblxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICB2YXIgb2Zmc2V0ID0gZXZlbnQuZGVsdGFZO1xuICAgIHNub3Quc2V0X2Zvdihzbm90LmZvdiArIG9mZnNldCAqIDAuMDYpO1xuXG4gIH1cblxuICB2YXIgbW91c2VfdXAgPSBmdW5jdGlvbihldmVudCkge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICB2YXIgeCA9IGZsb29yKGV2ZW50LmNsaWVudFggPj0gMCA/IGV2ZW50LmNsaWVudFggOiBldmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWCk7XG4gICAgdmFyIHkgPSBmbG9vcihldmVudC5jbGllbnRZID49IDAgPyBldmVudC5jbGllbnRZIDogZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVkpO1xuICAgIHggLT0gZG9tX29mZnNldF9sZWZ0O1xuICAgIHkgLT0gZG9tX29mZnNldF90b3A7XG5cbiAgICAvL1NjcmVlbiBjb29yZGluYXRlIHRvIFNwaGVyZSAzZCBjb29yZGluYXRlXG4gICAgaWYgKGRpc3RhbmNlMkQodG91Y2hlcy5tb3VzZV9kb3duX3gsIHRvdWNoZXMubW91c2VfZG93bl95LCB4LCB5KSA8IDUpIHtcbiAgICAgIHNub3QuY29udHJvbHMubW91c2VfY2xpY2soeCwgeSk7XG4gICAgfVxuICAgIHRvdWNoZXMuaXNfdG91Y2hpbmcgPSBmYWxzZTtcbiAgfVxuXG59KHdpbmRvdyk7XG4iXX0=
